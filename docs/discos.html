<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>discos API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#MeshManager">MeshManager</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MeshManager.__init__">MeshManager</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshManager.mesh">mesh</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshManager.original_mesh">original_mesh</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshManager.bounds">bounds</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshManager.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#MeshManager.stats">stats</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.log">log</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.load_mesh">load_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.copy">copy</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.to_trimesh">to_trimesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.get_z_range">get_z_range</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.center_mesh">center_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.scale_mesh">scale_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.align_with_z_axis">align_with_z_axis</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.align_furthest_points_with_z">align_furthest_points_with_z</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.analyze_mesh">analyze_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.print_mesh_analysis">print_mesh_analysis</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.repair_mesh">repair_mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.repair_mesh_pymeshfix">repair_mesh_pymeshfix</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.visualize_mesh_3d">visualize_mesh_3d</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.visualize_mesh_slice_interactive">visualize_mesh_slice_interactive</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.visualize_mesh_slice_grid">visualize_mesh_slice_grid</a>
                        </li>
                        <li>
                                <a class="function" href="#MeshManager.slice_mesh_by_z">slice_mesh_by_z</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CrossSection">CrossSection</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CrossSection.__init__">CrossSection</a>
                        </li>
                        <li>
                                <a class="variable" href="#CrossSection.z">z</a>
                        </li>
                        <li>
                                <a class="variable" href="#CrossSection.slice_index">slice_index</a>
                        </li>
                        <li>
                                <a class="variable" href="#CrossSection.polygons">polygons</a>
                        </li>
                        <li>
                                <a class="variable" href="#CrossSection.junction_ids">junction_ids</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Segment">Segment</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Segment.__init__">Segment</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.slice_index">slice_index</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.z_lower">z_lower</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.z_upper">z_upper</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.volume">volume</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.surface_area">surface_area</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.lower_junction_ids">lower_junction_ids</a>
                        </li>
                        <li>
                                <a class="variable" href="#Segment.upper_junction_ids">upper_junction_ids</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SkeletonGraph">SkeletonGraph</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SkeletonGraph.G">G</a>
                        </li>
                        <li>
                                <a class="variable" href="#SkeletonGraph.junctions">junctions</a>
                        </li>
                        <li>
                                <a class="variable" href="#SkeletonGraph.cross_sections">cross_sections</a>
                        </li>
                        <li>
                                <a class="variable" href="#SkeletonGraph.segments">segments</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.add_junction">add_junction</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.add_segment_edges">add_segment_edges</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.to_networkx">to_networkx</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.draw">draw</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.plot_cross_section">plot_cross_section</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.plot_all_cross_sections">plot_all_cross_sections</a>
                        </li>
                        <li>
                                <a class="function" href="#SkeletonGraph.to_swc">to_swc</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#skeletonize">skeletonize</a>
            </li>
            <li>
                    <a class="function" href="#create_cylinder_mesh">create_cylinder_mesh</a>
            </li>
            <li>
                    <a class="function" href="#create_torus_mesh">create_torus_mesh</a>
            </li>
            <li>
                    <a class="function" href="#create_branching_mesh">create_branching_mesh</a>
            </li>
            <li>
                    <a class="function" href="#create_demo_neuron_mesh">create_demo_neuron_mesh</a>
            </li>
            <li>
                    <a class="function" href="#save_demo_meshes">save_demo_meshes</a>
            </li>
            <li>
                    <a class="function" href="#data_path">data_path</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
discos    </h1>

                        <div class="docstring"><p>DISCOS: DISrete COllinear Skeletonization</p>

<p>A Python package for 3D mesh manipulation and skeletonization of complex neuronal morphologies.
Provides tools for mesh processing, segmentation, and conversion to SWC format using discrete
collinear skeletonization algorithms.</p>
</div>

                        <input id="mod-discos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-discos-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">DISCOS: DISrete COllinear Skeletonization</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">A Python package for 3D mesh manipulation and skeletonization of complex neuronal morphologies.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">Provides tools for mesh processing, segmentation, and conversion to SWC format using discrete</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">collinear skeletonization algorithms.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.0&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Jordan M. R. Fox&quot;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;jordanmrfox@gmail.com&quot;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="c1"># Demo mesh functions from demos module</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.demo</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">create_branching_mesh</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="n">create_cylinder_mesh</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="n">create_demo_neuron_mesh</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="n">create_torus_mesh</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="n">save_demo_meshes</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="p">)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="c1"># Mesh functions (primary 3D representation)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.mesh</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeshManager</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="c1"># Utility functions</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">data_path</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="c1"># Skeletonization functions</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.skeleton</span><span class="w"> </span><span class="kn">import</span> <span class="n">CrossSection</span><span class="p">,</span> <span class="n">Segment</span><span class="p">,</span> <span class="n">SkeletonGraph</span><span class="p">,</span> <span class="n">skeletonize</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="c1"># Mesh processing (primary 3D representation)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;MeshManager&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="c1"># Skeletonization functions</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;CrossSection&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;Segment&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;SkeletonGraph&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;skeletonize&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="c1"># Demo mesh functions</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;create_cylinder_mesh&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;create_torus_mesh&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;create_branching_mesh&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a>    <span class="s2">&quot;create_demo_neuron_mesh&quot;</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>    <span class="s2">&quot;save_demo_meshes&quot;</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a>    <span class="c1"># Path functions</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>    <span class="s2">&quot;data_path&quot;</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="MeshManager">
                            <input id="MeshManager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MeshManager</span>:

                <label class="view-source-button" for="MeshManager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager-56"><a href="#MeshManager-56"><span class="linenos">  56</span></a><span class="k">class</span><span class="w"> </span><span class="nc">MeshManager</span><span class="p">:</span>
</span><span id="MeshManager-57"><a href="#MeshManager-57"><span class="linenos">  57</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-58"><a href="#MeshManager-58"><span class="linenos">  58</span></a><span class="sd">    Unified mesh class handling loading, processing, and analysis.</span>
</span><span id="MeshManager-59"><a href="#MeshManager-59"><span class="linenos">  59</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MeshManager-60"><a href="#MeshManager-60"><span class="linenos">  60</span></a>
</span><span id="MeshManager-61"><a href="#MeshManager-61"><span class="linenos">  61</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="MeshManager-62"><a href="#MeshManager-62"><span class="linenos">  62</span></a>        <span class="c1"># Core mesh attributes</span>
</span><span id="MeshManager-63"><a href="#MeshManager-63"><span class="linenos">  63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager-64"><a href="#MeshManager-64"><span class="linenos">  64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager-65"><a href="#MeshManager-65"><span class="linenos">  65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-66"><a href="#MeshManager-66"><span class="linenos">  66</span></a>
</span><span id="MeshManager-67"><a href="#MeshManager-67"><span class="linenos">  67</span></a>        <span class="c1"># Attributes</span>
</span><span id="MeshManager-68"><a href="#MeshManager-68"><span class="linenos">  68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="MeshManager-69"><a href="#MeshManager-69"><span class="linenos">  69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MeshManager-70"><a href="#MeshManager-70"><span class="linenos">  70</span></a>            <span class="s2">&quot;processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-71"><a href="#MeshManager-71"><span class="linenos">  71</span></a>            <span class="s2">&quot;successful&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-72"><a href="#MeshManager-72"><span class="linenos">  72</span></a>            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-73"><a href="#MeshManager-73"><span class="linenos">  73</span></a>            <span class="s2">&quot;volume_fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-74"><a href="#MeshManager-74"><span class="linenos">  74</span></a>            <span class="s2">&quot;watertight_fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-75"><a href="#MeshManager-75"><span class="linenos">  75</span></a>            <span class="s2">&quot;degenerate_removed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-76"><a href="#MeshManager-76"><span class="linenos">  76</span></a>        <span class="p">}</span>
</span><span id="MeshManager-77"><a href="#MeshManager-77"><span class="linenos">  77</span></a>
</span><span id="MeshManager-78"><a href="#MeshManager-78"><span class="linenos">  78</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
</span><span id="MeshManager-79"><a href="#MeshManager-79"><span class="linenos">  79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compatibility shim: delegate to module logger respecting self.verbose.</span>
</span><span id="MeshManager-80"><a href="#MeshManager-80"><span class="linenos">  80</span></a>
</span><span id="MeshManager-81"><a href="#MeshManager-81"><span class="linenos">  81</span></a><span class="sd">        Levels: INFO, SUCCESS (maps to INFO), WARNING, ERROR, PROCESSING (maps to INFO)</span>
</span><span id="MeshManager-82"><a href="#MeshManager-82"><span class="linenos">  82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-83"><a href="#MeshManager-83"><span class="linenos">  83</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MeshManager-84"><a href="#MeshManager-84"><span class="linenos">  84</span></a>            <span class="k">return</span>
</span><span id="MeshManager-85"><a href="#MeshManager-85"><span class="linenos">  85</span></a>        <span class="n">lvl</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="MeshManager-86"><a href="#MeshManager-86"><span class="linenos">  86</span></a>        <span class="k">if</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;PROCESSING&quot;</span><span class="p">):</span>
</span><span id="MeshManager-87"><a href="#MeshManager-87"><span class="linenos">  87</span></a>            <span class="n">lvl</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
</span><span id="MeshManager-88"><a href="#MeshManager-88"><span class="linenos">  88</span></a>        <span class="k">if</span> <span class="n">lvl</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span><span class="p">:</span>
</span><span id="MeshManager-89"><a href="#MeshManager-89"><span class="linenos">  89</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager-90"><a href="#MeshManager-90"><span class="linenos">  90</span></a>        <span class="k">elif</span> <span class="n">lvl</span> <span class="o">==</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span>
</span><span id="MeshManager-91"><a href="#MeshManager-91"><span class="linenos">  91</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager-92"><a href="#MeshManager-92"><span class="linenos">  92</span></a>        <span class="k">elif</span> <span class="n">lvl</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
</span><span id="MeshManager-93"><a href="#MeshManager-93"><span class="linenos">  93</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager-94"><a href="#MeshManager-94"><span class="linenos">  94</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-95"><a href="#MeshManager-95"><span class="linenos">  95</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager-96"><a href="#MeshManager-96"><span class="linenos">  96</span></a>
</span><span id="MeshManager-97"><a href="#MeshManager-97"><span class="linenos">  97</span></a>    <span class="c1"># =================================================================</span>
</span><span id="MeshManager-98"><a href="#MeshManager-98"><span class="linenos">  98</span></a>    <span class="c1"># MESH LOADING AND BASIC OPERATIONS</span>
</span><span id="MeshManager-99"><a href="#MeshManager-99"><span class="linenos">  99</span></a>    <span class="c1"># =================================================================</span>
</span><span id="MeshManager-100"><a href="#MeshManager-100"><span class="linenos"> 100</span></a>
</span><span id="MeshManager-101"><a href="#MeshManager-101"><span class="linenos"> 101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_mesh</span><span class="p">(</span>
</span><span id="MeshManager-102"><a href="#MeshManager-102"><span class="linenos"> 102</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-103"><a href="#MeshManager-103"><span class="linenos"> 103</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-104"><a href="#MeshManager-104"><span class="linenos"> 104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-105"><a href="#MeshManager-105"><span class="linenos"> 105</span></a><span class="sd">        Load a mesh from file.</span>
</span><span id="MeshManager-106"><a href="#MeshManager-106"><span class="linenos"> 106</span></a>
</span><span id="MeshManager-107"><a href="#MeshManager-107"><span class="linenos"> 107</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-108"><a href="#MeshManager-108"><span class="linenos"> 108</span></a><span class="sd">            filepath: Path to mesh file</span>
</span><span id="MeshManager-109"><a href="#MeshManager-109"><span class="linenos"> 109</span></a><span class="sd">            file_format: Optional format specification (auto-detected if None)</span>
</span><span id="MeshManager-110"><a href="#MeshManager-110"><span class="linenos"> 110</span></a>
</span><span id="MeshManager-111"><a href="#MeshManager-111"><span class="linenos"> 111</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-112"><a href="#MeshManager-112"><span class="linenos"> 112</span></a><span class="sd">            Loaded trimesh object</span>
</span><span id="MeshManager-113"><a href="#MeshManager-113"><span class="linenos"> 113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-114"><a href="#MeshManager-114"><span class="linenos"> 114</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-115"><a href="#MeshManager-115"><span class="linenos"> 115</span></a>            <span class="k">if</span> <span class="n">file_format</span><span class="p">:</span>
</span><span id="MeshManager-116"><a href="#MeshManager-116"><span class="linenos"> 116</span></a>                <span class="n">mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_format</span><span class="p">)</span>
</span><span id="MeshManager-117"><a href="#MeshManager-117"><span class="linenos"> 117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-118"><a href="#MeshManager-118"><span class="linenos"> 118</span></a>                <span class="n">mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</span><span id="MeshManager-119"><a href="#MeshManager-119"><span class="linenos"> 119</span></a>
</span><span id="MeshManager-120"><a href="#MeshManager-120"><span class="linenos"> 120</span></a>            <span class="c1"># Ensure we have a single mesh</span>
</span><span id="MeshManager-121"><a href="#MeshManager-121"><span class="linenos"> 121</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Scene</span><span class="p">):</span>
</span><span id="MeshManager-122"><a href="#MeshManager-122"><span class="linenos"> 122</span></a>                <span class="c1"># If it&#39;s a scene, try to get the first geometry</span>
</span><span id="MeshManager-123"><a href="#MeshManager-123"><span class="linenos"> 123</span></a>                <span class="n">geometries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="MeshManager-124"><a href="#MeshManager-124"><span class="linenos"> 124</span></a>                <span class="k">if</span> <span class="n">geometries</span><span class="p">:</span>
</span><span id="MeshManager-125"><a href="#MeshManager-125"><span class="linenos"> 125</span></a>                    <span class="n">mesh</span> <span class="o">=</span> <span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MeshManager-126"><a href="#MeshManager-126"><span class="linenos"> 126</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-127"><a href="#MeshManager-127"><span class="linenos"> 127</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No geometry found in mesh scene&quot;</span><span class="p">)</span>
</span><span id="MeshManager-128"><a href="#MeshManager-128"><span class="linenos"> 128</span></a>
</span><span id="MeshManager-129"><a href="#MeshManager-129"><span class="linenos"> 129</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager-130"><a href="#MeshManager-130"><span class="linenos"> 130</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded object is not a mesh: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-131"><a href="#MeshManager-131"><span class="linenos"> 131</span></a>
</span><span id="MeshManager-132"><a href="#MeshManager-132"><span class="linenos"> 132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager-133"><a href="#MeshManager-133"><span class="linenos"> 133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="MeshManager-134"><a href="#MeshManager-134"><span class="linenos"> 134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-135"><a href="#MeshManager-135"><span class="linenos"> 135</span></a>
</span><span id="MeshManager-136"><a href="#MeshManager-136"><span class="linenos"> 136</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MeshManager-137"><a href="#MeshManager-137"><span class="linenos"> 137</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MeshManager-138"><a href="#MeshManager-138"><span class="linenos"> 138</span></a>                    <span class="s2">&quot;Loaded mesh: </span><span class="si">%d</span><span class="s2"> vertices, </span><span class="si">%d</span><span class="s2"> faces&quot;</span><span class="p">,</span>
</span><span id="MeshManager-139"><a href="#MeshManager-139"><span class="linenos"> 139</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">),</span>
</span><span id="MeshManager-140"><a href="#MeshManager-140"><span class="linenos"> 140</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span>
</span><span id="MeshManager-141"><a href="#MeshManager-141"><span class="linenos"> 141</span></a>                <span class="p">)</span>
</span><span id="MeshManager-142"><a href="#MeshManager-142"><span class="linenos"> 142</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Bounds: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</span><span id="MeshManager-143"><a href="#MeshManager-143"><span class="linenos"> 143</span></a>
</span><span id="MeshManager-144"><a href="#MeshManager-144"><span class="linenos"> 144</span></a>            <span class="k">return</span> <span class="n">mesh</span>
</span><span id="MeshManager-145"><a href="#MeshManager-145"><span class="linenos"> 145</span></a>
</span><span id="MeshManager-146"><a href="#MeshManager-146"><span class="linenos"> 146</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-147"><a href="#MeshManager-147"><span class="linenos"> 147</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load mesh from </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-148"><a href="#MeshManager-148"><span class="linenos"> 148</span></a>
</span><span id="MeshManager-149"><a href="#MeshManager-149"><span class="linenos"> 149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s2">&quot;obj&quot;</span><span class="p">):</span>
</span><span id="MeshManager-150"><a href="#MeshManager-150"><span class="linenos"> 150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_format</span><span class="p">)</span>
</span><span id="MeshManager-151"><a href="#MeshManager-151"><span class="linenos"> 151</span></a>
</span><span id="MeshManager-152"><a href="#MeshManager-152"><span class="linenos"> 152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MeshManager-153"><a href="#MeshManager-153"><span class="linenos"> 153</span></a>        <span class="k">return</span> <span class="n">MeshManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="MeshManager-154"><a href="#MeshManager-154"><span class="linenos"> 154</span></a>
</span><span id="MeshManager-155"><a href="#MeshManager-155"><span class="linenos"> 155</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_trimesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MeshManager-156"><a href="#MeshManager-156"><span class="linenos"> 156</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-157"><a href="#MeshManager-157"><span class="linenos"> 157</span></a>
</span><span id="MeshManager-158"><a href="#MeshManager-158"><span class="linenos"> 158</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
</span><span id="MeshManager-159"><a href="#MeshManager-159"><span class="linenos"> 159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute mesh bounding box.&quot;&quot;&quot;</span>
</span><span id="MeshManager-160"><a href="#MeshManager-160"><span class="linenos"> 160</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-161"><a href="#MeshManager-161"><span class="linenos"> 161</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-162"><a href="#MeshManager-162"><span class="linenos"> 162</span></a>
</span><span id="MeshManager-163"><a href="#MeshManager-163"><span class="linenos"> 163</span></a>        <span class="n">min_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MeshManager-164"><a href="#MeshManager-164"><span class="linenos"> 164</span></a>        <span class="n">max_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MeshManager-165"><a href="#MeshManager-165"><span class="linenos"> 165</span></a>
</span><span id="MeshManager-166"><a href="#MeshManager-166"><span class="linenos"> 166</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MeshManager-167"><a href="#MeshManager-167"><span class="linenos"> 167</span></a>            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">min_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="MeshManager-168"><a href="#MeshManager-168"><span class="linenos"> 168</span></a>            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">min_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">max_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="MeshManager-169"><a href="#MeshManager-169"><span class="linenos"> 169</span></a>            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">min_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="MeshManager-170"><a href="#MeshManager-170"><span class="linenos"> 170</span></a>        <span class="p">}</span>
</span><span id="MeshManager-171"><a href="#MeshManager-171"><span class="linenos"> 171</span></a>
</span><span id="MeshManager-172"><a href="#MeshManager-172"><span class="linenos"> 172</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_z_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="MeshManager-173"><a href="#MeshManager-173"><span class="linenos"> 173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the z-axis range of the mesh.&quot;&quot;&quot;</span>
</span><span id="MeshManager-174"><a href="#MeshManager-174"><span class="linenos"> 174</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-175"><a href="#MeshManager-175"><span class="linenos"> 175</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-176"><a href="#MeshManager-176"><span class="linenos"> 176</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
</span><span id="MeshManager-177"><a href="#MeshManager-177"><span class="linenos"> 177</span></a>
</span><span id="MeshManager-178"><a href="#MeshManager-178"><span class="linenos"> 178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">center_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;centroid&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-179"><a href="#MeshManager-179"><span class="linenos"> 179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-180"><a href="#MeshManager-180"><span class="linenos"> 180</span></a><span class="sd">        Center the mesh.</span>
</span><span id="MeshManager-181"><a href="#MeshManager-181"><span class="linenos"> 181</span></a>
</span><span id="MeshManager-182"><a href="#MeshManager-182"><span class="linenos"> 182</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-183"><a href="#MeshManager-183"><span class="linenos"> 183</span></a><span class="sd">            center_on: &#39;centroid&#39;, &#39;bounds_center&#39;, or &#39;origin&#39;</span>
</span><span id="MeshManager-184"><a href="#MeshManager-184"><span class="linenos"> 184</span></a>
</span><span id="MeshManager-185"><a href="#MeshManager-185"><span class="linenos"> 185</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-186"><a href="#MeshManager-186"><span class="linenos"> 186</span></a><span class="sd">            Centered mesh</span>
</span><span id="MeshManager-187"><a href="#MeshManager-187"><span class="linenos"> 187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-188"><a href="#MeshManager-188"><span class="linenos"> 188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-189"><a href="#MeshManager-189"><span class="linenos"> 189</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-190"><a href="#MeshManager-190"><span class="linenos"> 190</span></a>
</span><span id="MeshManager-191"><a href="#MeshManager-191"><span class="linenos"> 191</span></a>        <span class="k">if</span> <span class="n">center_on</span> <span class="o">==</span> <span class="s2">&quot;centroid&quot;</span><span class="p">:</span>
</span><span id="MeshManager-192"><a href="#MeshManager-192"><span class="linenos"> 192</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager-193"><a href="#MeshManager-193"><span class="linenos"> 193</span></a>        <span class="k">elif</span> <span class="n">center_on</span> <span class="o">==</span> <span class="s2">&quot;bounds_center&quot;</span><span class="p">:</span>
</span><span id="MeshManager-194"><a href="#MeshManager-194"><span class="linenos"> 194</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MeshManager-195"><a href="#MeshManager-195"><span class="linenos"> 195</span></a>        <span class="k">elif</span> <span class="n">center_on</span> <span class="o">==</span> <span class="s2">&quot;origin&quot;</span><span class="p">:</span>
</span><span id="MeshManager-196"><a href="#MeshManager-196"><span class="linenos"> 196</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="MeshManager-197"><a href="#MeshManager-197"><span class="linenos"> 197</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-198"><a href="#MeshManager-198"><span class="linenos"> 198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown center_on option: </span><span class="si">{</span><span class="n">center_on</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-199"><a href="#MeshManager-199"><span class="linenos"> 199</span></a>
</span><span id="MeshManager-200"><a href="#MeshManager-200"><span class="linenos"> 200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-=</span> <span class="n">center</span>
</span><span id="MeshManager-201"><a href="#MeshManager-201"><span class="linenos"> 201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-202"><a href="#MeshManager-202"><span class="linenos"> 202</span></a>
</span><span id="MeshManager-203"><a href="#MeshManager-203"><span class="linenos"> 203</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-204"><a href="#MeshManager-204"><span class="linenos"> 204</span></a>
</span><span id="MeshManager-205"><a href="#MeshManager-205"><span class="linenos"> 205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-206"><a href="#MeshManager-206"><span class="linenos"> 206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-207"><a href="#MeshManager-207"><span class="linenos"> 207</span></a><span class="sd">        Scale the mesh uniformly.</span>
</span><span id="MeshManager-208"><a href="#MeshManager-208"><span class="linenos"> 208</span></a>
</span><span id="MeshManager-209"><a href="#MeshManager-209"><span class="linenos"> 209</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-210"><a href="#MeshManager-210"><span class="linenos"> 210</span></a><span class="sd">            scale_factor: Scaling factor</span>
</span><span id="MeshManager-211"><a href="#MeshManager-211"><span class="linenos"> 211</span></a>
</span><span id="MeshManager-212"><a href="#MeshManager-212"><span class="linenos"> 212</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-213"><a href="#MeshManager-213"><span class="linenos"> 213</span></a><span class="sd">            Scaled mesh</span>
</span><span id="MeshManager-214"><a href="#MeshManager-214"><span class="linenos"> 214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-215"><a href="#MeshManager-215"><span class="linenos"> 215</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-216"><a href="#MeshManager-216"><span class="linenos"> 216</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-217"><a href="#MeshManager-217"><span class="linenos"> 217</span></a>
</span><span id="MeshManager-218"><a href="#MeshManager-218"><span class="linenos"> 218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">*=</span> <span class="n">scale_factor</span>
</span><span id="MeshManager-219"><a href="#MeshManager-219"><span class="linenos"> 219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-220"><a href="#MeshManager-220"><span class="linenos"> 220</span></a>
</span><span id="MeshManager-221"><a href="#MeshManager-221"><span class="linenos"> 221</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-222"><a href="#MeshManager-222"><span class="linenos"> 222</span></a>
</span><span id="MeshManager-223"><a href="#MeshManager-223"><span class="linenos"> 223</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">align_with_z_axis</span><span class="p">(</span>
</span><span id="MeshManager-224"><a href="#MeshManager-224"><span class="linenos"> 224</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">target_axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-225"><a href="#MeshManager-225"><span class="linenos"> 225</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-226"><a href="#MeshManager-226"><span class="linenos"> 226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-227"><a href="#MeshManager-227"><span class="linenos"> 227</span></a><span class="sd">        Align the mesh&#39;s principal axis with the z-axis.</span>
</span><span id="MeshManager-228"><a href="#MeshManager-228"><span class="linenos"> 228</span></a>
</span><span id="MeshManager-229"><a href="#MeshManager-229"><span class="linenos"> 229</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-230"><a href="#MeshManager-230"><span class="linenos"> 230</span></a><span class="sd">            target_axis: Target direction (default: [0, 0, 1])</span>
</span><span id="MeshManager-231"><a href="#MeshManager-231"><span class="linenos"> 231</span></a>
</span><span id="MeshManager-232"><a href="#MeshManager-232"><span class="linenos"> 232</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-233"><a href="#MeshManager-233"><span class="linenos"> 233</span></a><span class="sd">            Aligned mesh</span>
</span><span id="MeshManager-234"><a href="#MeshManager-234"><span class="linenos"> 234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-235"><a href="#MeshManager-235"><span class="linenos"> 235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-236"><a href="#MeshManager-236"><span class="linenos"> 236</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-237"><a href="#MeshManager-237"><span class="linenos"> 237</span></a>
</span><span id="MeshManager-238"><a href="#MeshManager-238"><span class="linenos"> 238</span></a>        <span class="k">if</span> <span class="n">target_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-239"><a href="#MeshManager-239"><span class="linenos"> 239</span></a>            <span class="n">target_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="MeshManager-240"><a href="#MeshManager-240"><span class="linenos"> 240</span></a>
</span><span id="MeshManager-241"><a href="#MeshManager-241"><span class="linenos"> 241</span></a>        <span class="c1"># Compute principal axis using PCA</span>
</span><span id="MeshManager-242"><a href="#MeshManager-242"><span class="linenos"> 242</span></a>        <span class="n">vertices_centered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager-243"><a href="#MeshManager-243"><span class="linenos"> 243</span></a>        <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">vertices_centered</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="MeshManager-244"><a href="#MeshManager-244"><span class="linenos"> 244</span></a>        <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
</span><span id="MeshManager-245"><a href="#MeshManager-245"><span class="linenos"> 245</span></a>
</span><span id="MeshManager-246"><a href="#MeshManager-246"><span class="linenos"> 246</span></a>        <span class="c1"># Principal axis is the eigenvector with largest eigenvalue</span>
</span><span id="MeshManager-247"><a href="#MeshManager-247"><span class="linenos"> 247</span></a>        <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)]</span>
</span><span id="MeshManager-248"><a href="#MeshManager-248"><span class="linenos"> 248</span></a>
</span><span id="MeshManager-249"><a href="#MeshManager-249"><span class="linenos"> 249</span></a>        <span class="c1"># Compute rotation to align principal axis with target</span>
</span><span id="MeshManager-250"><a href="#MeshManager-250"><span class="linenos"> 250</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_between_vectors</span><span class="p">(</span>
</span><span id="MeshManager-251"><a href="#MeshManager-251"><span class="linenos"> 251</span></a>            <span class="n">principal_axis</span><span class="p">,</span> <span class="n">target_axis</span>
</span><span id="MeshManager-252"><a href="#MeshManager-252"><span class="linenos"> 252</span></a>        <span class="p">)</span>
</span><span id="MeshManager-253"><a href="#MeshManager-253"><span class="linenos"> 253</span></a>
</span><span id="MeshManager-254"><a href="#MeshManager-254"><span class="linenos"> 254</span></a>        <span class="c1"># Apply rotation</span>
</span><span id="MeshManager-255"><a href="#MeshManager-255"><span class="linenos"> 255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager-256"><a href="#MeshManager-256"><span class="linenos"> 256</span></a>            <span class="n">rotation_matrix</span> <span class="o">@</span> <span class="n">vertices_centered</span><span class="o">.</span><span class="n">T</span>
</span><span id="MeshManager-257"><a href="#MeshManager-257"><span class="linenos"> 257</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager-258"><a href="#MeshManager-258"><span class="linenos"> 258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-259"><a href="#MeshManager-259"><span class="linenos"> 259</span></a>
</span><span id="MeshManager-260"><a href="#MeshManager-260"><span class="linenos"> 260</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-261"><a href="#MeshManager-261"><span class="linenos"> 261</span></a>
</span><span id="MeshManager-262"><a href="#MeshManager-262"><span class="linenos"> 262</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_rotation_matrix_between_vectors</span><span class="p">(</span>
</span><span id="MeshManager-263"><a href="#MeshManager-263"><span class="linenos"> 263</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">vec1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">vec2</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="MeshManager-264"><a href="#MeshManager-264"><span class="linenos"> 264</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="MeshManager-265"><a href="#MeshManager-265"><span class="linenos"> 265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute rotation matrix to rotate vec1 to vec2.&quot;&quot;&quot;</span>
</span><span id="MeshManager-266"><a href="#MeshManager-266"><span class="linenos"> 266</span></a>        <span class="c1"># Normalize vectors</span>
</span><span id="MeshManager-267"><a href="#MeshManager-267"><span class="linenos"> 267</span></a>        <span class="n">vec1</span> <span class="o">=</span> <span class="n">vec1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec1</span><span class="p">)</span>
</span><span id="MeshManager-268"><a href="#MeshManager-268"><span class="linenos"> 268</span></a>        <span class="n">vec2</span> <span class="o">=</span> <span class="n">vec2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vec2</span><span class="p">)</span>
</span><span id="MeshManager-269"><a href="#MeshManager-269"><span class="linenos"> 269</span></a>
</span><span id="MeshManager-270"><a href="#MeshManager-270"><span class="linenos"> 270</span></a>        <span class="c1"># Check if vectors are already aligned</span>
</span><span id="MeshManager-271"><a href="#MeshManager-271"><span class="linenos"> 271</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">):</span>
</span><span id="MeshManager-272"><a href="#MeshManager-272"><span class="linenos"> 272</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="MeshManager-273"><a href="#MeshManager-273"><span class="linenos"> 273</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="o">-</span><span class="n">vec2</span><span class="p">):</span>
</span><span id="MeshManager-274"><a href="#MeshManager-274"><span class="linenos"> 274</span></a>            <span class="c1"># 180-degree rotation - find perpendicular axis</span>
</span><span id="MeshManager-275"><a href="#MeshManager-275"><span class="linenos"> 275</span></a>            <span class="n">perp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vec1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.9</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="MeshManager-276"><a href="#MeshManager-276"><span class="linenos"> 276</span></a>            <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">perp</span><span class="p">)</span>
</span><span id="MeshManager-277"><a href="#MeshManager-277"><span class="linenos"> 277</span></a>            <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="MeshManager-278"><a href="#MeshManager-278"><span class="linenos"> 278</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rodrigues_rotation</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="MeshManager-279"><a href="#MeshManager-279"><span class="linenos"> 279</span></a>
</span><span id="MeshManager-280"><a href="#MeshManager-280"><span class="linenos"> 280</span></a>        <span class="c1"># General case using Rodrigues&#39; formula</span>
</span><span id="MeshManager-281"><a href="#MeshManager-281"><span class="linenos"> 281</span></a>        <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">)</span>
</span><span id="MeshManager-282"><a href="#MeshManager-282"><span class="linenos"> 282</span></a>        <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
</span><span id="MeshManager-283"><a href="#MeshManager-283"><span class="linenos"> 283</span></a>        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec1</span><span class="p">,</span> <span class="n">vec2</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MeshManager-284"><a href="#MeshManager-284"><span class="linenos"> 284</span></a>
</span><span id="MeshManager-285"><a href="#MeshManager-285"><span class="linenos"> 285</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rodrigues_rotation</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
</span><span id="MeshManager-286"><a href="#MeshManager-286"><span class="linenos"> 286</span></a>
</span><span id="MeshManager-287"><a href="#MeshManager-287"><span class="linenos"> 287</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_rodrigues_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="MeshManager-288"><a href="#MeshManager-288"><span class="linenos"> 288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rodrigues&#39; rotation formula.&quot;&quot;&quot;</span>
</span><span id="MeshManager-289"><a href="#MeshManager-289"><span class="linenos"> 289</span></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="MeshManager-290"><a href="#MeshManager-290"><span class="linenos"> 290</span></a>            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]]</span>
</span><span id="MeshManager-291"><a href="#MeshManager-291"><span class="linenos"> 291</span></a>        <span class="p">)</span>
</span><span id="MeshManager-292"><a href="#MeshManager-292"><span class="linenos"> 292</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">K</span> <span class="o">@</span> <span class="n">K</span>
</span><span id="MeshManager-293"><a href="#MeshManager-293"><span class="linenos"> 293</span></a>
</span><span id="MeshManager-294"><a href="#MeshManager-294"><span class="linenos"> 294</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_furthest_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
</span><span id="MeshManager-295"><a href="#MeshManager-295"><span class="linenos"> 295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return indices (i,j) of a furthest-apart pair and the vector points[j]-points[i].&quot;&quot;&quot;</span>
</span><span id="MeshManager-296"><a href="#MeshManager-296"><span class="linenos"> 296</span></a>        <span class="n">best_i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MeshManager-297"><a href="#MeshManager-297"><span class="linenos"> 297</span></a>        <span class="n">best_j</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="MeshManager-298"><a href="#MeshManager-298"><span class="linenos"> 298</span></a>        <span class="n">best_d2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="MeshManager-299"><a href="#MeshManager-299"><span class="linenos"> 299</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MeshManager-300"><a href="#MeshManager-300"><span class="linenos"> 300</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MeshManager-301"><a href="#MeshManager-301"><span class="linenos"> 301</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MeshManager-302"><a href="#MeshManager-302"><span class="linenos"> 302</span></a>            <span class="k">if</span> <span class="n">diffs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-303"><a href="#MeshManager-303"><span class="linenos"> 303</span></a>                <span class="k">continue</span>
</span><span id="MeshManager-304"><a href="#MeshManager-304"><span class="linenos"> 304</span></a>            <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">diffs</span><span class="p">)</span>
</span><span id="MeshManager-305"><a href="#MeshManager-305"><span class="linenos"> 305</span></a>            <span class="k">if</span> <span class="n">d2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-306"><a href="#MeshManager-306"><span class="linenos"> 306</span></a>                <span class="k">continue</span>
</span><span id="MeshManager-307"><a href="#MeshManager-307"><span class="linenos"> 307</span></a>            <span class="n">j_rel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">d2</span><span class="p">))</span>
</span><span id="MeshManager-308"><a href="#MeshManager-308"><span class="linenos"> 308</span></a>            <span class="k">if</span> <span class="n">d2</span><span class="p">[</span><span class="n">j_rel</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_d2</span><span class="p">:</span>
</span><span id="MeshManager-309"><a href="#MeshManager-309"><span class="linenos"> 309</span></a>                <span class="n">best_d2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">j_rel</span><span class="p">])</span>
</span><span id="MeshManager-310"><a href="#MeshManager-310"><span class="linenos"> 310</span></a>                <span class="n">best_i</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="MeshManager-311"><a href="#MeshManager-311"><span class="linenos"> 311</span></a>                <span class="n">best_j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j_rel</span>
</span><span id="MeshManager-312"><a href="#MeshManager-312"><span class="linenos"> 312</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">best_j</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">best_i</span><span class="p">]</span>
</span><span id="MeshManager-313"><a href="#MeshManager-313"><span class="linenos"> 313</span></a>        <span class="k">return</span> <span class="n">best_i</span><span class="p">,</span> <span class="n">best_j</span><span class="p">,</span> <span class="n">v</span>
</span><span id="MeshManager-314"><a href="#MeshManager-314"><span class="linenos"> 314</span></a>
</span><span id="MeshManager-315"><a href="#MeshManager-315"><span class="linenos"> 315</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">align_furthest_points_with_z</span><span class="p">(</span>
</span><span id="MeshManager-316"><a href="#MeshManager-316"><span class="linenos"> 316</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-317"><a href="#MeshManager-317"><span class="linenos"> 317</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="MeshManager-318"><a href="#MeshManager-318"><span class="linenos"> 318</span></a>        <span class="n">prefer_positive_z</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-319"><a href="#MeshManager-319"><span class="linenos"> 319</span></a>        <span class="n">use_convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-320"><a href="#MeshManager-320"><span class="linenos"> 320</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-321"><a href="#MeshManager-321"><span class="linenos"> 321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-322"><a href="#MeshManager-322"><span class="linenos"> 322</span></a><span class="sd">        Orient the mesh so the vector between the two furthest-apart points</span>
</span><span id="MeshManager-323"><a href="#MeshManager-323"><span class="linenos"> 323</span></a><span class="sd">        aligns with the +Z axis.</span>
</span><span id="MeshManager-324"><a href="#MeshManager-324"><span class="linenos"> 324</span></a>
</span><span id="MeshManager-325"><a href="#MeshManager-325"><span class="linenos"> 325</span></a><span class="sd">        This computes a diameter of the point set (by default using the convex</span>
</span><span id="MeshManager-326"><a href="#MeshManager-326"><span class="linenos"> 326</span></a><span class="sd">        hull vertices for efficiency), finds the pair of points with maximum</span>
</span><span id="MeshManager-327"><a href="#MeshManager-327"><span class="linenos"> 327</span></a><span class="sd">        Euclidean distance, and rotates the mesh about its centroid so that</span>
</span><span id="MeshManager-328"><a href="#MeshManager-328"><span class="linenos"> 328</span></a><span class="sd">        this vector is aligned with the positive z-axis.</span>
</span><span id="MeshManager-329"><a href="#MeshManager-329"><span class="linenos"> 329</span></a>
</span><span id="MeshManager-330"><a href="#MeshManager-330"><span class="linenos"> 330</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-331"><a href="#MeshManager-331"><span class="linenos"> 331</span></a><span class="sd">            prefer_positive_z: If True, align the diameter to +Z; otherwise the</span>
</span><span id="MeshManager-332"><a href="#MeshManager-332"><span class="linenos"> 332</span></a><span class="sd">                orientation to Z is arbitrary up to a sign.</span>
</span><span id="MeshManager-333"><a href="#MeshManager-333"><span class="linenos"> 333</span></a><span class="sd">            use_convex_hull: If True (default), compute the diameter over the</span>
</span><span id="MeshManager-334"><a href="#MeshManager-334"><span class="linenos"> 334</span></a><span class="sd">                convex hull vertices. This is typically much smaller than the</span>
</span><span id="MeshManager-335"><a href="#MeshManager-335"><span class="linenos"> 335</span></a><span class="sd">                full vertex set and yields the same diameter for convex sets.</span>
</span><span id="MeshManager-336"><a href="#MeshManager-336"><span class="linenos"> 336</span></a>
</span><span id="MeshManager-337"><a href="#MeshManager-337"><span class="linenos"> 337</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-338"><a href="#MeshManager-338"><span class="linenos"> 338</span></a><span class="sd">            The rotated mesh (also stored in self.mesh).</span>
</span><span id="MeshManager-339"><a href="#MeshManager-339"><span class="linenos"> 339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-340"><a href="#MeshManager-340"><span class="linenos"> 340</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-341"><a href="#MeshManager-341"><span class="linenos"> 341</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-342"><a href="#MeshManager-342"><span class="linenos"> 342</span></a>
</span><span id="MeshManager-343"><a href="#MeshManager-343"><span class="linenos"> 343</span></a>        <span class="c1"># Select candidate points</span>
</span><span id="MeshManager-344"><a href="#MeshManager-344"><span class="linenos"> 344</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-345"><a href="#MeshManager-345"><span class="linenos"> 345</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager-346"><a href="#MeshManager-346"><span class="linenos"> 346</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">convex_hull</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager-347"><a href="#MeshManager-347"><span class="linenos"> 347</span></a>                <span class="k">if</span> <span class="n">use_convex_hull</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;convex_hull&quot;</span><span class="p">)</span>
</span><span id="MeshManager-348"><a href="#MeshManager-348"><span class="linenos"> 348</span></a>                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager-349"><a href="#MeshManager-349"><span class="linenos"> 349</span></a>            <span class="p">)</span>
</span><span id="MeshManager-350"><a href="#MeshManager-350"><span class="linenos"> 350</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-351"><a href="#MeshManager-351"><span class="linenos"> 351</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager-352"><a href="#MeshManager-352"><span class="linenos"> 352</span></a>
</span><span id="MeshManager-353"><a href="#MeshManager-353"><span class="linenos"> 353</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="MeshManager-354"><a href="#MeshManager-354"><span class="linenos"> 354</span></a>        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="MeshManager-355"><a href="#MeshManager-355"><span class="linenos"> 355</span></a>            <span class="c1"># Nothing to do</span>
</span><span id="MeshManager-356"><a href="#MeshManager-356"><span class="linenos"> 356</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-357"><a href="#MeshManager-357"><span class="linenos"> 357</span></a>
</span><span id="MeshManager-358"><a href="#MeshManager-358"><span class="linenos"> 358</span></a>        <span class="c1"># Find furthest pair using a vectorized per-anchor pass (O(n^2) time, O(n) mem)</span>
</span><span id="MeshManager-359"><a href="#MeshManager-359"><span class="linenos"> 359</span></a>        <span class="n">best_i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MeshManager-360"><a href="#MeshManager-360"><span class="linenos"> 360</span></a>        <span class="n">best_j</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MeshManager-361"><a href="#MeshManager-361"><span class="linenos"> 361</span></a>        <span class="n">best_d2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="MeshManager-362"><a href="#MeshManager-362"><span class="linenos"> 362</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MeshManager-363"><a href="#MeshManager-363"><span class="linenos"> 363</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MeshManager-364"><a href="#MeshManager-364"><span class="linenos"> 364</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MeshManager-365"><a href="#MeshManager-365"><span class="linenos"> 365</span></a>            <span class="k">if</span> <span class="n">diffs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-366"><a href="#MeshManager-366"><span class="linenos"> 366</span></a>                <span class="k">continue</span>
</span><span id="MeshManager-367"><a href="#MeshManager-367"><span class="linenos"> 367</span></a>            <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">diffs</span><span class="p">)</span>
</span><span id="MeshManager-368"><a href="#MeshManager-368"><span class="linenos"> 368</span></a>            <span class="n">j_rel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">d2</span><span class="p">))</span>
</span><span id="MeshManager-369"><a href="#MeshManager-369"><span class="linenos"> 369</span></a>            <span class="k">if</span> <span class="n">d2</span><span class="p">[</span><span class="n">j_rel</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_d2</span><span class="p">:</span>
</span><span id="MeshManager-370"><a href="#MeshManager-370"><span class="linenos"> 370</span></a>                <span class="n">best_d2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">j_rel</span><span class="p">])</span>
</span><span id="MeshManager-371"><a href="#MeshManager-371"><span class="linenos"> 371</span></a>                <span class="n">best_i</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="MeshManager-372"><a href="#MeshManager-372"><span class="linenos"> 372</span></a>                <span class="n">best_j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j_rel</span>
</span><span id="MeshManager-373"><a href="#MeshManager-373"><span class="linenos"> 373</span></a>
</span><span id="MeshManager-374"><a href="#MeshManager-374"><span class="linenos"> 374</span></a>        <span class="n">p1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">best_i</span><span class="p">]</span>
</span><span id="MeshManager-375"><a href="#MeshManager-375"><span class="linenos"> 375</span></a>        <span class="n">p2</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">best_j</span><span class="p">]</span>
</span><span id="MeshManager-376"><a href="#MeshManager-376"><span class="linenos"> 376</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
</span><span id="MeshManager-377"><a href="#MeshManager-377"><span class="linenos"> 377</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="MeshManager-378"><a href="#MeshManager-378"><span class="linenos"> 378</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span> <span class="ow">or</span> <span class="n">norm</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
</span><span id="MeshManager-379"><a href="#MeshManager-379"><span class="linenos"> 379</span></a>            <span class="c1"># Degenerate case; nothing to rotate</span>
</span><span id="MeshManager-380"><a href="#MeshManager-380"><span class="linenos"> 380</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-381"><a href="#MeshManager-381"><span class="linenos"> 381</span></a>
</span><span id="MeshManager-382"><a href="#MeshManager-382"><span class="linenos"> 382</span></a>        <span class="k">if</span> <span class="n">prefer_positive_z</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-383"><a href="#MeshManager-383"><span class="linenos"> 383</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span>
</span><span id="MeshManager-384"><a href="#MeshManager-384"><span class="linenos"> 384</span></a>
</span><span id="MeshManager-385"><a href="#MeshManager-385"><span class="linenos"> 385</span></a>        <span class="c1"># Compute rotation from v to +Z</span>
</span><span id="MeshManager-386"><a href="#MeshManager-386"><span class="linenos"> 386</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="MeshManager-387"><a href="#MeshManager-387"><span class="linenos"> 387</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_between_vectors</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MeshManager-388"><a href="#MeshManager-388"><span class="linenos"> 388</span></a>
</span><span id="MeshManager-389"><a href="#MeshManager-389"><span class="linenos"> 389</span></a>        <span class="c1"># Rotate about centroid to preserve position</span>
</span><span id="MeshManager-390"><a href="#MeshManager-390"><span class="linenos"> 390</span></a>        <span class="n">centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager-391"><a href="#MeshManager-391"><span class="linenos"> 391</span></a>        <span class="n">vc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-</span> <span class="n">centroid</span>
</span><span id="MeshManager-392"><a href="#MeshManager-392"><span class="linenos"> 392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">@</span> <span class="n">vc</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">centroid</span>
</span><span id="MeshManager-393"><a href="#MeshManager-393"><span class="linenos"> 393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-394"><a href="#MeshManager-394"><span class="linenos"> 394</span></a>
</span><span id="MeshManager-395"><a href="#MeshManager-395"><span class="linenos"> 395</span></a>        <span class="c1"># Post-rotation correction: compute the furthest pair on the rotated</span>
</span><span id="MeshManager-396"><a href="#MeshManager-396"><span class="linenos"> 396</span></a>        <span class="c1"># vertices and ensure that vector is aligned with +Z as well. This</span>
</span><span id="MeshManager-397"><a href="#MeshManager-397"><span class="linenos"> 397</span></a>        <span class="c1"># guards against cases where the exact furthest pair differs slightly</span>
</span><span id="MeshManager-398"><a href="#MeshManager-398"><span class="linenos"> 398</span></a>        <span class="c1"># from the one chosen for the initial rotation.</span>
</span><span id="MeshManager-399"><a href="#MeshManager-399"><span class="linenos"> 399</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-400"><a href="#MeshManager-400"><span class="linenos"> 400</span></a>            <span class="n">all_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="MeshManager-401"><a href="#MeshManager-401"><span class="linenos"> 401</span></a>            <span class="k">if</span> <span class="n">all_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="MeshManager-402"><a href="#MeshManager-402"><span class="linenos"> 402</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_furthest_pair</span><span class="p">(</span><span class="n">all_pts</span><span class="p">)</span>
</span><span id="MeshManager-403"><a href="#MeshManager-403"><span class="linenos"> 403</span></a>                <span class="k">if</span> <span class="n">prefer_positive_z</span> <span class="ow">and</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-404"><a href="#MeshManager-404"><span class="linenos"> 404</span></a>                    <span class="n">v2</span> <span class="o">=</span> <span class="o">-</span><span class="n">v2</span>
</span><span id="MeshManager-405"><a href="#MeshManager-405"><span class="linenos"> 405</span></a>                <span class="n">v2n</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="MeshManager-406"><a href="#MeshManager-406"><span class="linenos"> 406</span></a>                <span class="k">if</span> <span class="n">v2n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.999</span><span class="p">:</span>
</span><span id="MeshManager-407"><a href="#MeshManager-407"><span class="linenos"> 407</span></a>                    <span class="n">R2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_between_vectors</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MeshManager-408"><a href="#MeshManager-408"><span class="linenos"> 408</span></a>                    <span class="n">vc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-</span> <span class="n">centroid</span>
</span><span id="MeshManager-409"><a href="#MeshManager-409"><span class="linenos"> 409</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span><span class="n">R2</span> <span class="o">@</span> <span class="n">vc2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">centroid</span>
</span><span id="MeshManager-410"><a href="#MeshManager-410"><span class="linenos"> 410</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager-411"><a href="#MeshManager-411"><span class="linenos"> 411</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-412"><a href="#MeshManager-412"><span class="linenos"> 412</span></a>            <span class="c1"># If anything goes wrong, we keep the initial rotation which already</span>
</span><span id="MeshManager-413"><a href="#MeshManager-413"><span class="linenos"> 413</span></a>            <span class="c1"># aligns the chosen diameter to +Z.</span>
</span><span id="MeshManager-414"><a href="#MeshManager-414"><span class="linenos"> 414</span></a>            <span class="k">pass</span>
</span><span id="MeshManager-415"><a href="#MeshManager-415"><span class="linenos"> 415</span></a>
</span><span id="MeshManager-416"><a href="#MeshManager-416"><span class="linenos"> 416</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-417"><a href="#MeshManager-417"><span class="linenos"> 417</span></a>
</span><span id="MeshManager-418"><a href="#MeshManager-418"><span class="linenos"> 418</span></a>    <span class="c1"># combining the functions from utils into this class</span>
</span><span id="MeshManager-419"><a href="#MeshManager-419"><span class="linenos"> 419</span></a>
</span><span id="MeshManager-420"><a href="#MeshManager-420"><span class="linenos"> 420</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="MeshManager-421"><a href="#MeshManager-421"><span class="linenos"> 421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-422"><a href="#MeshManager-422"><span class="linenos"> 422</span></a><span class="sd">        Analyze and return mesh properties for diagnostic purposes.</span>
</span><span id="MeshManager-423"><a href="#MeshManager-423"><span class="linenos"> 423</span></a><span class="sd">        This function performs pure analysis without modifying the input mesh.</span>
</span><span id="MeshManager-424"><a href="#MeshManager-424"><span class="linenos"> 424</span></a>
</span><span id="MeshManager-425"><a href="#MeshManager-425"><span class="linenos"> 425</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-426"><a href="#MeshManager-426"><span class="linenos"> 426</span></a><span class="sd">            Dictionary of mesh properties including volume, watertightness, winding consistency,</span>
</span><span id="MeshManager-427"><a href="#MeshManager-427"><span class="linenos"> 427</span></a><span class="sd">            face count, vertex count, bounds, and potential issues.</span>
</span><span id="MeshManager-428"><a href="#MeshManager-428"><span class="linenos"> 428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-429"><a href="#MeshManager-429"><span class="linenos"> 429</span></a>
</span><span id="MeshManager-430"><a href="#MeshManager-430"><span class="linenos"> 430</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_trimesh</span><span class="p">()</span>
</span><span id="MeshManager-431"><a href="#MeshManager-431"><span class="linenos"> 431</span></a>        <span class="c1"># Initialize results dictionary</span>
</span><span id="MeshManager-432"><a href="#MeshManager-432"><span class="linenos"> 432</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MeshManager-433"><a href="#MeshManager-433"><span class="linenos"> 433</span></a>            <span class="s2">&quot;face_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span>
</span><span id="MeshManager-434"><a href="#MeshManager-434"><span class="linenos"> 434</span></a>            <span class="s2">&quot;vertex_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">),</span>
</span><span id="MeshManager-435"><a href="#MeshManager-435"><span class="linenos"> 435</span></a>            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-436"><a href="#MeshManager-436"><span class="linenos"> 436</span></a>            <span class="s2">&quot;is_watertight&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">,</span>
</span><span id="MeshManager-437"><a href="#MeshManager-437"><span class="linenos"> 437</span></a>            <span class="s2">&quot;is_winding_consistent&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">,</span>
</span><span id="MeshManager-438"><a href="#MeshManager-438"><span class="linenos"> 438</span></a>            <span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MeshManager-439"><a href="#MeshManager-439"><span class="linenos"> 439</span></a>        <span class="p">}</span>
</span><span id="MeshManager-440"><a href="#MeshManager-440"><span class="linenos"> 440</span></a>
</span><span id="MeshManager-441"><a href="#MeshManager-441"><span class="linenos"> 441</span></a>        <span class="c1"># Calculate volume (report actual value, even if negative)</span>
</span><span id="MeshManager-442"><a href="#MeshManager-442"><span class="linenos"> 442</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-443"><a href="#MeshManager-443"><span class="linenos"> 443</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span>
</span><span id="MeshManager-444"><a href="#MeshManager-444"><span class="linenos"> 444</span></a>            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-445"><a href="#MeshManager-445"><span class="linenos"> 445</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-446"><a href="#MeshManager-446"><span class="linenos"> 446</span></a>                    <span class="s2">&quot;Negative volume detected - face normals may be inverted&quot;</span>
</span><span id="MeshManager-447"><a href="#MeshManager-447"><span class="linenos"> 447</span></a>                <span class="p">)</span>
</span><span id="MeshManager-448"><a href="#MeshManager-448"><span class="linenos"> 448</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-449"><a href="#MeshManager-449"><span class="linenos"> 449</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-450"><a href="#MeshManager-450"><span class="linenos"> 450</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume calculation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-451"><a href="#MeshManager-451"><span class="linenos"> 451</span></a>
</span><span id="MeshManager-452"><a href="#MeshManager-452"><span class="linenos"> 452</span></a>        <span class="c1"># Check for non-manifold edges</span>
</span><span id="MeshManager-453"><a href="#MeshManager-453"><span class="linenos"> 453</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-454"><a href="#MeshManager-454"><span class="linenos"> 454</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;is_manifold&quot;</span><span class="p">):</span>
</span><span id="MeshManager-455"><a href="#MeshManager-455"><span class="linenos"> 455</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;is_manifold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_manifold</span>
</span><span id="MeshManager-456"><a href="#MeshManager-456"><span class="linenos"> 456</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_manifold</span><span class="p">:</span>
</span><span id="MeshManager-457"><a href="#MeshManager-457"><span class="linenos"> 457</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Non-manifold edges detected&quot;</span><span class="p">)</span>
</span><span id="MeshManager-458"><a href="#MeshManager-458"><span class="linenos"> 458</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-459"><a href="#MeshManager-459"><span class="linenos"> 459</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;is_manifold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-460"><a href="#MeshManager-460"><span class="linenos"> 460</span></a>
</span><span id="MeshManager-461"><a href="#MeshManager-461"><span class="linenos"> 461</span></a>        <span class="c1"># Calculate topological properties using trimesh&#39;s built-in methods</span>
</span><span id="MeshManager-462"><a href="#MeshManager-462"><span class="linenos"> 462</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-463"><a href="#MeshManager-463"><span class="linenos"> 463</span></a>            <span class="c1"># Use trimesh&#39;s built-in euler_number property for correct topology calculation</span>
</span><span id="MeshManager-464"><a href="#MeshManager-464"><span class="linenos"> 464</span></a>            <span class="c1"># For a sphere: euler_number = 2</span>
</span><span id="MeshManager-465"><a href="#MeshManager-465"><span class="linenos"> 465</span></a>            <span class="c1"># For a torus: euler_number = 0</span>
</span><span id="MeshManager-466"><a href="#MeshManager-466"><span class="linenos"> 466</span></a>            <span class="c1"># For a double torus: euler_number = -2</span>
</span><span id="MeshManager-467"><a href="#MeshManager-467"><span class="linenos"> 467</span></a>            <span class="c1"># Genus = (2 - euler_number) / 2</span>
</span><span id="MeshManager-468"><a href="#MeshManager-468"><span class="linenos"> 468</span></a>
</span><span id="MeshManager-469"><a href="#MeshManager-469"><span class="linenos"> 469</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">euler_number</span>
</span><span id="MeshManager-470"><a href="#MeshManager-470"><span class="linenos"> 470</span></a>
</span><span id="MeshManager-471"><a href="#MeshManager-471"><span class="linenos"> 471</span></a>            <span class="c1"># Only calculate genus for closed (watertight) meshes</span>
</span><span id="MeshManager-472"><a href="#MeshManager-472"><span class="linenos"> 472</span></a>            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="MeshManager-473"><a href="#MeshManager-473"><span class="linenos"> 473</span></a>                <span class="c1"># For a closed orientable surface: genus = (2 - euler_number) / 2</span>
</span><span id="MeshManager-474"><a href="#MeshManager-474"><span class="linenos"> 474</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="n">mesh</span><span class="o">.</span><span class="n">euler_number</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="MeshManager-475"><a href="#MeshManager-475"><span class="linenos"> 475</span></a>
</span><span id="MeshManager-476"><a href="#MeshManager-476"><span class="linenos"> 476</span></a>                <span class="c1"># Sanity check - genus should be non-negative for simple shapes</span>
</span><span id="MeshManager-477"><a href="#MeshManager-477"><span class="linenos"> 477</span></a>                <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-478"><a href="#MeshManager-478"><span class="linenos"> 478</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager-479"><a href="#MeshManager-479"><span class="linenos"> 479</span></a>                        <span class="mi">0</span>  <span class="c1"># Default to 0 for simple shapes like spheres, cylinders</span>
</span><span id="MeshManager-480"><a href="#MeshManager-480"><span class="linenos"> 480</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-481"><a href="#MeshManager-481"><span class="linenos"> 481</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-482"><a href="#MeshManager-482"><span class="linenos"> 482</span></a>                        <span class="s2">&quot;Calculated negative genus, defaulting to 0&quot;</span>
</span><span id="MeshManager-483"><a href="#MeshManager-483"><span class="linenos"> 483</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-484"><a href="#MeshManager-484"><span class="linenos"> 484</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-485"><a href="#MeshManager-485"><span class="linenos"> 485</span></a>                <span class="c1"># For non-watertight meshes, genus is not well-defined</span>
</span><span id="MeshManager-486"><a href="#MeshManager-486"><span class="linenos"> 486</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-487"><a href="#MeshManager-487"><span class="linenos"> 487</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Genus undefined for non-watertight mesh&quot;</span><span class="p">)</span>
</span><span id="MeshManager-488"><a href="#MeshManager-488"><span class="linenos"> 488</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-489"><a href="#MeshManager-489"><span class="linenos"> 489</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-490"><a href="#MeshManager-490"><span class="linenos"> 490</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-491"><a href="#MeshManager-491"><span class="linenos"> 491</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Topology calculation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-492"><a href="#MeshManager-492"><span class="linenos"> 492</span></a>
</span><span id="MeshManager-493"><a href="#MeshManager-493"><span class="linenos"> 493</span></a>        <span class="c1"># Analyze face normals</span>
</span><span id="MeshManager-494"><a href="#MeshManager-494"><span class="linenos"> 494</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-495"><a href="#MeshManager-495"><span class="linenos"> 495</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;face_normals&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-496"><a href="#MeshManager-496"><span class="linenos"> 496</span></a>                <span class="c1"># Get statistics on face normal directions</span>
</span><span id="MeshManager-497"><a href="#MeshManager-497"><span class="linenos"> 497</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MeshManager-498"><a href="#MeshManager-498"><span class="linenos"> 498</span></a>                    <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="MeshManager-499"><a href="#MeshManager-499"><span class="linenos"> 499</span></a>                    <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="MeshManager-500"><a href="#MeshManager-500"><span class="linenos"> 500</span></a>                    <span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="MeshManager-501"><a href="#MeshManager-501"><span class="linenos"> 501</span></a>                <span class="p">}</span>
</span><span id="MeshManager-502"><a href="#MeshManager-502"><span class="linenos"> 502</span></a>
</span><span id="MeshManager-503"><a href="#MeshManager-503"><span class="linenos"> 503</span></a>                <span class="c1"># Check if normals are predominantly pointing inward (negative volume)</span>
</span><span id="MeshManager-504"><a href="#MeshManager-504"><span class="linenos"> 504</span></a>                <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-505"><a href="#MeshManager-505"><span class="linenos"> 505</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;inward&quot;</span>
</span><span id="MeshManager-506"><a href="#MeshManager-506"><span class="linenos"> 506</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-507"><a href="#MeshManager-507"><span class="linenos"> 507</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;outward&quot;</span>
</span><span id="MeshManager-508"><a href="#MeshManager-508"><span class="linenos"> 508</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-509"><a href="#MeshManager-509"><span class="linenos"> 509</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-510"><a href="#MeshManager-510"><span class="linenos"> 510</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normal analysis failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-511"><a href="#MeshManager-511"><span class="linenos"> 511</span></a>
</span><span id="MeshManager-512"><a href="#MeshManager-512"><span class="linenos"> 512</span></a>        <span class="c1"># Check for duplicate vertices and faces</span>
</span><span id="MeshManager-513"><a href="#MeshManager-513"><span class="linenos"> 513</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-514"><a href="#MeshManager-514"><span class="linenos"> 514</span></a>            <span class="n">unique_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MeshManager-515"><a href="#MeshManager-515"><span class="linenos"> 515</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_verts</span><span class="p">)</span>
</span><span id="MeshManager-516"><a href="#MeshManager-516"><span class="linenos"> 516</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-517"><a href="#MeshManager-517"><span class="linenos"> 517</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-518"><a href="#MeshManager-518"><span class="linenos"> 518</span></a>                    <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;duplicate_vertices&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> duplicate vertices&quot;</span>
</span><span id="MeshManager-519"><a href="#MeshManager-519"><span class="linenos"> 519</span></a>                <span class="p">)</span>
</span><span id="MeshManager-520"><a href="#MeshManager-520"><span class="linenos"> 520</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-521"><a href="#MeshManager-521"><span class="linenos"> 521</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-522"><a href="#MeshManager-522"><span class="linenos"> 522</span></a>
</span><span id="MeshManager-523"><a href="#MeshManager-523"><span class="linenos"> 523</span></a>        <span class="c1"># Check for degenerate faces (zero area)</span>
</span><span id="MeshManager-524"><a href="#MeshManager-524"><span class="linenos"> 524</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-525"><a href="#MeshManager-525"><span class="linenos"> 525</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;area_faces&quot;</span><span class="p">):</span>
</span><span id="MeshManager-526"><a href="#MeshManager-526"><span class="linenos"> 526</span></a>                <span class="n">degenerate_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">area_faces</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">)</span>
</span><span id="MeshManager-527"><a href="#MeshManager-527"><span class="linenos"> 527</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;degenerate_faces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">degenerate_count</span><span class="p">)</span>
</span><span id="MeshManager-528"><a href="#MeshManager-528"><span class="linenos"> 528</span></a>                <span class="k">if</span> <span class="n">degenerate_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-529"><a href="#MeshManager-529"><span class="linenos"> 529</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-530"><a href="#MeshManager-530"><span class="linenos"> 530</span></a>                        <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">degenerate_count</span><span class="si">}</span><span class="s2"> degenerate faces&quot;</span>
</span><span id="MeshManager-531"><a href="#MeshManager-531"><span class="linenos"> 531</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-532"><a href="#MeshManager-532"><span class="linenos"> 532</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-533"><a href="#MeshManager-533"><span class="linenos"> 533</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;degenerate_faces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-534"><a href="#MeshManager-534"><span class="linenos"> 534</span></a>
</span><span id="MeshManager-535"><a href="#MeshManager-535"><span class="linenos"> 535</span></a>        <span class="c1"># Check for connected components</span>
</span><span id="MeshManager-536"><a href="#MeshManager-536"><span class="linenos"> 536</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-537"><a href="#MeshManager-537"><span class="linenos"> 537</span></a>            <span class="n">components</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MeshManager-538"><a href="#MeshManager-538"><span class="linenos"> 538</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;component_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</span><span id="MeshManager-539"><a href="#MeshManager-539"><span class="linenos"> 539</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MeshManager-540"><a href="#MeshManager-540"><span class="linenos"> 540</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-541"><a href="#MeshManager-541"><span class="linenos"> 541</span></a>                    <span class="sa">f</span><span class="s2">&quot;Mesh has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> disconnected components&quot;</span>
</span><span id="MeshManager-542"><a href="#MeshManager-542"><span class="linenos"> 542</span></a>                <span class="p">)</span>
</span><span id="MeshManager-543"><a href="#MeshManager-543"><span class="linenos"> 543</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-544"><a href="#MeshManager-544"><span class="linenos"> 544</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;component_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-545"><a href="#MeshManager-545"><span class="linenos"> 545</span></a>
</span><span id="MeshManager-546"><a href="#MeshManager-546"><span class="linenos"> 546</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="MeshManager-547"><a href="#MeshManager-547"><span class="linenos"> 547</span></a>
</span><span id="MeshManager-548"><a href="#MeshManager-548"><span class="linenos"> 548</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_mesh_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-549"><a href="#MeshManager-549"><span class="linenos"> 549</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-550"><a href="#MeshManager-550"><span class="linenos"> 550</span></a><span class="sd">        Analyze a mesh and print a formatted report of its properties.</span>
</span><span id="MeshManager-551"><a href="#MeshManager-551"><span class="linenos"> 551</span></a>
</span><span id="MeshManager-552"><a href="#MeshManager-552"><span class="linenos"> 552</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-553"><a href="#MeshManager-553"><span class="linenos"> 553</span></a><span class="sd">            verbose: Whether to print detailed information</span>
</span><span id="MeshManager-554"><a href="#MeshManager-554"><span class="linenos"> 554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-555"><a href="#MeshManager-555"><span class="linenos"> 555</span></a>        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_mesh</span><span class="p">()</span>
</span><span id="MeshManager-556"><a href="#MeshManager-556"><span class="linenos"> 556</span></a>
</span><span id="MeshManager-557"><a href="#MeshManager-557"><span class="linenos"> 557</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mesh Analysis Report&quot;</span><span class="p">)</span>
</span><span id="MeshManager-558"><a href="#MeshManager-558"><span class="linenos"> 558</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================&quot;</span><span class="p">)</span>
</span><span id="MeshManager-559"><a href="#MeshManager-559"><span class="linenos"> 559</span></a>
</span><span id="MeshManager-560"><a href="#MeshManager-560"><span class="linenos"> 560</span></a>        <span class="c1"># Basic properties</span>
</span><span id="MeshManager-561"><a href="#MeshManager-561"><span class="linenos"> 561</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Geometry:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-562"><a href="#MeshManager-562"><span class="linenos"> 562</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Vertices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;vertex_count&#39;</span><span class="p">])</span>
</span><span id="MeshManager-563"><a href="#MeshManager-563"><span class="linenos"> 563</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Faces: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;face_count&#39;</span><span class="p">])</span>
</span><span id="MeshManager-564"><a href="#MeshManager-564"><span class="linenos"> 564</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;component_count&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-565"><a href="#MeshManager-565"><span class="linenos"> 565</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Components: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;component_count&#39;</span><span class="p">])</span>
</span><span id="MeshManager-566"><a href="#MeshManager-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-567"><a href="#MeshManager-567"><span class="linenos"> 567</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Volume: </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>
</span><span id="MeshManager-568"><a href="#MeshManager-568"><span class="linenos"> 568</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-569"><a href="#MeshManager-569"><span class="linenos"> 569</span></a>            <span class="n">min_bound</span><span class="p">,</span> <span class="n">max_bound</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span>
</span><span id="MeshManager-570"><a href="#MeshManager-570"><span class="linenos"> 570</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MeshManager-571"><a href="#MeshManager-571"><span class="linenos"> 571</span></a>                <span class="s2">&quot;  * Bounds: [</span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">] to [</span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">]&quot;</span><span class="p">,</span>
</span><span id="MeshManager-572"><a href="#MeshManager-572"><span class="linenos"> 572</span></a>                <span class="n">min_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-573"><a href="#MeshManager-573"><span class="linenos"> 573</span></a>                <span class="n">min_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-574"><a href="#MeshManager-574"><span class="linenos"> 574</span></a>                <span class="n">min_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-575"><a href="#MeshManager-575"><span class="linenos"> 575</span></a>                <span class="n">max_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-576"><a href="#MeshManager-576"><span class="linenos"> 576</span></a>                <span class="n">max_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-577"><a href="#MeshManager-577"><span class="linenos"> 577</span></a>                <span class="n">max_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-578"><a href="#MeshManager-578"><span class="linenos"> 578</span></a>            <span class="p">)</span>
</span><span id="MeshManager-579"><a href="#MeshManager-579"><span class="linenos"> 579</span></a>
</span><span id="MeshManager-580"><a href="#MeshManager-580"><span class="linenos"> 580</span></a>        <span class="c1"># Mesh quality</span>
</span><span id="MeshManager-581"><a href="#MeshManager-581"><span class="linenos"> 581</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mesh Quality:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-582"><a href="#MeshManager-582"><span class="linenos"> 582</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Watertight: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_watertight&#39;</span><span class="p">])</span>
</span><span id="MeshManager-583"><a href="#MeshManager-583"><span class="linenos"> 583</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Winding Consistent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_winding_consistent&#39;</span><span class="p">])</span>
</span><span id="MeshManager-584"><a href="#MeshManager-584"><span class="linenos"> 584</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_manifold&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-585"><a href="#MeshManager-585"><span class="linenos"> 585</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Manifold: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_manifold&#39;</span><span class="p">])</span>
</span><span id="MeshManager-586"><a href="#MeshManager-586"><span class="linenos"> 586</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_direction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-587"><a href="#MeshManager-587"><span class="linenos"> 587</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Normal Direction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;normal_direction&#39;</span><span class="p">])</span>
</span><span id="MeshManager-588"><a href="#MeshManager-588"><span class="linenos"> 588</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-589"><a href="#MeshManager-589"><span class="linenos"> 589</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Duplicate Vertices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;duplicate_vertices&#39;</span><span class="p">])</span>
</span><span id="MeshManager-590"><a href="#MeshManager-590"><span class="linenos"> 590</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;degenerate_faces&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-591"><a href="#MeshManager-591"><span class="linenos"> 591</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Degenerate Faces: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;degenerate_faces&#39;</span><span class="p">])</span>
</span><span id="MeshManager-592"><a href="#MeshManager-592"><span class="linenos"> 592</span></a>
</span><span id="MeshManager-593"><a href="#MeshManager-593"><span class="linenos"> 593</span></a>        <span class="c1"># Topology</span>
</span><span id="MeshManager-594"><a href="#MeshManager-594"><span class="linenos"> 594</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="MeshManager-595"><a href="#MeshManager-595"><span class="linenos"> 595</span></a>            <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;genus&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MeshManager-596"><a href="#MeshManager-596"><span class="linenos"> 596</span></a>            <span class="ow">or</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MeshManager-597"><a href="#MeshManager-597"><span class="linenos"> 597</span></a>        <span class="p">):</span>
</span><span id="MeshManager-598"><a href="#MeshManager-598"><span class="linenos"> 598</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Topology:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-599"><a href="#MeshManager-599"><span class="linenos"> 599</span></a>            <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;genus&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-600"><a href="#MeshManager-600"><span class="linenos"> 600</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Genus: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;genus&#39;</span><span class="p">])</span>
</span><span id="MeshManager-601"><a href="#MeshManager-601"><span class="linenos"> 601</span></a>            <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-602"><a href="#MeshManager-602"><span class="linenos"> 602</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Euler Characteristic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;euler_characteristic&#39;</span><span class="p">])</span>
</span><span id="MeshManager-603"><a href="#MeshManager-603"><span class="linenos"> 603</span></a>
</span><span id="MeshManager-604"><a href="#MeshManager-604"><span class="linenos"> 604</span></a>        <span class="c1"># Issues</span>
</span><span id="MeshManager-605"><a href="#MeshManager-605"><span class="linenos"> 605</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]:</span>
</span><span id="MeshManager-606"><a href="#MeshManager-606"><span class="linenos"> 606</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Issues Detected (</span><span class="si">%d</span><span class="s2">):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]))</span>
</span><span id="MeshManager-607"><a href="#MeshManager-607"><span class="linenos"> 607</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">issue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]):</span>
</span><span id="MeshManager-608"><a href="#MeshManager-608"><span class="linenos"> 608</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">issue</span><span class="p">)</span>
</span><span id="MeshManager-609"><a href="#MeshManager-609"><span class="linenos"> 609</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-610"><a href="#MeshManager-610"><span class="linenos"> 610</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No issues detected&quot;</span><span class="p">)</span>
</span><span id="MeshManager-611"><a href="#MeshManager-611"><span class="linenos"> 611</span></a>
</span><span id="MeshManager-612"><a href="#MeshManager-612"><span class="linenos"> 612</span></a>        <span class="c1"># Detailed stats</span>
</span><span id="MeshManager-613"><a href="#MeshManager-613"><span class="linenos"> 613</span></a>        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-614"><a href="#MeshManager-614"><span class="linenos"> 614</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Normal Statistics:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-615"><a href="#MeshManager-615"><span class="linenos"> 615</span></a>            <span class="n">mean</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
</span><span id="MeshManager-616"><a href="#MeshManager-616"><span class="linenos"> 616</span></a>            <span class="n">sum_val</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">][</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span>
</span><span id="MeshManager-617"><a href="#MeshManager-617"><span class="linenos"> 617</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Mean: [</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MeshManager-618"><a href="#MeshManager-618"><span class="linenos"> 618</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Sum: [</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sum_val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sum_val</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sum_val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MeshManager-619"><a href="#MeshManager-619"><span class="linenos"> 619</span></a>
</span><span id="MeshManager-620"><a href="#MeshManager-620"><span class="linenos"> 620</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendation:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-621"><a href="#MeshManager-621"><span class="linenos"> 621</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]:</span>
</span><span id="MeshManager-622"><a href="#MeshManager-622"><span class="linenos"> 622</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Consider using repair_mesh() to fix the detected issues.&quot;</span><span class="p">)</span>
</span><span id="MeshManager-623"><a href="#MeshManager-623"><span class="linenos"> 623</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-624"><a href="#MeshManager-624"><span class="linenos"> 624</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Mesh appears to be in good condition.&quot;</span><span class="p">)</span>
</span><span id="MeshManager-625"><a href="#MeshManager-625"><span class="linenos"> 625</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================&quot;</span><span class="p">)</span>
</span><span id="MeshManager-626"><a href="#MeshManager-626"><span class="linenos"> 626</span></a>
</span><span id="MeshManager-627"><a href="#MeshManager-627"><span class="linenos"> 627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repair_mesh</span><span class="p">(</span>
</span><span id="MeshManager-628"><a href="#MeshManager-628"><span class="linenos"> 628</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-629"><a href="#MeshManager-629"><span class="linenos"> 629</span></a>        <span class="n">fix_holes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-630"><a href="#MeshManager-630"><span class="linenos"> 630</span></a>        <span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-631"><a href="#MeshManager-631"><span class="linenos"> 631</span></a>        <span class="n">fix_normals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-632"><a href="#MeshManager-632"><span class="linenos"> 632</span></a>        <span class="n">remove_degenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-633"><a href="#MeshManager-633"><span class="linenos"> 633</span></a>        <span class="n">fix_negative_volume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-634"><a href="#MeshManager-634"><span class="linenos"> 634</span></a>        <span class="n">keep_largest_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-635"><a href="#MeshManager-635"><span class="linenos"> 635</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-636"><a href="#MeshManager-636"><span class="linenos"> 636</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-637"><a href="#MeshManager-637"><span class="linenos"> 637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-638"><a href="#MeshManager-638"><span class="linenos"> 638</span></a><span class="sd">        Attempt to repair common mesh issues to improve watertightness and quality.</span>
</span><span id="MeshManager-639"><a href="#MeshManager-639"><span class="linenos"> 639</span></a>
</span><span id="MeshManager-640"><a href="#MeshManager-640"><span class="linenos"> 640</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-641"><a href="#MeshManager-641"><span class="linenos"> 641</span></a><span class="sd">            mesh_data: Either a Trimesh object or (vertices, faces) tuple</span>
</span><span id="MeshManager-642"><a href="#MeshManager-642"><span class="linenos"> 642</span></a><span class="sd">            fix_holes: Whether to attempt filling holes</span>
</span><span id="MeshManager-643"><a href="#MeshManager-643"><span class="linenos"> 643</span></a><span class="sd">            remove_duplicates: Whether to remove duplicate faces and vertices</span>
</span><span id="MeshManager-644"><a href="#MeshManager-644"><span class="linenos"> 644</span></a><span class="sd">            fix_normals: Whether to fix face normal consistency</span>
</span><span id="MeshManager-645"><a href="#MeshManager-645"><span class="linenos"> 645</span></a><span class="sd">            remove_degenerate: Whether to remove degenerate faces</span>
</span><span id="MeshManager-646"><a href="#MeshManager-646"><span class="linenos"> 646</span></a><span class="sd">            fix_negative_volume: Whether to invert faces if mesh has negative volume</span>
</span><span id="MeshManager-647"><a href="#MeshManager-647"><span class="linenos"> 647</span></a><span class="sd">            keep_largest_component: Whether to keep only the largest connected component</span>
</span><span id="MeshManager-648"><a href="#MeshManager-648"><span class="linenos"> 648</span></a><span class="sd">            verbose: Whether to print repair summary</span>
</span><span id="MeshManager-649"><a href="#MeshManager-649"><span class="linenos"> 649</span></a>
</span><span id="MeshManager-650"><a href="#MeshManager-650"><span class="linenos"> 650</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-651"><a href="#MeshManager-651"><span class="linenos"> 651</span></a><span class="sd">            Repaired mesh (new copy, original is not modified)</span>
</span><span id="MeshManager-652"><a href="#MeshManager-652"><span class="linenos"> 652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-653"><a href="#MeshManager-653"><span class="linenos"> 653</span></a>
</span><span id="MeshManager-654"><a href="#MeshManager-654"><span class="linenos"> 654</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_trimesh</span><span class="p">()</span>
</span><span id="MeshManager-655"><a href="#MeshManager-655"><span class="linenos"> 655</span></a>
</span><span id="MeshManager-656"><a href="#MeshManager-656"><span class="linenos"> 656</span></a>        <span class="n">repair_log</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager-657"><a href="#MeshManager-657"><span class="linenos"> 657</span></a>
</span><span id="MeshManager-658"><a href="#MeshManager-658"><span class="linenos"> 658</span></a>        <span class="c1"># Fix negative volume by inverting faces if needed</span>
</span><span id="MeshManager-659"><a href="#MeshManager-659"><span class="linenos"> 659</span></a>        <span class="k">if</span> <span class="n">fix_negative_volume</span><span class="p">:</span>
</span><span id="MeshManager-660"><a href="#MeshManager-660"><span class="linenos"> 660</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-661"><a href="#MeshManager-661"><span class="linenos"> 661</span></a>                <span class="c1"># Check if the mesh has a negative volume</span>
</span><span id="MeshManager-662"><a href="#MeshManager-662"><span class="linenos"> 662</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-663"><a href="#MeshManager-663"><span class="linenos"> 663</span></a>                    <span class="n">initial_volume</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span>
</span><span id="MeshManager-664"><a href="#MeshManager-664"><span class="linenos"> 664</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
</span><span id="MeshManager-665"><a href="#MeshManager-665"><span class="linenos"> 665</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-666"><a href="#MeshManager-666"><span class="linenos"> 666</span></a>                        <span class="sa">f</span><span class="s2">&quot;Inverted faces to fix negative volume: </span><span class="si">{</span><span class="n">initial_volume</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">mesh</span><span class="o">.</span><span class="n">volume</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MeshManager-667"><a href="#MeshManager-667"><span class="linenos"> 667</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-668"><a href="#MeshManager-668"><span class="linenos"> 668</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-669"><a href="#MeshManager-669"><span class="linenos"> 669</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fix negative volume: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-670"><a href="#MeshManager-670"><span class="linenos"> 670</span></a>
</span><span id="MeshManager-671"><a href="#MeshManager-671"><span class="linenos"> 671</span></a>        <span class="c1"># Remove duplicate and degenerate faces</span>
</span><span id="MeshManager-672"><a href="#MeshManager-672"><span class="linenos"> 672</span></a>        <span class="k">if</span> <span class="n">remove_duplicates</span><span class="p">:</span>
</span><span id="MeshManager-673"><a href="#MeshManager-673"><span class="linenos"> 673</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-674"><a href="#MeshManager-674"><span class="linenos"> 674</span></a>                <span class="n">initial_faces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager-675"><a href="#MeshManager-675"><span class="linenos"> 675</span></a>                <span class="n">mesh</span><span class="o">.</span><span class="n">remove_duplicate_faces</span><span class="p">()</span>
</span><span id="MeshManager-676"><a href="#MeshManager-676"><span class="linenos"> 676</span></a>                <span class="n">removed_faces</span> <span class="o">=</span> <span class="n">initial_faces</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager-677"><a href="#MeshManager-677"><span class="linenos"> 677</span></a>                <span class="k">if</span> <span class="n">removed_faces</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-678"><a href="#MeshManager-678"><span class="linenos"> 678</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">removed_faces</span><span class="si">}</span><span class="s2"> duplicate faces&quot;</span><span class="p">)</span>
</span><span id="MeshManager-679"><a href="#MeshManager-679"><span class="linenos"> 679</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-680"><a href="#MeshManager-680"><span class="linenos"> 680</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove duplicate faces: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-681"><a href="#MeshManager-681"><span class="linenos"> 681</span></a>
</span><span id="MeshManager-682"><a href="#MeshManager-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="n">remove_degenerate</span><span class="p">:</span>
</span><span id="MeshManager-683"><a href="#MeshManager-683"><span class="linenos"> 683</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-684"><a href="#MeshManager-684"><span class="linenos"> 684</span></a>                <span class="n">initial_faces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager-685"><a href="#MeshManager-685"><span class="linenos"> 685</span></a>                <span class="n">mesh</span><span class="o">.</span><span class="n">remove_degenerate_faces</span><span class="p">()</span>
</span><span id="MeshManager-686"><a href="#MeshManager-686"><span class="linenos"> 686</span></a>                <span class="n">removed_faces</span> <span class="o">=</span> <span class="n">initial_faces</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager-687"><a href="#MeshManager-687"><span class="linenos"> 687</span></a>                <span class="k">if</span> <span class="n">removed_faces</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-688"><a href="#MeshManager-688"><span class="linenos"> 688</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">removed_faces</span><span class="si">}</span><span class="s2"> degenerate faces&quot;</span><span class="p">)</span>
</span><span id="MeshManager-689"><a href="#MeshManager-689"><span class="linenos"> 689</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-690"><a href="#MeshManager-690"><span class="linenos"> 690</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove degenerate faces: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-691"><a href="#MeshManager-691"><span class="linenos"> 691</span></a>
</span><span id="MeshManager-692"><a href="#MeshManager-692"><span class="linenos"> 692</span></a>        <span class="c1"># Fix winding consistency</span>
</span><span id="MeshManager-693"><a href="#MeshManager-693"><span class="linenos"> 693</span></a>        <span class="k">if</span> <span class="n">fix_normals</span><span class="p">:</span>
</span><span id="MeshManager-694"><a href="#MeshManager-694"><span class="linenos"> 694</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-695"><a href="#MeshManager-695"><span class="linenos"> 695</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">:</span>
</span><span id="MeshManager-696"><a href="#MeshManager-696"><span class="linenos"> 696</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">fix_normals</span><span class="p">()</span>
</span><span id="MeshManager-697"><a href="#MeshManager-697"><span class="linenos"> 697</span></a>                    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">:</span>
</span><span id="MeshManager-698"><a href="#MeshManager-698"><span class="linenos"> 698</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Fixed face normal winding consistency&quot;</span><span class="p">)</span>
</span><span id="MeshManager-699"><a href="#MeshManager-699"><span class="linenos"> 699</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-700"><a href="#MeshManager-700"><span class="linenos"> 700</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-701"><a href="#MeshManager-701"><span class="linenos"> 701</span></a>                            <span class="s2">&quot;Attempted to fix normals but still inconsistent&quot;</span>
</span><span id="MeshManager-702"><a href="#MeshManager-702"><span class="linenos"> 702</span></a>                        <span class="p">)</span>
</span><span id="MeshManager-703"><a href="#MeshManager-703"><span class="linenos"> 703</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-704"><a href="#MeshManager-704"><span class="linenos"> 704</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fix normals: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-705"><a href="#MeshManager-705"><span class="linenos"> 705</span></a>
</span><span id="MeshManager-706"><a href="#MeshManager-706"><span class="linenos"> 706</span></a>        <span class="c1"># Attempt to fill holes</span>
</span><span id="MeshManager-707"><a href="#MeshManager-707"><span class="linenos"> 707</span></a>        <span class="k">if</span> <span class="n">fix_holes</span><span class="p">:</span>
</span><span id="MeshManager-708"><a href="#MeshManager-708"><span class="linenos"> 708</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-709"><a href="#MeshManager-709"><span class="linenos"> 709</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="MeshManager-710"><a href="#MeshManager-710"><span class="linenos"> 710</span></a>                    <span class="n">initial_watertight</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span>
</span><span id="MeshManager-711"><a href="#MeshManager-711"><span class="linenos"> 711</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">fill_holes</span><span class="p">()</span>
</span><span id="MeshManager-712"><a href="#MeshManager-712"><span class="linenos"> 712</span></a>                    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">initial_watertight</span><span class="p">:</span>
</span><span id="MeshManager-713"><a href="#MeshManager-713"><span class="linenos"> 713</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-714"><a href="#MeshManager-714"><span class="linenos"> 714</span></a>                            <span class="s2">&quot;Successfully filled holes - mesh is now watertight&quot;</span>
</span><span id="MeshManager-715"><a href="#MeshManager-715"><span class="linenos"> 715</span></a>                        <span class="p">)</span>
</span><span id="MeshManager-716"><a href="#MeshManager-716"><span class="linenos"> 716</span></a>                    <span class="k">elif</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="MeshManager-717"><a href="#MeshManager-717"><span class="linenos"> 717</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Mesh was already watertight&quot;</span><span class="p">)</span>
</span><span id="MeshManager-718"><a href="#MeshManager-718"><span class="linenos"> 718</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-719"><a href="#MeshManager-719"><span class="linenos"> 719</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-720"><a href="#MeshManager-720"><span class="linenos"> 720</span></a>                            <span class="s2">&quot;Attempted to fill holes but mesh still not watertight&quot;</span>
</span><span id="MeshManager-721"><a href="#MeshManager-721"><span class="linenos"> 721</span></a>                        <span class="p">)</span>
</span><span id="MeshManager-722"><a href="#MeshManager-722"><span class="linenos"> 722</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-723"><a href="#MeshManager-723"><span class="linenos"> 723</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fill holes: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-724"><a href="#MeshManager-724"><span class="linenos"> 724</span></a>
</span><span id="MeshManager-725"><a href="#MeshManager-725"><span class="linenos"> 725</span></a>        <span class="c1"># Keep only the largest component if requested</span>
</span><span id="MeshManager-726"><a href="#MeshManager-726"><span class="linenos"> 726</span></a>        <span class="k">if</span> <span class="n">keep_largest_component</span><span class="p">:</span>
</span><span id="MeshManager-727"><a href="#MeshManager-727"><span class="linenos"> 727</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-728"><a href="#MeshManager-728"><span class="linenos"> 728</span></a>                <span class="n">components</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MeshManager-729"><a href="#MeshManager-729"><span class="linenos"> 729</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MeshManager-730"><a href="#MeshManager-730"><span class="linenos"> 730</span></a>                    <span class="c1"># Keep the largest component by volume or face count</span>
</span><span id="MeshManager-731"><a href="#MeshManager-731"><span class="linenos"> 731</span></a>                    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MeshManager-732"><a href="#MeshManager-732"><span class="linenos"> 732</span></a>                        <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager-733"><a href="#MeshManager-733"><span class="linenos"> 733</span></a>                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">components</span>
</span><span id="MeshManager-734"><a href="#MeshManager-734"><span class="linenos"> 734</span></a>                    <span class="p">]</span>
</span><span id="MeshManager-735"><a href="#MeshManager-735"><span class="linenos"> 735</span></a>                    <span class="n">largest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
</span><span id="MeshManager-736"><a href="#MeshManager-736"><span class="linenos"> 736</span></a>                    <span class="n">mesh</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">largest_idx</span><span class="p">]</span>
</span><span id="MeshManager-737"><a href="#MeshManager-737"><span class="linenos"> 737</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-738"><a href="#MeshManager-738"><span class="linenos"> 738</span></a>                        <span class="sa">f</span><span class="s2">&quot;Kept largest of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> components (volume: </span><span class="si">{</span><span class="n">volumes</span><span class="p">[</span><span class="n">largest_idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="MeshManager-739"><a href="#MeshManager-739"><span class="linenos"> 739</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-740"><a href="#MeshManager-740"><span class="linenos"> 740</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-741"><a href="#MeshManager-741"><span class="linenos"> 741</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to isolate largest component: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-742"><a href="#MeshManager-742"><span class="linenos"> 742</span></a>
</span><span id="MeshManager-743"><a href="#MeshManager-743"><span class="linenos"> 743</span></a>        <span class="c1"># Final processing to ensure consistency</span>
</span><span id="MeshManager-744"><a href="#MeshManager-744"><span class="linenos"> 744</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-745"><a href="#MeshManager-745"><span class="linenos"> 745</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager-746"><a href="#MeshManager-746"><span class="linenos"> 746</span></a>            <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Applied final mesh processing and validation&quot;</span><span class="p">)</span>
</span><span id="MeshManager-747"><a href="#MeshManager-747"><span class="linenos"> 747</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-748"><a href="#MeshManager-748"><span class="linenos"> 748</span></a>            <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final processing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-749"><a href="#MeshManager-749"><span class="linenos"> 749</span></a>
</span><span id="MeshManager-750"><a href="#MeshManager-750"><span class="linenos"> 750</span></a>        <span class="c1"># Store repair log as mesh metadata</span>
</span><span id="MeshManager-751"><a href="#MeshManager-751"><span class="linenos"> 751</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="MeshManager-752"><a href="#MeshManager-752"><span class="linenos"> 752</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MeshManager-753"><a href="#MeshManager-753"><span class="linenos"> 753</span></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;repair_log&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">repair_log</span>
</span><span id="MeshManager-754"><a href="#MeshManager-754"><span class="linenos"> 754</span></a>
</span><span id="MeshManager-755"><a href="#MeshManager-755"><span class="linenos"> 755</span></a>        <span class="c1"># Log repair summary</span>
</span><span id="MeshManager-756"><a href="#MeshManager-756"><span class="linenos"> 756</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="MeshManager-757"><a href="#MeshManager-757"><span class="linenos"> 757</span></a>            <span class="k">if</span> <span class="n">repair_log</span><span class="p">:</span>
</span><span id="MeshManager-758"><a href="#MeshManager-758"><span class="linenos"> 758</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mesh Repair Summary:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-759"><a href="#MeshManager-759"><span class="linenos"> 759</span></a>                <span class="k">for</span> <span class="n">log_entry</span> <span class="ow">in</span> <span class="n">repair_log</span><span class="p">:</span>
</span><span id="MeshManager-760"><a href="#MeshManager-760"><span class="linenos"> 760</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_entry</span><span class="p">)</span>
</span><span id="MeshManager-761"><a href="#MeshManager-761"><span class="linenos"> 761</span></a>
</span><span id="MeshManager-762"><a href="#MeshManager-762"><span class="linenos"> 762</span></a>                <span class="c1"># Final mesh status</span>
</span><span id="MeshManager-763"><a href="#MeshManager-763"><span class="linenos"> 763</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final Mesh Status:&quot;</span><span class="p">)</span>
</span><span id="MeshManager-764"><a href="#MeshManager-764"><span class="linenos"> 764</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MeshManager-765"><a href="#MeshManager-765"><span class="linenos"> 765</span></a>                    <span class="s2">&quot;   Volume: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager-766"><a href="#MeshManager-766"><span class="linenos"> 766</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
</span><span id="MeshManager-767"><a href="#MeshManager-767"><span class="linenos"> 767</span></a>                <span class="p">)</span>
</span><span id="MeshManager-768"><a href="#MeshManager-768"><span class="linenos"> 768</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Watertight: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">)</span>
</span><span id="MeshManager-769"><a href="#MeshManager-769"><span class="linenos"> 769</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Winding consistent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">)</span>
</span><span id="MeshManager-770"><a href="#MeshManager-770"><span class="linenos"> 770</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Faces: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
</span><span id="MeshManager-771"><a href="#MeshManager-771"><span class="linenos"> 771</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Vertices: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">))</span>
</span><span id="MeshManager-772"><a href="#MeshManager-772"><span class="linenos"> 772</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-773"><a href="#MeshManager-773"><span class="linenos"> 773</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No repairs needed - mesh is in good condition&quot;</span><span class="p">)</span>
</span><span id="MeshManager-774"><a href="#MeshManager-774"><span class="linenos"> 774</span></a>
</span><span id="MeshManager-775"><a href="#MeshManager-775"><span class="linenos"> 775</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager-776"><a href="#MeshManager-776"><span class="linenos"> 776</span></a>        <span class="k">return</span> <span class="n">mesh</span>
</span><span id="MeshManager-777"><a href="#MeshManager-777"><span class="linenos"> 777</span></a>
</span><span id="MeshManager-778"><a href="#MeshManager-778"><span class="linenos"> 778</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repair_mesh_pymeshfix</span><span class="p">(</span>
</span><span id="MeshManager-779"><a href="#MeshManager-779"><span class="linenos"> 779</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-780"><a href="#MeshManager-780"><span class="linenos"> 780</span></a>        <span class="n">join_components</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-781"><a href="#MeshManager-781"><span class="linenos"> 781</span></a>        <span class="n">remove_small_components</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-782"><a href="#MeshManager-782"><span class="linenos"> 782</span></a>        <span class="n">keep_largest_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-783"><a href="#MeshManager-783"><span class="linenos"> 783</span></a>        <span class="n">min_component_faces</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="MeshManager-784"><a href="#MeshManager-784"><span class="linenos"> 784</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-785"><a href="#MeshManager-785"><span class="linenos"> 785</span></a>        <span class="n">safe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-786"><a href="#MeshManager-786"><span class="linenos"> 786</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">120.0</span><span class="p">,</span>
</span><span id="MeshManager-787"><a href="#MeshManager-787"><span class="linenos"> 787</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager-788"><a href="#MeshManager-788"><span class="linenos"> 788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Repair current mesh using PyMeshFix.</span>
</span><span id="MeshManager-789"><a href="#MeshManager-789"><span class="linenos"> 789</span></a>
</span><span id="MeshManager-790"><a href="#MeshManager-790"><span class="linenos"> 790</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-791"><a href="#MeshManager-791"><span class="linenos"> 791</span></a><span class="sd">            join_components: Merge nearby components during repair.</span>
</span><span id="MeshManager-792"><a href="#MeshManager-792"><span class="linenos"> 792</span></a><span class="sd">            remove_small_components: Remove very small components (PyMeshFix behavior).</span>
</span><span id="MeshManager-793"><a href="#MeshManager-793"><span class="linenos"> 793</span></a><span class="sd">            keep_largest_component: After repair, keep only the largest connected component.</span>
</span><span id="MeshManager-794"><a href="#MeshManager-794"><span class="linenos"> 794</span></a><span class="sd">            min_component_faces: Minimum faces to consider a component when filtering.</span>
</span><span id="MeshManager-795"><a href="#MeshManager-795"><span class="linenos"> 795</span></a><span class="sd">            verbose: Whether to print concise summary (unused here but kept for API symmetry).</span>
</span><span id="MeshManager-796"><a href="#MeshManager-796"><span class="linenos"> 796</span></a><span class="sd">            safe: Run PyMeshFix in a separate process to avoid hard interpreter exits.</span>
</span><span id="MeshManager-797"><a href="#MeshManager-797"><span class="linenos"> 797</span></a><span class="sd">            timeout: Seconds to wait for PyMeshFix before aborting.</span>
</span><span id="MeshManager-798"><a href="#MeshManager-798"><span class="linenos"> 798</span></a>
</span><span id="MeshManager-799"><a href="#MeshManager-799"><span class="linenos"> 799</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-800"><a href="#MeshManager-800"><span class="linenos"> 800</span></a><span class="sd">            Repaired mesh (also assigned to `self.mesh`).</span>
</span><span id="MeshManager-801"><a href="#MeshManager-801"><span class="linenos"> 801</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-802"><a href="#MeshManager-802"><span class="linenos"> 802</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-803"><a href="#MeshManager-803"><span class="linenos"> 803</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-804"><a href="#MeshManager-804"><span class="linenos"> 804</span></a>
</span><span id="MeshManager-805"><a href="#MeshManager-805"><span class="linenos"> 805</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-806"><a href="#MeshManager-806"><span class="linenos"> 806</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">pymeshfix</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeshFix</span>  <span class="c1"># type: ignore</span>
</span><span id="MeshManager-807"><a href="#MeshManager-807"><span class="linenos"> 807</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-808"><a href="#MeshManager-808"><span class="linenos"> 808</span></a>            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
</span><span id="MeshManager-809"><a href="#MeshManager-809"><span class="linenos"> 809</span></a>                <span class="s2">&quot;pymeshfix is required for repair_mesh_pymeshfix; install with `uv pip install pymeshfix`.&quot;</span>
</span><span id="MeshManager-810"><a href="#MeshManager-810"><span class="linenos"> 810</span></a>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="MeshManager-811"><a href="#MeshManager-811"><span class="linenos"> 811</span></a>
</span><span id="MeshManager-812"><a href="#MeshManager-812"><span class="linenos"> 812</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-813"><a href="#MeshManager-813"><span class="linenos"> 813</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="MeshManager-814"><a href="#MeshManager-814"><span class="linenos"> 814</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="MeshManager-815"><a href="#MeshManager-815"><span class="linenos"> 815</span></a>
</span><span id="MeshManager-816"><a href="#MeshManager-816"><span class="linenos"> 816</span></a>        <span class="c1"># Run PyMeshFix either inline (unsafe) or in a separate process (safe)</span>
</span><span id="MeshManager-817"><a href="#MeshManager-817"><span class="linenos"> 817</span></a>        <span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
</span><span id="MeshManager-818"><a href="#MeshManager-818"><span class="linenos"> 818</span></a>            <span class="n">ctx</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
</span><span id="MeshManager-819"><a href="#MeshManager-819"><span class="linenos"> 819</span></a>            <span class="n">queue</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">queues</span><span class="o">.</span><span class="n">Queue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="MeshManager-820"><a href="#MeshManager-820"><span class="linenos"> 820</span></a>            <span class="n">proc</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span>
</span><span id="MeshManager-821"><a href="#MeshManager-821"><span class="linenos"> 821</span></a>                <span class="n">target</span><span class="o">=</span><span class="n">_pymeshfix_worker</span><span class="p">,</span>
</span><span id="MeshManager-822"><a href="#MeshManager-822"><span class="linenos"> 822</span></a>                <span class="n">args</span><span class="o">=</span><span class="p">(</span>
</span><span id="MeshManager-823"><a href="#MeshManager-823"><span class="linenos"> 823</span></a>                    <span class="n">queue</span><span class="p">,</span>
</span><span id="MeshManager-824"><a href="#MeshManager-824"><span class="linenos"> 824</span></a>                    <span class="n">v</span><span class="p">,</span>
</span><span id="MeshManager-825"><a href="#MeshManager-825"><span class="linenos"> 825</span></a>                    <span class="n">f</span><span class="p">,</span>
</span><span id="MeshManager-826"><a href="#MeshManager-826"><span class="linenos"> 826</span></a>                    <span class="nb">bool</span><span class="p">(</span><span class="n">join_components</span><span class="p">),</span>
</span><span id="MeshManager-827"><a href="#MeshManager-827"><span class="linenos"> 827</span></a>                    <span class="nb">bool</span><span class="p">(</span><span class="n">remove_small_components</span><span class="p">),</span>
</span><span id="MeshManager-828"><a href="#MeshManager-828"><span class="linenos"> 828</span></a>                    <span class="nb">bool</span><span class="p">(</span><span class="n">verbose</span><span class="p">),</span>
</span><span id="MeshManager-829"><a href="#MeshManager-829"><span class="linenos"> 829</span></a>                <span class="p">),</span>
</span><span id="MeshManager-830"><a href="#MeshManager-830"><span class="linenos"> 830</span></a>            <span class="p">)</span>
</span><span id="MeshManager-831"><a href="#MeshManager-831"><span class="linenos"> 831</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="MeshManager-832"><a href="#MeshManager-832"><span class="linenos"> 832</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="MeshManager-833"><a href="#MeshManager-833"><span class="linenos"> 833</span></a>
</span><span id="MeshManager-834"><a href="#MeshManager-834"><span class="linenos"> 834</span></a>            <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span><span id="MeshManager-835"><a href="#MeshManager-835"><span class="linenos"> 835</span></a>                <span class="c1"># Timed out</span>
</span><span id="MeshManager-836"><a href="#MeshManager-836"><span class="linenos"> 836</span></a>                <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="MeshManager-837"><a href="#MeshManager-837"><span class="linenos"> 837</span></a>                <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="MeshManager-838"><a href="#MeshManager-838"><span class="linenos"> 838</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyMeshFix timed out after </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span><span id="MeshManager-839"><a href="#MeshManager-839"><span class="linenos"> 839</span></a>
</span><span id="MeshManager-840"><a href="#MeshManager-840"><span class="linenos"> 840</span></a>            <span class="c1"># Retrieve results from queue</span>
</span><span id="MeshManager-841"><a href="#MeshManager-841"><span class="linenos"> 841</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="MeshManager-842"><a href="#MeshManager-842"><span class="linenos"> 842</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="MeshManager-843"><a href="#MeshManager-843"><span class="linenos"> 843</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-844"><a href="#MeshManager-844"><span class="linenos"> 844</span></a>                <span class="c1"># Likely a hard crash in the child</span>
</span><span id="MeshManager-845"><a href="#MeshManager-845"><span class="linenos"> 845</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="MeshManager-846"><a href="#MeshManager-846"><span class="linenos"> 846</span></a>                    <span class="sa">f</span><span class="s2">&quot;PyMeshFix crashed (exit code </span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">exitcode</span><span class="si">}</span><span class="s2">) with no result&quot;</span>
</span><span id="MeshManager-847"><a href="#MeshManager-847"><span class="linenos"> 847</span></a>                <span class="p">)</span>
</span><span id="MeshManager-848"><a href="#MeshManager-848"><span class="linenos"> 848</span></a>
</span><span id="MeshManager-849"><a href="#MeshManager-849"><span class="linenos"> 849</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span> <span class="ow">or</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
</span><span id="MeshManager-850"><a href="#MeshManager-850"><span class="linenos"> 850</span></a>                <span class="c1"># msg could be (&quot;err&quot;, error_str, traceback)</span>
</span><span id="MeshManager-851"><a href="#MeshManager-851"><span class="linenos"> 851</span></a>                <span class="n">detail</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager-852"><a href="#MeshManager-852"><span class="linenos"> 852</span></a>                    <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MeshManager-853"><a href="#MeshManager-853"><span class="linenos"> 853</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="MeshManager-854"><a href="#MeshManager-854"><span class="linenos"> 854</span></a>                    <span class="k">else</span> <span class="s2">&quot;unknown error&quot;</span>
</span><span id="MeshManager-855"><a href="#MeshManager-855"><span class="linenos"> 855</span></a>                <span class="p">)</span>
</span><span id="MeshManager-856"><a href="#MeshManager-856"><span class="linenos"> 856</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyMeshFix failed: </span><span class="si">{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-857"><a href="#MeshManager-857"><span class="linenos"> 857</span></a>
</span><span id="MeshManager-858"><a href="#MeshManager-858"><span class="linenos"> 858</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="MeshManager-859"><a href="#MeshManager-859"><span class="linenos"> 859</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-860"><a href="#MeshManager-860"><span class="linenos"> 860</span></a>            <span class="n">mf</span> <span class="o">=</span> <span class="n">MeshFix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="MeshManager-861"><a href="#MeshManager-861"><span class="linenos"> 861</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-862"><a href="#MeshManager-862"><span class="linenos"> 862</span></a>                <span class="n">mf</span><span class="o">.</span><span class="n">repair</span><span class="p">(</span>
</span><span id="MeshManager-863"><a href="#MeshManager-863"><span class="linenos"> 863</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="MeshManager-864"><a href="#MeshManager-864"><span class="linenos"> 864</span></a>                    <span class="n">joincomp</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">join_components</span><span class="p">),</span>
</span><span id="MeshManager-865"><a href="#MeshManager-865"><span class="linenos"> 865</span></a>                    <span class="n">remove_small_components</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">remove_small_components</span><span class="p">),</span>
</span><span id="MeshManager-866"><a href="#MeshManager-866"><span class="linenos"> 866</span></a>                <span class="p">)</span>
</span><span id="MeshManager-867"><a href="#MeshManager-867"><span class="linenos"> 867</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MeshManager-868"><a href="#MeshManager-868"><span class="linenos"> 868</span></a>                <span class="c1"># Older signature without keywords</span>
</span><span id="MeshManager-869"><a href="#MeshManager-869"><span class="linenos"> 869</span></a>                <span class="n">mf</span><span class="o">.</span><span class="n">repair</span><span class="p">()</span>
</span><span id="MeshManager-870"><a href="#MeshManager-870"><span class="linenos"> 870</span></a>
</span><span id="MeshManager-871"><a href="#MeshManager-871"><span class="linenos"> 871</span></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="MeshManager-872"><a href="#MeshManager-872"><span class="linenos"> 872</span></a>            <span class="n">f2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="MeshManager-873"><a href="#MeshManager-873"><span class="linenos"> 873</span></a>            <span class="k">if</span> <span class="n">v2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">f2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-874"><a href="#MeshManager-874"><span class="linenos"> 874</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PyMeshFix returned an empty mesh&quot;</span><span class="p">)</span>
</span><span id="MeshManager-875"><a href="#MeshManager-875"><span class="linenos"> 875</span></a>
</span><span id="MeshManager-876"><a href="#MeshManager-876"><span class="linenos"> 876</span></a>        <span class="n">repaired</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">v2</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager-877"><a href="#MeshManager-877"><span class="linenos"> 877</span></a>        <span class="c1"># Post-process: fix normals, validate</span>
</span><span id="MeshManager-878"><a href="#MeshManager-878"><span class="linenos"> 878</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-879"><a href="#MeshManager-879"><span class="linenos"> 879</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">repaired</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">:</span>
</span><span id="MeshManager-880"><a href="#MeshManager-880"><span class="linenos"> 880</span></a>                <span class="n">repaired</span><span class="o">.</span><span class="n">fix_normals</span><span class="p">()</span>
</span><span id="MeshManager-881"><a href="#MeshManager-881"><span class="linenos"> 881</span></a>            <span class="n">repaired</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager-882"><a href="#MeshManager-882"><span class="linenos"> 882</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-883"><a href="#MeshManager-883"><span class="linenos"> 883</span></a>            <span class="k">pass</span>
</span><span id="MeshManager-884"><a href="#MeshManager-884"><span class="linenos"> 884</span></a>
</span><span id="MeshManager-885"><a href="#MeshManager-885"><span class="linenos"> 885</span></a>        <span class="c1"># Optionally keep largest component</span>
</span><span id="MeshManager-886"><a href="#MeshManager-886"><span class="linenos"> 886</span></a>        <span class="k">if</span> <span class="n">keep_largest_component</span><span class="p">:</span>
</span><span id="MeshManager-887"><a href="#MeshManager-887"><span class="linenos"> 887</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-888"><a href="#MeshManager-888"><span class="linenos"> 888</span></a>                <span class="n">comps</span> <span class="o">=</span> <span class="n">repaired</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MeshManager-889"><a href="#MeshManager-889"><span class="linenos"> 889</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MeshManager-890"><a href="#MeshManager-890"><span class="linenos"> 890</span></a>
</span><span id="MeshManager-891"><a href="#MeshManager-891"><span class="linenos"> 891</span></a>                    <span class="k">def</span><span class="w"> </span><span class="nf">comp_key</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager-892"><a href="#MeshManager-892"><span class="linenos"> 892</span></a>                        <span class="n">vol</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
</span><span id="MeshManager-893"><a href="#MeshManager-893"><span class="linenos"> 893</span></a>                        <span class="k">return</span> <span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
</span><span id="MeshManager-894"><a href="#MeshManager-894"><span class="linenos"> 894</span></a>
</span><span id="MeshManager-895"><a href="#MeshManager-895"><span class="linenos"> 895</span></a>                    <span class="n">comps_filtered</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MeshManager-896"><a href="#MeshManager-896"><span class="linenos"> 896</span></a>                        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comps</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_component_faces</span><span class="p">)</span>
</span><span id="MeshManager-897"><a href="#MeshManager-897"><span class="linenos"> 897</span></a>                    <span class="p">]</span>
</span><span id="MeshManager-898"><a href="#MeshManager-898"><span class="linenos"> 898</span></a>                    <span class="n">use</span> <span class="o">=</span> <span class="n">comps_filtered</span> <span class="k">if</span> <span class="n">comps_filtered</span> <span class="k">else</span> <span class="n">comps</span>
</span><span id="MeshManager-899"><a href="#MeshManager-899"><span class="linenos"> 899</span></a>                    <span class="n">repaired</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">use</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">comp_key</span><span class="p">)</span>
</span><span id="MeshManager-900"><a href="#MeshManager-900"><span class="linenos"> 900</span></a>                    <span class="n">repaired</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager-901"><a href="#MeshManager-901"><span class="linenos"> 901</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-902"><a href="#MeshManager-902"><span class="linenos"> 902</span></a>                <span class="k">pass</span>
</span><span id="MeshManager-903"><a href="#MeshManager-903"><span class="linenos"> 903</span></a>
</span><span id="MeshManager-904"><a href="#MeshManager-904"><span class="linenos"> 904</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">repaired</span>
</span><span id="MeshManager-905"><a href="#MeshManager-905"><span class="linenos"> 905</span></a>        <span class="k">return</span> <span class="n">repaired</span>
</span><span id="MeshManager-906"><a href="#MeshManager-906"><span class="linenos"> 906</span></a>
</span><span id="MeshManager-907"><a href="#MeshManager-907"><span class="linenos"> 907</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_mesh_3d</span><span class="p">(</span>
</span><span id="MeshManager-908"><a href="#MeshManager-908"><span class="linenos"> 908</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-909"><a href="#MeshManager-909"><span class="linenos"> 909</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3D Mesh Visualization&quot;</span><span class="p">,</span>
</span><span id="MeshManager-910"><a href="#MeshManager-910"><span class="linenos"> 910</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
</span><span id="MeshManager-911"><a href="#MeshManager-911"><span class="linenos"> 911</span></a>        <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="MeshManager-912"><a href="#MeshManager-912"><span class="linenos"> 912</span></a>        <span class="n">show_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-913"><a href="#MeshManager-913"><span class="linenos"> 913</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-914"><a href="#MeshManager-914"><span class="linenos"> 914</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="MeshManager-915"><a href="#MeshManager-915"><span class="linenos"> 915</span></a>        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
</span><span id="MeshManager-916"><a href="#MeshManager-916"><span class="linenos"> 916</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
</span><span id="MeshManager-917"><a href="#MeshManager-917"><span class="linenos"> 917</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-918"><a href="#MeshManager-918"><span class="linenos"> 918</span></a><span class="sd">        Create a 3D visualization of a mesh.</span>
</span><span id="MeshManager-919"><a href="#MeshManager-919"><span class="linenos"> 919</span></a>
</span><span id="MeshManager-920"><a href="#MeshManager-920"><span class="linenos"> 920</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-921"><a href="#MeshManager-921"><span class="linenos"> 921</span></a><span class="sd">            title: Plot title</span>
</span><span id="MeshManager-922"><a href="#MeshManager-922"><span class="linenos"> 922</span></a><span class="sd">            color: Mesh color (named color or RGB tuple)</span>
</span><span id="MeshManager-923"><a href="#MeshManager-923"><span class="linenos"> 923</span></a><span class="sd">            backend: Visualization backend (&#39;plotly&#39; or &#39;matplotlib&#39;)</span>
</span><span id="MeshManager-924"><a href="#MeshManager-924"><span class="linenos"> 924</span></a><span class="sd">            show_axes: Whether to show coordinate axes</span>
</span><span id="MeshManager-925"><a href="#MeshManager-925"><span class="linenos"> 925</span></a><span class="sd">            show_wireframe: Whether to show wireframe overlay</span>
</span><span id="MeshManager-926"><a href="#MeshManager-926"><span class="linenos"> 926</span></a>
</span><span id="MeshManager-927"><a href="#MeshManager-927"><span class="linenos"> 927</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-928"><a href="#MeshManager-928"><span class="linenos"> 928</span></a><span class="sd">            Figure object (backend-dependent) or None if visualization fails</span>
</span><span id="MeshManager-929"><a href="#MeshManager-929"><span class="linenos"> 929</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-930"><a href="#MeshManager-930"><span class="linenos"> 930</span></a>        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="MeshManager-931"><a href="#MeshManager-931"><span class="linenos"> 931</span></a>            <span class="c1"># Try plotly first, then fallback to others</span>
</span><span id="MeshManager-932"><a href="#MeshManager-932"><span class="linenos"> 932</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-933"><a href="#MeshManager-933"><span class="linenos"> 933</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager-934"><a href="#MeshManager-934"><span class="linenos"> 934</span></a>
</span><span id="MeshManager-935"><a href="#MeshManager-935"><span class="linenos"> 935</span></a>                <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;plotly&quot;</span>
</span><span id="MeshManager-936"><a href="#MeshManager-936"><span class="linenos"> 936</span></a>            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager-937"><a href="#MeshManager-937"><span class="linenos"> 937</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-938"><a href="#MeshManager-938"><span class="linenos"> 938</span></a>                    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="MeshManager-939"><a href="#MeshManager-939"><span class="linenos"> 939</span></a>
</span><span id="MeshManager-940"><a href="#MeshManager-940"><span class="linenos"> 940</span></a>                    <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;matplotlib&quot;</span>
</span><span id="MeshManager-941"><a href="#MeshManager-941"><span class="linenos"> 941</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager-942"><a href="#MeshManager-942"><span class="linenos"> 942</span></a>                    <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;plotly&quot;</span>
</span><span id="MeshManager-943"><a href="#MeshManager-943"><span class="linenos"> 943</span></a>
</span><span id="MeshManager-944"><a href="#MeshManager-944"><span class="linenos"> 944</span></a>        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;plotly&quot;</span><span class="p">:</span>
</span><span id="MeshManager-945"><a href="#MeshManager-945"><span class="linenos"> 945</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_mesh_plotly</span><span class="p">(</span>
</span><span id="MeshManager-946"><a href="#MeshManager-946"><span class="linenos"> 946</span></a>                <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_axes</span><span class="p">,</span> <span class="n">show_wireframe</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
</span><span id="MeshManager-947"><a href="#MeshManager-947"><span class="linenos"> 947</span></a>            <span class="p">)</span>
</span><span id="MeshManager-948"><a href="#MeshManager-948"><span class="linenos"> 948</span></a>        <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;matplotlib&quot;</span><span class="p">:</span>
</span><span id="MeshManager-949"><a href="#MeshManager-949"><span class="linenos"> 949</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_mesh_matplotlib</span><span class="p">(</span>
</span><span id="MeshManager-950"><a href="#MeshManager-950"><span class="linenos"> 950</span></a>                <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_axes</span><span class="p">,</span> <span class="n">show_wireframe</span>
</span><span id="MeshManager-951"><a href="#MeshManager-951"><span class="linenos"> 951</span></a>            <span class="p">)</span>
</span><span id="MeshManager-952"><a href="#MeshManager-952"><span class="linenos"> 952</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-953"><a href="#MeshManager-953"><span class="linenos"> 953</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown backend: </span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-954"><a href="#MeshManager-954"><span class="linenos"> 954</span></a>
</span><span id="MeshManager-955"><a href="#MeshManager-955"><span class="linenos"> 955</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_visualize_mesh_plotly</span><span class="p">(</span>
</span><span id="MeshManager-956"><a href="#MeshManager-956"><span class="linenos"> 956</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_axes</span><span class="p">,</span> <span class="n">show_wireframe</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span>
</span><span id="MeshManager-957"><a href="#MeshManager-957"><span class="linenos"> 957</span></a>    <span class="p">):</span>
</span><span id="MeshManager-958"><a href="#MeshManager-958"><span class="linenos"> 958</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plotly-based mesh visualization.&quot;&quot;&quot;</span>
</span><span id="MeshManager-959"><a href="#MeshManager-959"><span class="linenos"> 959</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-960"><a href="#MeshManager-960"><span class="linenos"> 960</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager-961"><a href="#MeshManager-961"><span class="linenos"> 961</span></a>
</span><span id="MeshManager-962"><a href="#MeshManager-962"><span class="linenos"> 962</span></a>            <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager-963"><a href="#MeshManager-963"><span class="linenos"> 963</span></a>            <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span>
</span><span id="MeshManager-964"><a href="#MeshManager-964"><span class="linenos"> 964</span></a>
</span><span id="MeshManager-965"><a href="#MeshManager-965"><span class="linenos"> 965</span></a>            <span class="c1"># Create mesh trace</span>
</span><span id="MeshManager-966"><a href="#MeshManager-966"><span class="linenos"> 966</span></a>            <span class="n">mesh_trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span>
</span><span id="MeshManager-967"><a href="#MeshManager-967"><span class="linenos"> 967</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-968"><a href="#MeshManager-968"><span class="linenos"> 968</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-969"><a href="#MeshManager-969"><span class="linenos"> 969</span></a>                <span class="n">z</span><span class="o">=</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-970"><a href="#MeshManager-970"><span class="linenos"> 970</span></a>                <span class="n">i</span><span class="o">=</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-971"><a href="#MeshManager-971"><span class="linenos"> 971</span></a>                <span class="n">j</span><span class="o">=</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-972"><a href="#MeshManager-972"><span class="linenos"> 972</span></a>                <span class="n">k</span><span class="o">=</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-973"><a href="#MeshManager-973"><span class="linenos"> 973</span></a>                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
</span><span id="MeshManager-974"><a href="#MeshManager-974"><span class="linenos"> 974</span></a>                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="MeshManager-975"><a href="#MeshManager-975"><span class="linenos"> 975</span></a>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mesh&quot;</span><span class="p">,</span>
</span><span id="MeshManager-976"><a href="#MeshManager-976"><span class="linenos"> 976</span></a>            <span class="p">)</span>
</span><span id="MeshManager-977"><a href="#MeshManager-977"><span class="linenos"> 977</span></a>
</span><span id="MeshManager-978"><a href="#MeshManager-978"><span class="linenos"> 978</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">mesh_trace</span><span class="p">])</span>
</span><span id="MeshManager-979"><a href="#MeshManager-979"><span class="linenos"> 979</span></a>
</span><span id="MeshManager-980"><a href="#MeshManager-980"><span class="linenos"> 980</span></a>            <span class="c1"># Add wireframe if requested</span>
</span><span id="MeshManager-981"><a href="#MeshManager-981"><span class="linenos"> 981</span></a>            <span class="k">if</span> <span class="n">show_wireframe</span><span class="p">:</span>
</span><span id="MeshManager-982"><a href="#MeshManager-982"><span class="linenos"> 982</span></a>                <span class="c1"># Create wireframe edges</span>
</span><span id="MeshManager-983"><a href="#MeshManager-983"><span class="linenos"> 983</span></a>                <span class="n">edge_trace</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager-984"><a href="#MeshManager-984"><span class="linenos"> 984</span></a>                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
</span><span id="MeshManager-985"><a href="#MeshManager-985"><span class="linenos"> 985</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span><span id="MeshManager-986"><a href="#MeshManager-986"><span class="linenos"> 986</span></a>                        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">face</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="MeshManager-987"><a href="#MeshManager-987"><span class="linenos"> 987</span></a>                        <span class="n">edge_trace</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="MeshManager-988"><a href="#MeshManager-988"><span class="linenos"> 988</span></a>                            <span class="p">[</span>
</span><span id="MeshManager-989"><a href="#MeshManager-989"><span class="linenos"> 989</span></a>                                <span class="n">vertices</span><span class="p">[</span><span class="n">v1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-990"><a href="#MeshManager-990"><span class="linenos"> 990</span></a>                                <span class="n">vertices</span><span class="p">[</span><span class="n">v2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-991"><a href="#MeshManager-991"><span class="linenos"> 991</span></a>                                <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-992"><a href="#MeshManager-992"><span class="linenos"> 992</span></a>                                <span class="n">vertices</span><span class="p">[</span><span class="n">v1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-993"><a href="#MeshManager-993"><span class="linenos"> 993</span></a>                                <span class="n">vertices</span><span class="p">[</span><span class="n">v2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-994"><a href="#MeshManager-994"><span class="linenos"> 994</span></a>                                <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-995"><a href="#MeshManager-995"><span class="linenos"> 995</span></a>                                <span class="n">vertices</span><span class="p">[</span><span class="n">v1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-996"><a href="#MeshManager-996"><span class="linenos"> 996</span></a>                                <span class="n">vertices</span><span class="p">[</span><span class="n">v2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-997"><a href="#MeshManager-997"><span class="linenos"> 997</span></a>                                <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-998"><a href="#MeshManager-998"><span class="linenos"> 998</span></a>                            <span class="p">]</span>
</span><span id="MeshManager-999"><a href="#MeshManager-999"><span class="linenos"> 999</span></a>                        <span class="p">)</span>
</span><span id="MeshManager-1000"><a href="#MeshManager-1000"><span class="linenos">1000</span></a>
</span><span id="MeshManager-1001"><a href="#MeshManager-1001"><span class="linenos">1001</span></a>                <span class="k">if</span> <span class="n">edge_trace</span><span class="p">:</span>
</span><span id="MeshManager-1002"><a href="#MeshManager-1002"><span class="linenos">1002</span></a>                    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="MeshManager-1003"><a href="#MeshManager-1003"><span class="linenos">1003</span></a>                        <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
</span><span id="MeshManager-1004"><a href="#MeshManager-1004"><span class="linenos">1004</span></a>                            <span class="n">x</span><span class="o">=</span><span class="n">edge_trace</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span>
</span><span id="MeshManager-1005"><a href="#MeshManager-1005"><span class="linenos">1005</span></a>                            <span class="n">y</span><span class="o">=</span><span class="n">edge_trace</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">],</span>
</span><span id="MeshManager-1006"><a href="#MeshManager-1006"><span class="linenos">1006</span></a>                            <span class="n">z</span><span class="o">=</span><span class="n">edge_trace</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">3</span><span class="p">],</span>
</span><span id="MeshManager-1007"><a href="#MeshManager-1007"><span class="linenos">1007</span></a>                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1008"><a href="#MeshManager-1008"><span class="linenos">1008</span></a>                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
</span><span id="MeshManager-1009"><a href="#MeshManager-1009"><span class="linenos">1009</span></a>                            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Wireframe&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1010"><a href="#MeshManager-1010"><span class="linenos">1010</span></a>                        <span class="p">)</span>
</span><span id="MeshManager-1011"><a href="#MeshManager-1011"><span class="linenos">1011</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-1012"><a href="#MeshManager-1012"><span class="linenos">1012</span></a>
</span><span id="MeshManager-1013"><a href="#MeshManager-1013"><span class="linenos">1013</span></a>            <span class="c1"># Configure layout</span>
</span><span id="MeshManager-1014"><a href="#MeshManager-1014"><span class="linenos">1014</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="MeshManager-1015"><a href="#MeshManager-1015"><span class="linenos">1015</span></a>                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="MeshManager-1016"><a href="#MeshManager-1016"><span class="linenos">1016</span></a>                <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-1017"><a href="#MeshManager-1017"><span class="linenos">1017</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="MeshManager-1018"><a href="#MeshManager-1018"><span class="linenos">1018</span></a>                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="MeshManager-1019"><a href="#MeshManager-1019"><span class="linenos">1019</span></a>                <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1020"><a href="#MeshManager-1020"><span class="linenos">1020</span></a>                    <span class="n">aspectmode</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1021"><a href="#MeshManager-1021"><span class="linenos">1021</span></a>                    <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="n">show_axes</span><span class="p">),</span>
</span><span id="MeshManager-1022"><a href="#MeshManager-1022"><span class="linenos">1022</span></a>                    <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="n">show_axes</span><span class="p">),</span>
</span><span id="MeshManager-1023"><a href="#MeshManager-1023"><span class="linenos">1023</span></a>                    <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="n">show_axes</span><span class="p">),</span>
</span><span id="MeshManager-1024"><a href="#MeshManager-1024"><span class="linenos">1024</span></a>                <span class="p">),</span>
</span><span id="MeshManager-1025"><a href="#MeshManager-1025"><span class="linenos">1025</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1026"><a href="#MeshManager-1026"><span class="linenos">1026</span></a>
</span><span id="MeshManager-1027"><a href="#MeshManager-1027"><span class="linenos">1027</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="MeshManager-1028"><a href="#MeshManager-1028"><span class="linenos">1028</span></a>
</span><span id="MeshManager-1029"><a href="#MeshManager-1029"><span class="linenos">1029</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager-1030"><a href="#MeshManager-1030"><span class="linenos">1030</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotly not available&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1031"><a href="#MeshManager-1031"><span class="linenos">1031</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1032"><a href="#MeshManager-1032"><span class="linenos">1032</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-1033"><a href="#MeshManager-1033"><span class="linenos">1033</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotly visualization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1034"><a href="#MeshManager-1034"><span class="linenos">1034</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1035"><a href="#MeshManager-1035"><span class="linenos">1035</span></a>
</span><span id="MeshManager-1036"><a href="#MeshManager-1036"><span class="linenos">1036</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_visualize_mesh_matplotlib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_axes</span><span class="p">,</span> <span class="n">show_wireframe</span><span class="p">):</span>
</span><span id="MeshManager-1037"><a href="#MeshManager-1037"><span class="linenos">1037</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Matplotlib-based mesh visualization.&quot;&quot;&quot;</span>
</span><span id="MeshManager-1038"><a href="#MeshManager-1038"><span class="linenos">1038</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1039"><a href="#MeshManager-1039"><span class="linenos">1039</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="MeshManager-1040"><a href="#MeshManager-1040"><span class="linenos">1040</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.mplot3d.art3d</span><span class="w"> </span><span class="kn">import</span> <span class="n">Poly3DCollection</span>
</span><span id="MeshManager-1041"><a href="#MeshManager-1041"><span class="linenos">1041</span></a>
</span><span id="MeshManager-1042"><a href="#MeshManager-1042"><span class="linenos">1042</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</span><span id="MeshManager-1043"><a href="#MeshManager-1043"><span class="linenos">1043</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1044"><a href="#MeshManager-1044"><span class="linenos">1044</span></a>
</span><span id="MeshManager-1045"><a href="#MeshManager-1045"><span class="linenos">1045</span></a>            <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager-1046"><a href="#MeshManager-1046"><span class="linenos">1046</span></a>            <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span>
</span><span id="MeshManager-1047"><a href="#MeshManager-1047"><span class="linenos">1047</span></a>
</span><span id="MeshManager-1048"><a href="#MeshManager-1048"><span class="linenos">1048</span></a>            <span class="c1"># Create mesh surface</span>
</span><span id="MeshManager-1049"><a href="#MeshManager-1049"><span class="linenos">1049</span></a>            <span class="n">poly3d</span> <span class="o">=</span> <span class="n">Poly3DCollection</span><span class="p">(</span>
</span><span id="MeshManager-1050"><a href="#MeshManager-1050"><span class="linenos">1050</span></a>                <span class="n">vertices</span><span class="p">[</span><span class="n">faces</span><span class="p">],</span>
</span><span id="MeshManager-1051"><a href="#MeshManager-1051"><span class="linenos">1051</span></a>                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="MeshManager-1052"><a href="#MeshManager-1052"><span class="linenos">1052</span></a>                <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="MeshManager-1053"><a href="#MeshManager-1053"><span class="linenos">1053</span></a>                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span> <span class="k">if</span> <span class="n">show_wireframe</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-1054"><a href="#MeshManager-1054"><span class="linenos">1054</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1055"><a href="#MeshManager-1055"><span class="linenos">1055</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">poly3d</span><span class="p">)</span>
</span><span id="MeshManager-1056"><a href="#MeshManager-1056"><span class="linenos">1056</span></a>
</span><span id="MeshManager-1057"><a href="#MeshManager-1057"><span class="linenos">1057</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="MeshManager-1058"><a href="#MeshManager-1058"><span class="linenos">1058</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="MeshManager-1059"><a href="#MeshManager-1059"><span class="linenos">1059</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="MeshManager-1060"><a href="#MeshManager-1060"><span class="linenos">1060</span></a>
</span><span id="MeshManager-1061"><a href="#MeshManager-1061"><span class="linenos">1061</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X (m)&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1062"><a href="#MeshManager-1062"><span class="linenos">1062</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y (m)&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1063"><a href="#MeshManager-1063"><span class="linenos">1063</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Z (m)&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1064"><a href="#MeshManager-1064"><span class="linenos">1064</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="MeshManager-1065"><a href="#MeshManager-1065"><span class="linenos">1065</span></a>
</span><span id="MeshManager-1066"><a href="#MeshManager-1066"><span class="linenos">1066</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">show_axes</span><span class="p">:</span>
</span><span id="MeshManager-1067"><a href="#MeshManager-1067"><span class="linenos">1067</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="MeshManager-1068"><a href="#MeshManager-1068"><span class="linenos">1068</span></a>
</span><span id="MeshManager-1069"><a href="#MeshManager-1069"><span class="linenos">1069</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="MeshManager-1070"><a href="#MeshManager-1070"><span class="linenos">1070</span></a>            <span class="k">return</span> <span class="n">fig</span>
</span><span id="MeshManager-1071"><a href="#MeshManager-1071"><span class="linenos">1071</span></a>
</span><span id="MeshManager-1072"><a href="#MeshManager-1072"><span class="linenos">1072</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager-1073"><a href="#MeshManager-1073"><span class="linenos">1073</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Matplotlib not available&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1074"><a href="#MeshManager-1074"><span class="linenos">1074</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1075"><a href="#MeshManager-1075"><span class="linenos">1075</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-1076"><a href="#MeshManager-1076"><span class="linenos">1076</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Matplotlib visualization failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1077"><a href="#MeshManager-1077"><span class="linenos">1077</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1078"><a href="#MeshManager-1078"><span class="linenos">1078</span></a>
</span><span id="MeshManager-1079"><a href="#MeshManager-1079"><span class="linenos">1079</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_mesh_slice_interactive</span><span class="p">(</span>
</span><span id="MeshManager-1080"><a href="#MeshManager-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-1081"><a href="#MeshManager-1081"><span class="linenos">1081</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Interactive Mesh Slice&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1082"><a href="#MeshManager-1082"><span class="linenos">1082</span></a>        <span class="n">z_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-1083"><a href="#MeshManager-1083"><span class="linenos">1083</span></a>        <span class="n">num_slices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="MeshManager-1084"><a href="#MeshManager-1084"><span class="linenos">1084</span></a>        <span class="n">slice_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1085"><a href="#MeshManager-1085"><span class="linenos">1085</span></a>        <span class="n">mesh_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1086"><a href="#MeshManager-1086"><span class="linenos">1086</span></a>        <span class="n">mesh_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="MeshManager-1087"><a href="#MeshManager-1087"><span class="linenos">1087</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
</span><span id="MeshManager-1088"><a href="#MeshManager-1088"><span class="linenos">1088</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-1089"><a href="#MeshManager-1089"><span class="linenos">1089</span></a><span class="sd">        Create an interactive 3D visualization of a mesh with a controllable slice plane.</span>
</span><span id="MeshManager-1090"><a href="#MeshManager-1090"><span class="linenos">1090</span></a>
</span><span id="MeshManager-1091"><a href="#MeshManager-1091"><span class="linenos">1091</span></a><span class="sd">        This function displays a 3D mesh and calculates the intersection of the mesh</span>
</span><span id="MeshManager-1092"><a href="#MeshManager-1092"><span class="linenos">1092</span></a><span class="sd">        with an xy-plane at a user-controlled z-value. The intersection is shown as a</span>
</span><span id="MeshManager-1093"><a href="#MeshManager-1093"><span class="linenos">1093</span></a><span class="sd">        colored line on the mesh. A slider allows the user to interactively change the</span>
</span><span id="MeshManager-1094"><a href="#MeshManager-1094"><span class="linenos">1094</span></a><span class="sd">        z-value of the intersection plane.</span>
</span><span id="MeshManager-1095"><a href="#MeshManager-1095"><span class="linenos">1095</span></a>
</span><span id="MeshManager-1096"><a href="#MeshManager-1096"><span class="linenos">1096</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-1097"><a href="#MeshManager-1097"><span class="linenos">1097</span></a><span class="sd">            title: Plot title</span>
</span><span id="MeshManager-1098"><a href="#MeshManager-1098"><span class="linenos">1098</span></a><span class="sd">            z_range: Tuple of (min_z, max_z) for slice range. Auto-detected if None.</span>
</span><span id="MeshManager-1099"><a href="#MeshManager-1099"><span class="linenos">1099</span></a><span class="sd">            num_slices: Number of positions for the slider</span>
</span><span id="MeshManager-1100"><a href="#MeshManager-1100"><span class="linenos">1100</span></a><span class="sd">            slice_color: Color for the intersection line</span>
</span><span id="MeshManager-1101"><a href="#MeshManager-1101"><span class="linenos">1101</span></a><span class="sd">            mesh_color: Color for the 3D mesh</span>
</span><span id="MeshManager-1102"><a href="#MeshManager-1102"><span class="linenos">1102</span></a><span class="sd">            mesh_opacity: Opacity of the 3D mesh (0-1)</span>
</span><span id="MeshManager-1103"><a href="#MeshManager-1103"><span class="linenos">1103</span></a>
</span><span id="MeshManager-1104"><a href="#MeshManager-1104"><span class="linenos">1104</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-1105"><a href="#MeshManager-1105"><span class="linenos">1105</span></a><span class="sd">            Plotly figure with interactive slider for controlling the z-value</span>
</span><span id="MeshManager-1106"><a href="#MeshManager-1106"><span class="linenos">1106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-1107"><a href="#MeshManager-1107"><span class="linenos">1107</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1108"><a href="#MeshManager-1108"><span class="linenos">1108</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager-1109"><a href="#MeshManager-1109"><span class="linenos">1109</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager-1110"><a href="#MeshManager-1110"><span class="linenos">1110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotly is required for interactive visualization&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1111"><a href="#MeshManager-1111"><span class="linenos">1111</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1112"><a href="#MeshManager-1112"><span class="linenos">1112</span></a>
</span><span id="MeshManager-1113"><a href="#MeshManager-1113"><span class="linenos">1113</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-1114"><a href="#MeshManager-1114"><span class="linenos">1114</span></a>
</span><span id="MeshManager-1115"><a href="#MeshManager-1115"><span class="linenos">1115</span></a>        <span class="c1"># Determine z-range if not provided</span>
</span><span id="MeshManager-1116"><a href="#MeshManager-1116"><span class="linenos">1116</span></a>        <span class="k">if</span> <span class="n">z_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-1117"><a href="#MeshManager-1117"><span class="linenos">1117</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="MeshManager-1118"><a href="#MeshManager-1118"><span class="linenos">1118</span></a>            <span class="c1"># Add small padding</span>
</span><span id="MeshManager-1119"><a href="#MeshManager-1119"><span class="linenos">1119</span></a>            <span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_max</span> <span class="o">-</span> <span class="n">z_min</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span>
</span><span id="MeshManager-1120"><a href="#MeshManager-1120"><span class="linenos">1120</span></a>            <span class="n">z_min</span> <span class="o">-=</span> <span class="n">padding</span>
</span><span id="MeshManager-1121"><a href="#MeshManager-1121"><span class="linenos">1121</span></a>            <span class="n">z_max</span> <span class="o">+=</span> <span class="n">padding</span>
</span><span id="MeshManager-1122"><a href="#MeshManager-1122"><span class="linenos">1122</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-1123"><a href="#MeshManager-1123"><span class="linenos">1123</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">z_range</span>
</span><span id="MeshManager-1124"><a href="#MeshManager-1124"><span class="linenos">1124</span></a>
</span><span id="MeshManager-1125"><a href="#MeshManager-1125"><span class="linenos">1125</span></a>        <span class="c1"># Create the base figure with the mesh</span>
</span><span id="MeshManager-1126"><a href="#MeshManager-1126"><span class="linenos">1126</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
</span><span id="MeshManager-1127"><a href="#MeshManager-1127"><span class="linenos">1127</span></a>
</span><span id="MeshManager-1128"><a href="#MeshManager-1128"><span class="linenos">1128</span></a>        <span class="c1"># Add the mesh to the figure</span>
</span><span id="MeshManager-1129"><a href="#MeshManager-1129"><span class="linenos">1129</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="MeshManager-1130"><a href="#MeshManager-1130"><span class="linenos">1130</span></a>            <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span>
</span><span id="MeshManager-1131"><a href="#MeshManager-1131"><span class="linenos">1131</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-1132"><a href="#MeshManager-1132"><span class="linenos">1132</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-1133"><a href="#MeshManager-1133"><span class="linenos">1133</span></a>                <span class="n">z</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-1134"><a href="#MeshManager-1134"><span class="linenos">1134</span></a>                <span class="n">i</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-1135"><a href="#MeshManager-1135"><span class="linenos">1135</span></a>                <span class="n">j</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-1136"><a href="#MeshManager-1136"><span class="linenos">1136</span></a>                <span class="n">k</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager-1137"><a href="#MeshManager-1137"><span class="linenos">1137</span></a>                <span class="n">opacity</span><span class="o">=</span><span class="n">mesh_opacity</span><span class="p">,</span>
</span><span id="MeshManager-1138"><a href="#MeshManager-1138"><span class="linenos">1138</span></a>                <span class="n">color</span><span class="o">=</span><span class="n">mesh_color</span><span class="p">,</span>
</span><span id="MeshManager-1139"><a href="#MeshManager-1139"><span class="linenos">1139</span></a>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mesh&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1140"><a href="#MeshManager-1140"><span class="linenos">1140</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1141"><a href="#MeshManager-1141"><span class="linenos">1141</span></a>        <span class="p">)</span>
</span><span id="MeshManager-1142"><a href="#MeshManager-1142"><span class="linenos">1142</span></a>
</span><span id="MeshManager-1143"><a href="#MeshManager-1143"><span class="linenos">1143</span></a>        <span class="c1"># Function to create a slice at a given z-value</span>
</span><span id="MeshManager-1144"><a href="#MeshManager-1144"><span class="linenos">1144</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_slice_trace</span><span class="p">(</span><span class="n">z_value</span><span class="p">):</span>
</span><span id="MeshManager-1145"><a href="#MeshManager-1145"><span class="linenos">1145</span></a>            <span class="c1"># Calculate intersection with plane at z_value</span>
</span><span id="MeshManager-1146"><a href="#MeshManager-1146"><span class="linenos">1146</span></a>            <span class="n">section</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">plane_origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z_value</span><span class="p">],</span> <span class="n">plane_normal</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="MeshManager-1147"><a href="#MeshManager-1147"><span class="linenos">1147</span></a>
</span><span id="MeshManager-1148"><a href="#MeshManager-1148"><span class="linenos">1148</span></a>            <span class="c1"># If no intersection, return None</span>
</span><span id="MeshManager-1149"><a href="#MeshManager-1149"><span class="linenos">1149</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MeshManager-1150"><a href="#MeshManager-1150"><span class="linenos">1150</span></a>                <span class="n">section</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="MeshManager-1151"><a href="#MeshManager-1151"><span class="linenos">1151</span></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;entities&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1152"><a href="#MeshManager-1152"><span class="linenos">1152</span></a>                <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MeshManager-1153"><a href="#MeshManager-1153"><span class="linenos">1153</span></a>            <span class="p">):</span>
</span><span id="MeshManager-1154"><a href="#MeshManager-1154"><span class="linenos">1154</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1155"><a href="#MeshManager-1155"><span class="linenos">1155</span></a>
</span><span id="MeshManager-1156"><a href="#MeshManager-1156"><span class="linenos">1156</span></a>            <span class="c1"># Process all entities in the section to get 3D coordinates</span>
</span><span id="MeshManager-1157"><a href="#MeshManager-1157"><span class="linenos">1157</span></a>            <span class="n">all_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager-1158"><a href="#MeshManager-1158"><span class="linenos">1158</span></a>
</span><span id="MeshManager-1159"><a href="#MeshManager-1159"><span class="linenos">1159</span></a>            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
</span><span id="MeshManager-1160"><a href="#MeshManager-1160"><span class="linenos">1160</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager-1161"><a href="#MeshManager-1161"><span class="linenos">1161</span></a>                    <span class="c1"># Get the actual 2D coordinates</span>
</span><span id="MeshManager-1162"><a href="#MeshManager-1162"><span class="linenos">1162</span></a>                    <span class="n">points_2d</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
</span><span id="MeshManager-1163"><a href="#MeshManager-1163"><span class="linenos">1163</span></a>
</span><span id="MeshManager-1164"><a href="#MeshManager-1164"><span class="linenos">1164</span></a>                    <span class="c1"># Convert to 3D by adding z_value</span>
</span><span id="MeshManager-1165"><a href="#MeshManager-1165"><span class="linenos">1165</span></a>                    <span class="n">points_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
</span><span id="MeshManager-1166"><a href="#MeshManager-1166"><span class="linenos">1166</span></a>                        <span class="p">[</span><span class="n">points_2d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points_2d</span><span class="p">),</span> <span class="n">z_value</span><span class="p">)]</span>
</span><span id="MeshManager-1167"><a href="#MeshManager-1167"><span class="linenos">1167</span></a>                    <span class="p">)</span>
</span><span id="MeshManager-1168"><a href="#MeshManager-1168"><span class="linenos">1168</span></a>
</span><span id="MeshManager-1169"><a href="#MeshManager-1169"><span class="linenos">1169</span></a>                    <span class="c1"># Add closing point if needed (to complete the loop)</span>
</span><span id="MeshManager-1170"><a href="#MeshManager-1170"><span class="linenos">1170</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_2d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span>
</span><span id="MeshManager-1171"><a href="#MeshManager-1171"><span class="linenos">1171</span></a>                        <span class="n">points_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points_2d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MeshManager-1172"><a href="#MeshManager-1172"><span class="linenos">1172</span></a>                    <span class="p">):</span>
</span><span id="MeshManager-1173"><a href="#MeshManager-1173"><span class="linenos">1173</span></a>                        <span class="n">closing_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="MeshManager-1174"><a href="#MeshManager-1174"><span class="linenos">1174</span></a>                            <span class="p">[</span><span class="n">points_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">z_value</span><span class="p">]</span>
</span><span id="MeshManager-1175"><a href="#MeshManager-1175"><span class="linenos">1175</span></a>                        <span class="p">)</span>
</span><span id="MeshManager-1176"><a href="#MeshManager-1176"><span class="linenos">1176</span></a>                        <span class="n">points_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">points_3d</span><span class="p">,</span> <span class="n">closing_point</span><span class="p">])</span>
</span><span id="MeshManager-1177"><a href="#MeshManager-1177"><span class="linenos">1177</span></a>
</span><span id="MeshManager-1178"><a href="#MeshManager-1178"><span class="linenos">1178</span></a>                    <span class="c1"># Add to all points list</span>
</span><span id="MeshManager-1179"><a href="#MeshManager-1179"><span class="linenos">1179</span></a>                    <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">points_3d</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="MeshManager-1180"><a href="#MeshManager-1180"><span class="linenos">1180</span></a>
</span><span id="MeshManager-1181"><a href="#MeshManager-1181"><span class="linenos">1181</span></a>                    <span class="c1"># Add None to create a break between separate entities</span>
</span><span id="MeshManager-1182"><a href="#MeshManager-1182"><span class="linenos">1182</span></a>                    <span class="n">all_points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="MeshManager-1183"><a href="#MeshManager-1183"><span class="linenos">1183</span></a>
</span><span id="MeshManager-1184"><a href="#MeshManager-1184"><span class="linenos">1184</span></a>            <span class="c1"># If we have points, create a scatter trace</span>
</span><span id="MeshManager-1185"><a href="#MeshManager-1185"><span class="linenos">1185</span></a>            <span class="k">if</span> <span class="n">all_points</span><span class="p">:</span>
</span><span id="MeshManager-1186"><a href="#MeshManager-1186"><span class="linenos">1186</span></a>                <span class="n">x_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="MeshManager-1187"><a href="#MeshManager-1187"><span class="linenos">1187</span></a>                <span class="n">y_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="MeshManager-1188"><a href="#MeshManager-1188"><span class="linenos">1188</span></a>                <span class="n">z_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="MeshManager-1189"><a href="#MeshManager-1189"><span class="linenos">1189</span></a>
</span><span id="MeshManager-1190"><a href="#MeshManager-1190"><span class="linenos">1190</span></a>                <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
</span><span id="MeshManager-1191"><a href="#MeshManager-1191"><span class="linenos">1191</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">x_coords</span><span class="p">,</span>
</span><span id="MeshManager-1192"><a href="#MeshManager-1192"><span class="linenos">1192</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">y_coords</span><span class="p">,</span>
</span><span id="MeshManager-1193"><a href="#MeshManager-1193"><span class="linenos">1193</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z_coords</span><span class="p">,</span>
</span><span id="MeshManager-1194"><a href="#MeshManager-1194"><span class="linenos">1194</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1195"><a href="#MeshManager-1195"><span class="linenos">1195</span></a>                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">slice_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
</span><span id="MeshManager-1196"><a href="#MeshManager-1196"><span class="linenos">1196</span></a>                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Slice at z=</span><span class="si">{</span><span class="n">z_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1197"><a href="#MeshManager-1197"><span class="linenos">1197</span></a>                <span class="p">)</span>
</span><span id="MeshManager-1198"><a href="#MeshManager-1198"><span class="linenos">1198</span></a>
</span><span id="MeshManager-1199"><a href="#MeshManager-1199"><span class="linenos">1199</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1200"><a href="#MeshManager-1200"><span class="linenos">1200</span></a>
</span><span id="MeshManager-1201"><a href="#MeshManager-1201"><span class="linenos">1201</span></a>        <span class="c1"># Create initial slice</span>
</span><span id="MeshManager-1202"><a href="#MeshManager-1202"><span class="linenos">1202</span></a>        <span class="n">initial_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_min</span> <span class="o">+</span> <span class="n">z_max</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="MeshManager-1203"><a href="#MeshManager-1203"><span class="linenos">1203</span></a>        <span class="n">initial_slice</span> <span class="o">=</span> <span class="n">create_slice_trace</span><span class="p">(</span><span class="n">initial_z</span><span class="p">)</span>
</span><span id="MeshManager-1204"><a href="#MeshManager-1204"><span class="linenos">1204</span></a>
</span><span id="MeshManager-1205"><a href="#MeshManager-1205"><span class="linenos">1205</span></a>        <span class="c1"># Add initial slice to figure if it exists</span>
</span><span id="MeshManager-1206"><a href="#MeshManager-1206"><span class="linenos">1206</span></a>        <span class="k">if</span> <span class="n">initial_slice</span><span class="p">:</span>
</span><span id="MeshManager-1207"><a href="#MeshManager-1207"><span class="linenos">1207</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">initial_slice</span><span class="p">)</span>
</span><span id="MeshManager-1208"><a href="#MeshManager-1208"><span class="linenos">1208</span></a>
</span><span id="MeshManager-1209"><a href="#MeshManager-1209"><span class="linenos">1209</span></a>        <span class="c1"># Create frames for animation</span>
</span><span id="MeshManager-1210"><a href="#MeshManager-1210"><span class="linenos">1210</span></a>        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager-1211"><a href="#MeshManager-1211"><span class="linenos">1211</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">num_slices</span><span class="p">)):</span>
</span><span id="MeshManager-1212"><a href="#MeshManager-1212"><span class="linenos">1212</span></a>            <span class="c1"># Create a slice at this z-value</span>
</span><span id="MeshManager-1213"><a href="#MeshManager-1213"><span class="linenos">1213</span></a>            <span class="n">slice_trace</span> <span class="o">=</span> <span class="n">create_slice_trace</span><span class="p">(</span><span class="n">z_val</span><span class="p">)</span>
</span><span id="MeshManager-1214"><a href="#MeshManager-1214"><span class="linenos">1214</span></a>
</span><span id="MeshManager-1215"><a href="#MeshManager-1215"><span class="linenos">1215</span></a>            <span class="c1"># If we have a valid slice, add it to frames</span>
</span><span id="MeshManager-1216"><a href="#MeshManager-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="n">slice_trace</span><span class="p">:</span>
</span><span id="MeshManager-1217"><a href="#MeshManager-1217"><span class="linenos">1217</span></a>                <span class="n">frame_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slice_trace</span><span class="p">]</span>  <span class="c1"># Mesh and slice</span>
</span><span id="MeshManager-1218"><a href="#MeshManager-1218"><span class="linenos">1218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-1219"><a href="#MeshManager-1219"><span class="linenos">1219</span></a>                <span class="n">frame_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Just the mesh</span>
</span><span id="MeshManager-1220"><a href="#MeshManager-1220"><span class="linenos">1220</span></a>
</span><span id="MeshManager-1221"><a href="#MeshManager-1221"><span class="linenos">1221</span></a>            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager-1222"><a href="#MeshManager-1222"><span class="linenos">1222</span></a>                <span class="n">go</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="MeshManager-1223"><a href="#MeshManager-1223"><span class="linenos">1223</span></a>                    <span class="n">data</span><span class="o">=</span><span class="n">frame_data</span><span class="p">,</span>
</span><span id="MeshManager-1224"><a href="#MeshManager-1224"><span class="linenos">1224</span></a>                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1225"><a href="#MeshManager-1225"><span class="linenos">1225</span></a>                    <span class="n">traces</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># Update both traces</span>
</span><span id="MeshManager-1226"><a href="#MeshManager-1226"><span class="linenos">1226</span></a>                <span class="p">)</span>
</span><span id="MeshManager-1227"><a href="#MeshManager-1227"><span class="linenos">1227</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1228"><a href="#MeshManager-1228"><span class="linenos">1228</span></a>
</span><span id="MeshManager-1229"><a href="#MeshManager-1229"><span class="linenos">1229</span></a>        <span class="c1"># Create slider steps</span>
</span><span id="MeshManager-1230"><a href="#MeshManager-1230"><span class="linenos">1230</span></a>        <span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager-1231"><a href="#MeshManager-1231"><span class="linenos">1231</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">num_slices</span><span class="p">)):</span>
</span><span id="MeshManager-1232"><a href="#MeshManager-1232"><span class="linenos">1232</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1233"><a href="#MeshManager-1233"><span class="linenos">1233</span></a>                <span class="n">args</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager-1234"><a href="#MeshManager-1234"><span class="linenos">1234</span></a>                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="MeshManager-1235"><a href="#MeshManager-1235"><span class="linenos">1235</span></a>                    <span class="p">{</span><span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;immediate&quot;</span><span class="p">},</span>
</span><span id="MeshManager-1236"><a href="#MeshManager-1236"><span class="linenos">1236</span></a>                <span class="p">],</span>
</span><span id="MeshManager-1237"><a href="#MeshManager-1237"><span class="linenos">1237</span></a>                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1238"><a href="#MeshManager-1238"><span class="linenos">1238</span></a>                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;animate&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1239"><a href="#MeshManager-1239"><span class="linenos">1239</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1240"><a href="#MeshManager-1240"><span class="linenos">1240</span></a>            <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</span><span id="MeshManager-1241"><a href="#MeshManager-1241"><span class="linenos">1241</span></a>
</span><span id="MeshManager-1242"><a href="#MeshManager-1242"><span class="linenos">1242</span></a>        <span class="c1"># Configure the slider</span>
</span><span id="MeshManager-1243"><a href="#MeshManager-1243"><span class="linenos">1243</span></a>        <span class="n">sliders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MeshManager-1244"><a href="#MeshManager-1244"><span class="linenos">1244</span></a>            <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1245"><a href="#MeshManager-1245"><span class="linenos">1245</span></a>                <span class="n">active</span><span class="o">=</span><span class="n">num_slices</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Start in the middle</span>
</span><span id="MeshManager-1246"><a href="#MeshManager-1246"><span class="linenos">1246</span></a>                <span class="n">currentvalue</span><span class="o">=</span><span class="p">{</span>
</span><span id="MeshManager-1247"><a href="#MeshManager-1247"><span class="linenos">1247</span></a>                    <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;Z-value: &quot;</span><span class="p">,</span>
</span><span id="MeshManager-1248"><a href="#MeshManager-1248"><span class="linenos">1248</span></a>                    <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-1249"><a href="#MeshManager-1249"><span class="linenos">1249</span></a>                    <span class="s2">&quot;xanchor&quot;</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1250"><a href="#MeshManager-1250"><span class="linenos">1250</span></a>                <span class="p">},</span>
</span><span id="MeshManager-1251"><a href="#MeshManager-1251"><span class="linenos">1251</span></a>                <span class="n">pad</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
</span><span id="MeshManager-1252"><a href="#MeshManager-1252"><span class="linenos">1252</span></a>                <span class="nb">len</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
</span><span id="MeshManager-1253"><a href="#MeshManager-1253"><span class="linenos">1253</span></a>                <span class="n">x</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="MeshManager-1254"><a href="#MeshManager-1254"><span class="linenos">1254</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-1255"><a href="#MeshManager-1255"><span class="linenos">1255</span></a>                <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
</span><span id="MeshManager-1256"><a href="#MeshManager-1256"><span class="linenos">1256</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1257"><a href="#MeshManager-1257"><span class="linenos">1257</span></a>        <span class="p">]</span>
</span><span id="MeshManager-1258"><a href="#MeshManager-1258"><span class="linenos">1258</span></a>
</span><span id="MeshManager-1259"><a href="#MeshManager-1259"><span class="linenos">1259</span></a>        <span class="c1"># Configure the figure layout</span>
</span><span id="MeshManager-1260"><a href="#MeshManager-1260"><span class="linenos">1260</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="MeshManager-1261"><a href="#MeshManager-1261"><span class="linenos">1261</span></a>            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="MeshManager-1262"><a href="#MeshManager-1262"><span class="linenos">1262</span></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspectmode</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">1.5</span><span class="p">))),</span>
</span><span id="MeshManager-1263"><a href="#MeshManager-1263"><span class="linenos">1263</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>  <span class="c1"># Taller to make room for slider</span>
</span><span id="MeshManager-1264"><a href="#MeshManager-1264"><span class="linenos">1264</span></a>            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>  <span class="c1"># Add margin at bottom for slider</span>
</span><span id="MeshManager-1265"><a href="#MeshManager-1265"><span class="linenos">1265</span></a>            <span class="n">sliders</span><span class="o">=</span><span class="n">sliders</span><span class="p">,</span>
</span><span id="MeshManager-1266"><a href="#MeshManager-1266"><span class="linenos">1266</span></a>            <span class="c1"># Add animation controls</span>
</span><span id="MeshManager-1267"><a href="#MeshManager-1267"><span class="linenos">1267</span></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager-1268"><a href="#MeshManager-1268"><span class="linenos">1268</span></a>                <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1269"><a href="#MeshManager-1269"><span class="linenos">1269</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1270"><a href="#MeshManager-1270"><span class="linenos">1270</span></a>                    <span class="n">showactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-1271"><a href="#MeshManager-1271"><span class="linenos">1271</span></a>                    <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-1272"><a href="#MeshManager-1272"><span class="linenos">1272</span></a>                    <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager-1273"><a href="#MeshManager-1273"><span class="linenos">1273</span></a>                    <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1274"><a href="#MeshManager-1274"><span class="linenos">1274</span></a>                    <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1275"><a href="#MeshManager-1275"><span class="linenos">1275</span></a>                    <span class="n">pad</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span id="MeshManager-1276"><a href="#MeshManager-1276"><span class="linenos">1276</span></a>                    <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager-1277"><a href="#MeshManager-1277"><span class="linenos">1277</span></a>                        <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1278"><a href="#MeshManager-1278"><span class="linenos">1278</span></a>                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Play&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1279"><a href="#MeshManager-1279"><span class="linenos">1279</span></a>                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;animate&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1280"><a href="#MeshManager-1280"><span class="linenos">1280</span></a>                            <span class="n">args</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager-1281"><a href="#MeshManager-1281"><span class="linenos">1281</span></a>                                <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-1282"><a href="#MeshManager-1282"><span class="linenos">1282</span></a>                                <span class="p">{</span>
</span><span id="MeshManager-1283"><a href="#MeshManager-1283"><span class="linenos">1283</span></a>                                    <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="MeshManager-1284"><a href="#MeshManager-1284"><span class="linenos">1284</span></a>                                    <span class="s2">&quot;fromcurrent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-1285"><a href="#MeshManager-1285"><span class="linenos">1285</span></a>                                <span class="p">},</span>
</span><span id="MeshManager-1286"><a href="#MeshManager-1286"><span class="linenos">1286</span></a>                            <span class="p">],</span>
</span><span id="MeshManager-1287"><a href="#MeshManager-1287"><span class="linenos">1287</span></a>                        <span class="p">),</span>
</span><span id="MeshManager-1288"><a href="#MeshManager-1288"><span class="linenos">1288</span></a>                        <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1289"><a href="#MeshManager-1289"><span class="linenos">1289</span></a>                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pause&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1290"><a href="#MeshManager-1290"><span class="linenos">1290</span></a>                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;animate&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1291"><a href="#MeshManager-1291"><span class="linenos">1291</span></a>                            <span class="n">args</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager-1292"><a href="#MeshManager-1292"><span class="linenos">1292</span></a>                                <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="MeshManager-1293"><a href="#MeshManager-1293"><span class="linenos">1293</span></a>                                <span class="p">{</span>
</span><span id="MeshManager-1294"><a href="#MeshManager-1294"><span class="linenos">1294</span></a>                                    <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="MeshManager-1295"><a href="#MeshManager-1295"><span class="linenos">1295</span></a>                                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;immediate&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1296"><a href="#MeshManager-1296"><span class="linenos">1296</span></a>                                <span class="p">},</span>
</span><span id="MeshManager-1297"><a href="#MeshManager-1297"><span class="linenos">1297</span></a>                            <span class="p">],</span>
</span><span id="MeshManager-1298"><a href="#MeshManager-1298"><span class="linenos">1298</span></a>                        <span class="p">),</span>
</span><span id="MeshManager-1299"><a href="#MeshManager-1299"><span class="linenos">1299</span></a>                        <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager-1300"><a href="#MeshManager-1300"><span class="linenos">1300</span></a>                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reset View&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1301"><a href="#MeshManager-1301"><span class="linenos">1301</span></a>                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;relayout&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1302"><a href="#MeshManager-1302"><span class="linenos">1302</span></a>                            <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;scene.camera.eye&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)}],</span>
</span><span id="MeshManager-1303"><a href="#MeshManager-1303"><span class="linenos">1303</span></a>                        <span class="p">),</span>
</span><span id="MeshManager-1304"><a href="#MeshManager-1304"><span class="linenos">1304</span></a>                    <span class="p">],</span>
</span><span id="MeshManager-1305"><a href="#MeshManager-1305"><span class="linenos">1305</span></a>                <span class="p">)</span>
</span><span id="MeshManager-1306"><a href="#MeshManager-1306"><span class="linenos">1306</span></a>            <span class="p">],</span>
</span><span id="MeshManager-1307"><a href="#MeshManager-1307"><span class="linenos">1307</span></a>        <span class="p">)</span>
</span><span id="MeshManager-1308"><a href="#MeshManager-1308"><span class="linenos">1308</span></a>
</span><span id="MeshManager-1309"><a href="#MeshManager-1309"><span class="linenos">1309</span></a>        <span class="c1"># Set frames</span>
</span><span id="MeshManager-1310"><a href="#MeshManager-1310"><span class="linenos">1310</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
</span><span id="MeshManager-1311"><a href="#MeshManager-1311"><span class="linenos">1311</span></a>
</span><span id="MeshManager-1312"><a href="#MeshManager-1312"><span class="linenos">1312</span></a>        <span class="k">return</span> <span class="n">fig</span>
</span><span id="MeshManager-1313"><a href="#MeshManager-1313"><span class="linenos">1313</span></a>
</span><span id="MeshManager-1314"><a href="#MeshManager-1314"><span class="linenos">1314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_mesh_slice_grid</span><span class="p">(</span>
</span><span id="MeshManager-1315"><a href="#MeshManager-1315"><span class="linenos">1315</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-1316"><a href="#MeshManager-1316"><span class="linenos">1316</span></a>        <span class="n">vertices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-1317"><a href="#MeshManager-1317"><span class="linenos">1317</span></a>        <span class="n">faces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-1318"><a href="#MeshManager-1318"><span class="linenos">1318</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Mesh Slice Grid&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1319"><a href="#MeshManager-1319"><span class="linenos">1319</span></a>        <span class="n">num_slices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="MeshManager-1320"><a href="#MeshManager-1320"><span class="linenos">1320</span></a>        <span class="n">z_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager-1321"><a href="#MeshManager-1321"><span class="linenos">1321</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
</span><span id="MeshManager-1322"><a href="#MeshManager-1322"><span class="linenos">1322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-1323"><a href="#MeshManager-1323"><span class="linenos">1323</span></a><span class="sd">        Create a grid visualization showing multiple cross-sections of a 3D mesh.</span>
</span><span id="MeshManager-1324"><a href="#MeshManager-1324"><span class="linenos">1324</span></a>
</span><span id="MeshManager-1325"><a href="#MeshManager-1325"><span class="linenos">1325</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-1326"><a href="#MeshManager-1326"><span class="linenos">1326</span></a><span class="sd">            vertices: Vertex array (alternative to mesh_data)</span>
</span><span id="MeshManager-1327"><a href="#MeshManager-1327"><span class="linenos">1327</span></a><span class="sd">            faces: Face array (alternative to mesh_data)</span>
</span><span id="MeshManager-1328"><a href="#MeshManager-1328"><span class="linenos">1328</span></a><span class="sd">            title: Plot title</span>
</span><span id="MeshManager-1329"><a href="#MeshManager-1329"><span class="linenos">1329</span></a><span class="sd">            num_slices: Number of slices to show (should be perfect square for grid)</span>
</span><span id="MeshManager-1330"><a href="#MeshManager-1330"><span class="linenos">1330</span></a><span class="sd">            z_range: Tuple of (min_z, max_z) for slice range. Auto-detected if None.</span>
</span><span id="MeshManager-1331"><a href="#MeshManager-1331"><span class="linenos">1331</span></a>
</span><span id="MeshManager-1332"><a href="#MeshManager-1332"><span class="linenos">1332</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-1333"><a href="#MeshManager-1333"><span class="linenos">1333</span></a><span class="sd">            Plotly figure with subplot grid</span>
</span><span id="MeshManager-1334"><a href="#MeshManager-1334"><span class="linenos">1334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-1335"><a href="#MeshManager-1335"><span class="linenos">1335</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1336"><a href="#MeshManager-1336"><span class="linenos">1336</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="MeshManager-1337"><a href="#MeshManager-1337"><span class="linenos">1337</span></a>
</span><span id="MeshManager-1338"><a href="#MeshManager-1338"><span class="linenos">1338</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager-1339"><a href="#MeshManager-1339"><span class="linenos">1339</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">plotly.subplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_subplots</span>
</span><span id="MeshManager-1340"><a href="#MeshManager-1340"><span class="linenos">1340</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager-1341"><a href="#MeshManager-1341"><span class="linenos">1341</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotly not available for slice grid visualization&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1342"><a href="#MeshManager-1342"><span class="linenos">1342</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager-1343"><a href="#MeshManager-1343"><span class="linenos">1343</span></a>
</span><span id="MeshManager-1344"><a href="#MeshManager-1344"><span class="linenos">1344</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager-1345"><a href="#MeshManager-1345"><span class="linenos">1345</span></a>
</span><span id="MeshManager-1346"><a href="#MeshManager-1346"><span class="linenos">1346</span></a>        <span class="c1"># Determine grid size</span>
</span><span id="MeshManager-1347"><a href="#MeshManager-1347"><span class="linenos">1347</span></a>        <span class="n">grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_slices</span><span class="p">))</span>
</span><span id="MeshManager-1348"><a href="#MeshManager-1348"><span class="linenos">1348</span></a>        <span class="k">if</span> <span class="n">grid_size</span> <span class="o">*</span> <span class="n">grid_size</span> <span class="o">!=</span> <span class="n">num_slices</span><span class="p">:</span>
</span><span id="MeshManager-1349"><a href="#MeshManager-1349"><span class="linenos">1349</span></a>            <span class="n">grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_slices</span><span class="p">)))</span>
</span><span id="MeshManager-1350"><a href="#MeshManager-1350"><span class="linenos">1350</span></a>            <span class="n">num_slices</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">*</span> <span class="n">grid_size</span>
</span><span id="MeshManager-1351"><a href="#MeshManager-1351"><span class="linenos">1351</span></a>
</span><span id="MeshManager-1352"><a href="#MeshManager-1352"><span class="linenos">1352</span></a>        <span class="c1"># Determine Z range</span>
</span><span id="MeshManager-1353"><a href="#MeshManager-1353"><span class="linenos">1353</span></a>        <span class="k">if</span> <span class="n">z_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-1354"><a href="#MeshManager-1354"><span class="linenos">1354</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="MeshManager-1355"><a href="#MeshManager-1355"><span class="linenos">1355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager-1356"><a href="#MeshManager-1356"><span class="linenos">1356</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">z_range</span>
</span><span id="MeshManager-1357"><a href="#MeshManager-1357"><span class="linenos">1357</span></a>
</span><span id="MeshManager-1358"><a href="#MeshManager-1358"><span class="linenos">1358</span></a>        <span class="c1"># Create Z levels</span>
</span><span id="MeshManager-1359"><a href="#MeshManager-1359"><span class="linenos">1359</span></a>        <span class="n">z_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">num_slices</span><span class="p">)</span>
</span><span id="MeshManager-1360"><a href="#MeshManager-1360"><span class="linenos">1360</span></a>
</span><span id="MeshManager-1361"><a href="#MeshManager-1361"><span class="linenos">1361</span></a>        <span class="c1"># Create subplots</span>
</span><span id="MeshManager-1362"><a href="#MeshManager-1362"><span class="linenos">1362</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
</span><span id="MeshManager-1363"><a href="#MeshManager-1363"><span class="linenos">1363</span></a>            <span class="n">rows</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
</span><span id="MeshManager-1364"><a href="#MeshManager-1364"><span class="linenos">1364</span></a>            <span class="n">cols</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
</span><span id="MeshManager-1365"><a href="#MeshManager-1365"><span class="linenos">1365</span></a>            <span class="n">subplot_titles</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Z = </span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">z_levels</span><span class="p">],</span>
</span><span id="MeshManager-1366"><a href="#MeshManager-1366"><span class="linenos">1366</span></a>            <span class="n">specs</span><span class="o">=</span><span class="p">[[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;xy&quot;</span><span class="p">}]</span> <span class="o">*</span> <span class="n">grid_size</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)],</span>
</span><span id="MeshManager-1367"><a href="#MeshManager-1367"><span class="linenos">1367</span></a>        <span class="p">)</span>
</span><span id="MeshManager-1368"><a href="#MeshManager-1368"><span class="linenos">1368</span></a>
</span><span id="MeshManager-1369"><a href="#MeshManager-1369"><span class="linenos">1369</span></a>        <span class="c1"># Generate slices and add to subplots</span>
</span><span id="MeshManager-1370"><a href="#MeshManager-1370"><span class="linenos">1370</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">z_levels</span><span class="p">):</span>
</span><span id="MeshManager-1371"><a href="#MeshManager-1371"><span class="linenos">1371</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">grid_size</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="MeshManager-1372"><a href="#MeshManager-1372"><span class="linenos">1372</span></a>            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">grid_size</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="MeshManager-1373"><a href="#MeshManager-1373"><span class="linenos">1373</span></a>
</span><span id="MeshManager-1374"><a href="#MeshManager-1374"><span class="linenos">1374</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1375"><a href="#MeshManager-1375"><span class="linenos">1375</span></a>                <span class="c1"># Get 2D cross-section</span>
</span><span id="MeshManager-1376"><a href="#MeshManager-1376"><span class="linenos">1376</span></a>                <span class="n">slice_2d</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">section</span><span class="p">(</span>
</span><span id="MeshManager-1377"><a href="#MeshManager-1377"><span class="linenos">1377</span></a>                    <span class="n">plane_origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z_level</span><span class="p">],</span> <span class="n">plane_normal</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MeshManager-1378"><a href="#MeshManager-1378"><span class="linenos">1378</span></a>                <span class="p">)</span>
</span><span id="MeshManager-1379"><a href="#MeshManager-1379"><span class="linenos">1379</span></a>
</span><span id="MeshManager-1380"><a href="#MeshManager-1380"><span class="linenos">1380</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="MeshManager-1381"><a href="#MeshManager-1381"><span class="linenos">1381</span></a>                    <span class="n">slice_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MeshManager-1382"><a href="#MeshManager-1382"><span class="linenos">1382</span></a>                    <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">slice_2d</span><span class="p">,</span> <span class="s2">&quot;entities&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1383"><a href="#MeshManager-1383"><span class="linenos">1383</span></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_2d</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="MeshManager-1384"><a href="#MeshManager-1384"><span class="linenos">1384</span></a>                <span class="p">):</span>
</span><span id="MeshManager-1385"><a href="#MeshManager-1385"><span class="linenos">1385</span></a>                    <span class="c1"># Plot each entity in the slice</span>
</span><span id="MeshManager-1386"><a href="#MeshManager-1386"><span class="linenos">1386</span></a>                    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">slice_2d</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
</span><span id="MeshManager-1387"><a href="#MeshManager-1387"><span class="linenos">1387</span></a>                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">):</span>
</span><span id="MeshManager-1388"><a href="#MeshManager-1388"><span class="linenos">1388</span></a>                            <span class="n">points</span> <span class="o">=</span> <span class="n">slice_2d</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
</span><span id="MeshManager-1389"><a href="#MeshManager-1389"><span class="linenos">1389</span></a>                            <span class="c1"># Close the loop</span>
</span><span id="MeshManager-1390"><a href="#MeshManager-1390"><span class="linenos">1390</span></a>                            <span class="n">points_closed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">points</span><span class="p">,</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="MeshManager-1391"><a href="#MeshManager-1391"><span class="linenos">1391</span></a>
</span><span id="MeshManager-1392"><a href="#MeshManager-1392"><span class="linenos">1392</span></a>                            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="MeshManager-1393"><a href="#MeshManager-1393"><span class="linenos">1393</span></a>                                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="MeshManager-1394"><a href="#MeshManager-1394"><span class="linenos">1394</span></a>                                    <span class="n">x</span><span class="o">=</span><span class="n">points_closed</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager-1395"><a href="#MeshManager-1395"><span class="linenos">1395</span></a>                                    <span class="n">y</span><span class="o">=</span><span class="n">points_closed</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager-1396"><a href="#MeshManager-1396"><span class="linenos">1396</span></a>                                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
</span><span id="MeshManager-1397"><a href="#MeshManager-1397"><span class="linenos">1397</span></a>                                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
</span><span id="MeshManager-1398"><a href="#MeshManager-1398"><span class="linenos">1398</span></a>                                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-1399"><a href="#MeshManager-1399"><span class="linenos">1399</span></a>                                <span class="p">),</span>
</span><span id="MeshManager-1400"><a href="#MeshManager-1400"><span class="linenos">1400</span></a>                                <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
</span><span id="MeshManager-1401"><a href="#MeshManager-1401"><span class="linenos">1401</span></a>                                <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
</span><span id="MeshManager-1402"><a href="#MeshManager-1402"><span class="linenos">1402</span></a>                            <span class="p">)</span>
</span><span id="MeshManager-1403"><a href="#MeshManager-1403"><span class="linenos">1403</span></a>
</span><span id="MeshManager-1404"><a href="#MeshManager-1404"><span class="linenos">1404</span></a>                <span class="c1"># Set equal aspect ratio for each subplot</span>
</span><span id="MeshManager-1405"><a href="#MeshManager-1405"><span class="linenos">1405</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="MeshManager-1406"><a href="#MeshManager-1406"><span class="linenos">1406</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X (m)&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="MeshManager-1407"><a href="#MeshManager-1407"><span class="linenos">1407</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y (m)&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="MeshManager-1408"><a href="#MeshManager-1408"><span class="linenos">1408</span></a>
</span><span id="MeshManager-1409"><a href="#MeshManager-1409"><span class="linenos">1409</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager-1410"><a href="#MeshManager-1410"><span class="linenos">1410</span></a>                <span class="c1"># If slicing fails, just leave subplot empty</span>
</span><span id="MeshManager-1411"><a href="#MeshManager-1411"><span class="linenos">1411</span></a>                <span class="k">pass</span>
</span><span id="MeshManager-1412"><a href="#MeshManager-1412"><span class="linenos">1412</span></a>
</span><span id="MeshManager-1413"><a href="#MeshManager-1413"><span class="linenos">1413</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="MeshManager-1414"><a href="#MeshManager-1414"><span class="linenos">1414</span></a>            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="MeshManager-1415"><a href="#MeshManager-1415"><span class="linenos">1415</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">150</span> <span class="o">*</span> <span class="n">grid_size</span><span class="p">,</span>
</span><span id="MeshManager-1416"><a href="#MeshManager-1416"><span class="linenos">1416</span></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager-1417"><a href="#MeshManager-1417"><span class="linenos">1417</span></a>        <span class="p">)</span>
</span><span id="MeshManager-1418"><a href="#MeshManager-1418"><span class="linenos">1418</span></a>
</span><span id="MeshManager-1419"><a href="#MeshManager-1419"><span class="linenos">1419</span></a>        <span class="k">return</span> <span class="n">fig</span>
</span><span id="MeshManager-1420"><a href="#MeshManager-1420"><span class="linenos">1420</span></a>
</span><span id="MeshManager-1421"><a href="#MeshManager-1421"><span class="linenos">1421</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">slice_mesh_by_z</span><span class="p">(</span>
</span><span id="MeshManager-1422"><a href="#MeshManager-1422"><span class="linenos">1422</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager-1423"><a href="#MeshManager-1423"><span class="linenos">1423</span></a>        <span class="n">z</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="MeshManager-1424"><a href="#MeshManager-1424"><span class="linenos">1424</span></a>        <span class="n">cap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-1425"><a href="#MeshManager-1425"><span class="linenos">1425</span></a>        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager-1426"><a href="#MeshManager-1426"><span class="linenos">1426</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]]:</span>
</span><span id="MeshManager-1427"><a href="#MeshManager-1427"><span class="linenos">1427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager-1428"><a href="#MeshManager-1428"><span class="linenos">1428</span></a><span class="sd">        Slice the current mesh with the horizontal plane z = value and return</span>
</span><span id="MeshManager-1429"><a href="#MeshManager-1429"><span class="linenos">1429</span></a><span class="sd">        two new meshes partitioned along that plane.</span>
</span><span id="MeshManager-1430"><a href="#MeshManager-1430"><span class="linenos">1430</span></a>
</span><span id="MeshManager-1431"><a href="#MeshManager-1431"><span class="linenos">1431</span></a><span class="sd">        This creates new vertices where the plane intersects the original mesh</span>
</span><span id="MeshManager-1432"><a href="#MeshManager-1432"><span class="linenos">1432</span></a><span class="sd">        and (optionally) caps the cut so both results are closed.</span>
</span><span id="MeshManager-1433"><a href="#MeshManager-1433"><span class="linenos">1433</span></a>
</span><span id="MeshManager-1434"><a href="#MeshManager-1434"><span class="linenos">1434</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager-1435"><a href="#MeshManager-1435"><span class="linenos">1435</span></a><span class="sd">            z: Z-value of the slicing plane (plane origin [0, 0, z], normal [0, 0, 1]).</span>
</span><span id="MeshManager-1436"><a href="#MeshManager-1436"><span class="linenos">1436</span></a><span class="sd">            cap: If True, seal the open cut by adding faces.</span>
</span><span id="MeshManager-1437"><a href="#MeshManager-1437"><span class="linenos">1437</span></a><span class="sd">            validate: If True, run trimesh processing/validation on the results.</span>
</span><span id="MeshManager-1438"><a href="#MeshManager-1438"><span class="linenos">1438</span></a>
</span><span id="MeshManager-1439"><a href="#MeshManager-1439"><span class="linenos">1439</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager-1440"><a href="#MeshManager-1440"><span class="linenos">1440</span></a><span class="sd">            (below_mesh, above_mesh):</span>
</span><span id="MeshManager-1441"><a href="#MeshManager-1441"><span class="linenos">1441</span></a><span class="sd">                below_mesh contains the portion with vertices at z &lt;= value.</span>
</span><span id="MeshManager-1442"><a href="#MeshManager-1442"><span class="linenos">1442</span></a><span class="sd">                above_mesh contains the portion with vertices at z &gt;= value.</span>
</span><span id="MeshManager-1443"><a href="#MeshManager-1443"><span class="linenos">1443</span></a><span class="sd">                Either may be None if the plane lies completely outside the mesh.</span>
</span><span id="MeshManager-1444"><a href="#MeshManager-1444"><span class="linenos">1444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager-1445"><a href="#MeshManager-1445"><span class="linenos">1445</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-1446"><a href="#MeshManager-1446"><span class="linenos">1446</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager-1447"><a href="#MeshManager-1447"><span class="linenos">1447</span></a>
</span><span id="MeshManager-1448"><a href="#MeshManager-1448"><span class="linenos">1448</span></a>        <span class="n">plane_origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)])</span>
</span><span id="MeshManager-1449"><a href="#MeshManager-1449"><span class="linenos">1449</span></a>        <span class="n">plane_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="MeshManager-1450"><a href="#MeshManager-1450"><span class="linenos">1450</span></a>
</span><span id="MeshManager-1451"><a href="#MeshManager-1451"><span class="linenos">1451</span></a>        <span class="n">below_mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span>
</span><span id="MeshManager-1452"><a href="#MeshManager-1452"><span class="linenos">1452</span></a>        <span class="n">above_mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span>
</span><span id="MeshManager-1453"><a href="#MeshManager-1453"><span class="linenos">1453</span></a>
</span><span id="MeshManager-1454"><a href="#MeshManager-1454"><span class="linenos">1454</span></a>        <span class="c1"># Positive side (normal pointing +Z) yields z &gt;= z_plane -&gt; above</span>
</span><span id="MeshManager-1455"><a href="#MeshManager-1455"><span class="linenos">1455</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1456"><a href="#MeshManager-1456"><span class="linenos">1456</span></a>            <span class="n">above_mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">intersections</span><span class="o">.</span><span class="n">slice_mesh_plane</span><span class="p">(</span>
</span><span id="MeshManager-1457"><a href="#MeshManager-1457"><span class="linenos">1457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">plane_normal</span><span class="o">=</span><span class="n">plane_normal</span><span class="p">,</span> <span class="n">plane_origin</span><span class="o">=</span><span class="n">plane_origin</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="n">cap</span>
</span><span id="MeshManager-1458"><a href="#MeshManager-1458"><span class="linenos">1458</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1459"><a href="#MeshManager-1459"><span class="linenos">1459</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-1460"><a href="#MeshManager-1460"><span class="linenos">1460</span></a>            <span class="n">above_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-1461"><a href="#MeshManager-1461"><span class="linenos">1461</span></a>
</span><span id="MeshManager-1462"><a href="#MeshManager-1462"><span class="linenos">1462</span></a>        <span class="c1"># Reverse normal yields z &lt;= z_plane -&gt; below</span>
</span><span id="MeshManager-1463"><a href="#MeshManager-1463"><span class="linenos">1463</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1464"><a href="#MeshManager-1464"><span class="linenos">1464</span></a>            <span class="n">below_mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">intersections</span><span class="o">.</span><span class="n">slice_mesh_plane</span><span class="p">(</span>
</span><span id="MeshManager-1465"><a href="#MeshManager-1465"><span class="linenos">1465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span>
</span><span id="MeshManager-1466"><a href="#MeshManager-1466"><span class="linenos">1466</span></a>                <span class="n">plane_normal</span><span class="o">=-</span><span class="n">plane_normal</span><span class="p">,</span>
</span><span id="MeshManager-1467"><a href="#MeshManager-1467"><span class="linenos">1467</span></a>                <span class="n">plane_origin</span><span class="o">=</span><span class="n">plane_origin</span><span class="p">,</span>
</span><span id="MeshManager-1468"><a href="#MeshManager-1468"><span class="linenos">1468</span></a>                <span class="n">cap</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span>
</span><span id="MeshManager-1469"><a href="#MeshManager-1469"><span class="linenos">1469</span></a>            <span class="p">)</span>
</span><span id="MeshManager-1470"><a href="#MeshManager-1470"><span class="linenos">1470</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-1471"><a href="#MeshManager-1471"><span class="linenos">1471</span></a>            <span class="n">below_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-1472"><a href="#MeshManager-1472"><span class="linenos">1472</span></a>
</span><span id="MeshManager-1473"><a href="#MeshManager-1473"><span class="linenos">1473</span></a>        <span class="c1"># Normalize empty results to None</span>
</span><span id="MeshManager-1474"><a href="#MeshManager-1474"><span class="linenos">1474</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="MeshManager-1475"><a href="#MeshManager-1475"><span class="linenos">1475</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">above_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">above_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MeshManager-1476"><a href="#MeshManager-1476"><span class="linenos">1476</span></a>        <span class="p">):</span>
</span><span id="MeshManager-1477"><a href="#MeshManager-1477"><span class="linenos">1477</span></a>            <span class="n">above_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-1478"><a href="#MeshManager-1478"><span class="linenos">1478</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="MeshManager-1479"><a href="#MeshManager-1479"><span class="linenos">1479</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">below_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">below_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MeshManager-1480"><a href="#MeshManager-1480"><span class="linenos">1480</span></a>        <span class="p">):</span>
</span><span id="MeshManager-1481"><a href="#MeshManager-1481"><span class="linenos">1481</span></a>            <span class="n">below_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager-1482"><a href="#MeshManager-1482"><span class="linenos">1482</span></a>
</span><span id="MeshManager-1483"><a href="#MeshManager-1483"><span class="linenos">1483</span></a>        <span class="c1"># Optionally validate/process</span>
</span><span id="MeshManager-1484"><a href="#MeshManager-1484"><span class="linenos">1484</span></a>        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
</span><span id="MeshManager-1485"><a href="#MeshManager-1485"><span class="linenos">1485</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager-1486"><a href="#MeshManager-1486"><span class="linenos">1486</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1487"><a href="#MeshManager-1487"><span class="linenos">1487</span></a>                    <span class="n">above_mesh</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager-1488"><a href="#MeshManager-1488"><span class="linenos">1488</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-1489"><a href="#MeshManager-1489"><span class="linenos">1489</span></a>                    <span class="k">pass</span>
</span><span id="MeshManager-1490"><a href="#MeshManager-1490"><span class="linenos">1490</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager-1491"><a href="#MeshManager-1491"><span class="linenos">1491</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager-1492"><a href="#MeshManager-1492"><span class="linenos">1492</span></a>                    <span class="n">below_mesh</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager-1493"><a href="#MeshManager-1493"><span class="linenos">1493</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager-1494"><a href="#MeshManager-1494"><span class="linenos">1494</span></a>                    <span class="k">pass</span>
</span><span id="MeshManager-1495"><a href="#MeshManager-1495"><span class="linenos">1495</span></a>
</span><span id="MeshManager-1496"><a href="#MeshManager-1496"><span class="linenos">1496</span></a>        <span class="c1"># Attach metadata</span>
</span><span id="MeshManager-1497"><a href="#MeshManager-1497"><span class="linenos">1497</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager-1498"><a href="#MeshManager-1498"><span class="linenos">1498</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">above_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-1499"><a href="#MeshManager-1499"><span class="linenos">1499</span></a>                <span class="n">above_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MeshManager-1500"><a href="#MeshManager-1500"><span class="linenos">1500</span></a>            <span class="n">above_mesh</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;sliced_by_z&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;above&quot;</span><span class="p">})</span>
</span><span id="MeshManager-1501"><a href="#MeshManager-1501"><span class="linenos">1501</span></a>
</span><span id="MeshManager-1502"><a href="#MeshManager-1502"><span class="linenos">1502</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager-1503"><a href="#MeshManager-1503"><span class="linenos">1503</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">below_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager-1504"><a href="#MeshManager-1504"><span class="linenos">1504</span></a>                <span class="n">below_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MeshManager-1505"><a href="#MeshManager-1505"><span class="linenos">1505</span></a>            <span class="n">below_mesh</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;sliced_by_z&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;below&quot;</span><span class="p">})</span>
</span><span id="MeshManager-1506"><a href="#MeshManager-1506"><span class="linenos">1506</span></a>
</span><span id="MeshManager-1507"><a href="#MeshManager-1507"><span class="linenos">1507</span></a>        <span class="k">return</span> <span class="n">below_mesh</span><span class="p">,</span> <span class="n">above_mesh</span>
</span></pre></div>


            <div class="docstring"><p>Unified mesh class handling loading, processing, and analysis.</p>
</div>


                            <div id="MeshManager.__init__" class="classattr">
                                        <input id="MeshManager.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MeshManager</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="MeshManager.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.__init__-61"><a href="#MeshManager.__init__-61"><span class="linenos">61</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="MeshManager.__init__-62"><a href="#MeshManager.__init__-62"><span class="linenos">62</span></a>        <span class="c1"># Core mesh attributes</span>
</span><span id="MeshManager.__init__-63"><a href="#MeshManager.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager.__init__-64"><a href="#MeshManager.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager.__init__-65"><a href="#MeshManager.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.__init__-66"><a href="#MeshManager.__init__-66"><span class="linenos">66</span></a>
</span><span id="MeshManager.__init__-67"><a href="#MeshManager.__init__-67"><span class="linenos">67</span></a>        <span class="c1"># Attributes</span>
</span><span id="MeshManager.__init__-68"><a href="#MeshManager.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="MeshManager.__init__-69"><a href="#MeshManager.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MeshManager.__init__-70"><a href="#MeshManager.__init__-70"><span class="linenos">70</span></a>            <span class="s2">&quot;processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.__init__-71"><a href="#MeshManager.__init__-71"><span class="linenos">71</span></a>            <span class="s2">&quot;successful&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.__init__-72"><a href="#MeshManager.__init__-72"><span class="linenos">72</span></a>            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.__init__-73"><a href="#MeshManager.__init__-73"><span class="linenos">73</span></a>            <span class="s2">&quot;volume_fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.__init__-74"><a href="#MeshManager.__init__-74"><span class="linenos">74</span></a>            <span class="s2">&quot;watertight_fixed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.__init__-75"><a href="#MeshManager.__init__-75"><span class="linenos">75</span></a>            <span class="s2">&quot;degenerate_removed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.__init__-76"><a href="#MeshManager.__init__-76"><span class="linenos">76</span></a>        <span class="p">}</span>
</span></pre></div>


    

                            </div>
                            <div id="MeshManager.mesh" class="classattr">
                                <div class="attr variable">
            <span class="name">mesh</span>

        
    </div>
    <a class="headerlink" href="#MeshManager.mesh"></a>
    
    

                            </div>
                            <div id="MeshManager.original_mesh" class="classattr">
                                <div class="attr variable">
            <span class="name">original_mesh</span>

        
    </div>
    <a class="headerlink" href="#MeshManager.original_mesh"></a>
    
    

                            </div>
                            <div id="MeshManager.bounds" class="classattr">
                                <div class="attr variable">
            <span class="name">bounds</span>

        
    </div>
    <a class="headerlink" href="#MeshManager.bounds"></a>
    
    

                            </div>
                            <div id="MeshManager.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#MeshManager.verbose"></a>
    
    

                            </div>
                            <div id="MeshManager.stats" class="classattr">
                                <div class="attr variable">
            <span class="name">stats</span>

        
    </div>
    <a class="headerlink" href="#MeshManager.stats"></a>
    
    

                            </div>
                            <div id="MeshManager.log" class="classattr">
                                        <input id="MeshManager.log-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">message</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;INFO&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MeshManager.log-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.log"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.log-78"><a href="#MeshManager.log-78"><span class="linenos">78</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
</span><span id="MeshManager.log-79"><a href="#MeshManager.log-79"><span class="linenos">79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compatibility shim: delegate to module logger respecting self.verbose.</span>
</span><span id="MeshManager.log-80"><a href="#MeshManager.log-80"><span class="linenos">80</span></a>
</span><span id="MeshManager.log-81"><a href="#MeshManager.log-81"><span class="linenos">81</span></a><span class="sd">        Levels: INFO, SUCCESS (maps to INFO), WARNING, ERROR, PROCESSING (maps to INFO)</span>
</span><span id="MeshManager.log-82"><a href="#MeshManager.log-82"><span class="linenos">82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.log-83"><a href="#MeshManager.log-83"><span class="linenos">83</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MeshManager.log-84"><a href="#MeshManager.log-84"><span class="linenos">84</span></a>            <span class="k">return</span>
</span><span id="MeshManager.log-85"><a href="#MeshManager.log-85"><span class="linenos">85</span></a>        <span class="n">lvl</span> <span class="o">=</span> <span class="n">level</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="MeshManager.log-86"><a href="#MeshManager.log-86"><span class="linenos">86</span></a>        <span class="k">if</span> <span class="n">lvl</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;PROCESSING&quot;</span><span class="p">):</span>
</span><span id="MeshManager.log-87"><a href="#MeshManager.log-87"><span class="linenos">87</span></a>            <span class="n">lvl</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
</span><span id="MeshManager.log-88"><a href="#MeshManager.log-88"><span class="linenos">88</span></a>        <span class="k">if</span> <span class="n">lvl</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span><span class="p">:</span>
</span><span id="MeshManager.log-89"><a href="#MeshManager.log-89"><span class="linenos">89</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager.log-90"><a href="#MeshManager.log-90"><span class="linenos">90</span></a>        <span class="k">elif</span> <span class="n">lvl</span> <span class="o">==</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span>
</span><span id="MeshManager.log-91"><a href="#MeshManager.log-91"><span class="linenos">91</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager.log-92"><a href="#MeshManager.log-92"><span class="linenos">92</span></a>        <span class="k">elif</span> <span class="n">lvl</span> <span class="o">==</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span>
</span><span id="MeshManager.log-93"><a href="#MeshManager.log-93"><span class="linenos">93</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="MeshManager.log-94"><a href="#MeshManager.log-94"><span class="linenos">94</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.log-95"><a href="#MeshManager.log-95"><span class="linenos">95</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compatibility shim: delegate to module logger respecting self.verbose.</p>

<p>Levels: INFO, SUCCESS (maps to INFO), WARNING, ERROR, PROCESSING (maps to INFO)</p>
</div>


                            </div>
                            <div id="MeshManager.load_mesh" class="classattr">
                                        <input id="MeshManager.load_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.load_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.load_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.load_mesh-101"><a href="#MeshManager.load_mesh-101"><span class="linenos">101</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_mesh</span><span class="p">(</span>
</span><span id="MeshManager.load_mesh-102"><a href="#MeshManager.load_mesh-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.load_mesh-103"><a href="#MeshManager.load_mesh-103"><span class="linenos">103</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-104"><a href="#MeshManager.load_mesh-104"><span class="linenos">104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.load_mesh-105"><a href="#MeshManager.load_mesh-105"><span class="linenos">105</span></a><span class="sd">        Load a mesh from file.</span>
</span><span id="MeshManager.load_mesh-106"><a href="#MeshManager.load_mesh-106"><span class="linenos">106</span></a>
</span><span id="MeshManager.load_mesh-107"><a href="#MeshManager.load_mesh-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.load_mesh-108"><a href="#MeshManager.load_mesh-108"><span class="linenos">108</span></a><span class="sd">            filepath: Path to mesh file</span>
</span><span id="MeshManager.load_mesh-109"><a href="#MeshManager.load_mesh-109"><span class="linenos">109</span></a><span class="sd">            file_format: Optional format specification (auto-detected if None)</span>
</span><span id="MeshManager.load_mesh-110"><a href="#MeshManager.load_mesh-110"><span class="linenos">110</span></a>
</span><span id="MeshManager.load_mesh-111"><a href="#MeshManager.load_mesh-111"><span class="linenos">111</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.load_mesh-112"><a href="#MeshManager.load_mesh-112"><span class="linenos">112</span></a><span class="sd">            Loaded trimesh object</span>
</span><span id="MeshManager.load_mesh-113"><a href="#MeshManager.load_mesh-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.load_mesh-114"><a href="#MeshManager.load_mesh-114"><span class="linenos">114</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-115"><a href="#MeshManager.load_mesh-115"><span class="linenos">115</span></a>            <span class="k">if</span> <span class="n">file_format</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-116"><a href="#MeshManager.load_mesh-116"><span class="linenos">116</span></a>                <span class="n">mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_format</span><span class="p">)</span>
</span><span id="MeshManager.load_mesh-117"><a href="#MeshManager.load_mesh-117"><span class="linenos">117</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-118"><a href="#MeshManager.load_mesh-118"><span class="linenos">118</span></a>                <span class="n">mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</span><span id="MeshManager.load_mesh-119"><a href="#MeshManager.load_mesh-119"><span class="linenos">119</span></a>
</span><span id="MeshManager.load_mesh-120"><a href="#MeshManager.load_mesh-120"><span class="linenos">120</span></a>            <span class="c1"># Ensure we have a single mesh</span>
</span><span id="MeshManager.load_mesh-121"><a href="#MeshManager.load_mesh-121"><span class="linenos">121</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Scene</span><span class="p">):</span>
</span><span id="MeshManager.load_mesh-122"><a href="#MeshManager.load_mesh-122"><span class="linenos">122</span></a>                <span class="c1"># If it&#39;s a scene, try to get the first geometry</span>
</span><span id="MeshManager.load_mesh-123"><a href="#MeshManager.load_mesh-123"><span class="linenos">123</span></a>                <span class="n">geometries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="MeshManager.load_mesh-124"><a href="#MeshManager.load_mesh-124"><span class="linenos">124</span></a>                <span class="k">if</span> <span class="n">geometries</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-125"><a href="#MeshManager.load_mesh-125"><span class="linenos">125</span></a>                    <span class="n">mesh</span> <span class="o">=</span> <span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MeshManager.load_mesh-126"><a href="#MeshManager.load_mesh-126"><span class="linenos">126</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-127"><a href="#MeshManager.load_mesh-127"><span class="linenos">127</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No geometry found in mesh scene&quot;</span><span class="p">)</span>
</span><span id="MeshManager.load_mesh-128"><a href="#MeshManager.load_mesh-128"><span class="linenos">128</span></a>
</span><span id="MeshManager.load_mesh-129"><a href="#MeshManager.load_mesh-129"><span class="linenos">129</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager.load_mesh-130"><a href="#MeshManager.load_mesh-130"><span class="linenos">130</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded object is not a mesh: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.load_mesh-131"><a href="#MeshManager.load_mesh-131"><span class="linenos">131</span></a>
</span><span id="MeshManager.load_mesh-132"><a href="#MeshManager.load_mesh-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager.load_mesh-133"><a href="#MeshManager.load_mesh-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="MeshManager.load_mesh-134"><a href="#MeshManager.load_mesh-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.load_mesh-135"><a href="#MeshManager.load_mesh-135"><span class="linenos">135</span></a>
</span><span id="MeshManager.load_mesh-136"><a href="#MeshManager.load_mesh-136"><span class="linenos">136</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-137"><a href="#MeshManager.load_mesh-137"><span class="linenos">137</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MeshManager.load_mesh-138"><a href="#MeshManager.load_mesh-138"><span class="linenos">138</span></a>                    <span class="s2">&quot;Loaded mesh: </span><span class="si">%d</span><span class="s2"> vertices, </span><span class="si">%d</span><span class="s2"> faces&quot;</span><span class="p">,</span>
</span><span id="MeshManager.load_mesh-139"><a href="#MeshManager.load_mesh-139"><span class="linenos">139</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">),</span>
</span><span id="MeshManager.load_mesh-140"><a href="#MeshManager.load_mesh-140"><span class="linenos">140</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span>
</span><span id="MeshManager.load_mesh-141"><a href="#MeshManager.load_mesh-141"><span class="linenos">141</span></a>                <span class="p">)</span>
</span><span id="MeshManager.load_mesh-142"><a href="#MeshManager.load_mesh-142"><span class="linenos">142</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Bounds: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
</span><span id="MeshManager.load_mesh-143"><a href="#MeshManager.load_mesh-143"><span class="linenos">143</span></a>
</span><span id="MeshManager.load_mesh-144"><a href="#MeshManager.load_mesh-144"><span class="linenos">144</span></a>            <span class="k">return</span> <span class="n">mesh</span>
</span><span id="MeshManager.load_mesh-145"><a href="#MeshManager.load_mesh-145"><span class="linenos">145</span></a>
</span><span id="MeshManager.load_mesh-146"><a href="#MeshManager.load_mesh-146"><span class="linenos">146</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.load_mesh-147"><a href="#MeshManager.load_mesh-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load mesh from </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load a mesh from file.</p>

<p>Args:
    filepath: Path to mesh file
    file_format: Optional format specification (auto-detected if None)</p>

<p>Returns:
    Loaded trimesh object</p>
</div>


                            </div>
                            <div id="MeshManager.save" class="classattr">
                                        <input id="MeshManager.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filepath</span>, </span><span class="param"><span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;obj&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MeshManager.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.save-149"><a href="#MeshManager.save-149"><span class="linenos">149</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s2">&quot;obj&quot;</span><span class="p">):</span>
</span><span id="MeshManager.save-150"><a href="#MeshManager.save-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="n">file_format</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MeshManager.copy" class="classattr">
                                        <input id="MeshManager.copy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MeshManager.copy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.copy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.copy-152"><a href="#MeshManager.copy-152"><span class="linenos">152</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MeshManager.copy-153"><a href="#MeshManager.copy-153"><span class="linenos">153</span></a>        <span class="k">return</span> <span class="n">MeshManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MeshManager.to_trimesh" class="classattr">
                                        <input id="MeshManager.to_trimesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_trimesh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MeshManager.to_trimesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.to_trimesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.to_trimesh-155"><a href="#MeshManager.to_trimesh-155"><span class="linenos">155</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_trimesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MeshManager.to_trimesh-156"><a href="#MeshManager.to_trimesh-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span></pre></div>


    

                            </div>
                            <div id="MeshManager.get_z_range" class="classattr">
                                        <input id="MeshManager.get_z_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_z_range</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MeshManager.get_z_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.get_z_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.get_z_range-172"><a href="#MeshManager.get_z_range-172"><span class="linenos">172</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_z_range</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="MeshManager.get_z_range-173"><a href="#MeshManager.get_z_range-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the z-axis range of the mesh.&quot;&quot;&quot;</span>
</span><span id="MeshManager.get_z_range-174"><a href="#MeshManager.get_z_range-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.get_z_range-175"><a href="#MeshManager.get_z_range-175"><span class="linenos">175</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.get_z_range-176"><a href="#MeshManager.get_z_range-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the z-axis range of the mesh.</p>
</div>


                            </div>
                            <div id="MeshManager.center_mesh" class="classattr">
                                        <input id="MeshManager.center_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">center_mesh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">center_on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;centroid&#39;</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.center_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.center_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.center_mesh-178"><a href="#MeshManager.center_mesh-178"><span class="linenos">178</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">center_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_on</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;centroid&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.center_mesh-179"><a href="#MeshManager.center_mesh-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.center_mesh-180"><a href="#MeshManager.center_mesh-180"><span class="linenos">180</span></a><span class="sd">        Center the mesh.</span>
</span><span id="MeshManager.center_mesh-181"><a href="#MeshManager.center_mesh-181"><span class="linenos">181</span></a>
</span><span id="MeshManager.center_mesh-182"><a href="#MeshManager.center_mesh-182"><span class="linenos">182</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.center_mesh-183"><a href="#MeshManager.center_mesh-183"><span class="linenos">183</span></a><span class="sd">            center_on: &#39;centroid&#39;, &#39;bounds_center&#39;, or &#39;origin&#39;</span>
</span><span id="MeshManager.center_mesh-184"><a href="#MeshManager.center_mesh-184"><span class="linenos">184</span></a>
</span><span id="MeshManager.center_mesh-185"><a href="#MeshManager.center_mesh-185"><span class="linenos">185</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.center_mesh-186"><a href="#MeshManager.center_mesh-186"><span class="linenos">186</span></a><span class="sd">            Centered mesh</span>
</span><span id="MeshManager.center_mesh-187"><a href="#MeshManager.center_mesh-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.center_mesh-188"><a href="#MeshManager.center_mesh-188"><span class="linenos">188</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.center_mesh-189"><a href="#MeshManager.center_mesh-189"><span class="linenos">189</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.center_mesh-190"><a href="#MeshManager.center_mesh-190"><span class="linenos">190</span></a>
</span><span id="MeshManager.center_mesh-191"><a href="#MeshManager.center_mesh-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">center_on</span> <span class="o">==</span> <span class="s2">&quot;centroid&quot;</span><span class="p">:</span>
</span><span id="MeshManager.center_mesh-192"><a href="#MeshManager.center_mesh-192"><span class="linenos">192</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager.center_mesh-193"><a href="#MeshManager.center_mesh-193"><span class="linenos">193</span></a>        <span class="k">elif</span> <span class="n">center_on</span> <span class="o">==</span> <span class="s2">&quot;bounds_center&quot;</span><span class="p">:</span>
</span><span id="MeshManager.center_mesh-194"><a href="#MeshManager.center_mesh-194"><span class="linenos">194</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MeshManager.center_mesh-195"><a href="#MeshManager.center_mesh-195"><span class="linenos">195</span></a>        <span class="k">elif</span> <span class="n">center_on</span> <span class="o">==</span> <span class="s2">&quot;origin&quot;</span><span class="p">:</span>
</span><span id="MeshManager.center_mesh-196"><a href="#MeshManager.center_mesh-196"><span class="linenos">196</span></a>            <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="MeshManager.center_mesh-197"><a href="#MeshManager.center_mesh-197"><span class="linenos">197</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.center_mesh-198"><a href="#MeshManager.center_mesh-198"><span class="linenos">198</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown center_on option: </span><span class="si">{</span><span class="n">center_on</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.center_mesh-199"><a href="#MeshManager.center_mesh-199"><span class="linenos">199</span></a>
</span><span id="MeshManager.center_mesh-200"><a href="#MeshManager.center_mesh-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-=</span> <span class="n">center</span>
</span><span id="MeshManager.center_mesh-201"><a href="#MeshManager.center_mesh-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.center_mesh-202"><a href="#MeshManager.center_mesh-202"><span class="linenos">202</span></a>
</span><span id="MeshManager.center_mesh-203"><a href="#MeshManager.center_mesh-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span></pre></div>


            <div class="docstring"><p>Center the mesh.</p>

<p>Args:
    center_on: 'centroid', 'bounds_center', or 'origin'</p>

<p>Returns:
    Centered mesh</p>
</div>


                            </div>
                            <div id="MeshManager.scale_mesh" class="classattr">
                                        <input id="MeshManager.scale_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scale_mesh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.scale_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.scale_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.scale_mesh-205"><a href="#MeshManager.scale_mesh-205"><span class="linenos">205</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.scale_mesh-206"><a href="#MeshManager.scale_mesh-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.scale_mesh-207"><a href="#MeshManager.scale_mesh-207"><span class="linenos">207</span></a><span class="sd">        Scale the mesh uniformly.</span>
</span><span id="MeshManager.scale_mesh-208"><a href="#MeshManager.scale_mesh-208"><span class="linenos">208</span></a>
</span><span id="MeshManager.scale_mesh-209"><a href="#MeshManager.scale_mesh-209"><span class="linenos">209</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.scale_mesh-210"><a href="#MeshManager.scale_mesh-210"><span class="linenos">210</span></a><span class="sd">            scale_factor: Scaling factor</span>
</span><span id="MeshManager.scale_mesh-211"><a href="#MeshManager.scale_mesh-211"><span class="linenos">211</span></a>
</span><span id="MeshManager.scale_mesh-212"><a href="#MeshManager.scale_mesh-212"><span class="linenos">212</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.scale_mesh-213"><a href="#MeshManager.scale_mesh-213"><span class="linenos">213</span></a><span class="sd">            Scaled mesh</span>
</span><span id="MeshManager.scale_mesh-214"><a href="#MeshManager.scale_mesh-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.scale_mesh-215"><a href="#MeshManager.scale_mesh-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.scale_mesh-216"><a href="#MeshManager.scale_mesh-216"><span class="linenos">216</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.scale_mesh-217"><a href="#MeshManager.scale_mesh-217"><span class="linenos">217</span></a>
</span><span id="MeshManager.scale_mesh-218"><a href="#MeshManager.scale_mesh-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">*=</span> <span class="n">scale_factor</span>
</span><span id="MeshManager.scale_mesh-219"><a href="#MeshManager.scale_mesh-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.scale_mesh-220"><a href="#MeshManager.scale_mesh-220"><span class="linenos">220</span></a>
</span><span id="MeshManager.scale_mesh-221"><a href="#MeshManager.scale_mesh-221"><span class="linenos">221</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span></pre></div>


            <div class="docstring"><p>Scale the mesh uniformly.</p>

<p>Args:
    scale_factor: Scaling factor</p>

<p>Returns:
    Scaled mesh</p>
</div>


                            </div>
                            <div id="MeshManager.align_with_z_axis" class="classattr">
                                        <input id="MeshManager.align_with_z_axis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align_with_z_axis</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">target_axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.align_with_z_axis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.align_with_z_axis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.align_with_z_axis-223"><a href="#MeshManager.align_with_z_axis-223"><span class="linenos">223</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">align_with_z_axis</span><span class="p">(</span>
</span><span id="MeshManager.align_with_z_axis-224"><a href="#MeshManager.align_with_z_axis-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">target_axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.align_with_z_axis-225"><a href="#MeshManager.align_with_z_axis-225"><span class="linenos">225</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.align_with_z_axis-226"><a href="#MeshManager.align_with_z_axis-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.align_with_z_axis-227"><a href="#MeshManager.align_with_z_axis-227"><span class="linenos">227</span></a><span class="sd">        Align the mesh&#39;s principal axis with the z-axis.</span>
</span><span id="MeshManager.align_with_z_axis-228"><a href="#MeshManager.align_with_z_axis-228"><span class="linenos">228</span></a>
</span><span id="MeshManager.align_with_z_axis-229"><a href="#MeshManager.align_with_z_axis-229"><span class="linenos">229</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.align_with_z_axis-230"><a href="#MeshManager.align_with_z_axis-230"><span class="linenos">230</span></a><span class="sd">            target_axis: Target direction (default: [0, 0, 1])</span>
</span><span id="MeshManager.align_with_z_axis-231"><a href="#MeshManager.align_with_z_axis-231"><span class="linenos">231</span></a>
</span><span id="MeshManager.align_with_z_axis-232"><a href="#MeshManager.align_with_z_axis-232"><span class="linenos">232</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.align_with_z_axis-233"><a href="#MeshManager.align_with_z_axis-233"><span class="linenos">233</span></a><span class="sd">            Aligned mesh</span>
</span><span id="MeshManager.align_with_z_axis-234"><a href="#MeshManager.align_with_z_axis-234"><span class="linenos">234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.align_with_z_axis-235"><a href="#MeshManager.align_with_z_axis-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.align_with_z_axis-236"><a href="#MeshManager.align_with_z_axis-236"><span class="linenos">236</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.align_with_z_axis-237"><a href="#MeshManager.align_with_z_axis-237"><span class="linenos">237</span></a>
</span><span id="MeshManager.align_with_z_axis-238"><a href="#MeshManager.align_with_z_axis-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">target_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.align_with_z_axis-239"><a href="#MeshManager.align_with_z_axis-239"><span class="linenos">239</span></a>            <span class="n">target_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="MeshManager.align_with_z_axis-240"><a href="#MeshManager.align_with_z_axis-240"><span class="linenos">240</span></a>
</span><span id="MeshManager.align_with_z_axis-241"><a href="#MeshManager.align_with_z_axis-241"><span class="linenos">241</span></a>        <span class="c1"># Compute principal axis using PCA</span>
</span><span id="MeshManager.align_with_z_axis-242"><a href="#MeshManager.align_with_z_axis-242"><span class="linenos">242</span></a>        <span class="n">vertices_centered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager.align_with_z_axis-243"><a href="#MeshManager.align_with_z_axis-243"><span class="linenos">243</span></a>        <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">vertices_centered</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="MeshManager.align_with_z_axis-244"><a href="#MeshManager.align_with_z_axis-244"><span class="linenos">244</span></a>        <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
</span><span id="MeshManager.align_with_z_axis-245"><a href="#MeshManager.align_with_z_axis-245"><span class="linenos">245</span></a>
</span><span id="MeshManager.align_with_z_axis-246"><a href="#MeshManager.align_with_z_axis-246"><span class="linenos">246</span></a>        <span class="c1"># Principal axis is the eigenvector with largest eigenvalue</span>
</span><span id="MeshManager.align_with_z_axis-247"><a href="#MeshManager.align_with_z_axis-247"><span class="linenos">247</span></a>        <span class="n">principal_axis</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)]</span>
</span><span id="MeshManager.align_with_z_axis-248"><a href="#MeshManager.align_with_z_axis-248"><span class="linenos">248</span></a>
</span><span id="MeshManager.align_with_z_axis-249"><a href="#MeshManager.align_with_z_axis-249"><span class="linenos">249</span></a>        <span class="c1"># Compute rotation to align principal axis with target</span>
</span><span id="MeshManager.align_with_z_axis-250"><a href="#MeshManager.align_with_z_axis-250"><span class="linenos">250</span></a>        <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_between_vectors</span><span class="p">(</span>
</span><span id="MeshManager.align_with_z_axis-251"><a href="#MeshManager.align_with_z_axis-251"><span class="linenos">251</span></a>            <span class="n">principal_axis</span><span class="p">,</span> <span class="n">target_axis</span>
</span><span id="MeshManager.align_with_z_axis-252"><a href="#MeshManager.align_with_z_axis-252"><span class="linenos">252</span></a>        <span class="p">)</span>
</span><span id="MeshManager.align_with_z_axis-253"><a href="#MeshManager.align_with_z_axis-253"><span class="linenos">253</span></a>
</span><span id="MeshManager.align_with_z_axis-254"><a href="#MeshManager.align_with_z_axis-254"><span class="linenos">254</span></a>        <span class="c1"># Apply rotation</span>
</span><span id="MeshManager.align_with_z_axis-255"><a href="#MeshManager.align_with_z_axis-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager.align_with_z_axis-256"><a href="#MeshManager.align_with_z_axis-256"><span class="linenos">256</span></a>            <span class="n">rotation_matrix</span> <span class="o">@</span> <span class="n">vertices_centered</span><span class="o">.</span><span class="n">T</span>
</span><span id="MeshManager.align_with_z_axis-257"><a href="#MeshManager.align_with_z_axis-257"><span class="linenos">257</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager.align_with_z_axis-258"><a href="#MeshManager.align_with_z_axis-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.align_with_z_axis-259"><a href="#MeshManager.align_with_z_axis-259"><span class="linenos">259</span></a>
</span><span id="MeshManager.align_with_z_axis-260"><a href="#MeshManager.align_with_z_axis-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span></pre></div>


            <div class="docstring"><p>Align the mesh's principal axis with the z-axis.</p>

<p>Args:
    target_axis: Target direction (default: [0, 0, 1])</p>

<p>Returns:
    Aligned mesh</p>
</div>


                            </div>
                            <div id="MeshManager.align_furthest_points_with_z" class="classattr">
                                        <input id="MeshManager.align_furthest_points_with_z-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align_furthest_points_with_z</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">prefer_positive_z</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">use_convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.align_furthest_points_with_z-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.align_furthest_points_with_z"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.align_furthest_points_with_z-315"><a href="#MeshManager.align_furthest_points_with_z-315"><span class="linenos">315</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">align_furthest_points_with_z</span><span class="p">(</span>
</span><span id="MeshManager.align_furthest_points_with_z-316"><a href="#MeshManager.align_furthest_points_with_z-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.align_furthest_points_with_z-317"><a href="#MeshManager.align_furthest_points_with_z-317"><span class="linenos">317</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="MeshManager.align_furthest_points_with_z-318"><a href="#MeshManager.align_furthest_points_with_z-318"><span class="linenos">318</span></a>        <span class="n">prefer_positive_z</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.align_furthest_points_with_z-319"><a href="#MeshManager.align_furthest_points_with_z-319"><span class="linenos">319</span></a>        <span class="n">use_convex_hull</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.align_furthest_points_with_z-320"><a href="#MeshManager.align_furthest_points_with_z-320"><span class="linenos">320</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-321"><a href="#MeshManager.align_furthest_points_with_z-321"><span class="linenos">321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.align_furthest_points_with_z-322"><a href="#MeshManager.align_furthest_points_with_z-322"><span class="linenos">322</span></a><span class="sd">        Orient the mesh so the vector between the two furthest-apart points</span>
</span><span id="MeshManager.align_furthest_points_with_z-323"><a href="#MeshManager.align_furthest_points_with_z-323"><span class="linenos">323</span></a><span class="sd">        aligns with the +Z axis.</span>
</span><span id="MeshManager.align_furthest_points_with_z-324"><a href="#MeshManager.align_furthest_points_with_z-324"><span class="linenos">324</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-325"><a href="#MeshManager.align_furthest_points_with_z-325"><span class="linenos">325</span></a><span class="sd">        This computes a diameter of the point set (by default using the convex</span>
</span><span id="MeshManager.align_furthest_points_with_z-326"><a href="#MeshManager.align_furthest_points_with_z-326"><span class="linenos">326</span></a><span class="sd">        hull vertices for efficiency), finds the pair of points with maximum</span>
</span><span id="MeshManager.align_furthest_points_with_z-327"><a href="#MeshManager.align_furthest_points_with_z-327"><span class="linenos">327</span></a><span class="sd">        Euclidean distance, and rotates the mesh about its centroid so that</span>
</span><span id="MeshManager.align_furthest_points_with_z-328"><a href="#MeshManager.align_furthest_points_with_z-328"><span class="linenos">328</span></a><span class="sd">        this vector is aligned with the positive z-axis.</span>
</span><span id="MeshManager.align_furthest_points_with_z-329"><a href="#MeshManager.align_furthest_points_with_z-329"><span class="linenos">329</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-330"><a href="#MeshManager.align_furthest_points_with_z-330"><span class="linenos">330</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.align_furthest_points_with_z-331"><a href="#MeshManager.align_furthest_points_with_z-331"><span class="linenos">331</span></a><span class="sd">            prefer_positive_z: If True, align the diameter to +Z; otherwise the</span>
</span><span id="MeshManager.align_furthest_points_with_z-332"><a href="#MeshManager.align_furthest_points_with_z-332"><span class="linenos">332</span></a><span class="sd">                orientation to Z is arbitrary up to a sign.</span>
</span><span id="MeshManager.align_furthest_points_with_z-333"><a href="#MeshManager.align_furthest_points_with_z-333"><span class="linenos">333</span></a><span class="sd">            use_convex_hull: If True (default), compute the diameter over the</span>
</span><span id="MeshManager.align_furthest_points_with_z-334"><a href="#MeshManager.align_furthest_points_with_z-334"><span class="linenos">334</span></a><span class="sd">                convex hull vertices. This is typically much smaller than the</span>
</span><span id="MeshManager.align_furthest_points_with_z-335"><a href="#MeshManager.align_furthest_points_with_z-335"><span class="linenos">335</span></a><span class="sd">                full vertex set and yields the same diameter for convex sets.</span>
</span><span id="MeshManager.align_furthest_points_with_z-336"><a href="#MeshManager.align_furthest_points_with_z-336"><span class="linenos">336</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-337"><a href="#MeshManager.align_furthest_points_with_z-337"><span class="linenos">337</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.align_furthest_points_with_z-338"><a href="#MeshManager.align_furthest_points_with_z-338"><span class="linenos">338</span></a><span class="sd">            The rotated mesh (also stored in self.mesh).</span>
</span><span id="MeshManager.align_furthest_points_with_z-339"><a href="#MeshManager.align_furthest_points_with_z-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.align_furthest_points_with_z-340"><a href="#MeshManager.align_furthest_points_with_z-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-341"><a href="#MeshManager.align_furthest_points_with_z-341"><span class="linenos">341</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-342"><a href="#MeshManager.align_furthest_points_with_z-342"><span class="linenos">342</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-343"><a href="#MeshManager.align_furthest_points_with_z-343"><span class="linenos">343</span></a>        <span class="c1"># Select candidate points</span>
</span><span id="MeshManager.align_furthest_points_with_z-344"><a href="#MeshManager.align_furthest_points_with_z-344"><span class="linenos">344</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-345"><a href="#MeshManager.align_furthest_points_with_z-345"><span class="linenos">345</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager.align_furthest_points_with_z-346"><a href="#MeshManager.align_furthest_points_with_z-346"><span class="linenos">346</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">convex_hull</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager.align_furthest_points_with_z-347"><a href="#MeshManager.align_furthest_points_with_z-347"><span class="linenos">347</span></a>                <span class="k">if</span> <span class="n">use_convex_hull</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;convex_hull&quot;</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-348"><a href="#MeshManager.align_furthest_points_with_z-348"><span class="linenos">348</span></a>                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager.align_furthest_points_with_z-349"><a href="#MeshManager.align_furthest_points_with_z-349"><span class="linenos">349</span></a>            <span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-350"><a href="#MeshManager.align_furthest_points_with_z-350"><span class="linenos">350</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-351"><a href="#MeshManager.align_furthest_points_with_z-351"><span class="linenos">351</span></a>            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span>
</span><span id="MeshManager.align_furthest_points_with_z-352"><a href="#MeshManager.align_furthest_points_with_z-352"><span class="linenos">352</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-353"><a href="#MeshManager.align_furthest_points_with_z-353"><span class="linenos">353</span></a>        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-354"><a href="#MeshManager.align_furthest_points_with_z-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-355"><a href="#MeshManager.align_furthest_points_with_z-355"><span class="linenos">355</span></a>            <span class="c1"># Nothing to do</span>
</span><span id="MeshManager.align_furthest_points_with_z-356"><a href="#MeshManager.align_furthest_points_with_z-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager.align_furthest_points_with_z-357"><a href="#MeshManager.align_furthest_points_with_z-357"><span class="linenos">357</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-358"><a href="#MeshManager.align_furthest_points_with_z-358"><span class="linenos">358</span></a>        <span class="c1"># Find furthest pair using a vectorized per-anchor pass (O(n^2) time, O(n) mem)</span>
</span><span id="MeshManager.align_furthest_points_with_z-359"><a href="#MeshManager.align_furthest_points_with_z-359"><span class="linenos">359</span></a>        <span class="n">best_i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MeshManager.align_furthest_points_with_z-360"><a href="#MeshManager.align_furthest_points_with_z-360"><span class="linenos">360</span></a>        <span class="n">best_j</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MeshManager.align_furthest_points_with_z-361"><a href="#MeshManager.align_furthest_points_with_z-361"><span class="linenos">361</span></a>        <span class="n">best_d2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
</span><span id="MeshManager.align_furthest_points_with_z-362"><a href="#MeshManager.align_furthest_points_with_z-362"><span class="linenos">362</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MeshManager.align_furthest_points_with_z-363"><a href="#MeshManager.align_furthest_points_with_z-363"><span class="linenos">363</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MeshManager.align_furthest_points_with_z-364"><a href="#MeshManager.align_furthest_points_with_z-364"><span class="linenos">364</span></a>            <span class="n">diffs</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MeshManager.align_furthest_points_with_z-365"><a href="#MeshManager.align_furthest_points_with_z-365"><span class="linenos">365</span></a>            <span class="k">if</span> <span class="n">diffs</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-366"><a href="#MeshManager.align_furthest_points_with_z-366"><span class="linenos">366</span></a>                <span class="k">continue</span>
</span><span id="MeshManager.align_furthest_points_with_z-367"><a href="#MeshManager.align_furthest_points_with_z-367"><span class="linenos">367</span></a>            <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">diffs</span><span class="p">,</span> <span class="n">diffs</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-368"><a href="#MeshManager.align_furthest_points_with_z-368"><span class="linenos">368</span></a>            <span class="n">j_rel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">d2</span><span class="p">))</span>
</span><span id="MeshManager.align_furthest_points_with_z-369"><a href="#MeshManager.align_furthest_points_with_z-369"><span class="linenos">369</span></a>            <span class="k">if</span> <span class="n">d2</span><span class="p">[</span><span class="n">j_rel</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">best_d2</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-370"><a href="#MeshManager.align_furthest_points_with_z-370"><span class="linenos">370</span></a>                <span class="n">best_d2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">j_rel</span><span class="p">])</span>
</span><span id="MeshManager.align_furthest_points_with_z-371"><a href="#MeshManager.align_furthest_points_with_z-371"><span class="linenos">371</span></a>                <span class="n">best_i</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="MeshManager.align_furthest_points_with_z-372"><a href="#MeshManager.align_furthest_points_with_z-372"><span class="linenos">372</span></a>                <span class="n">best_j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">j_rel</span>
</span><span id="MeshManager.align_furthest_points_with_z-373"><a href="#MeshManager.align_furthest_points_with_z-373"><span class="linenos">373</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-374"><a href="#MeshManager.align_furthest_points_with_z-374"><span class="linenos">374</span></a>        <span class="n">p1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">best_i</span><span class="p">]</span>
</span><span id="MeshManager.align_furthest_points_with_z-375"><a href="#MeshManager.align_furthest_points_with_z-375"><span class="linenos">375</span></a>        <span class="n">p2</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">best_j</span><span class="p">]</span>
</span><span id="MeshManager.align_furthest_points_with_z-376"><a href="#MeshManager.align_furthest_points_with_z-376"><span class="linenos">376</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
</span><span id="MeshManager.align_furthest_points_with_z-377"><a href="#MeshManager.align_furthest_points_with_z-377"><span class="linenos">377</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="MeshManager.align_furthest_points_with_z-378"><a href="#MeshManager.align_furthest_points_with_z-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span> <span class="ow">or</span> <span class="n">norm</span> <span class="o">&lt;=</span> <span class="mf">1e-12</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-379"><a href="#MeshManager.align_furthest_points_with_z-379"><span class="linenos">379</span></a>            <span class="c1"># Degenerate case; nothing to rotate</span>
</span><span id="MeshManager.align_furthest_points_with_z-380"><a href="#MeshManager.align_furthest_points_with_z-380"><span class="linenos">380</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager.align_furthest_points_with_z-381"><a href="#MeshManager.align_furthest_points_with_z-381"><span class="linenos">381</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-382"><a href="#MeshManager.align_furthest_points_with_z-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="n">prefer_positive_z</span> <span class="ow">and</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-383"><a href="#MeshManager.align_furthest_points_with_z-383"><span class="linenos">383</span></a>            <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span>
</span><span id="MeshManager.align_furthest_points_with_z-384"><a href="#MeshManager.align_furthest_points_with_z-384"><span class="linenos">384</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-385"><a href="#MeshManager.align_furthest_points_with_z-385"><span class="linenos">385</span></a>        <span class="c1"># Compute rotation from v to +Z</span>
</span><span id="MeshManager.align_furthest_points_with_z-386"><a href="#MeshManager.align_furthest_points_with_z-386"><span class="linenos">386</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-387"><a href="#MeshManager.align_furthest_points_with_z-387"><span class="linenos">387</span></a>        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_between_vectors</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-388"><a href="#MeshManager.align_furthest_points_with_z-388"><span class="linenos">388</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-389"><a href="#MeshManager.align_furthest_points_with_z-389"><span class="linenos">389</span></a>        <span class="c1"># Rotate about centroid to preserve position</span>
</span><span id="MeshManager.align_furthest_points_with_z-390"><a href="#MeshManager.align_furthest_points_with_z-390"><span class="linenos">390</span></a>        <span class="n">centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="MeshManager.align_furthest_points_with_z-391"><a href="#MeshManager.align_furthest_points_with_z-391"><span class="linenos">391</span></a>        <span class="n">vc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-</span> <span class="n">centroid</span>
</span><span id="MeshManager.align_furthest_points_with_z-392"><a href="#MeshManager.align_furthest_points_with_z-392"><span class="linenos">392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">@</span> <span class="n">vc</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">centroid</span>
</span><span id="MeshManager.align_furthest_points_with_z-393"><a href="#MeshManager.align_furthest_points_with_z-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.align_furthest_points_with_z-394"><a href="#MeshManager.align_furthest_points_with_z-394"><span class="linenos">394</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-395"><a href="#MeshManager.align_furthest_points_with_z-395"><span class="linenos">395</span></a>        <span class="c1"># Post-rotation correction: compute the furthest pair on the rotated</span>
</span><span id="MeshManager.align_furthest_points_with_z-396"><a href="#MeshManager.align_furthest_points_with_z-396"><span class="linenos">396</span></a>        <span class="c1"># vertices and ensure that vector is aligned with +Z as well. This</span>
</span><span id="MeshManager.align_furthest_points_with_z-397"><a href="#MeshManager.align_furthest_points_with_z-397"><span class="linenos">397</span></a>        <span class="c1"># guards against cases where the exact furthest pair differs slightly</span>
</span><span id="MeshManager.align_furthest_points_with_z-398"><a href="#MeshManager.align_furthest_points_with_z-398"><span class="linenos">398</span></a>        <span class="c1"># from the one chosen for the initial rotation.</span>
</span><span id="MeshManager.align_furthest_points_with_z-399"><a href="#MeshManager.align_furthest_points_with_z-399"><span class="linenos">399</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-400"><a href="#MeshManager.align_furthest_points_with_z-400"><span class="linenos">400</span></a>            <span class="n">all_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-401"><a href="#MeshManager.align_furthest_points_with_z-401"><span class="linenos">401</span></a>            <span class="k">if</span> <span class="n">all_pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-402"><a href="#MeshManager.align_furthest_points_with_z-402"><span class="linenos">402</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_furthest_pair</span><span class="p">(</span><span class="n">all_pts</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-403"><a href="#MeshManager.align_furthest_points_with_z-403"><span class="linenos">403</span></a>                <span class="k">if</span> <span class="n">prefer_positive_z</span> <span class="ow">and</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-404"><a href="#MeshManager.align_furthest_points_with_z-404"><span class="linenos">404</span></a>                    <span class="n">v2</span> <span class="o">=</span> <span class="o">-</span><span class="n">v2</span>
</span><span id="MeshManager.align_furthest_points_with_z-405"><a href="#MeshManager.align_furthest_points_with_z-405"><span class="linenos">405</span></a>                <span class="n">v2n</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-406"><a href="#MeshManager.align_furthest_points_with_z-406"><span class="linenos">406</span></a>                <span class="k">if</span> <span class="n">v2n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.999</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-407"><a href="#MeshManager.align_furthest_points_with_z-407"><span class="linenos">407</span></a>                    <span class="n">R2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotation_matrix_between_vectors</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MeshManager.align_furthest_points_with_z-408"><a href="#MeshManager.align_furthest_points_with_z-408"><span class="linenos">408</span></a>                    <span class="n">vc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">-</span> <span class="n">centroid</span>
</span><span id="MeshManager.align_furthest_points_with_z-409"><a href="#MeshManager.align_furthest_points_with_z-409"><span class="linenos">409</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span><span class="n">R2</span> <span class="o">@</span> <span class="n">vc2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">centroid</span>
</span><span id="MeshManager.align_furthest_points_with_z-410"><a href="#MeshManager.align_furthest_points_with_z-410"><span class="linenos">410</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_bounds</span><span class="p">()</span>
</span><span id="MeshManager.align_furthest_points_with_z-411"><a href="#MeshManager.align_furthest_points_with_z-411"><span class="linenos">411</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.align_furthest_points_with_z-412"><a href="#MeshManager.align_furthest_points_with_z-412"><span class="linenos">412</span></a>            <span class="c1"># If anything goes wrong, we keep the initial rotation which already</span>
</span><span id="MeshManager.align_furthest_points_with_z-413"><a href="#MeshManager.align_furthest_points_with_z-413"><span class="linenos">413</span></a>            <span class="c1"># aligns the chosen diameter to +Z.</span>
</span><span id="MeshManager.align_furthest_points_with_z-414"><a href="#MeshManager.align_furthest_points_with_z-414"><span class="linenos">414</span></a>            <span class="k">pass</span>
</span><span id="MeshManager.align_furthest_points_with_z-415"><a href="#MeshManager.align_furthest_points_with_z-415"><span class="linenos">415</span></a>
</span><span id="MeshManager.align_furthest_points_with_z-416"><a href="#MeshManager.align_furthest_points_with_z-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span></pre></div>


            <div class="docstring"><p>Orient the mesh so the vector between the two furthest-apart points
aligns with the +Z axis.</p>

<p>This computes a diameter of the point set (by default using the convex
hull vertices for efficiency), finds the pair of points with maximum
Euclidean distance, and rotates the mesh about its centroid so that
this vector is aligned with the positive z-axis.</p>

<p>Args:
    prefer_positive_z: If True, align the diameter to +Z; otherwise the
        orientation to Z is arbitrary up to a sign.
    use_convex_hull: If True (default), compute the diameter over the
        convex hull vertices. This is typically much smaller than the
        full vertex set and yields the same diameter for convex sets.</p>

<p>Returns:
    The rotated mesh (also stored in self.mesh).</p>
</div>


                            </div>
                            <div id="MeshManager.analyze_mesh" class="classattr">
                                        <input id="MeshManager.analyze_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">analyze_mesh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="MeshManager.analyze_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.analyze_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.analyze_mesh-420"><a href="#MeshManager.analyze_mesh-420"><span class="linenos">420</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-421"><a href="#MeshManager.analyze_mesh-421"><span class="linenos">421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.analyze_mesh-422"><a href="#MeshManager.analyze_mesh-422"><span class="linenos">422</span></a><span class="sd">        Analyze and return mesh properties for diagnostic purposes.</span>
</span><span id="MeshManager.analyze_mesh-423"><a href="#MeshManager.analyze_mesh-423"><span class="linenos">423</span></a><span class="sd">        This function performs pure analysis without modifying the input mesh.</span>
</span><span id="MeshManager.analyze_mesh-424"><a href="#MeshManager.analyze_mesh-424"><span class="linenos">424</span></a>
</span><span id="MeshManager.analyze_mesh-425"><a href="#MeshManager.analyze_mesh-425"><span class="linenos">425</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.analyze_mesh-426"><a href="#MeshManager.analyze_mesh-426"><span class="linenos">426</span></a><span class="sd">            Dictionary of mesh properties including volume, watertightness, winding consistency,</span>
</span><span id="MeshManager.analyze_mesh-427"><a href="#MeshManager.analyze_mesh-427"><span class="linenos">427</span></a><span class="sd">            face count, vertex count, bounds, and potential issues.</span>
</span><span id="MeshManager.analyze_mesh-428"><a href="#MeshManager.analyze_mesh-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.analyze_mesh-429"><a href="#MeshManager.analyze_mesh-429"><span class="linenos">429</span></a>
</span><span id="MeshManager.analyze_mesh-430"><a href="#MeshManager.analyze_mesh-430"><span class="linenos">430</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_trimesh</span><span class="p">()</span>
</span><span id="MeshManager.analyze_mesh-431"><a href="#MeshManager.analyze_mesh-431"><span class="linenos">431</span></a>        <span class="c1"># Initialize results dictionary</span>
</span><span id="MeshManager.analyze_mesh-432"><a href="#MeshManager.analyze_mesh-432"><span class="linenos">432</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MeshManager.analyze_mesh-433"><a href="#MeshManager.analyze_mesh-433"><span class="linenos">433</span></a>            <span class="s2">&quot;face_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span>
</span><span id="MeshManager.analyze_mesh-434"><a href="#MeshManager.analyze_mesh-434"><span class="linenos">434</span></a>            <span class="s2">&quot;vertex_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">),</span>
</span><span id="MeshManager.analyze_mesh-435"><a href="#MeshManager.analyze_mesh-435"><span class="linenos">435</span></a>            <span class="s2">&quot;bounds&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;bounds&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager.analyze_mesh-436"><a href="#MeshManager.analyze_mesh-436"><span class="linenos">436</span></a>            <span class="s2">&quot;is_watertight&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">,</span>
</span><span id="MeshManager.analyze_mesh-437"><a href="#MeshManager.analyze_mesh-437"><span class="linenos">437</span></a>            <span class="s2">&quot;is_winding_consistent&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">,</span>
</span><span id="MeshManager.analyze_mesh-438"><a href="#MeshManager.analyze_mesh-438"><span class="linenos">438</span></a>            <span class="s2">&quot;issues&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MeshManager.analyze_mesh-439"><a href="#MeshManager.analyze_mesh-439"><span class="linenos">439</span></a>        <span class="p">}</span>
</span><span id="MeshManager.analyze_mesh-440"><a href="#MeshManager.analyze_mesh-440"><span class="linenos">440</span></a>
</span><span id="MeshManager.analyze_mesh-441"><a href="#MeshManager.analyze_mesh-441"><span class="linenos">441</span></a>        <span class="c1"># Calculate volume (report actual value, even if negative)</span>
</span><span id="MeshManager.analyze_mesh-442"><a href="#MeshManager.analyze_mesh-442"><span class="linenos">442</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-443"><a href="#MeshManager.analyze_mesh-443"><span class="linenos">443</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span>
</span><span id="MeshManager.analyze_mesh-444"><a href="#MeshManager.analyze_mesh-444"><span class="linenos">444</span></a>            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-445"><a href="#MeshManager.analyze_mesh-445"><span class="linenos">445</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.analyze_mesh-446"><a href="#MeshManager.analyze_mesh-446"><span class="linenos">446</span></a>                    <span class="s2">&quot;Negative volume detected - face normals may be inverted&quot;</span>
</span><span id="MeshManager.analyze_mesh-447"><a href="#MeshManager.analyze_mesh-447"><span class="linenos">447</span></a>                <span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-448"><a href="#MeshManager.analyze_mesh-448"><span class="linenos">448</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-449"><a href="#MeshManager.analyze_mesh-449"><span class="linenos">449</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-450"><a href="#MeshManager.analyze_mesh-450"><span class="linenos">450</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Volume calculation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-451"><a href="#MeshManager.analyze_mesh-451"><span class="linenos">451</span></a>
</span><span id="MeshManager.analyze_mesh-452"><a href="#MeshManager.analyze_mesh-452"><span class="linenos">452</span></a>        <span class="c1"># Check for non-manifold edges</span>
</span><span id="MeshManager.analyze_mesh-453"><a href="#MeshManager.analyze_mesh-453"><span class="linenos">453</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-454"><a href="#MeshManager.analyze_mesh-454"><span class="linenos">454</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;is_manifold&quot;</span><span class="p">):</span>
</span><span id="MeshManager.analyze_mesh-455"><a href="#MeshManager.analyze_mesh-455"><span class="linenos">455</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;is_manifold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_manifold</span>
</span><span id="MeshManager.analyze_mesh-456"><a href="#MeshManager.analyze_mesh-456"><span class="linenos">456</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_manifold</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-457"><a href="#MeshManager.analyze_mesh-457"><span class="linenos">457</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Non-manifold edges detected&quot;</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-458"><a href="#MeshManager.analyze_mesh-458"><span class="linenos">458</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-459"><a href="#MeshManager.analyze_mesh-459"><span class="linenos">459</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;is_manifold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-460"><a href="#MeshManager.analyze_mesh-460"><span class="linenos">460</span></a>
</span><span id="MeshManager.analyze_mesh-461"><a href="#MeshManager.analyze_mesh-461"><span class="linenos">461</span></a>        <span class="c1"># Calculate topological properties using trimesh&#39;s built-in methods</span>
</span><span id="MeshManager.analyze_mesh-462"><a href="#MeshManager.analyze_mesh-462"><span class="linenos">462</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-463"><a href="#MeshManager.analyze_mesh-463"><span class="linenos">463</span></a>            <span class="c1"># Use trimesh&#39;s built-in euler_number property for correct topology calculation</span>
</span><span id="MeshManager.analyze_mesh-464"><a href="#MeshManager.analyze_mesh-464"><span class="linenos">464</span></a>            <span class="c1"># For a sphere: euler_number = 2</span>
</span><span id="MeshManager.analyze_mesh-465"><a href="#MeshManager.analyze_mesh-465"><span class="linenos">465</span></a>            <span class="c1"># For a torus: euler_number = 0</span>
</span><span id="MeshManager.analyze_mesh-466"><a href="#MeshManager.analyze_mesh-466"><span class="linenos">466</span></a>            <span class="c1"># For a double torus: euler_number = -2</span>
</span><span id="MeshManager.analyze_mesh-467"><a href="#MeshManager.analyze_mesh-467"><span class="linenos">467</span></a>            <span class="c1"># Genus = (2 - euler_number) / 2</span>
</span><span id="MeshManager.analyze_mesh-468"><a href="#MeshManager.analyze_mesh-468"><span class="linenos">468</span></a>
</span><span id="MeshManager.analyze_mesh-469"><a href="#MeshManager.analyze_mesh-469"><span class="linenos">469</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">euler_number</span>
</span><span id="MeshManager.analyze_mesh-470"><a href="#MeshManager.analyze_mesh-470"><span class="linenos">470</span></a>
</span><span id="MeshManager.analyze_mesh-471"><a href="#MeshManager.analyze_mesh-471"><span class="linenos">471</span></a>            <span class="c1"># Only calculate genus for closed (watertight) meshes</span>
</span><span id="MeshManager.analyze_mesh-472"><a href="#MeshManager.analyze_mesh-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-473"><a href="#MeshManager.analyze_mesh-473"><span class="linenos">473</span></a>                <span class="c1"># For a closed orientable surface: genus = (2 - euler_number) / 2</span>
</span><span id="MeshManager.analyze_mesh-474"><a href="#MeshManager.analyze_mesh-474"><span class="linenos">474</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">2</span> <span class="o">-</span> <span class="n">mesh</span><span class="o">.</span><span class="n">euler_number</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-475"><a href="#MeshManager.analyze_mesh-475"><span class="linenos">475</span></a>
</span><span id="MeshManager.analyze_mesh-476"><a href="#MeshManager.analyze_mesh-476"><span class="linenos">476</span></a>                <span class="c1"># Sanity check - genus should be non-negative for simple shapes</span>
</span><span id="MeshManager.analyze_mesh-477"><a href="#MeshManager.analyze_mesh-477"><span class="linenos">477</span></a>                <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-478"><a href="#MeshManager.analyze_mesh-478"><span class="linenos">478</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager.analyze_mesh-479"><a href="#MeshManager.analyze_mesh-479"><span class="linenos">479</span></a>                        <span class="mi">0</span>  <span class="c1"># Default to 0 for simple shapes like spheres, cylinders</span>
</span><span id="MeshManager.analyze_mesh-480"><a href="#MeshManager.analyze_mesh-480"><span class="linenos">480</span></a>                    <span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-481"><a href="#MeshManager.analyze_mesh-481"><span class="linenos">481</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.analyze_mesh-482"><a href="#MeshManager.analyze_mesh-482"><span class="linenos">482</span></a>                        <span class="s2">&quot;Calculated negative genus, defaulting to 0&quot;</span>
</span><span id="MeshManager.analyze_mesh-483"><a href="#MeshManager.analyze_mesh-483"><span class="linenos">483</span></a>                    <span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-484"><a href="#MeshManager.analyze_mesh-484"><span class="linenos">484</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-485"><a href="#MeshManager.analyze_mesh-485"><span class="linenos">485</span></a>                <span class="c1"># For non-watertight meshes, genus is not well-defined</span>
</span><span id="MeshManager.analyze_mesh-486"><a href="#MeshManager.analyze_mesh-486"><span class="linenos">486</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-487"><a href="#MeshManager.analyze_mesh-487"><span class="linenos">487</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Genus undefined for non-watertight mesh&quot;</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-488"><a href="#MeshManager.analyze_mesh-488"><span class="linenos">488</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-489"><a href="#MeshManager.analyze_mesh-489"><span class="linenos">489</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;genus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-490"><a href="#MeshManager.analyze_mesh-490"><span class="linenos">490</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-491"><a href="#MeshManager.analyze_mesh-491"><span class="linenos">491</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Topology calculation failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-492"><a href="#MeshManager.analyze_mesh-492"><span class="linenos">492</span></a>
</span><span id="MeshManager.analyze_mesh-493"><a href="#MeshManager.analyze_mesh-493"><span class="linenos">493</span></a>        <span class="c1"># Analyze face normals</span>
</span><span id="MeshManager.analyze_mesh-494"><a href="#MeshManager.analyze_mesh-494"><span class="linenos">494</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-495"><a href="#MeshManager.analyze_mesh-495"><span class="linenos">495</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;face_normals&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-496"><a href="#MeshManager.analyze_mesh-496"><span class="linenos">496</span></a>                <span class="c1"># Get statistics on face normal directions</span>
</span><span id="MeshManager.analyze_mesh-497"><a href="#MeshManager.analyze_mesh-497"><span class="linenos">497</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MeshManager.analyze_mesh-498"><a href="#MeshManager.analyze_mesh-498"><span class="linenos">498</span></a>                    <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="MeshManager.analyze_mesh-499"><a href="#MeshManager.analyze_mesh-499"><span class="linenos">499</span></a>                    <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="MeshManager.analyze_mesh-500"><a href="#MeshManager.analyze_mesh-500"><span class="linenos">500</span></a>                    <span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="MeshManager.analyze_mesh-501"><a href="#MeshManager.analyze_mesh-501"><span class="linenos">501</span></a>                <span class="p">}</span>
</span><span id="MeshManager.analyze_mesh-502"><a href="#MeshManager.analyze_mesh-502"><span class="linenos">502</span></a>
</span><span id="MeshManager.analyze_mesh-503"><a href="#MeshManager.analyze_mesh-503"><span class="linenos">503</span></a>                <span class="c1"># Check if normals are predominantly pointing inward (negative volume)</span>
</span><span id="MeshManager.analyze_mesh-504"><a href="#MeshManager.analyze_mesh-504"><span class="linenos">504</span></a>                <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-505"><a href="#MeshManager.analyze_mesh-505"><span class="linenos">505</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;inward&quot;</span>
</span><span id="MeshManager.analyze_mesh-506"><a href="#MeshManager.analyze_mesh-506"><span class="linenos">506</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-507"><a href="#MeshManager.analyze_mesh-507"><span class="linenos">507</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;outward&quot;</span>
</span><span id="MeshManager.analyze_mesh-508"><a href="#MeshManager.analyze_mesh-508"><span class="linenos">508</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-509"><a href="#MeshManager.analyze_mesh-509"><span class="linenos">509</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-510"><a href="#MeshManager.analyze_mesh-510"><span class="linenos">510</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normal analysis failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-511"><a href="#MeshManager.analyze_mesh-511"><span class="linenos">511</span></a>
</span><span id="MeshManager.analyze_mesh-512"><a href="#MeshManager.analyze_mesh-512"><span class="linenos">512</span></a>        <span class="c1"># Check for duplicate vertices and faces</span>
</span><span id="MeshManager.analyze_mesh-513"><a href="#MeshManager.analyze_mesh-513"><span class="linenos">513</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-514"><a href="#MeshManager.analyze_mesh-514"><span class="linenos">514</span></a>            <span class="n">unique_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-515"><a href="#MeshManager.analyze_mesh-515"><span class="linenos">515</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_verts</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-516"><a href="#MeshManager.analyze_mesh-516"><span class="linenos">516</span></a>            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-517"><a href="#MeshManager.analyze_mesh-517"><span class="linenos">517</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.analyze_mesh-518"><a href="#MeshManager.analyze_mesh-518"><span class="linenos">518</span></a>                    <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;duplicate_vertices&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> duplicate vertices&quot;</span>
</span><span id="MeshManager.analyze_mesh-519"><a href="#MeshManager.analyze_mesh-519"><span class="linenos">519</span></a>                <span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-520"><a href="#MeshManager.analyze_mesh-520"><span class="linenos">520</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-521"><a href="#MeshManager.analyze_mesh-521"><span class="linenos">521</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-522"><a href="#MeshManager.analyze_mesh-522"><span class="linenos">522</span></a>
</span><span id="MeshManager.analyze_mesh-523"><a href="#MeshManager.analyze_mesh-523"><span class="linenos">523</span></a>        <span class="c1"># Check for degenerate faces (zero area)</span>
</span><span id="MeshManager.analyze_mesh-524"><a href="#MeshManager.analyze_mesh-524"><span class="linenos">524</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-525"><a href="#MeshManager.analyze_mesh-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;area_faces&quot;</span><span class="p">):</span>
</span><span id="MeshManager.analyze_mesh-526"><a href="#MeshManager.analyze_mesh-526"><span class="linenos">526</span></a>                <span class="n">degenerate_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">area_faces</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-527"><a href="#MeshManager.analyze_mesh-527"><span class="linenos">527</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;degenerate_faces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">degenerate_count</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-528"><a href="#MeshManager.analyze_mesh-528"><span class="linenos">528</span></a>                <span class="k">if</span> <span class="n">degenerate_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-529"><a href="#MeshManager.analyze_mesh-529"><span class="linenos">529</span></a>                    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.analyze_mesh-530"><a href="#MeshManager.analyze_mesh-530"><span class="linenos">530</span></a>                        <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">degenerate_count</span><span class="si">}</span><span class="s2"> degenerate faces&quot;</span>
</span><span id="MeshManager.analyze_mesh-531"><a href="#MeshManager.analyze_mesh-531"><span class="linenos">531</span></a>                    <span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-532"><a href="#MeshManager.analyze_mesh-532"><span class="linenos">532</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-533"><a href="#MeshManager.analyze_mesh-533"><span class="linenos">533</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;degenerate_faces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-534"><a href="#MeshManager.analyze_mesh-534"><span class="linenos">534</span></a>
</span><span id="MeshManager.analyze_mesh-535"><a href="#MeshManager.analyze_mesh-535"><span class="linenos">535</span></a>        <span class="c1"># Check for connected components</span>
</span><span id="MeshManager.analyze_mesh-536"><a href="#MeshManager.analyze_mesh-536"><span class="linenos">536</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-537"><a href="#MeshManager.analyze_mesh-537"><span class="linenos">537</span></a>            <span class="n">components</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-538"><a href="#MeshManager.analyze_mesh-538"><span class="linenos">538</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;component_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-539"><a href="#MeshManager.analyze_mesh-539"><span class="linenos">539</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-540"><a href="#MeshManager.analyze_mesh-540"><span class="linenos">540</span></a>                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.analyze_mesh-541"><a href="#MeshManager.analyze_mesh-541"><span class="linenos">541</span></a>                    <span class="sa">f</span><span class="s2">&quot;Mesh has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> disconnected components&quot;</span>
</span><span id="MeshManager.analyze_mesh-542"><a href="#MeshManager.analyze_mesh-542"><span class="linenos">542</span></a>                <span class="p">)</span>
</span><span id="MeshManager.analyze_mesh-543"><a href="#MeshManager.analyze_mesh-543"><span class="linenos">543</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.analyze_mesh-544"><a href="#MeshManager.analyze_mesh-544"><span class="linenos">544</span></a>            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;component_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.analyze_mesh-545"><a href="#MeshManager.analyze_mesh-545"><span class="linenos">545</span></a>
</span><span id="MeshManager.analyze_mesh-546"><a href="#MeshManager.analyze_mesh-546"><span class="linenos">546</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Analyze and return mesh properties for diagnostic purposes.
This function performs pure analysis without modifying the input mesh.</p>

<p>Returns:
    Dictionary of mesh properties including volume, watertightness, winding consistency,
    face count, vertex count, bounds, and potential issues.</p>
</div>


                            </div>
                            <div id="MeshManager.print_mesh_analysis" class="classattr">
                                        <input id="MeshManager.print_mesh_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_mesh_analysis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MeshManager.print_mesh_analysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.print_mesh_analysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.print_mesh_analysis-548"><a href="#MeshManager.print_mesh_analysis-548"><span class="linenos">548</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_mesh_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-549"><a href="#MeshManager.print_mesh_analysis-549"><span class="linenos">549</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.print_mesh_analysis-550"><a href="#MeshManager.print_mesh_analysis-550"><span class="linenos">550</span></a><span class="sd">        Analyze a mesh and print a formatted report of its properties.</span>
</span><span id="MeshManager.print_mesh_analysis-551"><a href="#MeshManager.print_mesh_analysis-551"><span class="linenos">551</span></a>
</span><span id="MeshManager.print_mesh_analysis-552"><a href="#MeshManager.print_mesh_analysis-552"><span class="linenos">552</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.print_mesh_analysis-553"><a href="#MeshManager.print_mesh_analysis-553"><span class="linenos">553</span></a><span class="sd">            verbose: Whether to print detailed information</span>
</span><span id="MeshManager.print_mesh_analysis-554"><a href="#MeshManager.print_mesh_analysis-554"><span class="linenos">554</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.print_mesh_analysis-555"><a href="#MeshManager.print_mesh_analysis-555"><span class="linenos">555</span></a>        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_mesh</span><span class="p">()</span>
</span><span id="MeshManager.print_mesh_analysis-556"><a href="#MeshManager.print_mesh_analysis-556"><span class="linenos">556</span></a>
</span><span id="MeshManager.print_mesh_analysis-557"><a href="#MeshManager.print_mesh_analysis-557"><span class="linenos">557</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mesh Analysis Report&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-558"><a href="#MeshManager.print_mesh_analysis-558"><span class="linenos">558</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-559"><a href="#MeshManager.print_mesh_analysis-559"><span class="linenos">559</span></a>
</span><span id="MeshManager.print_mesh_analysis-560"><a href="#MeshManager.print_mesh_analysis-560"><span class="linenos">560</span></a>        <span class="c1"># Basic properties</span>
</span><span id="MeshManager.print_mesh_analysis-561"><a href="#MeshManager.print_mesh_analysis-561"><span class="linenos">561</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Geometry:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-562"><a href="#MeshManager.print_mesh_analysis-562"><span class="linenos">562</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Vertices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;vertex_count&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-563"><a href="#MeshManager.print_mesh_analysis-563"><span class="linenos">563</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Faces: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;face_count&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-564"><a href="#MeshManager.print_mesh_analysis-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;component_count&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-565"><a href="#MeshManager.print_mesh_analysis-565"><span class="linenos">565</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Components: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;component_count&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-566"><a href="#MeshManager.print_mesh_analysis-566"><span class="linenos">566</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-567"><a href="#MeshManager.print_mesh_analysis-567"><span class="linenos">567</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Volume: </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-568"><a href="#MeshManager.print_mesh_analysis-568"><span class="linenos">568</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-569"><a href="#MeshManager.print_mesh_analysis-569"><span class="linenos">569</span></a>            <span class="n">min_bound</span><span class="p">,</span> <span class="n">max_bound</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;bounds&quot;</span><span class="p">]</span>
</span><span id="MeshManager.print_mesh_analysis-570"><a href="#MeshManager.print_mesh_analysis-570"><span class="linenos">570</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MeshManager.print_mesh_analysis-571"><a href="#MeshManager.print_mesh_analysis-571"><span class="linenos">571</span></a>                <span class="s2">&quot;  * Bounds: [</span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">] to [</span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">, </span><span class="si">%.1f</span><span class="s2">]&quot;</span><span class="p">,</span>
</span><span id="MeshManager.print_mesh_analysis-572"><a href="#MeshManager.print_mesh_analysis-572"><span class="linenos">572</span></a>                <span class="n">min_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager.print_mesh_analysis-573"><a href="#MeshManager.print_mesh_analysis-573"><span class="linenos">573</span></a>                <span class="n">min_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager.print_mesh_analysis-574"><a href="#MeshManager.print_mesh_analysis-574"><span class="linenos">574</span></a>                <span class="n">min_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager.print_mesh_analysis-575"><a href="#MeshManager.print_mesh_analysis-575"><span class="linenos">575</span></a>                <span class="n">max_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager.print_mesh_analysis-576"><a href="#MeshManager.print_mesh_analysis-576"><span class="linenos">576</span></a>                <span class="n">max_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager.print_mesh_analysis-577"><a href="#MeshManager.print_mesh_analysis-577"><span class="linenos">577</span></a>                <span class="n">max_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager.print_mesh_analysis-578"><a href="#MeshManager.print_mesh_analysis-578"><span class="linenos">578</span></a>            <span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-579"><a href="#MeshManager.print_mesh_analysis-579"><span class="linenos">579</span></a>
</span><span id="MeshManager.print_mesh_analysis-580"><a href="#MeshManager.print_mesh_analysis-580"><span class="linenos">580</span></a>        <span class="c1"># Mesh quality</span>
</span><span id="MeshManager.print_mesh_analysis-581"><a href="#MeshManager.print_mesh_analysis-581"><span class="linenos">581</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mesh Quality:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-582"><a href="#MeshManager.print_mesh_analysis-582"><span class="linenos">582</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Watertight: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_watertight&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-583"><a href="#MeshManager.print_mesh_analysis-583"><span class="linenos">583</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Winding Consistent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_winding_consistent&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-584"><a href="#MeshManager.print_mesh_analysis-584"><span class="linenos">584</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_manifold&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-585"><a href="#MeshManager.print_mesh_analysis-585"><span class="linenos">585</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Manifold: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;is_manifold&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-586"><a href="#MeshManager.print_mesh_analysis-586"><span class="linenos">586</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_direction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-587"><a href="#MeshManager.print_mesh_analysis-587"><span class="linenos">587</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Normal Direction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;normal_direction&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-588"><a href="#MeshManager.print_mesh_analysis-588"><span class="linenos">588</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duplicate_vertices&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-589"><a href="#MeshManager.print_mesh_analysis-589"><span class="linenos">589</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Duplicate Vertices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;duplicate_vertices&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-590"><a href="#MeshManager.print_mesh_analysis-590"><span class="linenos">590</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;degenerate_faces&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-591"><a href="#MeshManager.print_mesh_analysis-591"><span class="linenos">591</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Degenerate Faces: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;degenerate_faces&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-592"><a href="#MeshManager.print_mesh_analysis-592"><span class="linenos">592</span></a>
</span><span id="MeshManager.print_mesh_analysis-593"><a href="#MeshManager.print_mesh_analysis-593"><span class="linenos">593</span></a>        <span class="c1"># Topology</span>
</span><span id="MeshManager.print_mesh_analysis-594"><a href="#MeshManager.print_mesh_analysis-594"><span class="linenos">594</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="MeshManager.print_mesh_analysis-595"><a href="#MeshManager.print_mesh_analysis-595"><span class="linenos">595</span></a>            <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;genus&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MeshManager.print_mesh_analysis-596"><a href="#MeshManager.print_mesh_analysis-596"><span class="linenos">596</span></a>            <span class="ow">or</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MeshManager.print_mesh_analysis-597"><a href="#MeshManager.print_mesh_analysis-597"><span class="linenos">597</span></a>        <span class="p">):</span>
</span><span id="MeshManager.print_mesh_analysis-598"><a href="#MeshManager.print_mesh_analysis-598"><span class="linenos">598</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Topology:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-599"><a href="#MeshManager.print_mesh_analysis-599"><span class="linenos">599</span></a>            <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;genus&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-600"><a href="#MeshManager.print_mesh_analysis-600"><span class="linenos">600</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Genus: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;genus&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-601"><a href="#MeshManager.print_mesh_analysis-601"><span class="linenos">601</span></a>            <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;euler_characteristic&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-602"><a href="#MeshManager.print_mesh_analysis-602"><span class="linenos">602</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Euler Characteristic: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;euler_characteristic&#39;</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-603"><a href="#MeshManager.print_mesh_analysis-603"><span class="linenos">603</span></a>
</span><span id="MeshManager.print_mesh_analysis-604"><a href="#MeshManager.print_mesh_analysis-604"><span class="linenos">604</span></a>        <span class="c1"># Issues</span>
</span><span id="MeshManager.print_mesh_analysis-605"><a href="#MeshManager.print_mesh_analysis-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]:</span>
</span><span id="MeshManager.print_mesh_analysis-606"><a href="#MeshManager.print_mesh_analysis-606"><span class="linenos">606</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Issues Detected (</span><span class="si">%d</span><span class="s2">):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]))</span>
</span><span id="MeshManager.print_mesh_analysis-607"><a href="#MeshManager.print_mesh_analysis-607"><span class="linenos">607</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">issue</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]):</span>
</span><span id="MeshManager.print_mesh_analysis-608"><a href="#MeshManager.print_mesh_analysis-608"><span class="linenos">608</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">. </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">issue</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-609"><a href="#MeshManager.print_mesh_analysis-609"><span class="linenos">609</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-610"><a href="#MeshManager.print_mesh_analysis-610"><span class="linenos">610</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No issues detected&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-611"><a href="#MeshManager.print_mesh_analysis-611"><span class="linenos">611</span></a>
</span><span id="MeshManager.print_mesh_analysis-612"><a href="#MeshManager.print_mesh_analysis-612"><span class="linenos">612</span></a>        <span class="c1"># Detailed stats</span>
</span><span id="MeshManager.print_mesh_analysis-613"><a href="#MeshManager.print_mesh_analysis-613"><span class="linenos">613</span></a>        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-614"><a href="#MeshManager.print_mesh_analysis-614"><span class="linenos">614</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Normal Statistics:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-615"><a href="#MeshManager.print_mesh_analysis-615"><span class="linenos">615</span></a>            <span class="n">mean</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
</span><span id="MeshManager.print_mesh_analysis-616"><a href="#MeshManager.print_mesh_analysis-616"><span class="linenos">616</span></a>            <span class="n">sum_val</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;normal_stats&quot;</span><span class="p">][</span><span class="s2">&quot;sum&quot;</span><span class="p">]</span>
</span><span id="MeshManager.print_mesh_analysis-617"><a href="#MeshManager.print_mesh_analysis-617"><span class="linenos">617</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Mean: [</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mean</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-618"><a href="#MeshManager.print_mesh_analysis-618"><span class="linenos">618</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  * Sum: [</span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">, </span><span class="si">%.4f</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sum_val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sum_val</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sum_val</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MeshManager.print_mesh_analysis-619"><a href="#MeshManager.print_mesh_analysis-619"><span class="linenos">619</span></a>
</span><span id="MeshManager.print_mesh_analysis-620"><a href="#MeshManager.print_mesh_analysis-620"><span class="linenos">620</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendation:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-621"><a href="#MeshManager.print_mesh_analysis-621"><span class="linenos">621</span></a>        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;issues&quot;</span><span class="p">]:</span>
</span><span id="MeshManager.print_mesh_analysis-622"><a href="#MeshManager.print_mesh_analysis-622"><span class="linenos">622</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Consider using repair_mesh() to fix the detected issues.&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-623"><a href="#MeshManager.print_mesh_analysis-623"><span class="linenos">623</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.print_mesh_analysis-624"><a href="#MeshManager.print_mesh_analysis-624"><span class="linenos">624</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Mesh appears to be in good condition.&quot;</span><span class="p">)</span>
</span><span id="MeshManager.print_mesh_analysis-625"><a href="#MeshManager.print_mesh_analysis-625"><span class="linenos">625</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;====================&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Analyze a mesh and print a formatted report of its properties.</p>

<p>Args:
    verbose: Whether to print detailed information</p>
</div>


                            </div>
                            <div id="MeshManager.repair_mesh" class="classattr">
                                        <input id="MeshManager.repair_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">repair_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fix_holes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">fix_normals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">remove_degenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">fix_negative_volume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">keep_largest_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.repair_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.repair_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.repair_mesh-627"><a href="#MeshManager.repair_mesh-627"><span class="linenos">627</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repair_mesh</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-628"><a href="#MeshManager.repair_mesh-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-629"><a href="#MeshManager.repair_mesh-629"><span class="linenos">629</span></a>        <span class="n">fix_holes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-630"><a href="#MeshManager.repair_mesh-630"><span class="linenos">630</span></a>        <span class="n">remove_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-631"><a href="#MeshManager.repair_mesh-631"><span class="linenos">631</span></a>        <span class="n">fix_normals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-632"><a href="#MeshManager.repair_mesh-632"><span class="linenos">632</span></a>        <span class="n">remove_degenerate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-633"><a href="#MeshManager.repair_mesh-633"><span class="linenos">633</span></a>        <span class="n">fix_negative_volume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-634"><a href="#MeshManager.repair_mesh-634"><span class="linenos">634</span></a>        <span class="n">keep_largest_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-635"><a href="#MeshManager.repair_mesh-635"><span class="linenos">635</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-636"><a href="#MeshManager.repair_mesh-636"><span class="linenos">636</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-637"><a href="#MeshManager.repair_mesh-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.repair_mesh-638"><a href="#MeshManager.repair_mesh-638"><span class="linenos">638</span></a><span class="sd">        Attempt to repair common mesh issues to improve watertightness and quality.</span>
</span><span id="MeshManager.repair_mesh-639"><a href="#MeshManager.repair_mesh-639"><span class="linenos">639</span></a>
</span><span id="MeshManager.repair_mesh-640"><a href="#MeshManager.repair_mesh-640"><span class="linenos">640</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.repair_mesh-641"><a href="#MeshManager.repair_mesh-641"><span class="linenos">641</span></a><span class="sd">            mesh_data: Either a Trimesh object or (vertices, faces) tuple</span>
</span><span id="MeshManager.repair_mesh-642"><a href="#MeshManager.repair_mesh-642"><span class="linenos">642</span></a><span class="sd">            fix_holes: Whether to attempt filling holes</span>
</span><span id="MeshManager.repair_mesh-643"><a href="#MeshManager.repair_mesh-643"><span class="linenos">643</span></a><span class="sd">            remove_duplicates: Whether to remove duplicate faces and vertices</span>
</span><span id="MeshManager.repair_mesh-644"><a href="#MeshManager.repair_mesh-644"><span class="linenos">644</span></a><span class="sd">            fix_normals: Whether to fix face normal consistency</span>
</span><span id="MeshManager.repair_mesh-645"><a href="#MeshManager.repair_mesh-645"><span class="linenos">645</span></a><span class="sd">            remove_degenerate: Whether to remove degenerate faces</span>
</span><span id="MeshManager.repair_mesh-646"><a href="#MeshManager.repair_mesh-646"><span class="linenos">646</span></a><span class="sd">            fix_negative_volume: Whether to invert faces if mesh has negative volume</span>
</span><span id="MeshManager.repair_mesh-647"><a href="#MeshManager.repair_mesh-647"><span class="linenos">647</span></a><span class="sd">            keep_largest_component: Whether to keep only the largest connected component</span>
</span><span id="MeshManager.repair_mesh-648"><a href="#MeshManager.repair_mesh-648"><span class="linenos">648</span></a><span class="sd">            verbose: Whether to print repair summary</span>
</span><span id="MeshManager.repair_mesh-649"><a href="#MeshManager.repair_mesh-649"><span class="linenos">649</span></a>
</span><span id="MeshManager.repair_mesh-650"><a href="#MeshManager.repair_mesh-650"><span class="linenos">650</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.repair_mesh-651"><a href="#MeshManager.repair_mesh-651"><span class="linenos">651</span></a><span class="sd">            Repaired mesh (new copy, original is not modified)</span>
</span><span id="MeshManager.repair_mesh-652"><a href="#MeshManager.repair_mesh-652"><span class="linenos">652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.repair_mesh-653"><a href="#MeshManager.repair_mesh-653"><span class="linenos">653</span></a>
</span><span id="MeshManager.repair_mesh-654"><a href="#MeshManager.repair_mesh-654"><span class="linenos">654</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_trimesh</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh-655"><a href="#MeshManager.repair_mesh-655"><span class="linenos">655</span></a>
</span><span id="MeshManager.repair_mesh-656"><a href="#MeshManager.repair_mesh-656"><span class="linenos">656</span></a>        <span class="n">repair_log</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager.repair_mesh-657"><a href="#MeshManager.repair_mesh-657"><span class="linenos">657</span></a>
</span><span id="MeshManager.repair_mesh-658"><a href="#MeshManager.repair_mesh-658"><span class="linenos">658</span></a>        <span class="c1"># Fix negative volume by inverting faces if needed</span>
</span><span id="MeshManager.repair_mesh-659"><a href="#MeshManager.repair_mesh-659"><span class="linenos">659</span></a>        <span class="k">if</span> <span class="n">fix_negative_volume</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-660"><a href="#MeshManager.repair_mesh-660"><span class="linenos">660</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-661"><a href="#MeshManager.repair_mesh-661"><span class="linenos">661</span></a>                <span class="c1"># Check if the mesh has a negative volume</span>
</span><span id="MeshManager.repair_mesh-662"><a href="#MeshManager.repair_mesh-662"><span class="linenos">662</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-663"><a href="#MeshManager.repair_mesh-663"><span class="linenos">663</span></a>                    <span class="n">initial_volume</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span>
</span><span id="MeshManager.repair_mesh-664"><a href="#MeshManager.repair_mesh-664"><span class="linenos">664</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">invert</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh-665"><a href="#MeshManager.repair_mesh-665"><span class="linenos">665</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-666"><a href="#MeshManager.repair_mesh-666"><span class="linenos">666</span></a>                        <span class="sa">f</span><span class="s2">&quot;Inverted faces to fix negative volume: </span><span class="si">{</span><span class="n">initial_volume</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">mesh</span><span class="o">.</span><span class="n">volume</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MeshManager.repair_mesh-667"><a href="#MeshManager.repair_mesh-667"><span class="linenos">667</span></a>                    <span class="p">)</span>
</span><span id="MeshManager.repair_mesh-668"><a href="#MeshManager.repair_mesh-668"><span class="linenos">668</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-669"><a href="#MeshManager.repair_mesh-669"><span class="linenos">669</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fix negative volume: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-670"><a href="#MeshManager.repair_mesh-670"><span class="linenos">670</span></a>
</span><span id="MeshManager.repair_mesh-671"><a href="#MeshManager.repair_mesh-671"><span class="linenos">671</span></a>        <span class="c1"># Remove duplicate and degenerate faces</span>
</span><span id="MeshManager.repair_mesh-672"><a href="#MeshManager.repair_mesh-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="n">remove_duplicates</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-673"><a href="#MeshManager.repair_mesh-673"><span class="linenos">673</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-674"><a href="#MeshManager.repair_mesh-674"><span class="linenos">674</span></a>                <span class="n">initial_faces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-675"><a href="#MeshManager.repair_mesh-675"><span class="linenos">675</span></a>                <span class="n">mesh</span><span class="o">.</span><span class="n">remove_duplicate_faces</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh-676"><a href="#MeshManager.repair_mesh-676"><span class="linenos">676</span></a>                <span class="n">removed_faces</span> <span class="o">=</span> <span class="n">initial_faces</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-677"><a href="#MeshManager.repair_mesh-677"><span class="linenos">677</span></a>                <span class="k">if</span> <span class="n">removed_faces</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-678"><a href="#MeshManager.repair_mesh-678"><span class="linenos">678</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">removed_faces</span><span class="si">}</span><span class="s2"> duplicate faces&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-679"><a href="#MeshManager.repair_mesh-679"><span class="linenos">679</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-680"><a href="#MeshManager.repair_mesh-680"><span class="linenos">680</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove duplicate faces: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-681"><a href="#MeshManager.repair_mesh-681"><span class="linenos">681</span></a>
</span><span id="MeshManager.repair_mesh-682"><a href="#MeshManager.repair_mesh-682"><span class="linenos">682</span></a>        <span class="k">if</span> <span class="n">remove_degenerate</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-683"><a href="#MeshManager.repair_mesh-683"><span class="linenos">683</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-684"><a href="#MeshManager.repair_mesh-684"><span class="linenos">684</span></a>                <span class="n">initial_faces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-685"><a href="#MeshManager.repair_mesh-685"><span class="linenos">685</span></a>                <span class="n">mesh</span><span class="o">.</span><span class="n">remove_degenerate_faces</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh-686"><a href="#MeshManager.repair_mesh-686"><span class="linenos">686</span></a>                <span class="n">removed_faces</span> <span class="o">=</span> <span class="n">initial_faces</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-687"><a href="#MeshManager.repair_mesh-687"><span class="linenos">687</span></a>                <span class="k">if</span> <span class="n">removed_faces</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-688"><a href="#MeshManager.repair_mesh-688"><span class="linenos">688</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">removed_faces</span><span class="si">}</span><span class="s2"> degenerate faces&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-689"><a href="#MeshManager.repair_mesh-689"><span class="linenos">689</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-690"><a href="#MeshManager.repair_mesh-690"><span class="linenos">690</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove degenerate faces: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-691"><a href="#MeshManager.repair_mesh-691"><span class="linenos">691</span></a>
</span><span id="MeshManager.repair_mesh-692"><a href="#MeshManager.repair_mesh-692"><span class="linenos">692</span></a>        <span class="c1"># Fix winding consistency</span>
</span><span id="MeshManager.repair_mesh-693"><a href="#MeshManager.repair_mesh-693"><span class="linenos">693</span></a>        <span class="k">if</span> <span class="n">fix_normals</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-694"><a href="#MeshManager.repair_mesh-694"><span class="linenos">694</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-695"><a href="#MeshManager.repair_mesh-695"><span class="linenos">695</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-696"><a href="#MeshManager.repair_mesh-696"><span class="linenos">696</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">fix_normals</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh-697"><a href="#MeshManager.repair_mesh-697"><span class="linenos">697</span></a>                    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-698"><a href="#MeshManager.repair_mesh-698"><span class="linenos">698</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Fixed face normal winding consistency&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-699"><a href="#MeshManager.repair_mesh-699"><span class="linenos">699</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-700"><a href="#MeshManager.repair_mesh-700"><span class="linenos">700</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-701"><a href="#MeshManager.repair_mesh-701"><span class="linenos">701</span></a>                            <span class="s2">&quot;Attempted to fix normals but still inconsistent&quot;</span>
</span><span id="MeshManager.repair_mesh-702"><a href="#MeshManager.repair_mesh-702"><span class="linenos">702</span></a>                        <span class="p">)</span>
</span><span id="MeshManager.repair_mesh-703"><a href="#MeshManager.repair_mesh-703"><span class="linenos">703</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-704"><a href="#MeshManager.repair_mesh-704"><span class="linenos">704</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fix normals: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-705"><a href="#MeshManager.repair_mesh-705"><span class="linenos">705</span></a>
</span><span id="MeshManager.repair_mesh-706"><a href="#MeshManager.repair_mesh-706"><span class="linenos">706</span></a>        <span class="c1"># Attempt to fill holes</span>
</span><span id="MeshManager.repair_mesh-707"><a href="#MeshManager.repair_mesh-707"><span class="linenos">707</span></a>        <span class="k">if</span> <span class="n">fix_holes</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-708"><a href="#MeshManager.repair_mesh-708"><span class="linenos">708</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-709"><a href="#MeshManager.repair_mesh-709"><span class="linenos">709</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-710"><a href="#MeshManager.repair_mesh-710"><span class="linenos">710</span></a>                    <span class="n">initial_watertight</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span>
</span><span id="MeshManager.repair_mesh-711"><a href="#MeshManager.repair_mesh-711"><span class="linenos">711</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">fill_holes</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh-712"><a href="#MeshManager.repair_mesh-712"><span class="linenos">712</span></a>                    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">initial_watertight</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-713"><a href="#MeshManager.repair_mesh-713"><span class="linenos">713</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-714"><a href="#MeshManager.repair_mesh-714"><span class="linenos">714</span></a>                            <span class="s2">&quot;Successfully filled holes - mesh is now watertight&quot;</span>
</span><span id="MeshManager.repair_mesh-715"><a href="#MeshManager.repair_mesh-715"><span class="linenos">715</span></a>                        <span class="p">)</span>
</span><span id="MeshManager.repair_mesh-716"><a href="#MeshManager.repair_mesh-716"><span class="linenos">716</span></a>                    <span class="k">elif</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-717"><a href="#MeshManager.repair_mesh-717"><span class="linenos">717</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Mesh was already watertight&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-718"><a href="#MeshManager.repair_mesh-718"><span class="linenos">718</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-719"><a href="#MeshManager.repair_mesh-719"><span class="linenos">719</span></a>                        <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-720"><a href="#MeshManager.repair_mesh-720"><span class="linenos">720</span></a>                            <span class="s2">&quot;Attempted to fill holes but mesh still not watertight&quot;</span>
</span><span id="MeshManager.repair_mesh-721"><a href="#MeshManager.repair_mesh-721"><span class="linenos">721</span></a>                        <span class="p">)</span>
</span><span id="MeshManager.repair_mesh-722"><a href="#MeshManager.repair_mesh-722"><span class="linenos">722</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-723"><a href="#MeshManager.repair_mesh-723"><span class="linenos">723</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fill holes: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-724"><a href="#MeshManager.repair_mesh-724"><span class="linenos">724</span></a>
</span><span id="MeshManager.repair_mesh-725"><a href="#MeshManager.repair_mesh-725"><span class="linenos">725</span></a>        <span class="c1"># Keep only the largest component if requested</span>
</span><span id="MeshManager.repair_mesh-726"><a href="#MeshManager.repair_mesh-726"><span class="linenos">726</span></a>        <span class="k">if</span> <span class="n">keep_largest_component</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-727"><a href="#MeshManager.repair_mesh-727"><span class="linenos">727</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-728"><a href="#MeshManager.repair_mesh-728"><span class="linenos">728</span></a>                <span class="n">components</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-729"><a href="#MeshManager.repair_mesh-729"><span class="linenos">729</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-730"><a href="#MeshManager.repair_mesh-730"><span class="linenos">730</span></a>                    <span class="c1"># Keep the largest component by volume or face count</span>
</span><span id="MeshManager.repair_mesh-731"><a href="#MeshManager.repair_mesh-731"><span class="linenos">731</span></a>                    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MeshManager.repair_mesh-732"><a href="#MeshManager.repair_mesh-732"><span class="linenos">732</span></a>                        <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-733"><a href="#MeshManager.repair_mesh-733"><span class="linenos">733</span></a>                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">components</span>
</span><span id="MeshManager.repair_mesh-734"><a href="#MeshManager.repair_mesh-734"><span class="linenos">734</span></a>                    <span class="p">]</span>
</span><span id="MeshManager.repair_mesh-735"><a href="#MeshManager.repair_mesh-735"><span class="linenos">735</span></a>                    <span class="n">largest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">volumes</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-736"><a href="#MeshManager.repair_mesh-736"><span class="linenos">736</span></a>                    <span class="n">mesh</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">largest_idx</span><span class="p">]</span>
</span><span id="MeshManager.repair_mesh-737"><a href="#MeshManager.repair_mesh-737"><span class="linenos">737</span></a>                    <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-738"><a href="#MeshManager.repair_mesh-738"><span class="linenos">738</span></a>                        <span class="sa">f</span><span class="s2">&quot;Kept largest of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> components (volume: </span><span class="si">{</span><span class="n">volumes</span><span class="p">[</span><span class="n">largest_idx</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="MeshManager.repair_mesh-739"><a href="#MeshManager.repair_mesh-739"><span class="linenos">739</span></a>                    <span class="p">)</span>
</span><span id="MeshManager.repair_mesh-740"><a href="#MeshManager.repair_mesh-740"><span class="linenos">740</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-741"><a href="#MeshManager.repair_mesh-741"><span class="linenos">741</span></a>                <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to isolate largest component: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-742"><a href="#MeshManager.repair_mesh-742"><span class="linenos">742</span></a>
</span><span id="MeshManager.repair_mesh-743"><a href="#MeshManager.repair_mesh-743"><span class="linenos">743</span></a>        <span class="c1"># Final processing to ensure consistency</span>
</span><span id="MeshManager.repair_mesh-744"><a href="#MeshManager.repair_mesh-744"><span class="linenos">744</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-745"><a href="#MeshManager.repair_mesh-745"><span class="linenos">745</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-746"><a href="#MeshManager.repair_mesh-746"><span class="linenos">746</span></a>            <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Applied final mesh processing and validation&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-747"><a href="#MeshManager.repair_mesh-747"><span class="linenos">747</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-748"><a href="#MeshManager.repair_mesh-748"><span class="linenos">748</span></a>            <span class="n">repair_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final processing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-749"><a href="#MeshManager.repair_mesh-749"><span class="linenos">749</span></a>
</span><span id="MeshManager.repair_mesh-750"><a href="#MeshManager.repair_mesh-750"><span class="linenos">750</span></a>        <span class="c1"># Store repair log as mesh metadata</span>
</span><span id="MeshManager.repair_mesh-751"><a href="#MeshManager.repair_mesh-751"><span class="linenos">751</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
</span><span id="MeshManager.repair_mesh-752"><a href="#MeshManager.repair_mesh-752"><span class="linenos">752</span></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MeshManager.repair_mesh-753"><a href="#MeshManager.repair_mesh-753"><span class="linenos">753</span></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;repair_log&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">repair_log</span>
</span><span id="MeshManager.repair_mesh-754"><a href="#MeshManager.repair_mesh-754"><span class="linenos">754</span></a>
</span><span id="MeshManager.repair_mesh-755"><a href="#MeshManager.repair_mesh-755"><span class="linenos">755</span></a>        <span class="c1"># Log repair summary</span>
</span><span id="MeshManager.repair_mesh-756"><a href="#MeshManager.repair_mesh-756"><span class="linenos">756</span></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-757"><a href="#MeshManager.repair_mesh-757"><span class="linenos">757</span></a>            <span class="k">if</span> <span class="n">repair_log</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-758"><a href="#MeshManager.repair_mesh-758"><span class="linenos">758</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Mesh Repair Summary:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-759"><a href="#MeshManager.repair_mesh-759"><span class="linenos">759</span></a>                <span class="k">for</span> <span class="n">log_entry</span> <span class="ow">in</span> <span class="n">repair_log</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-760"><a href="#MeshManager.repair_mesh-760"><span class="linenos">760</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">log_entry</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-761"><a href="#MeshManager.repair_mesh-761"><span class="linenos">761</span></a>
</span><span id="MeshManager.repair_mesh-762"><a href="#MeshManager.repair_mesh-762"><span class="linenos">762</span></a>                <span class="c1"># Final mesh status</span>
</span><span id="MeshManager.repair_mesh-763"><a href="#MeshManager.repair_mesh-763"><span class="linenos">763</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Final Mesh Status:&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-764"><a href="#MeshManager.repair_mesh-764"><span class="linenos">764</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh-765"><a href="#MeshManager.repair_mesh-765"><span class="linenos">765</span></a>                    <span class="s2">&quot;   Volume: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-766"><a href="#MeshManager.repair_mesh-766"><span class="linenos">766</span></a>                    <span class="n">mesh</span><span class="o">.</span><span class="n">volume</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh-767"><a href="#MeshManager.repair_mesh-767"><span class="linenos">767</span></a>                <span class="p">)</span>
</span><span id="MeshManager.repair_mesh-768"><a href="#MeshManager.repair_mesh-768"><span class="linenos">768</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Watertight: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-769"><a href="#MeshManager.repair_mesh-769"><span class="linenos">769</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Winding consistent: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-770"><a href="#MeshManager.repair_mesh-770"><span class="linenos">770</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Faces: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
</span><span id="MeshManager.repair_mesh-771"><a href="#MeshManager.repair_mesh-771"><span class="linenos">771</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   Vertices: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">))</span>
</span><span id="MeshManager.repair_mesh-772"><a href="#MeshManager.repair_mesh-772"><span class="linenos">772</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh-773"><a href="#MeshManager.repair_mesh-773"><span class="linenos">773</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No repairs needed - mesh is in good condition&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh-774"><a href="#MeshManager.repair_mesh-774"><span class="linenos">774</span></a>
</span><span id="MeshManager.repair_mesh-775"><a href="#MeshManager.repair_mesh-775"><span class="linenos">775</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
</span><span id="MeshManager.repair_mesh-776"><a href="#MeshManager.repair_mesh-776"><span class="linenos">776</span></a>        <span class="k">return</span> <span class="n">mesh</span>
</span></pre></div>


            <div class="docstring"><p>Attempt to repair common mesh issues to improve watertightness and quality.</p>

<p>Args:
    mesh_data: Either a Trimesh object or (vertices, faces) tuple
    fix_holes: Whether to attempt filling holes
    remove_duplicates: Whether to remove duplicate faces and vertices
    fix_normals: Whether to fix face normal consistency
    remove_degenerate: Whether to remove degenerate faces
    fix_negative_volume: Whether to invert faces if mesh has negative volume
    keep_largest_component: Whether to keep only the largest connected component
    verbose: Whether to print repair summary</p>

<p>Returns:
    Repaired mesh (new copy, original is not modified)</p>
</div>


                            </div>
                            <div id="MeshManager.repair_mesh_pymeshfix" class="classattr">
                                        <input id="MeshManager.repair_mesh_pymeshfix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">repair_mesh_pymeshfix</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">join_components</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">remove_small_components</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">keep_largest_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">min_component_faces</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">safe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">120.0</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="MeshManager.repair_mesh_pymeshfix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.repair_mesh_pymeshfix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.repair_mesh_pymeshfix-778"><a href="#MeshManager.repair_mesh_pymeshfix-778"><span class="linenos">778</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repair_mesh_pymeshfix</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-779"><a href="#MeshManager.repair_mesh_pymeshfix-779"><span class="linenos">779</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-780"><a href="#MeshManager.repair_mesh_pymeshfix-780"><span class="linenos">780</span></a>        <span class="n">join_components</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-781"><a href="#MeshManager.repair_mesh_pymeshfix-781"><span class="linenos">781</span></a>        <span class="n">remove_small_components</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-782"><a href="#MeshManager.repair_mesh_pymeshfix-782"><span class="linenos">782</span></a>        <span class="n">keep_largest_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-783"><a href="#MeshManager.repair_mesh_pymeshfix-783"><span class="linenos">783</span></a>        <span class="n">min_component_faces</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-784"><a href="#MeshManager.repair_mesh_pymeshfix-784"><span class="linenos">784</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-785"><a href="#MeshManager.repair_mesh_pymeshfix-785"><span class="linenos">785</span></a>        <span class="n">safe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-786"><a href="#MeshManager.repair_mesh_pymeshfix-786"><span class="linenos">786</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">120.0</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-787"><a href="#MeshManager.repair_mesh_pymeshfix-787"><span class="linenos">787</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-788"><a href="#MeshManager.repair_mesh_pymeshfix-788"><span class="linenos">788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Repair current mesh using PyMeshFix.</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-789"><a href="#MeshManager.repair_mesh_pymeshfix-789"><span class="linenos">789</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-790"><a href="#MeshManager.repair_mesh_pymeshfix-790"><span class="linenos">790</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-791"><a href="#MeshManager.repair_mesh_pymeshfix-791"><span class="linenos">791</span></a><span class="sd">            join_components: Merge nearby components during repair.</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-792"><a href="#MeshManager.repair_mesh_pymeshfix-792"><span class="linenos">792</span></a><span class="sd">            remove_small_components: Remove very small components (PyMeshFix behavior).</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-793"><a href="#MeshManager.repair_mesh_pymeshfix-793"><span class="linenos">793</span></a><span class="sd">            keep_largest_component: After repair, keep only the largest connected component.</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-794"><a href="#MeshManager.repair_mesh_pymeshfix-794"><span class="linenos">794</span></a><span class="sd">            min_component_faces: Minimum faces to consider a component when filtering.</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-795"><a href="#MeshManager.repair_mesh_pymeshfix-795"><span class="linenos">795</span></a><span class="sd">            verbose: Whether to print concise summary (unused here but kept for API symmetry).</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-796"><a href="#MeshManager.repair_mesh_pymeshfix-796"><span class="linenos">796</span></a><span class="sd">            safe: Run PyMeshFix in a separate process to avoid hard interpreter exits.</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-797"><a href="#MeshManager.repair_mesh_pymeshfix-797"><span class="linenos">797</span></a><span class="sd">            timeout: Seconds to wait for PyMeshFix before aborting.</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-798"><a href="#MeshManager.repair_mesh_pymeshfix-798"><span class="linenos">798</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-799"><a href="#MeshManager.repair_mesh_pymeshfix-799"><span class="linenos">799</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-800"><a href="#MeshManager.repair_mesh_pymeshfix-800"><span class="linenos">800</span></a><span class="sd">            Repaired mesh (also assigned to `self.mesh`).</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-801"><a href="#MeshManager.repair_mesh_pymeshfix-801"><span class="linenos">801</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-802"><a href="#MeshManager.repair_mesh_pymeshfix-802"><span class="linenos">802</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-803"><a href="#MeshManager.repair_mesh_pymeshfix-803"><span class="linenos">803</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-804"><a href="#MeshManager.repair_mesh_pymeshfix-804"><span class="linenos">804</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-805"><a href="#MeshManager.repair_mesh_pymeshfix-805"><span class="linenos">805</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-806"><a href="#MeshManager.repair_mesh_pymeshfix-806"><span class="linenos">806</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">pymeshfix</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeshFix</span>  <span class="c1"># type: ignore</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-807"><a href="#MeshManager.repair_mesh_pymeshfix-807"><span class="linenos">807</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-808"><a href="#MeshManager.repair_mesh_pymeshfix-808"><span class="linenos">808</span></a>            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-809"><a href="#MeshManager.repair_mesh_pymeshfix-809"><span class="linenos">809</span></a>                <span class="s2">&quot;pymeshfix is required for repair_mesh_pymeshfix; install with `uv pip install pymeshfix`.&quot;</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-810"><a href="#MeshManager.repair_mesh_pymeshfix-810"><span class="linenos">810</span></a>            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-811"><a href="#MeshManager.repair_mesh_pymeshfix-811"><span class="linenos">811</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-812"><a href="#MeshManager.repair_mesh_pymeshfix-812"><span class="linenos">812</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-813"><a href="#MeshManager.repair_mesh_pymeshfix-813"><span class="linenos">813</span></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-814"><a href="#MeshManager.repair_mesh_pymeshfix-814"><span class="linenos">814</span></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">faces</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-815"><a href="#MeshManager.repair_mesh_pymeshfix-815"><span class="linenos">815</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-816"><a href="#MeshManager.repair_mesh_pymeshfix-816"><span class="linenos">816</span></a>        <span class="c1"># Run PyMeshFix either inline (unsafe) or in a separate process (safe)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-817"><a href="#MeshManager.repair_mesh_pymeshfix-817"><span class="linenos">817</span></a>        <span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-818"><a href="#MeshManager.repair_mesh_pymeshfix-818"><span class="linenos">818</span></a>            <span class="n">ctx</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">get_context</span><span class="p">(</span><span class="s2">&quot;spawn&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-819"><a href="#MeshManager.repair_mesh_pymeshfix-819"><span class="linenos">819</span></a>            <span class="n">queue</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">queues</span><span class="o">.</span><span class="n">Queue</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-820"><a href="#MeshManager.repair_mesh_pymeshfix-820"><span class="linenos">820</span></a>            <span class="n">proc</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-821"><a href="#MeshManager.repair_mesh_pymeshfix-821"><span class="linenos">821</span></a>                <span class="n">target</span><span class="o">=</span><span class="n">_pymeshfix_worker</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-822"><a href="#MeshManager.repair_mesh_pymeshfix-822"><span class="linenos">822</span></a>                <span class="n">args</span><span class="o">=</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-823"><a href="#MeshManager.repair_mesh_pymeshfix-823"><span class="linenos">823</span></a>                    <span class="n">queue</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-824"><a href="#MeshManager.repair_mesh_pymeshfix-824"><span class="linenos">824</span></a>                    <span class="n">v</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-825"><a href="#MeshManager.repair_mesh_pymeshfix-825"><span class="linenos">825</span></a>                    <span class="n">f</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-826"><a href="#MeshManager.repair_mesh_pymeshfix-826"><span class="linenos">826</span></a>                    <span class="nb">bool</span><span class="p">(</span><span class="n">join_components</span><span class="p">),</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-827"><a href="#MeshManager.repair_mesh_pymeshfix-827"><span class="linenos">827</span></a>                    <span class="nb">bool</span><span class="p">(</span><span class="n">remove_small_components</span><span class="p">),</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-828"><a href="#MeshManager.repair_mesh_pymeshfix-828"><span class="linenos">828</span></a>                    <span class="nb">bool</span><span class="p">(</span><span class="n">verbose</span><span class="p">),</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-829"><a href="#MeshManager.repair_mesh_pymeshfix-829"><span class="linenos">829</span></a>                <span class="p">),</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-830"><a href="#MeshManager.repair_mesh_pymeshfix-830"><span class="linenos">830</span></a>            <span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-831"><a href="#MeshManager.repair_mesh_pymeshfix-831"><span class="linenos">831</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-832"><a href="#MeshManager.repair_mesh_pymeshfix-832"><span class="linenos">832</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-833"><a href="#MeshManager.repair_mesh_pymeshfix-833"><span class="linenos">833</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-834"><a href="#MeshManager.repair_mesh_pymeshfix-834"><span class="linenos">834</span></a>            <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-835"><a href="#MeshManager.repair_mesh_pymeshfix-835"><span class="linenos">835</span></a>                <span class="c1"># Timed out</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-836"><a href="#MeshManager.repair_mesh_pymeshfix-836"><span class="linenos">836</span></a>                <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-837"><a href="#MeshManager.repair_mesh_pymeshfix-837"><span class="linenos">837</span></a>                <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-838"><a href="#MeshManager.repair_mesh_pymeshfix-838"><span class="linenos">838</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyMeshFix timed out after </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-839"><a href="#MeshManager.repair_mesh_pymeshfix-839"><span class="linenos">839</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-840"><a href="#MeshManager.repair_mesh_pymeshfix-840"><span class="linenos">840</span></a>            <span class="c1"># Retrieve results from queue</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-841"><a href="#MeshManager.repair_mesh_pymeshfix-841"><span class="linenos">841</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-842"><a href="#MeshManager.repair_mesh_pymeshfix-842"><span class="linenos">842</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-843"><a href="#MeshManager.repair_mesh_pymeshfix-843"><span class="linenos">843</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-844"><a href="#MeshManager.repair_mesh_pymeshfix-844"><span class="linenos">844</span></a>                <span class="c1"># Likely a hard crash in the child</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-845"><a href="#MeshManager.repair_mesh_pymeshfix-845"><span class="linenos">845</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-846"><a href="#MeshManager.repair_mesh_pymeshfix-846"><span class="linenos">846</span></a>                    <span class="sa">f</span><span class="s2">&quot;PyMeshFix crashed (exit code </span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">exitcode</span><span class="si">}</span><span class="s2">) with no result&quot;</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-847"><a href="#MeshManager.repair_mesh_pymeshfix-847"><span class="linenos">847</span></a>                <span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-848"><a href="#MeshManager.repair_mesh_pymeshfix-848"><span class="linenos">848</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-849"><a href="#MeshManager.repair_mesh_pymeshfix-849"><span class="linenos">849</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span> <span class="ow">or</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;ok&quot;</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-850"><a href="#MeshManager.repair_mesh_pymeshfix-850"><span class="linenos">850</span></a>                <span class="c1"># msg could be (&quot;err&quot;, error_str, traceback)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-851"><a href="#MeshManager.repair_mesh_pymeshfix-851"><span class="linenos">851</span></a>                <span class="n">detail</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-852"><a href="#MeshManager.repair_mesh_pymeshfix-852"><span class="linenos">852</span></a>                    <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-853"><a href="#MeshManager.repair_mesh_pymeshfix-853"><span class="linenos">853</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-854"><a href="#MeshManager.repair_mesh_pymeshfix-854"><span class="linenos">854</span></a>                    <span class="k">else</span> <span class="s2">&quot;unknown error&quot;</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-855"><a href="#MeshManager.repair_mesh_pymeshfix-855"><span class="linenos">855</span></a>                <span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-856"><a href="#MeshManager.repair_mesh_pymeshfix-856"><span class="linenos">856</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PyMeshFix failed: </span><span class="si">{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-857"><a href="#MeshManager.repair_mesh_pymeshfix-857"><span class="linenos">857</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-858"><a href="#MeshManager.repair_mesh_pymeshfix-858"><span class="linenos">858</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">msg</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-859"><a href="#MeshManager.repair_mesh_pymeshfix-859"><span class="linenos">859</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-860"><a href="#MeshManager.repair_mesh_pymeshfix-860"><span class="linenos">860</span></a>            <span class="n">mf</span> <span class="o">=</span> <span class="n">MeshFix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-861"><a href="#MeshManager.repair_mesh_pymeshfix-861"><span class="linenos">861</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-862"><a href="#MeshManager.repair_mesh_pymeshfix-862"><span class="linenos">862</span></a>                <span class="n">mf</span><span class="o">.</span><span class="n">repair</span><span class="p">(</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-863"><a href="#MeshManager.repair_mesh_pymeshfix-863"><span class="linenos">863</span></a>                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-864"><a href="#MeshManager.repair_mesh_pymeshfix-864"><span class="linenos">864</span></a>                    <span class="n">joincomp</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">join_components</span><span class="p">),</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-865"><a href="#MeshManager.repair_mesh_pymeshfix-865"><span class="linenos">865</span></a>                    <span class="n">remove_small_components</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">remove_small_components</span><span class="p">),</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-866"><a href="#MeshManager.repair_mesh_pymeshfix-866"><span class="linenos">866</span></a>                <span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-867"><a href="#MeshManager.repair_mesh_pymeshfix-867"><span class="linenos">867</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-868"><a href="#MeshManager.repair_mesh_pymeshfix-868"><span class="linenos">868</span></a>                <span class="c1"># Older signature without keywords</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-869"><a href="#MeshManager.repair_mesh_pymeshfix-869"><span class="linenos">869</span></a>                <span class="n">mf</span><span class="o">.</span><span class="n">repair</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-870"><a href="#MeshManager.repair_mesh_pymeshfix-870"><span class="linenos">870</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-871"><a href="#MeshManager.repair_mesh_pymeshfix-871"><span class="linenos">871</span></a>            <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-872"><a href="#MeshManager.repair_mesh_pymeshfix-872"><span class="linenos">872</span></a>            <span class="n">f2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-873"><a href="#MeshManager.repair_mesh_pymeshfix-873"><span class="linenos">873</span></a>            <span class="k">if</span> <span class="n">v2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">f2</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-874"><a href="#MeshManager.repair_mesh_pymeshfix-874"><span class="linenos">874</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PyMeshFix returned an empty mesh&quot;</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-875"><a href="#MeshManager.repair_mesh_pymeshfix-875"><span class="linenos">875</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-876"><a href="#MeshManager.repair_mesh_pymeshfix-876"><span class="linenos">876</span></a>        <span class="n">repaired</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">(</span><span class="n">vertices</span><span class="o">=</span><span class="n">v2</span><span class="p">,</span> <span class="n">faces</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-877"><a href="#MeshManager.repair_mesh_pymeshfix-877"><span class="linenos">877</span></a>        <span class="c1"># Post-process: fix normals, validate</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-878"><a href="#MeshManager.repair_mesh_pymeshfix-878"><span class="linenos">878</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-879"><a href="#MeshManager.repair_mesh_pymeshfix-879"><span class="linenos">879</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">repaired</span><span class="o">.</span><span class="n">is_winding_consistent</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-880"><a href="#MeshManager.repair_mesh_pymeshfix-880"><span class="linenos">880</span></a>                <span class="n">repaired</span><span class="o">.</span><span class="n">fix_normals</span><span class="p">()</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-881"><a href="#MeshManager.repair_mesh_pymeshfix-881"><span class="linenos">881</span></a>            <span class="n">repaired</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-882"><a href="#MeshManager.repair_mesh_pymeshfix-882"><span class="linenos">882</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-883"><a href="#MeshManager.repair_mesh_pymeshfix-883"><span class="linenos">883</span></a>            <span class="k">pass</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-884"><a href="#MeshManager.repair_mesh_pymeshfix-884"><span class="linenos">884</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-885"><a href="#MeshManager.repair_mesh_pymeshfix-885"><span class="linenos">885</span></a>        <span class="c1"># Optionally keep largest component</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-886"><a href="#MeshManager.repair_mesh_pymeshfix-886"><span class="linenos">886</span></a>        <span class="k">if</span> <span class="n">keep_largest_component</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-887"><a href="#MeshManager.repair_mesh_pymeshfix-887"><span class="linenos">887</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-888"><a href="#MeshManager.repair_mesh_pymeshfix-888"><span class="linenos">888</span></a>                <span class="n">comps</span> <span class="o">=</span> <span class="n">repaired</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-889"><a href="#MeshManager.repair_mesh_pymeshfix-889"><span class="linenos">889</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-890"><a href="#MeshManager.repair_mesh_pymeshfix-890"><span class="linenos">890</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-891"><a href="#MeshManager.repair_mesh_pymeshfix-891"><span class="linenos">891</span></a>                    <span class="k">def</span><span class="w"> </span><span class="nf">comp_key</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-892"><a href="#MeshManager.repair_mesh_pymeshfix-892"><span class="linenos">892</span></a>                        <span class="n">vol</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-893"><a href="#MeshManager.repair_mesh_pymeshfix-893"><span class="linenos">893</span></a>                        <span class="k">return</span> <span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">faces</span><span class="p">))</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-894"><a href="#MeshManager.repair_mesh_pymeshfix-894"><span class="linenos">894</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-895"><a href="#MeshManager.repair_mesh_pymeshfix-895"><span class="linenos">895</span></a>                    <span class="n">comps_filtered</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-896"><a href="#MeshManager.repair_mesh_pymeshfix-896"><span class="linenos">896</span></a>                        <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comps</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_component_faces</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-897"><a href="#MeshManager.repair_mesh_pymeshfix-897"><span class="linenos">897</span></a>                    <span class="p">]</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-898"><a href="#MeshManager.repair_mesh_pymeshfix-898"><span class="linenos">898</span></a>                    <span class="n">use</span> <span class="o">=</span> <span class="n">comps_filtered</span> <span class="k">if</span> <span class="n">comps_filtered</span> <span class="k">else</span> <span class="n">comps</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-899"><a href="#MeshManager.repair_mesh_pymeshfix-899"><span class="linenos">899</span></a>                    <span class="n">repaired</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">use</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">comp_key</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-900"><a href="#MeshManager.repair_mesh_pymeshfix-900"><span class="linenos">900</span></a>                    <span class="n">repaired</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-901"><a href="#MeshManager.repair_mesh_pymeshfix-901"><span class="linenos">901</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-902"><a href="#MeshManager.repair_mesh_pymeshfix-902"><span class="linenos">902</span></a>                <span class="k">pass</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-903"><a href="#MeshManager.repair_mesh_pymeshfix-903"><span class="linenos">903</span></a>
</span><span id="MeshManager.repair_mesh_pymeshfix-904"><a href="#MeshManager.repair_mesh_pymeshfix-904"><span class="linenos">904</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">repaired</span>
</span><span id="MeshManager.repair_mesh_pymeshfix-905"><a href="#MeshManager.repair_mesh_pymeshfix-905"><span class="linenos">905</span></a>        <span class="k">return</span> <span class="n">repaired</span>
</span></pre></div>


            <div class="docstring"><p>Repair current mesh using PyMeshFix.</p>

<p>Args:
    join_components: Merge nearby components during repair.
    remove_small_components: Remove very small components (PyMeshFix behavior).
    keep_largest_component: After repair, keep only the largest connected component.
    min_component_faces: Minimum faces to consider a component when filtering.
    verbose: Whether to print concise summary (unused here but kept for API symmetry).
    safe: Run PyMeshFix in a separate process to avoid hard interpreter exits.
    timeout: Seconds to wait for PyMeshFix before aborting.</p>

<p>Returns:
    Repaired mesh (also assigned to <code>self.mesh</code>).</p>
</div>


                            </div>
                            <div id="MeshManager.visualize_mesh_3d" class="classattr">
                                        <input id="MeshManager.visualize_mesh_3d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize_mesh_3d</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;3D Mesh Visualization&#39;</span>,</span><span class="param">	<span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>,</span><span class="param">	<span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>,</span><span class="param">	<span class="n">show_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MeshManager.visualize_mesh_3d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.visualize_mesh_3d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.visualize_mesh_3d-907"><a href="#MeshManager.visualize_mesh_3d-907"><span class="linenos">907</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_mesh_3d</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_3d-908"><a href="#MeshManager.visualize_mesh_3d-908"><span class="linenos">908</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-909"><a href="#MeshManager.visualize_mesh_3d-909"><span class="linenos">909</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3D Mesh Visualization&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-910"><a href="#MeshManager.visualize_mesh_3d-910"><span class="linenos">910</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-911"><a href="#MeshManager.visualize_mesh_3d-911"><span class="linenos">911</span></a>        <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-912"><a href="#MeshManager.visualize_mesh_3d-912"><span class="linenos">912</span></a>        <span class="n">show_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-913"><a href="#MeshManager.visualize_mesh_3d-913"><span class="linenos">913</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-914"><a href="#MeshManager.visualize_mesh_3d-914"><span class="linenos">914</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-915"><a href="#MeshManager.visualize_mesh_3d-915"><span class="linenos">915</span></a>        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_3d-916"><a href="#MeshManager.visualize_mesh_3d-916"><span class="linenos">916</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
</span><span id="MeshManager.visualize_mesh_3d-917"><a href="#MeshManager.visualize_mesh_3d-917"><span class="linenos">917</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.visualize_mesh_3d-918"><a href="#MeshManager.visualize_mesh_3d-918"><span class="linenos">918</span></a><span class="sd">        Create a 3D visualization of a mesh.</span>
</span><span id="MeshManager.visualize_mesh_3d-919"><a href="#MeshManager.visualize_mesh_3d-919"><span class="linenos">919</span></a>
</span><span id="MeshManager.visualize_mesh_3d-920"><a href="#MeshManager.visualize_mesh_3d-920"><span class="linenos">920</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.visualize_mesh_3d-921"><a href="#MeshManager.visualize_mesh_3d-921"><span class="linenos">921</span></a><span class="sd">            title: Plot title</span>
</span><span id="MeshManager.visualize_mesh_3d-922"><a href="#MeshManager.visualize_mesh_3d-922"><span class="linenos">922</span></a><span class="sd">            color: Mesh color (named color or RGB tuple)</span>
</span><span id="MeshManager.visualize_mesh_3d-923"><a href="#MeshManager.visualize_mesh_3d-923"><span class="linenos">923</span></a><span class="sd">            backend: Visualization backend (&#39;plotly&#39; or &#39;matplotlib&#39;)</span>
</span><span id="MeshManager.visualize_mesh_3d-924"><a href="#MeshManager.visualize_mesh_3d-924"><span class="linenos">924</span></a><span class="sd">            show_axes: Whether to show coordinate axes</span>
</span><span id="MeshManager.visualize_mesh_3d-925"><a href="#MeshManager.visualize_mesh_3d-925"><span class="linenos">925</span></a><span class="sd">            show_wireframe: Whether to show wireframe overlay</span>
</span><span id="MeshManager.visualize_mesh_3d-926"><a href="#MeshManager.visualize_mesh_3d-926"><span class="linenos">926</span></a>
</span><span id="MeshManager.visualize_mesh_3d-927"><a href="#MeshManager.visualize_mesh_3d-927"><span class="linenos">927</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.visualize_mesh_3d-928"><a href="#MeshManager.visualize_mesh_3d-928"><span class="linenos">928</span></a><span class="sd">            Figure object (backend-dependent) or None if visualization fails</span>
</span><span id="MeshManager.visualize_mesh_3d-929"><a href="#MeshManager.visualize_mesh_3d-929"><span class="linenos">929</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.visualize_mesh_3d-930"><a href="#MeshManager.visualize_mesh_3d-930"><span class="linenos">930</span></a>        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-931"><a href="#MeshManager.visualize_mesh_3d-931"><span class="linenos">931</span></a>            <span class="c1"># Try plotly first, then fallback to others</span>
</span><span id="MeshManager.visualize_mesh_3d-932"><a href="#MeshManager.visualize_mesh_3d-932"><span class="linenos">932</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-933"><a href="#MeshManager.visualize_mesh_3d-933"><span class="linenos">933</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager.visualize_mesh_3d-934"><a href="#MeshManager.visualize_mesh_3d-934"><span class="linenos">934</span></a>
</span><span id="MeshManager.visualize_mesh_3d-935"><a href="#MeshManager.visualize_mesh_3d-935"><span class="linenos">935</span></a>                <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;plotly&quot;</span>
</span><span id="MeshManager.visualize_mesh_3d-936"><a href="#MeshManager.visualize_mesh_3d-936"><span class="linenos">936</span></a>            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-937"><a href="#MeshManager.visualize_mesh_3d-937"><span class="linenos">937</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-938"><a href="#MeshManager.visualize_mesh_3d-938"><span class="linenos">938</span></a>                    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="MeshManager.visualize_mesh_3d-939"><a href="#MeshManager.visualize_mesh_3d-939"><span class="linenos">939</span></a>
</span><span id="MeshManager.visualize_mesh_3d-940"><a href="#MeshManager.visualize_mesh_3d-940"><span class="linenos">940</span></a>                    <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;matplotlib&quot;</span>
</span><span id="MeshManager.visualize_mesh_3d-941"><a href="#MeshManager.visualize_mesh_3d-941"><span class="linenos">941</span></a>                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-942"><a href="#MeshManager.visualize_mesh_3d-942"><span class="linenos">942</span></a>                    <span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;plotly&quot;</span>
</span><span id="MeshManager.visualize_mesh_3d-943"><a href="#MeshManager.visualize_mesh_3d-943"><span class="linenos">943</span></a>
</span><span id="MeshManager.visualize_mesh_3d-944"><a href="#MeshManager.visualize_mesh_3d-944"><span class="linenos">944</span></a>        <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;plotly&quot;</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-945"><a href="#MeshManager.visualize_mesh_3d-945"><span class="linenos">945</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_mesh_plotly</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_3d-946"><a href="#MeshManager.visualize_mesh_3d-946"><span class="linenos">946</span></a>                <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_axes</span><span class="p">,</span> <span class="n">show_wireframe</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
</span><span id="MeshManager.visualize_mesh_3d-947"><a href="#MeshManager.visualize_mesh_3d-947"><span class="linenos">947</span></a>            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_3d-948"><a href="#MeshManager.visualize_mesh_3d-948"><span class="linenos">948</span></a>        <span class="k">elif</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">&quot;matplotlib&quot;</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-949"><a href="#MeshManager.visualize_mesh_3d-949"><span class="linenos">949</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_mesh_matplotlib</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_3d-950"><a href="#MeshManager.visualize_mesh_3d-950"><span class="linenos">950</span></a>                <span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">show_axes</span><span class="p">,</span> <span class="n">show_wireframe</span>
</span><span id="MeshManager.visualize_mesh_3d-951"><a href="#MeshManager.visualize_mesh_3d-951"><span class="linenos">951</span></a>            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_3d-952"><a href="#MeshManager.visualize_mesh_3d-952"><span class="linenos">952</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_3d-953"><a href="#MeshManager.visualize_mesh_3d-953"><span class="linenos">953</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown backend: </span><span class="si">{</span><span class="n">backend</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a 3D visualization of a mesh.</p>

<p>Args:
    title: Plot title
    color: Mesh color (named color or RGB tuple)
    backend: Visualization backend ('plotly' or 'matplotlib')
    show_axes: Whether to show coordinate axes
    show_wireframe: Whether to show wireframe overlay</p>

<p>Returns:
    Figure object (backend-dependent) or None if visualization fails</p>
</div>


                            </div>
                            <div id="MeshManager.visualize_mesh_slice_interactive" class="classattr">
                                        <input id="MeshManager.visualize_mesh_slice_interactive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize_mesh_slice_interactive</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Interactive Mesh Slice&#39;</span>,</span><span class="param">	<span class="n">z_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">num_slices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">slice_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>,</span><span class="param">	<span class="n">mesh_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>,</span><span class="param">	<span class="n">mesh_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MeshManager.visualize_mesh_slice_interactive-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.visualize_mesh_slice_interactive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.visualize_mesh_slice_interactive-1079"><a href="#MeshManager.visualize_mesh_slice_interactive-1079"><span class="linenos">1079</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_mesh_slice_interactive</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1080"><a href="#MeshManager.visualize_mesh_slice_interactive-1080"><span class="linenos">1080</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1081"><a href="#MeshManager.visualize_mesh_slice_interactive-1081"><span class="linenos">1081</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Interactive Mesh Slice&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1082"><a href="#MeshManager.visualize_mesh_slice_interactive-1082"><span class="linenos">1082</span></a>        <span class="n">z_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1083"><a href="#MeshManager.visualize_mesh_slice_interactive-1083"><span class="linenos">1083</span></a>        <span class="n">num_slices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1084"><a href="#MeshManager.visualize_mesh_slice_interactive-1084"><span class="linenos">1084</span></a>        <span class="n">slice_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1085"><a href="#MeshManager.visualize_mesh_slice_interactive-1085"><span class="linenos">1085</span></a>        <span class="n">mesh_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1086"><a href="#MeshManager.visualize_mesh_slice_interactive-1086"><span class="linenos">1086</span></a>        <span class="n">mesh_opacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1087"><a href="#MeshManager.visualize_mesh_slice_interactive-1087"><span class="linenos">1087</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1088"><a href="#MeshManager.visualize_mesh_slice_interactive-1088"><span class="linenos">1088</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1089"><a href="#MeshManager.visualize_mesh_slice_interactive-1089"><span class="linenos">1089</span></a><span class="sd">        Create an interactive 3D visualization of a mesh with a controllable slice plane.</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1090"><a href="#MeshManager.visualize_mesh_slice_interactive-1090"><span class="linenos">1090</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1091"><a href="#MeshManager.visualize_mesh_slice_interactive-1091"><span class="linenos">1091</span></a><span class="sd">        This function displays a 3D mesh and calculates the intersection of the mesh</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1092"><a href="#MeshManager.visualize_mesh_slice_interactive-1092"><span class="linenos">1092</span></a><span class="sd">        with an xy-plane at a user-controlled z-value. The intersection is shown as a</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1093"><a href="#MeshManager.visualize_mesh_slice_interactive-1093"><span class="linenos">1093</span></a><span class="sd">        colored line on the mesh. A slider allows the user to interactively change the</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1094"><a href="#MeshManager.visualize_mesh_slice_interactive-1094"><span class="linenos">1094</span></a><span class="sd">        z-value of the intersection plane.</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1095"><a href="#MeshManager.visualize_mesh_slice_interactive-1095"><span class="linenos">1095</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1096"><a href="#MeshManager.visualize_mesh_slice_interactive-1096"><span class="linenos">1096</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1097"><a href="#MeshManager.visualize_mesh_slice_interactive-1097"><span class="linenos">1097</span></a><span class="sd">            title: Plot title</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1098"><a href="#MeshManager.visualize_mesh_slice_interactive-1098"><span class="linenos">1098</span></a><span class="sd">            z_range: Tuple of (min_z, max_z) for slice range. Auto-detected if None.</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1099"><a href="#MeshManager.visualize_mesh_slice_interactive-1099"><span class="linenos">1099</span></a><span class="sd">            num_slices: Number of positions for the slider</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1100"><a href="#MeshManager.visualize_mesh_slice_interactive-1100"><span class="linenos">1100</span></a><span class="sd">            slice_color: Color for the intersection line</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1101"><a href="#MeshManager.visualize_mesh_slice_interactive-1101"><span class="linenos">1101</span></a><span class="sd">            mesh_color: Color for the 3D mesh</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1102"><a href="#MeshManager.visualize_mesh_slice_interactive-1102"><span class="linenos">1102</span></a><span class="sd">            mesh_opacity: Opacity of the 3D mesh (0-1)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1103"><a href="#MeshManager.visualize_mesh_slice_interactive-1103"><span class="linenos">1103</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1104"><a href="#MeshManager.visualize_mesh_slice_interactive-1104"><span class="linenos">1104</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1105"><a href="#MeshManager.visualize_mesh_slice_interactive-1105"><span class="linenos">1105</span></a><span class="sd">            Plotly figure with interactive slider for controlling the z-value</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1106"><a href="#MeshManager.visualize_mesh_slice_interactive-1106"><span class="linenos">1106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1107"><a href="#MeshManager.visualize_mesh_slice_interactive-1107"><span class="linenos">1107</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1108"><a href="#MeshManager.visualize_mesh_slice_interactive-1108"><span class="linenos">1108</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1109"><a href="#MeshManager.visualize_mesh_slice_interactive-1109"><span class="linenos">1109</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1110"><a href="#MeshManager.visualize_mesh_slice_interactive-1110"><span class="linenos">1110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotly is required for interactive visualization&quot;</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1111"><a href="#MeshManager.visualize_mesh_slice_interactive-1111"><span class="linenos">1111</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1112"><a href="#MeshManager.visualize_mesh_slice_interactive-1112"><span class="linenos">1112</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1113"><a href="#MeshManager.visualize_mesh_slice_interactive-1113"><span class="linenos">1113</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1114"><a href="#MeshManager.visualize_mesh_slice_interactive-1114"><span class="linenos">1114</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1115"><a href="#MeshManager.visualize_mesh_slice_interactive-1115"><span class="linenos">1115</span></a>        <span class="c1"># Determine z-range if not provided</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1116"><a href="#MeshManager.visualize_mesh_slice_interactive-1116"><span class="linenos">1116</span></a>        <span class="k">if</span> <span class="n">z_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1117"><a href="#MeshManager.visualize_mesh_slice_interactive-1117"><span class="linenos">1117</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1118"><a href="#MeshManager.visualize_mesh_slice_interactive-1118"><span class="linenos">1118</span></a>            <span class="c1"># Add small padding</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1119"><a href="#MeshManager.visualize_mesh_slice_interactive-1119"><span class="linenos">1119</span></a>            <span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_max</span> <span class="o">-</span> <span class="n">z_min</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1120"><a href="#MeshManager.visualize_mesh_slice_interactive-1120"><span class="linenos">1120</span></a>            <span class="n">z_min</span> <span class="o">-=</span> <span class="n">padding</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1121"><a href="#MeshManager.visualize_mesh_slice_interactive-1121"><span class="linenos">1121</span></a>            <span class="n">z_max</span> <span class="o">+=</span> <span class="n">padding</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1122"><a href="#MeshManager.visualize_mesh_slice_interactive-1122"><span class="linenos">1122</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1123"><a href="#MeshManager.visualize_mesh_slice_interactive-1123"><span class="linenos">1123</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">z_range</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1124"><a href="#MeshManager.visualize_mesh_slice_interactive-1124"><span class="linenos">1124</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1125"><a href="#MeshManager.visualize_mesh_slice_interactive-1125"><span class="linenos">1125</span></a>        <span class="c1"># Create the base figure with the mesh</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1126"><a href="#MeshManager.visualize_mesh_slice_interactive-1126"><span class="linenos">1126</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1127"><a href="#MeshManager.visualize_mesh_slice_interactive-1127"><span class="linenos">1127</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1128"><a href="#MeshManager.visualize_mesh_slice_interactive-1128"><span class="linenos">1128</span></a>        <span class="c1"># Add the mesh to the figure</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1129"><a href="#MeshManager.visualize_mesh_slice_interactive-1129"><span class="linenos">1129</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1130"><a href="#MeshManager.visualize_mesh_slice_interactive-1130"><span class="linenos">1130</span></a>            <span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1131"><a href="#MeshManager.visualize_mesh_slice_interactive-1131"><span class="linenos">1131</span></a>                <span class="n">x</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1132"><a href="#MeshManager.visualize_mesh_slice_interactive-1132"><span class="linenos">1132</span></a>                <span class="n">y</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1133"><a href="#MeshManager.visualize_mesh_slice_interactive-1133"><span class="linenos">1133</span></a>                <span class="n">z</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1134"><a href="#MeshManager.visualize_mesh_slice_interactive-1134"><span class="linenos">1134</span></a>                <span class="n">i</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1135"><a href="#MeshManager.visualize_mesh_slice_interactive-1135"><span class="linenos">1135</span></a>                <span class="n">j</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1136"><a href="#MeshManager.visualize_mesh_slice_interactive-1136"><span class="linenos">1136</span></a>                <span class="n">k</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1137"><a href="#MeshManager.visualize_mesh_slice_interactive-1137"><span class="linenos">1137</span></a>                <span class="n">opacity</span><span class="o">=</span><span class="n">mesh_opacity</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1138"><a href="#MeshManager.visualize_mesh_slice_interactive-1138"><span class="linenos">1138</span></a>                <span class="n">color</span><span class="o">=</span><span class="n">mesh_color</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1139"><a href="#MeshManager.visualize_mesh_slice_interactive-1139"><span class="linenos">1139</span></a>                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Mesh&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1140"><a href="#MeshManager.visualize_mesh_slice_interactive-1140"><span class="linenos">1140</span></a>            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1141"><a href="#MeshManager.visualize_mesh_slice_interactive-1141"><span class="linenos">1141</span></a>        <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1142"><a href="#MeshManager.visualize_mesh_slice_interactive-1142"><span class="linenos">1142</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1143"><a href="#MeshManager.visualize_mesh_slice_interactive-1143"><span class="linenos">1143</span></a>        <span class="c1"># Function to create a slice at a given z-value</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1144"><a href="#MeshManager.visualize_mesh_slice_interactive-1144"><span class="linenos">1144</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_slice_trace</span><span class="p">(</span><span class="n">z_value</span><span class="p">):</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1145"><a href="#MeshManager.visualize_mesh_slice_interactive-1145"><span class="linenos">1145</span></a>            <span class="c1"># Calculate intersection with plane at z_value</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1146"><a href="#MeshManager.visualize_mesh_slice_interactive-1146"><span class="linenos">1146</span></a>            <span class="n">section</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">section</span><span class="p">(</span><span class="n">plane_origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z_value</span><span class="p">],</span> <span class="n">plane_normal</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1147"><a href="#MeshManager.visualize_mesh_slice_interactive-1147"><span class="linenos">1147</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1148"><a href="#MeshManager.visualize_mesh_slice_interactive-1148"><span class="linenos">1148</span></a>            <span class="c1"># If no intersection, return None</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1149"><a href="#MeshManager.visualize_mesh_slice_interactive-1149"><span class="linenos">1149</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1150"><a href="#MeshManager.visualize_mesh_slice_interactive-1150"><span class="linenos">1150</span></a>                <span class="n">section</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1151"><a href="#MeshManager.visualize_mesh_slice_interactive-1151"><span class="linenos">1151</span></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s2">&quot;entities&quot;</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1152"><a href="#MeshManager.visualize_mesh_slice_interactive-1152"><span class="linenos">1152</span></a>                <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1153"><a href="#MeshManager.visualize_mesh_slice_interactive-1153"><span class="linenos">1153</span></a>            <span class="p">):</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1154"><a href="#MeshManager.visualize_mesh_slice_interactive-1154"><span class="linenos">1154</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1155"><a href="#MeshManager.visualize_mesh_slice_interactive-1155"><span class="linenos">1155</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1156"><a href="#MeshManager.visualize_mesh_slice_interactive-1156"><span class="linenos">1156</span></a>            <span class="c1"># Process all entities in the section to get 3D coordinates</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1157"><a href="#MeshManager.visualize_mesh_slice_interactive-1157"><span class="linenos">1157</span></a>            <span class="n">all_points</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1158"><a href="#MeshManager.visualize_mesh_slice_interactive-1158"><span class="linenos">1158</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1159"><a href="#MeshManager.visualize_mesh_slice_interactive-1159"><span class="linenos">1159</span></a>            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">section</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1160"><a href="#MeshManager.visualize_mesh_slice_interactive-1160"><span class="linenos">1160</span></a>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1161"><a href="#MeshManager.visualize_mesh_slice_interactive-1161"><span class="linenos">1161</span></a>                    <span class="c1"># Get the actual 2D coordinates</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1162"><a href="#MeshManager.visualize_mesh_slice_interactive-1162"><span class="linenos">1162</span></a>                    <span class="n">points_2d</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1163"><a href="#MeshManager.visualize_mesh_slice_interactive-1163"><span class="linenos">1163</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1164"><a href="#MeshManager.visualize_mesh_slice_interactive-1164"><span class="linenos">1164</span></a>                    <span class="c1"># Convert to 3D by adding z_value</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1165"><a href="#MeshManager.visualize_mesh_slice_interactive-1165"><span class="linenos">1165</span></a>                    <span class="n">points_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1166"><a href="#MeshManager.visualize_mesh_slice_interactive-1166"><span class="linenos">1166</span></a>                        <span class="p">[</span><span class="n">points_2d</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points_2d</span><span class="p">),</span> <span class="n">z_value</span><span class="p">)]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1167"><a href="#MeshManager.visualize_mesh_slice_interactive-1167"><span class="linenos">1167</span></a>                    <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1168"><a href="#MeshManager.visualize_mesh_slice_interactive-1168"><span class="linenos">1168</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1169"><a href="#MeshManager.visualize_mesh_slice_interactive-1169"><span class="linenos">1169</span></a>                    <span class="c1"># Add closing point if needed (to complete the loop)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1170"><a href="#MeshManager.visualize_mesh_slice_interactive-1170"><span class="linenos">1170</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_2d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1171"><a href="#MeshManager.visualize_mesh_slice_interactive-1171"><span class="linenos">1171</span></a>                        <span class="n">points_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points_2d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1172"><a href="#MeshManager.visualize_mesh_slice_interactive-1172"><span class="linenos">1172</span></a>                    <span class="p">):</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1173"><a href="#MeshManager.visualize_mesh_slice_interactive-1173"><span class="linenos">1173</span></a>                        <span class="n">closing_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1174"><a href="#MeshManager.visualize_mesh_slice_interactive-1174"><span class="linenos">1174</span></a>                            <span class="p">[</span><span class="n">points_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">points_2d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">z_value</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1175"><a href="#MeshManager.visualize_mesh_slice_interactive-1175"><span class="linenos">1175</span></a>                        <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1176"><a href="#MeshManager.visualize_mesh_slice_interactive-1176"><span class="linenos">1176</span></a>                        <span class="n">points_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">points_3d</span><span class="p">,</span> <span class="n">closing_point</span><span class="p">])</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1177"><a href="#MeshManager.visualize_mesh_slice_interactive-1177"><span class="linenos">1177</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1178"><a href="#MeshManager.visualize_mesh_slice_interactive-1178"><span class="linenos">1178</span></a>                    <span class="c1"># Add to all points list</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1179"><a href="#MeshManager.visualize_mesh_slice_interactive-1179"><span class="linenos">1179</span></a>                    <span class="n">all_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">points_3d</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1180"><a href="#MeshManager.visualize_mesh_slice_interactive-1180"><span class="linenos">1180</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1181"><a href="#MeshManager.visualize_mesh_slice_interactive-1181"><span class="linenos">1181</span></a>                    <span class="c1"># Add None to create a break between separate entities</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1182"><a href="#MeshManager.visualize_mesh_slice_interactive-1182"><span class="linenos">1182</span></a>                    <span class="n">all_points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1183"><a href="#MeshManager.visualize_mesh_slice_interactive-1183"><span class="linenos">1183</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1184"><a href="#MeshManager.visualize_mesh_slice_interactive-1184"><span class="linenos">1184</span></a>            <span class="c1"># If we have points, create a scatter trace</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1185"><a href="#MeshManager.visualize_mesh_slice_interactive-1185"><span class="linenos">1185</span></a>            <span class="k">if</span> <span class="n">all_points</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1186"><a href="#MeshManager.visualize_mesh_slice_interactive-1186"><span class="linenos">1186</span></a>                <span class="n">x_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1187"><a href="#MeshManager.visualize_mesh_slice_interactive-1187"><span class="linenos">1187</span></a>                <span class="n">y_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1188"><a href="#MeshManager.visualize_mesh_slice_interactive-1188"><span class="linenos">1188</span></a>                <span class="n">z_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_points</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1189"><a href="#MeshManager.visualize_mesh_slice_interactive-1189"><span class="linenos">1189</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1190"><a href="#MeshManager.visualize_mesh_slice_interactive-1190"><span class="linenos">1190</span></a>                <span class="k">return</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1191"><a href="#MeshManager.visualize_mesh_slice_interactive-1191"><span class="linenos">1191</span></a>                    <span class="n">x</span><span class="o">=</span><span class="n">x_coords</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1192"><a href="#MeshManager.visualize_mesh_slice_interactive-1192"><span class="linenos">1192</span></a>                    <span class="n">y</span><span class="o">=</span><span class="n">y_coords</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1193"><a href="#MeshManager.visualize_mesh_slice_interactive-1193"><span class="linenos">1193</span></a>                    <span class="n">z</span><span class="o">=</span><span class="n">z_coords</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1194"><a href="#MeshManager.visualize_mesh_slice_interactive-1194"><span class="linenos">1194</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1195"><a href="#MeshManager.visualize_mesh_slice_interactive-1195"><span class="linenos">1195</span></a>                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">slice_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1196"><a href="#MeshManager.visualize_mesh_slice_interactive-1196"><span class="linenos">1196</span></a>                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Slice at z=</span><span class="si">{</span><span class="n">z_value</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1197"><a href="#MeshManager.visualize_mesh_slice_interactive-1197"><span class="linenos">1197</span></a>                <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1198"><a href="#MeshManager.visualize_mesh_slice_interactive-1198"><span class="linenos">1198</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1199"><a href="#MeshManager.visualize_mesh_slice_interactive-1199"><span class="linenos">1199</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1200"><a href="#MeshManager.visualize_mesh_slice_interactive-1200"><span class="linenos">1200</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1201"><a href="#MeshManager.visualize_mesh_slice_interactive-1201"><span class="linenos">1201</span></a>        <span class="c1"># Create initial slice</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1202"><a href="#MeshManager.visualize_mesh_slice_interactive-1202"><span class="linenos">1202</span></a>        <span class="n">initial_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_min</span> <span class="o">+</span> <span class="n">z_max</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1203"><a href="#MeshManager.visualize_mesh_slice_interactive-1203"><span class="linenos">1203</span></a>        <span class="n">initial_slice</span> <span class="o">=</span> <span class="n">create_slice_trace</span><span class="p">(</span><span class="n">initial_z</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1204"><a href="#MeshManager.visualize_mesh_slice_interactive-1204"><span class="linenos">1204</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1205"><a href="#MeshManager.visualize_mesh_slice_interactive-1205"><span class="linenos">1205</span></a>        <span class="c1"># Add initial slice to figure if it exists</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1206"><a href="#MeshManager.visualize_mesh_slice_interactive-1206"><span class="linenos">1206</span></a>        <span class="k">if</span> <span class="n">initial_slice</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1207"><a href="#MeshManager.visualize_mesh_slice_interactive-1207"><span class="linenos">1207</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">initial_slice</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1208"><a href="#MeshManager.visualize_mesh_slice_interactive-1208"><span class="linenos">1208</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1209"><a href="#MeshManager.visualize_mesh_slice_interactive-1209"><span class="linenos">1209</span></a>        <span class="c1"># Create frames for animation</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1210"><a href="#MeshManager.visualize_mesh_slice_interactive-1210"><span class="linenos">1210</span></a>        <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1211"><a href="#MeshManager.visualize_mesh_slice_interactive-1211"><span class="linenos">1211</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">num_slices</span><span class="p">)):</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1212"><a href="#MeshManager.visualize_mesh_slice_interactive-1212"><span class="linenos">1212</span></a>            <span class="c1"># Create a slice at this z-value</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1213"><a href="#MeshManager.visualize_mesh_slice_interactive-1213"><span class="linenos">1213</span></a>            <span class="n">slice_trace</span> <span class="o">=</span> <span class="n">create_slice_trace</span><span class="p">(</span><span class="n">z_val</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1214"><a href="#MeshManager.visualize_mesh_slice_interactive-1214"><span class="linenos">1214</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1215"><a href="#MeshManager.visualize_mesh_slice_interactive-1215"><span class="linenos">1215</span></a>            <span class="c1"># If we have a valid slice, add it to frames</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1216"><a href="#MeshManager.visualize_mesh_slice_interactive-1216"><span class="linenos">1216</span></a>            <span class="k">if</span> <span class="n">slice_trace</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1217"><a href="#MeshManager.visualize_mesh_slice_interactive-1217"><span class="linenos">1217</span></a>                <span class="n">frame_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">slice_trace</span><span class="p">]</span>  <span class="c1"># Mesh and slice</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1218"><a href="#MeshManager.visualize_mesh_slice_interactive-1218"><span class="linenos">1218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1219"><a href="#MeshManager.visualize_mesh_slice_interactive-1219"><span class="linenos">1219</span></a>                <span class="n">frame_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Just the mesh</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1220"><a href="#MeshManager.visualize_mesh_slice_interactive-1220"><span class="linenos">1220</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1221"><a href="#MeshManager.visualize_mesh_slice_interactive-1221"><span class="linenos">1221</span></a>            <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1222"><a href="#MeshManager.visualize_mesh_slice_interactive-1222"><span class="linenos">1222</span></a>                <span class="n">go</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1223"><a href="#MeshManager.visualize_mesh_slice_interactive-1223"><span class="linenos">1223</span></a>                    <span class="n">data</span><span class="o">=</span><span class="n">frame_data</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1224"><a href="#MeshManager.visualize_mesh_slice_interactive-1224"><span class="linenos">1224</span></a>                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1225"><a href="#MeshManager.visualize_mesh_slice_interactive-1225"><span class="linenos">1225</span></a>                    <span class="n">traces</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># Update both traces</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1226"><a href="#MeshManager.visualize_mesh_slice_interactive-1226"><span class="linenos">1226</span></a>                <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1227"><a href="#MeshManager.visualize_mesh_slice_interactive-1227"><span class="linenos">1227</span></a>            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1228"><a href="#MeshManager.visualize_mesh_slice_interactive-1228"><span class="linenos">1228</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1229"><a href="#MeshManager.visualize_mesh_slice_interactive-1229"><span class="linenos">1229</span></a>        <span class="c1"># Create slider steps</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1230"><a href="#MeshManager.visualize_mesh_slice_interactive-1230"><span class="linenos">1230</span></a>        <span class="n">steps</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1231"><a href="#MeshManager.visualize_mesh_slice_interactive-1231"><span class="linenos">1231</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">num_slices</span><span class="p">)):</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1232"><a href="#MeshManager.visualize_mesh_slice_interactive-1232"><span class="linenos">1232</span></a>            <span class="n">step</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1233"><a href="#MeshManager.visualize_mesh_slice_interactive-1233"><span class="linenos">1233</span></a>                <span class="n">args</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1234"><a href="#MeshManager.visualize_mesh_slice_interactive-1234"><span class="linenos">1234</span></a>                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;frame_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1235"><a href="#MeshManager.visualize_mesh_slice_interactive-1235"><span class="linenos">1235</span></a>                    <span class="p">{</span><span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;immediate&quot;</span><span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1236"><a href="#MeshManager.visualize_mesh_slice_interactive-1236"><span class="linenos">1236</span></a>                <span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1237"><a href="#MeshManager.visualize_mesh_slice_interactive-1237"><span class="linenos">1237</span></a>                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1238"><a href="#MeshManager.visualize_mesh_slice_interactive-1238"><span class="linenos">1238</span></a>                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;animate&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1239"><a href="#MeshManager.visualize_mesh_slice_interactive-1239"><span class="linenos">1239</span></a>            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1240"><a href="#MeshManager.visualize_mesh_slice_interactive-1240"><span class="linenos">1240</span></a>            <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1241"><a href="#MeshManager.visualize_mesh_slice_interactive-1241"><span class="linenos">1241</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1242"><a href="#MeshManager.visualize_mesh_slice_interactive-1242"><span class="linenos">1242</span></a>        <span class="c1"># Configure the slider</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1243"><a href="#MeshManager.visualize_mesh_slice_interactive-1243"><span class="linenos">1243</span></a>        <span class="n">sliders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1244"><a href="#MeshManager.visualize_mesh_slice_interactive-1244"><span class="linenos">1244</span></a>            <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1245"><a href="#MeshManager.visualize_mesh_slice_interactive-1245"><span class="linenos">1245</span></a>                <span class="n">active</span><span class="o">=</span><span class="n">num_slices</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Start in the middle</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1246"><a href="#MeshManager.visualize_mesh_slice_interactive-1246"><span class="linenos">1246</span></a>                <span class="n">currentvalue</span><span class="o">=</span><span class="p">{</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1247"><a href="#MeshManager.visualize_mesh_slice_interactive-1247"><span class="linenos">1247</span></a>                    <span class="s2">&quot;prefix&quot;</span><span class="p">:</span> <span class="s2">&quot;Z-value: &quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1248"><a href="#MeshManager.visualize_mesh_slice_interactive-1248"><span class="linenos">1248</span></a>                    <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1249"><a href="#MeshManager.visualize_mesh_slice_interactive-1249"><span class="linenos">1249</span></a>                    <span class="s2">&quot;xanchor&quot;</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1250"><a href="#MeshManager.visualize_mesh_slice_interactive-1250"><span class="linenos">1250</span></a>                <span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1251"><a href="#MeshManager.visualize_mesh_slice_interactive-1251"><span class="linenos">1251</span></a>                <span class="n">pad</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1252"><a href="#MeshManager.visualize_mesh_slice_interactive-1252"><span class="linenos">1252</span></a>                <span class="nb">len</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1253"><a href="#MeshManager.visualize_mesh_slice_interactive-1253"><span class="linenos">1253</span></a>                <span class="n">x</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1254"><a href="#MeshManager.visualize_mesh_slice_interactive-1254"><span class="linenos">1254</span></a>                <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1255"><a href="#MeshManager.visualize_mesh_slice_interactive-1255"><span class="linenos">1255</span></a>                <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1256"><a href="#MeshManager.visualize_mesh_slice_interactive-1256"><span class="linenos">1256</span></a>            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1257"><a href="#MeshManager.visualize_mesh_slice_interactive-1257"><span class="linenos">1257</span></a>        <span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1258"><a href="#MeshManager.visualize_mesh_slice_interactive-1258"><span class="linenos">1258</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1259"><a href="#MeshManager.visualize_mesh_slice_interactive-1259"><span class="linenos">1259</span></a>        <span class="c1"># Configure the figure layout</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1260"><a href="#MeshManager.visualize_mesh_slice_interactive-1260"><span class="linenos">1260</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1261"><a href="#MeshManager.visualize_mesh_slice_interactive-1261"><span class="linenos">1261</span></a>            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1262"><a href="#MeshManager.visualize_mesh_slice_interactive-1262"><span class="linenos">1262</span></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspectmode</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">1.5</span><span class="p">))),</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1263"><a href="#MeshManager.visualize_mesh_slice_interactive-1263"><span class="linenos">1263</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>  <span class="c1"># Taller to make room for slider</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1264"><a href="#MeshManager.visualize_mesh_slice_interactive-1264"><span class="linenos">1264</span></a>            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>  <span class="c1"># Add margin at bottom for slider</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1265"><a href="#MeshManager.visualize_mesh_slice_interactive-1265"><span class="linenos">1265</span></a>            <span class="n">sliders</span><span class="o">=</span><span class="n">sliders</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1266"><a href="#MeshManager.visualize_mesh_slice_interactive-1266"><span class="linenos">1266</span></a>            <span class="c1"># Add animation controls</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1267"><a href="#MeshManager.visualize_mesh_slice_interactive-1267"><span class="linenos">1267</span></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1268"><a href="#MeshManager.visualize_mesh_slice_interactive-1268"><span class="linenos">1268</span></a>                <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1269"><a href="#MeshManager.visualize_mesh_slice_interactive-1269"><span class="linenos">1269</span></a>                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;buttons&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1270"><a href="#MeshManager.visualize_mesh_slice_interactive-1270"><span class="linenos">1270</span></a>                    <span class="n">showactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1271"><a href="#MeshManager.visualize_mesh_slice_interactive-1271"><span class="linenos">1271</span></a>                    <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1272"><a href="#MeshManager.visualize_mesh_slice_interactive-1272"><span class="linenos">1272</span></a>                    <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1273"><a href="#MeshManager.visualize_mesh_slice_interactive-1273"><span class="linenos">1273</span></a>                    <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1274"><a href="#MeshManager.visualize_mesh_slice_interactive-1274"><span class="linenos">1274</span></a>                    <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1275"><a href="#MeshManager.visualize_mesh_slice_interactive-1275"><span class="linenos">1275</span></a>                    <span class="n">pad</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1276"><a href="#MeshManager.visualize_mesh_slice_interactive-1276"><span class="linenos">1276</span></a>                    <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1277"><a href="#MeshManager.visualize_mesh_slice_interactive-1277"><span class="linenos">1277</span></a>                        <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1278"><a href="#MeshManager.visualize_mesh_slice_interactive-1278"><span class="linenos">1278</span></a>                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Play&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1279"><a href="#MeshManager.visualize_mesh_slice_interactive-1279"><span class="linenos">1279</span></a>                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;animate&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1280"><a href="#MeshManager.visualize_mesh_slice_interactive-1280"><span class="linenos">1280</span></a>                            <span class="n">args</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1281"><a href="#MeshManager.visualize_mesh_slice_interactive-1281"><span class="linenos">1281</span></a>                                <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1282"><a href="#MeshManager.visualize_mesh_slice_interactive-1282"><span class="linenos">1282</span></a>                                <span class="p">{</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1283"><a href="#MeshManager.visualize_mesh_slice_interactive-1283"><span class="linenos">1283</span></a>                                    <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1284"><a href="#MeshManager.visualize_mesh_slice_interactive-1284"><span class="linenos">1284</span></a>                                    <span class="s2">&quot;fromcurrent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1285"><a href="#MeshManager.visualize_mesh_slice_interactive-1285"><span class="linenos">1285</span></a>                                <span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1286"><a href="#MeshManager.visualize_mesh_slice_interactive-1286"><span class="linenos">1286</span></a>                            <span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1287"><a href="#MeshManager.visualize_mesh_slice_interactive-1287"><span class="linenos">1287</span></a>                        <span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1288"><a href="#MeshManager.visualize_mesh_slice_interactive-1288"><span class="linenos">1288</span></a>                        <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1289"><a href="#MeshManager.visualize_mesh_slice_interactive-1289"><span class="linenos">1289</span></a>                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pause&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1290"><a href="#MeshManager.visualize_mesh_slice_interactive-1290"><span class="linenos">1290</span></a>                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;animate&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1291"><a href="#MeshManager.visualize_mesh_slice_interactive-1291"><span class="linenos">1291</span></a>                            <span class="n">args</span><span class="o">=</span><span class="p">[</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1292"><a href="#MeshManager.visualize_mesh_slice_interactive-1292"><span class="linenos">1292</span></a>                                <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1293"><a href="#MeshManager.visualize_mesh_slice_interactive-1293"><span class="linenos">1293</span></a>                                <span class="p">{</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1294"><a href="#MeshManager.visualize_mesh_slice_interactive-1294"><span class="linenos">1294</span></a>                                    <span class="s2">&quot;frame&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;redraw&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1295"><a href="#MeshManager.visualize_mesh_slice_interactive-1295"><span class="linenos">1295</span></a>                                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;immediate&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1296"><a href="#MeshManager.visualize_mesh_slice_interactive-1296"><span class="linenos">1296</span></a>                                <span class="p">},</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1297"><a href="#MeshManager.visualize_mesh_slice_interactive-1297"><span class="linenos">1297</span></a>                            <span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1298"><a href="#MeshManager.visualize_mesh_slice_interactive-1298"><span class="linenos">1298</span></a>                        <span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1299"><a href="#MeshManager.visualize_mesh_slice_interactive-1299"><span class="linenos">1299</span></a>                        <span class="nb">dict</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1300"><a href="#MeshManager.visualize_mesh_slice_interactive-1300"><span class="linenos">1300</span></a>                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reset View&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1301"><a href="#MeshManager.visualize_mesh_slice_interactive-1301"><span class="linenos">1301</span></a>                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;relayout&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1302"><a href="#MeshManager.visualize_mesh_slice_interactive-1302"><span class="linenos">1302</span></a>                            <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;scene.camera.eye&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)}],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1303"><a href="#MeshManager.visualize_mesh_slice_interactive-1303"><span class="linenos">1303</span></a>                        <span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1304"><a href="#MeshManager.visualize_mesh_slice_interactive-1304"><span class="linenos">1304</span></a>                    <span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1305"><a href="#MeshManager.visualize_mesh_slice_interactive-1305"><span class="linenos">1305</span></a>                <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1306"><a href="#MeshManager.visualize_mesh_slice_interactive-1306"><span class="linenos">1306</span></a>            <span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1307"><a href="#MeshManager.visualize_mesh_slice_interactive-1307"><span class="linenos">1307</span></a>        <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1308"><a href="#MeshManager.visualize_mesh_slice_interactive-1308"><span class="linenos">1308</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1309"><a href="#MeshManager.visualize_mesh_slice_interactive-1309"><span class="linenos">1309</span></a>        <span class="c1"># Set frames</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1310"><a href="#MeshManager.visualize_mesh_slice_interactive-1310"><span class="linenos">1310</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1311"><a href="#MeshManager.visualize_mesh_slice_interactive-1311"><span class="linenos">1311</span></a>
</span><span id="MeshManager.visualize_mesh_slice_interactive-1312"><a href="#MeshManager.visualize_mesh_slice_interactive-1312"><span class="linenos">1312</span></a>        <span class="k">return</span> <span class="n">fig</span>
</span></pre></div>


            <div class="docstring"><p>Create an interactive 3D visualization of a mesh with a controllable slice plane.</p>

<p>This function displays a 3D mesh and calculates the intersection of the mesh
with an xy-plane at a user-controlled z-value. The intersection is shown as a
colored line on the mesh. A slider allows the user to interactively change the
z-value of the intersection plane.</p>

<p>Args:
    title: Plot title
    z_range: Tuple of (min_z, max_z) for slice range. Auto-detected if None.
    num_slices: Number of positions for the slider
    slice_color: Color for the intersection line
    mesh_color: Color for the 3D mesh
    mesh_opacity: Opacity of the 3D mesh (0-1)</p>

<p>Returns:
    Plotly figure with interactive slider for controlling the z-value</p>
</div>


                            </div>
                            <div id="MeshManager.visualize_mesh_slice_grid" class="classattr">
                                        <input id="MeshManager.visualize_mesh_slice_grid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize_mesh_slice_grid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">faces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Mesh Slice Grid&#39;</span>,</span><span class="param">	<span class="n">num_slices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span>,</span><span class="param">	<span class="n">z_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MeshManager.visualize_mesh_slice_grid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.visualize_mesh_slice_grid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.visualize_mesh_slice_grid-1314"><a href="#MeshManager.visualize_mesh_slice_grid-1314"><span class="linenos">1314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize_mesh_slice_grid</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1315"><a href="#MeshManager.visualize_mesh_slice_grid-1315"><span class="linenos">1315</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1316"><a href="#MeshManager.visualize_mesh_slice_grid-1316"><span class="linenos">1316</span></a>        <span class="n">vertices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1317"><a href="#MeshManager.visualize_mesh_slice_grid-1317"><span class="linenos">1317</span></a>        <span class="n">faces</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1318"><a href="#MeshManager.visualize_mesh_slice_grid-1318"><span class="linenos">1318</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Mesh Slice Grid&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1319"><a href="#MeshManager.visualize_mesh_slice_grid-1319"><span class="linenos">1319</span></a>        <span class="n">num_slices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1320"><a href="#MeshManager.visualize_mesh_slice_grid-1320"><span class="linenos">1320</span></a>        <span class="n">z_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1321"><a href="#MeshManager.visualize_mesh_slice_grid-1321"><span class="linenos">1321</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1322"><a href="#MeshManager.visualize_mesh_slice_grid-1322"><span class="linenos">1322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1323"><a href="#MeshManager.visualize_mesh_slice_grid-1323"><span class="linenos">1323</span></a><span class="sd">        Create a grid visualization showing multiple cross-sections of a 3D mesh.</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1324"><a href="#MeshManager.visualize_mesh_slice_grid-1324"><span class="linenos">1324</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1325"><a href="#MeshManager.visualize_mesh_slice_grid-1325"><span class="linenos">1325</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1326"><a href="#MeshManager.visualize_mesh_slice_grid-1326"><span class="linenos">1326</span></a><span class="sd">            vertices: Vertex array (alternative to mesh_data)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1327"><a href="#MeshManager.visualize_mesh_slice_grid-1327"><span class="linenos">1327</span></a><span class="sd">            faces: Face array (alternative to mesh_data)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1328"><a href="#MeshManager.visualize_mesh_slice_grid-1328"><span class="linenos">1328</span></a><span class="sd">            title: Plot title</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1329"><a href="#MeshManager.visualize_mesh_slice_grid-1329"><span class="linenos">1329</span></a><span class="sd">            num_slices: Number of slices to show (should be perfect square for grid)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1330"><a href="#MeshManager.visualize_mesh_slice_grid-1330"><span class="linenos">1330</span></a><span class="sd">            z_range: Tuple of (min_z, max_z) for slice range. Auto-detected if None.</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1331"><a href="#MeshManager.visualize_mesh_slice_grid-1331"><span class="linenos">1331</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1332"><a href="#MeshManager.visualize_mesh_slice_grid-1332"><span class="linenos">1332</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1333"><a href="#MeshManager.visualize_mesh_slice_grid-1333"><span class="linenos">1333</span></a><span class="sd">            Plotly figure with subplot grid</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1334"><a href="#MeshManager.visualize_mesh_slice_grid-1334"><span class="linenos">1334</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1335"><a href="#MeshManager.visualize_mesh_slice_grid-1335"><span class="linenos">1335</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1336"><a href="#MeshManager.visualize_mesh_slice_grid-1336"><span class="linenos">1336</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1337"><a href="#MeshManager.visualize_mesh_slice_grid-1337"><span class="linenos">1337</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1338"><a href="#MeshManager.visualize_mesh_slice_grid-1338"><span class="linenos">1338</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1339"><a href="#MeshManager.visualize_mesh_slice_grid-1339"><span class="linenos">1339</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">plotly.subplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_subplots</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1340"><a href="#MeshManager.visualize_mesh_slice_grid-1340"><span class="linenos">1340</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1341"><a href="#MeshManager.visualize_mesh_slice_grid-1341"><span class="linenos">1341</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotly not available for slice grid visualization&quot;</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1342"><a href="#MeshManager.visualize_mesh_slice_grid-1342"><span class="linenos">1342</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1343"><a href="#MeshManager.visualize_mesh_slice_grid-1343"><span class="linenos">1343</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1344"><a href="#MeshManager.visualize_mesh_slice_grid-1344"><span class="linenos">1344</span></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1345"><a href="#MeshManager.visualize_mesh_slice_grid-1345"><span class="linenos">1345</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1346"><a href="#MeshManager.visualize_mesh_slice_grid-1346"><span class="linenos">1346</span></a>        <span class="c1"># Determine grid size</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1347"><a href="#MeshManager.visualize_mesh_slice_grid-1347"><span class="linenos">1347</span></a>        <span class="n">grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_slices</span><span class="p">))</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1348"><a href="#MeshManager.visualize_mesh_slice_grid-1348"><span class="linenos">1348</span></a>        <span class="k">if</span> <span class="n">grid_size</span> <span class="o">*</span> <span class="n">grid_size</span> <span class="o">!=</span> <span class="n">num_slices</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1349"><a href="#MeshManager.visualize_mesh_slice_grid-1349"><span class="linenos">1349</span></a>            <span class="n">grid_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num_slices</span><span class="p">)))</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1350"><a href="#MeshManager.visualize_mesh_slice_grid-1350"><span class="linenos">1350</span></a>            <span class="n">num_slices</span> <span class="o">=</span> <span class="n">grid_size</span> <span class="o">*</span> <span class="n">grid_size</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1351"><a href="#MeshManager.visualize_mesh_slice_grid-1351"><span class="linenos">1351</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1352"><a href="#MeshManager.visualize_mesh_slice_grid-1352"><span class="linenos">1352</span></a>        <span class="c1"># Determine Z range</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1353"><a href="#MeshManager.visualize_mesh_slice_grid-1353"><span class="linenos">1353</span></a>        <span class="k">if</span> <span class="n">z_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1354"><a href="#MeshManager.visualize_mesh_slice_grid-1354"><span class="linenos">1354</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1355"><a href="#MeshManager.visualize_mesh_slice_grid-1355"><span class="linenos">1355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1356"><a href="#MeshManager.visualize_mesh_slice_grid-1356"><span class="linenos">1356</span></a>            <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">z_range</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1357"><a href="#MeshManager.visualize_mesh_slice_grid-1357"><span class="linenos">1357</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1358"><a href="#MeshManager.visualize_mesh_slice_grid-1358"><span class="linenos">1358</span></a>        <span class="c1"># Create Z levels</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1359"><a href="#MeshManager.visualize_mesh_slice_grid-1359"><span class="linenos">1359</span></a>        <span class="n">z_levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">,</span> <span class="n">num_slices</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1360"><a href="#MeshManager.visualize_mesh_slice_grid-1360"><span class="linenos">1360</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1361"><a href="#MeshManager.visualize_mesh_slice_grid-1361"><span class="linenos">1361</span></a>        <span class="c1"># Create subplots</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1362"><a href="#MeshManager.visualize_mesh_slice_grid-1362"><span class="linenos">1362</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1363"><a href="#MeshManager.visualize_mesh_slice_grid-1363"><span class="linenos">1363</span></a>            <span class="n">rows</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1364"><a href="#MeshManager.visualize_mesh_slice_grid-1364"><span class="linenos">1364</span></a>            <span class="n">cols</span><span class="o">=</span><span class="n">grid_size</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1365"><a href="#MeshManager.visualize_mesh_slice_grid-1365"><span class="linenos">1365</span></a>            <span class="n">subplot_titles</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Z = </span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">z_levels</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1366"><a href="#MeshManager.visualize_mesh_slice_grid-1366"><span class="linenos">1366</span></a>            <span class="n">specs</span><span class="o">=</span><span class="p">[[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;xy&quot;</span><span class="p">}]</span> <span class="o">*</span> <span class="n">grid_size</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">)],</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1367"><a href="#MeshManager.visualize_mesh_slice_grid-1367"><span class="linenos">1367</span></a>        <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1368"><a href="#MeshManager.visualize_mesh_slice_grid-1368"><span class="linenos">1368</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1369"><a href="#MeshManager.visualize_mesh_slice_grid-1369"><span class="linenos">1369</span></a>        <span class="c1"># Generate slices and add to subplots</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1370"><a href="#MeshManager.visualize_mesh_slice_grid-1370"><span class="linenos">1370</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z_level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">z_levels</span><span class="p">):</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1371"><a href="#MeshManager.visualize_mesh_slice_grid-1371"><span class="linenos">1371</span></a>            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">grid_size</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1372"><a href="#MeshManager.visualize_mesh_slice_grid-1372"><span class="linenos">1372</span></a>            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">grid_size</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1373"><a href="#MeshManager.visualize_mesh_slice_grid-1373"><span class="linenos">1373</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1374"><a href="#MeshManager.visualize_mesh_slice_grid-1374"><span class="linenos">1374</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1375"><a href="#MeshManager.visualize_mesh_slice_grid-1375"><span class="linenos">1375</span></a>                <span class="c1"># Get 2D cross-section</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1376"><a href="#MeshManager.visualize_mesh_slice_grid-1376"><span class="linenos">1376</span></a>                <span class="n">slice_2d</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">section</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1377"><a href="#MeshManager.visualize_mesh_slice_grid-1377"><span class="linenos">1377</span></a>                    <span class="n">plane_origin</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z_level</span><span class="p">],</span> <span class="n">plane_normal</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1378"><a href="#MeshManager.visualize_mesh_slice_grid-1378"><span class="linenos">1378</span></a>                <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1379"><a href="#MeshManager.visualize_mesh_slice_grid-1379"><span class="linenos">1379</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1380"><a href="#MeshManager.visualize_mesh_slice_grid-1380"><span class="linenos">1380</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1381"><a href="#MeshManager.visualize_mesh_slice_grid-1381"><span class="linenos">1381</span></a>                    <span class="n">slice_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1382"><a href="#MeshManager.visualize_mesh_slice_grid-1382"><span class="linenos">1382</span></a>                    <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">slice_2d</span><span class="p">,</span> <span class="s2">&quot;entities&quot;</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1383"><a href="#MeshManager.visualize_mesh_slice_grid-1383"><span class="linenos">1383</span></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_2d</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1384"><a href="#MeshManager.visualize_mesh_slice_grid-1384"><span class="linenos">1384</span></a>                <span class="p">):</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1385"><a href="#MeshManager.visualize_mesh_slice_grid-1385"><span class="linenos">1385</span></a>                    <span class="c1"># Plot each entity in the slice</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1386"><a href="#MeshManager.visualize_mesh_slice_grid-1386"><span class="linenos">1386</span></a>                    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">slice_2d</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1387"><a href="#MeshManager.visualize_mesh_slice_grid-1387"><span class="linenos">1387</span></a>                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">):</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1388"><a href="#MeshManager.visualize_mesh_slice_grid-1388"><span class="linenos">1388</span></a>                            <span class="n">points</span> <span class="o">=</span> <span class="n">slice_2d</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">points</span><span class="p">]</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1389"><a href="#MeshManager.visualize_mesh_slice_grid-1389"><span class="linenos">1389</span></a>                            <span class="c1"># Close the loop</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1390"><a href="#MeshManager.visualize_mesh_slice_grid-1390"><span class="linenos">1390</span></a>                            <span class="n">points_closed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">points</span><span class="p">,</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1391"><a href="#MeshManager.visualize_mesh_slice_grid-1391"><span class="linenos">1391</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1392"><a href="#MeshManager.visualize_mesh_slice_grid-1392"><span class="linenos">1392</span></a>                            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1393"><a href="#MeshManager.visualize_mesh_slice_grid-1393"><span class="linenos">1393</span></a>                                <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1394"><a href="#MeshManager.visualize_mesh_slice_grid-1394"><span class="linenos">1394</span></a>                                    <span class="n">x</span><span class="o">=</span><span class="n">points_closed</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1395"><a href="#MeshManager.visualize_mesh_slice_grid-1395"><span class="linenos">1395</span></a>                                    <span class="n">y</span><span class="o">=</span><span class="n">points_closed</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1396"><a href="#MeshManager.visualize_mesh_slice_grid-1396"><span class="linenos">1396</span></a>                                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1397"><a href="#MeshManager.visualize_mesh_slice_grid-1397"><span class="linenos">1397</span></a>                                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1398"><a href="#MeshManager.visualize_mesh_slice_grid-1398"><span class="linenos">1398</span></a>                                    <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1399"><a href="#MeshManager.visualize_mesh_slice_grid-1399"><span class="linenos">1399</span></a>                                <span class="p">),</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1400"><a href="#MeshManager.visualize_mesh_slice_grid-1400"><span class="linenos">1400</span></a>                                <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1401"><a href="#MeshManager.visualize_mesh_slice_grid-1401"><span class="linenos">1401</span></a>                                <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1402"><a href="#MeshManager.visualize_mesh_slice_grid-1402"><span class="linenos">1402</span></a>                            <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1403"><a href="#MeshManager.visualize_mesh_slice_grid-1403"><span class="linenos">1403</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1404"><a href="#MeshManager.visualize_mesh_slice_grid-1404"><span class="linenos">1404</span></a>                <span class="c1"># Set equal aspect ratio for each subplot</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1405"><a href="#MeshManager.visualize_mesh_slice_grid-1405"><span class="linenos">1405</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1406"><a href="#MeshManager.visualize_mesh_slice_grid-1406"><span class="linenos">1406</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X (m)&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1407"><a href="#MeshManager.visualize_mesh_slice_grid-1407"><span class="linenos">1407</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y (m)&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1408"><a href="#MeshManager.visualize_mesh_slice_grid-1408"><span class="linenos">1408</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1409"><a href="#MeshManager.visualize_mesh_slice_grid-1409"><span class="linenos">1409</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1410"><a href="#MeshManager.visualize_mesh_slice_grid-1410"><span class="linenos">1410</span></a>                <span class="c1"># If slicing fails, just leave subplot empty</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1411"><a href="#MeshManager.visualize_mesh_slice_grid-1411"><span class="linenos">1411</span></a>                <span class="k">pass</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1412"><a href="#MeshManager.visualize_mesh_slice_grid-1412"><span class="linenos">1412</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1413"><a href="#MeshManager.visualize_mesh_slice_grid-1413"><span class="linenos">1413</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1414"><a href="#MeshManager.visualize_mesh_slice_grid-1414"><span class="linenos">1414</span></a>            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1415"><a href="#MeshManager.visualize_mesh_slice_grid-1415"><span class="linenos">1415</span></a>            <span class="n">height</span><span class="o">=</span><span class="mi">150</span> <span class="o">*</span> <span class="n">grid_size</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1416"><a href="#MeshManager.visualize_mesh_slice_grid-1416"><span class="linenos">1416</span></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1417"><a href="#MeshManager.visualize_mesh_slice_grid-1417"><span class="linenos">1417</span></a>        <span class="p">)</span>
</span><span id="MeshManager.visualize_mesh_slice_grid-1418"><a href="#MeshManager.visualize_mesh_slice_grid-1418"><span class="linenos">1418</span></a>
</span><span id="MeshManager.visualize_mesh_slice_grid-1419"><a href="#MeshManager.visualize_mesh_slice_grid-1419"><span class="linenos">1419</span></a>        <span class="k">return</span> <span class="n">fig</span>
</span></pre></div>


            <div class="docstring"><p>Create a grid visualization showing multiple cross-sections of a 3D mesh.</p>

<p>Args:
    vertices: Vertex array (alternative to mesh_data)
    faces: Face array (alternative to mesh_data)
    title: Plot title
    num_slices: Number of slices to show (should be perfect square for grid)
    z_range: Tuple of (min_z, max_z) for slice range. Auto-detected if None.</p>

<p>Returns:
    Plotly figure with subplot grid</p>
</div>


                            </div>
                            <div id="MeshManager.slice_mesh_by_z" class="classattr">
                                        <input id="MeshManager.slice_mesh_by_z-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">slice_mesh_by_z</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">z</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">cap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MeshManager.slice_mesh_by_z-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MeshManager.slice_mesh_by_z"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MeshManager.slice_mesh_by_z-1421"><a href="#MeshManager.slice_mesh_by_z-1421"><span class="linenos">1421</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">slice_mesh_by_z</span><span class="p">(</span>
</span><span id="MeshManager.slice_mesh_by_z-1422"><a href="#MeshManager.slice_mesh_by_z-1422"><span class="linenos">1422</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1423"><a href="#MeshManager.slice_mesh_by_z-1423"><span class="linenos">1423</span></a>        <span class="n">z</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1424"><a href="#MeshManager.slice_mesh_by_z-1424"><span class="linenos">1424</span></a>        <span class="n">cap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1425"><a href="#MeshManager.slice_mesh_by_z-1425"><span class="linenos">1425</span></a>        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1426"><a href="#MeshManager.slice_mesh_by_z-1426"><span class="linenos">1426</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]]:</span>
</span><span id="MeshManager.slice_mesh_by_z-1427"><a href="#MeshManager.slice_mesh_by_z-1427"><span class="linenos">1427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MeshManager.slice_mesh_by_z-1428"><a href="#MeshManager.slice_mesh_by_z-1428"><span class="linenos">1428</span></a><span class="sd">        Slice the current mesh with the horizontal plane z = value and return</span>
</span><span id="MeshManager.slice_mesh_by_z-1429"><a href="#MeshManager.slice_mesh_by_z-1429"><span class="linenos">1429</span></a><span class="sd">        two new meshes partitioned along that plane.</span>
</span><span id="MeshManager.slice_mesh_by_z-1430"><a href="#MeshManager.slice_mesh_by_z-1430"><span class="linenos">1430</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1431"><a href="#MeshManager.slice_mesh_by_z-1431"><span class="linenos">1431</span></a><span class="sd">        This creates new vertices where the plane intersects the original mesh</span>
</span><span id="MeshManager.slice_mesh_by_z-1432"><a href="#MeshManager.slice_mesh_by_z-1432"><span class="linenos">1432</span></a><span class="sd">        and (optionally) caps the cut so both results are closed.</span>
</span><span id="MeshManager.slice_mesh_by_z-1433"><a href="#MeshManager.slice_mesh_by_z-1433"><span class="linenos">1433</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1434"><a href="#MeshManager.slice_mesh_by_z-1434"><span class="linenos">1434</span></a><span class="sd">        Args:</span>
</span><span id="MeshManager.slice_mesh_by_z-1435"><a href="#MeshManager.slice_mesh_by_z-1435"><span class="linenos">1435</span></a><span class="sd">            z: Z-value of the slicing plane (plane origin [0, 0, z], normal [0, 0, 1]).</span>
</span><span id="MeshManager.slice_mesh_by_z-1436"><a href="#MeshManager.slice_mesh_by_z-1436"><span class="linenos">1436</span></a><span class="sd">            cap: If True, seal the open cut by adding faces.</span>
</span><span id="MeshManager.slice_mesh_by_z-1437"><a href="#MeshManager.slice_mesh_by_z-1437"><span class="linenos">1437</span></a><span class="sd">            validate: If True, run trimesh processing/validation on the results.</span>
</span><span id="MeshManager.slice_mesh_by_z-1438"><a href="#MeshManager.slice_mesh_by_z-1438"><span class="linenos">1438</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1439"><a href="#MeshManager.slice_mesh_by_z-1439"><span class="linenos">1439</span></a><span class="sd">        Returns:</span>
</span><span id="MeshManager.slice_mesh_by_z-1440"><a href="#MeshManager.slice_mesh_by_z-1440"><span class="linenos">1440</span></a><span class="sd">            (below_mesh, above_mesh):</span>
</span><span id="MeshManager.slice_mesh_by_z-1441"><a href="#MeshManager.slice_mesh_by_z-1441"><span class="linenos">1441</span></a><span class="sd">                below_mesh contains the portion with vertices at z &lt;= value.</span>
</span><span id="MeshManager.slice_mesh_by_z-1442"><a href="#MeshManager.slice_mesh_by_z-1442"><span class="linenos">1442</span></a><span class="sd">                above_mesh contains the portion with vertices at z &gt;= value.</span>
</span><span id="MeshManager.slice_mesh_by_z-1443"><a href="#MeshManager.slice_mesh_by_z-1443"><span class="linenos">1443</span></a><span class="sd">                Either may be None if the plane lies completely outside the mesh.</span>
</span><span id="MeshManager.slice_mesh_by_z-1444"><a href="#MeshManager.slice_mesh_by_z-1444"><span class="linenos">1444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MeshManager.slice_mesh_by_z-1445"><a href="#MeshManager.slice_mesh_by_z-1445"><span class="linenos">1445</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1446"><a href="#MeshManager.slice_mesh_by_z-1446"><span class="linenos">1446</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh loaded&quot;</span><span class="p">)</span>
</span><span id="MeshManager.slice_mesh_by_z-1447"><a href="#MeshManager.slice_mesh_by_z-1447"><span class="linenos">1447</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1448"><a href="#MeshManager.slice_mesh_by_z-1448"><span class="linenos">1448</span></a>        <span class="n">plane_origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)])</span>
</span><span id="MeshManager.slice_mesh_by_z-1449"><a href="#MeshManager.slice_mesh_by_z-1449"><span class="linenos">1449</span></a>        <span class="n">plane_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="MeshManager.slice_mesh_by_z-1450"><a href="#MeshManager.slice_mesh_by_z-1450"><span class="linenos">1450</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1451"><a href="#MeshManager.slice_mesh_by_z-1451"><span class="linenos">1451</span></a>        <span class="n">below_mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span>
</span><span id="MeshManager.slice_mesh_by_z-1452"><a href="#MeshManager.slice_mesh_by_z-1452"><span class="linenos">1452</span></a>        <span class="n">above_mesh</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">]</span>
</span><span id="MeshManager.slice_mesh_by_z-1453"><a href="#MeshManager.slice_mesh_by_z-1453"><span class="linenos">1453</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1454"><a href="#MeshManager.slice_mesh_by_z-1454"><span class="linenos">1454</span></a>        <span class="c1"># Positive side (normal pointing +Z) yields z &gt;= z_plane -&gt; above</span>
</span><span id="MeshManager.slice_mesh_by_z-1455"><a href="#MeshManager.slice_mesh_by_z-1455"><span class="linenos">1455</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1456"><a href="#MeshManager.slice_mesh_by_z-1456"><span class="linenos">1456</span></a>            <span class="n">above_mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">intersections</span><span class="o">.</span><span class="n">slice_mesh_plane</span><span class="p">(</span>
</span><span id="MeshManager.slice_mesh_by_z-1457"><a href="#MeshManager.slice_mesh_by_z-1457"><span class="linenos">1457</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">plane_normal</span><span class="o">=</span><span class="n">plane_normal</span><span class="p">,</span> <span class="n">plane_origin</span><span class="o">=</span><span class="n">plane_origin</span><span class="p">,</span> <span class="n">cap</span><span class="o">=</span><span class="n">cap</span>
</span><span id="MeshManager.slice_mesh_by_z-1458"><a href="#MeshManager.slice_mesh_by_z-1458"><span class="linenos">1458</span></a>            <span class="p">)</span>
</span><span id="MeshManager.slice_mesh_by_z-1459"><a href="#MeshManager.slice_mesh_by_z-1459"><span class="linenos">1459</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1460"><a href="#MeshManager.slice_mesh_by_z-1460"><span class="linenos">1460</span></a>            <span class="n">above_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.slice_mesh_by_z-1461"><a href="#MeshManager.slice_mesh_by_z-1461"><span class="linenos">1461</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1462"><a href="#MeshManager.slice_mesh_by_z-1462"><span class="linenos">1462</span></a>        <span class="c1"># Reverse normal yields z &lt;= z_plane -&gt; below</span>
</span><span id="MeshManager.slice_mesh_by_z-1463"><a href="#MeshManager.slice_mesh_by_z-1463"><span class="linenos">1463</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1464"><a href="#MeshManager.slice_mesh_by_z-1464"><span class="linenos">1464</span></a>            <span class="n">below_mesh</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">intersections</span><span class="o">.</span><span class="n">slice_mesh_plane</span><span class="p">(</span>
</span><span id="MeshManager.slice_mesh_by_z-1465"><a href="#MeshManager.slice_mesh_by_z-1465"><span class="linenos">1465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1466"><a href="#MeshManager.slice_mesh_by_z-1466"><span class="linenos">1466</span></a>                <span class="n">plane_normal</span><span class="o">=-</span><span class="n">plane_normal</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1467"><a href="#MeshManager.slice_mesh_by_z-1467"><span class="linenos">1467</span></a>                <span class="n">plane_origin</span><span class="o">=</span><span class="n">plane_origin</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1468"><a href="#MeshManager.slice_mesh_by_z-1468"><span class="linenos">1468</span></a>                <span class="n">cap</span><span class="o">=</span><span class="n">cap</span><span class="p">,</span>
</span><span id="MeshManager.slice_mesh_by_z-1469"><a href="#MeshManager.slice_mesh_by_z-1469"><span class="linenos">1469</span></a>            <span class="p">)</span>
</span><span id="MeshManager.slice_mesh_by_z-1470"><a href="#MeshManager.slice_mesh_by_z-1470"><span class="linenos">1470</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1471"><a href="#MeshManager.slice_mesh_by_z-1471"><span class="linenos">1471</span></a>            <span class="n">below_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.slice_mesh_by_z-1472"><a href="#MeshManager.slice_mesh_by_z-1472"><span class="linenos">1472</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1473"><a href="#MeshManager.slice_mesh_by_z-1473"><span class="linenos">1473</span></a>        <span class="c1"># Normalize empty results to None</span>
</span><span id="MeshManager.slice_mesh_by_z-1474"><a href="#MeshManager.slice_mesh_by_z-1474"><span class="linenos">1474</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="MeshManager.slice_mesh_by_z-1475"><a href="#MeshManager.slice_mesh_by_z-1475"><span class="linenos">1475</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">above_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">above_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MeshManager.slice_mesh_by_z-1476"><a href="#MeshManager.slice_mesh_by_z-1476"><span class="linenos">1476</span></a>        <span class="p">):</span>
</span><span id="MeshManager.slice_mesh_by_z-1477"><a href="#MeshManager.slice_mesh_by_z-1477"><span class="linenos">1477</span></a>            <span class="n">above_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.slice_mesh_by_z-1478"><a href="#MeshManager.slice_mesh_by_z-1478"><span class="linenos">1478</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="MeshManager.slice_mesh_by_z-1479"><a href="#MeshManager.slice_mesh_by_z-1479"><span class="linenos">1479</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">below_mesh</span><span class="o">.</span><span class="n">faces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">below_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="MeshManager.slice_mesh_by_z-1480"><a href="#MeshManager.slice_mesh_by_z-1480"><span class="linenos">1480</span></a>        <span class="p">):</span>
</span><span id="MeshManager.slice_mesh_by_z-1481"><a href="#MeshManager.slice_mesh_by_z-1481"><span class="linenos">1481</span></a>            <span class="n">below_mesh</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MeshManager.slice_mesh_by_z-1482"><a href="#MeshManager.slice_mesh_by_z-1482"><span class="linenos">1482</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1483"><a href="#MeshManager.slice_mesh_by_z-1483"><span class="linenos">1483</span></a>        <span class="c1"># Optionally validate/process</span>
</span><span id="MeshManager.slice_mesh_by_z-1484"><a href="#MeshManager.slice_mesh_by_z-1484"><span class="linenos">1484</span></a>        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1485"><a href="#MeshManager.slice_mesh_by_z-1485"><span class="linenos">1485</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager.slice_mesh_by_z-1486"><a href="#MeshManager.slice_mesh_by_z-1486"><span class="linenos">1486</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1487"><a href="#MeshManager.slice_mesh_by_z-1487"><span class="linenos">1487</span></a>                    <span class="n">above_mesh</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager.slice_mesh_by_z-1488"><a href="#MeshManager.slice_mesh_by_z-1488"><span class="linenos">1488</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1489"><a href="#MeshManager.slice_mesh_by_z-1489"><span class="linenos">1489</span></a>                    <span class="k">pass</span>
</span><span id="MeshManager.slice_mesh_by_z-1490"><a href="#MeshManager.slice_mesh_by_z-1490"><span class="linenos">1490</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager.slice_mesh_by_z-1491"><a href="#MeshManager.slice_mesh_by_z-1491"><span class="linenos">1491</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1492"><a href="#MeshManager.slice_mesh_by_z-1492"><span class="linenos">1492</span></a>                    <span class="n">below_mesh</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MeshManager.slice_mesh_by_z-1493"><a href="#MeshManager.slice_mesh_by_z-1493"><span class="linenos">1493</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1494"><a href="#MeshManager.slice_mesh_by_z-1494"><span class="linenos">1494</span></a>                    <span class="k">pass</span>
</span><span id="MeshManager.slice_mesh_by_z-1495"><a href="#MeshManager.slice_mesh_by_z-1495"><span class="linenos">1495</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1496"><a href="#MeshManager.slice_mesh_by_z-1496"><span class="linenos">1496</span></a>        <span class="c1"># Attach metadata</span>
</span><span id="MeshManager.slice_mesh_by_z-1497"><a href="#MeshManager.slice_mesh_by_z-1497"><span class="linenos">1497</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager.slice_mesh_by_z-1498"><a href="#MeshManager.slice_mesh_by_z-1498"><span class="linenos">1498</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">above_mesh</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">above_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1499"><a href="#MeshManager.slice_mesh_by_z-1499"><span class="linenos">1499</span></a>                <span class="n">above_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MeshManager.slice_mesh_by_z-1500"><a href="#MeshManager.slice_mesh_by_z-1500"><span class="linenos">1500</span></a>            <span class="n">above_mesh</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;sliced_by_z&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;above&quot;</span><span class="p">})</span>
</span><span id="MeshManager.slice_mesh_by_z-1501"><a href="#MeshManager.slice_mesh_by_z-1501"><span class="linenos">1501</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1502"><a href="#MeshManager.slice_mesh_by_z-1502"><span class="linenos">1502</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">):</span>
</span><span id="MeshManager.slice_mesh_by_z-1503"><a href="#MeshManager.slice_mesh_by_z-1503"><span class="linenos">1503</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">below_mesh</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">below_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MeshManager.slice_mesh_by_z-1504"><a href="#MeshManager.slice_mesh_by_z-1504"><span class="linenos">1504</span></a>                <span class="n">below_mesh</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MeshManager.slice_mesh_by_z-1505"><a href="#MeshManager.slice_mesh_by_z-1505"><span class="linenos">1505</span></a>            <span class="n">below_mesh</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;sliced_by_z&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;below&quot;</span><span class="p">})</span>
</span><span id="MeshManager.slice_mesh_by_z-1506"><a href="#MeshManager.slice_mesh_by_z-1506"><span class="linenos">1506</span></a>
</span><span id="MeshManager.slice_mesh_by_z-1507"><a href="#MeshManager.slice_mesh_by_z-1507"><span class="linenos">1507</span></a>        <span class="k">return</span> <span class="n">below_mesh</span><span class="p">,</span> <span class="n">above_mesh</span>
</span></pre></div>


            <div class="docstring"><p>Slice the current mesh with the horizontal plane z = value and return
two new meshes partitioned along that plane.</p>

<p>This creates new vertices where the plane intersects the original mesh
and (optionally) caps the cut so both results are closed.</p>

<p>Args:
    z: Z-value of the slicing plane (plane origin [0, 0, z], normal [0, 0, 1]).
    cap: If True, seal the open cut by adding faces.
    validate: If True, run trimesh processing/validation on the results.</p>

<p>Returns:
    (below_mesh, above_mesh):
        below_mesh contains the portion with vertices at z &lt;= value.
        above_mesh contains the portion with vertices at z &gt;= value.
        Either may be None if the plane lies completely outside the mesh.</p>
</div>


                            </div>
                </section>
                <section id="CrossSection">
                            <input id="CrossSection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">CrossSection</span>:

                <label class="view-source-button" for="CrossSection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CrossSection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CrossSection-124"><a href="#CrossSection-124"><span class="linenos">124</span></a><span class="nd">@dataclass</span>
</span><span id="CrossSection-125"><a href="#CrossSection-125"><span class="linenos">125</span></a><span class="k">class</span><span class="w"> </span><span class="nc">CrossSection</span><span class="p">:</span>
</span><span id="CrossSection-126"><a href="#CrossSection-126"><span class="linenos">126</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cross-section at a cut plane with potentially multiple closed polygons.&quot;&quot;&quot;</span>
</span><span id="CrossSection-127"><a href="#CrossSection-127"><span class="linenos">127</span></a>
</span><span id="CrossSection-128"><a href="#CrossSection-128"><span class="linenos">128</span></a>    <span class="n">z</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="CrossSection-129"><a href="#CrossSection-129"><span class="linenos">129</span></a>    <span class="n">slice_index</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="CrossSection-130"><a href="#CrossSection-130"><span class="linenos">130</span></a>    <span class="n">polygons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">]</span>
</span><span id="CrossSection-131"><a href="#CrossSection-131"><span class="linenos">131</span></a>    <span class="n">junction_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Cross-section at a cut plane with potentially multiple closed polygons.</p>
</div>


                            <div id="CrossSection.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">CrossSection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">z</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">slice_index</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">polygons</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">]</span>,</span><span class="param">	<span class="n">junction_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#CrossSection.__init__"></a>
    
    

                            </div>
                            <div id="CrossSection.z" class="classattr">
                                <div class="attr variable">
            <span class="name">z</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#CrossSection.z"></a>
    
    

                            </div>
                            <div id="CrossSection.slice_index" class="classattr">
                                <div class="attr variable">
            <span class="name">slice_index</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#CrossSection.slice_index"></a>
    
    

                            </div>
                            <div id="CrossSection.polygons" class="classattr">
                                <div class="attr variable">
            <span class="name">polygons</span><span class="annotation">: List[shapely.geometry.polygon.Polygon]</span>

        
    </div>
    <a class="headerlink" href="#CrossSection.polygons"></a>
    
    

                            </div>
                            <div id="CrossSection.junction_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">junction_ids</span><span class="annotation">: List[int]</span>

        
    </div>
    <a class="headerlink" href="#CrossSection.junction_ids"></a>
    
    

                            </div>
                </section>
                <section id="Segment">
                            <input id="Segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Segment</span>:

                <label class="view-source-button" for="Segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Segment-134"><a href="#Segment-134"><span class="linenos">134</span></a><span class="nd">@dataclass</span>
</span><span id="Segment-135"><a href="#Segment-135"><span class="linenos">135</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Segment</span><span class="p">:</span>
</span><span id="Segment-136"><a href="#Segment-136"><span class="linenos">136</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Segment-137"><a href="#Segment-137"><span class="linenos">137</span></a><span class="sd">    A 3D segment (band component) between two adjacent cuts.</span>
</span><span id="Segment-138"><a href="#Segment-138"><span class="linenos">138</span></a>
</span><span id="Segment-139"><a href="#Segment-139"><span class="linenos">139</span></a><span class="sd">    Each segment induces one or more edges in the skeleton graph, connecting</span>
</span><span id="Segment-140"><a href="#Segment-140"><span class="linenos">140</span></a><span class="sd">    junctions at the lower cut to junctions at the upper cut.</span>
</span><span id="Segment-141"><a href="#Segment-141"><span class="linenos">141</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Segment-142"><a href="#Segment-142"><span class="linenos">142</span></a>
</span><span id="Segment-143"><a href="#Segment-143"><span class="linenos">143</span></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Segment-144"><a href="#Segment-144"><span class="linenos">144</span></a>    <span class="n">slice_index</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Segment-145"><a href="#Segment-145"><span class="linenos">145</span></a>    <span class="n">z_lower</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Segment-146"><a href="#Segment-146"><span class="linenos">146</span></a>    <span class="n">z_upper</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Segment-147"><a href="#Segment-147"><span class="linenos">147</span></a>    <span class="n">volume</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Segment-148"><a href="#Segment-148"><span class="linenos">148</span></a>    <span class="n">surface_area</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Segment-149"><a href="#Segment-149"><span class="linenos">149</span></a>    <span class="n">lower_junction_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="Segment-150"><a href="#Segment-150"><span class="linenos">150</span></a>    <span class="n">upper_junction_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A 3D segment (band component) between two adjacent cuts.</p>

<p>Each segment induces one or more edges in the skeleton graph, connecting
junctions at the lower cut to junctions at the upper cut.</p>
</div>


                            <div id="Segment.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Segment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">slice_index</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">z_lower</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">z_upper</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">volume</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">surface_area</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">lower_junction_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">upper_junction_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Segment.__init__"></a>
    
    

                            </div>
                            <div id="Segment.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Segment.id"></a>
    
    

                            </div>
                            <div id="Segment.slice_index" class="classattr">
                                <div class="attr variable">
            <span class="name">slice_index</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Segment.slice_index"></a>
    
    

                            </div>
                            <div id="Segment.z_lower" class="classattr">
                                <div class="attr variable">
            <span class="name">z_lower</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Segment.z_lower"></a>
    
    

                            </div>
                            <div id="Segment.z_upper" class="classattr">
                                <div class="attr variable">
            <span class="name">z_upper</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Segment.z_upper"></a>
    
    

                            </div>
                            <div id="Segment.volume" class="classattr">
                                <div class="attr variable">
            <span class="name">volume</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Segment.volume"></a>
    
    

                            </div>
                            <div id="Segment.surface_area" class="classattr">
                                <div class="attr variable">
            <span class="name">surface_area</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#Segment.surface_area"></a>
    
    

                            </div>
                            <div id="Segment.lower_junction_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">lower_junction_ids</span><span class="annotation">: List[int]</span>

        
    </div>
    <a class="headerlink" href="#Segment.lower_junction_ids"></a>
    
    

                            </div>
                            <div id="Segment.upper_junction_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">upper_junction_ids</span><span class="annotation">: List[int]</span>

        
    </div>
    <a class="headerlink" href="#Segment.upper_junction_ids"></a>
    
    

                            </div>
                </section>
                <section id="SkeletonGraph">
                            <input id="SkeletonGraph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SkeletonGraph</span>:

                <label class="view-source-button" for="SkeletonGraph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph-153"><a href="#SkeletonGraph-153"><span class="linenos">153</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SkeletonGraph</span><span class="p">:</span>
</span><span id="SkeletonGraph-154"><a href="#SkeletonGraph-154"><span class="linenos">154</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="SkeletonGraph-155"><a href="#SkeletonGraph-155"><span class="linenos">155</span></a><span class="sd">    Graph where nodes are `Junction`s and edges correspond to cylinder-like</span>
</span><span id="SkeletonGraph-156"><a href="#SkeletonGraph-156"><span class="linenos">156</span></a><span class="sd">    segments connecting nodes on adjacent cuts only.</span>
</span><span id="SkeletonGraph-157"><a href="#SkeletonGraph-157"><span class="linenos">157</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph-158"><a href="#SkeletonGraph-158"><span class="linenos">158</span></a>
</span><span id="SkeletonGraph-159"><a href="#SkeletonGraph-159"><span class="linenos">159</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SkeletonGraph-160"><a href="#SkeletonGraph-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span><span id="SkeletonGraph-161"><a href="#SkeletonGraph-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Junction</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph-162"><a href="#SkeletonGraph-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cross_sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CrossSection</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-163"><a href="#SkeletonGraph-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Segment</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-164"><a href="#SkeletonGraph-164"><span class="linenos">164</span></a>
</span><span id="SkeletonGraph-165"><a href="#SkeletonGraph-165"><span class="linenos">165</span></a>    <span class="c1"># ----------------------------- Node/edge API -----------------------------</span>
</span><span id="SkeletonGraph-166"><a href="#SkeletonGraph-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_junction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Junction</span><span class="p">):</span>
</span><span id="SkeletonGraph-167"><a href="#SkeletonGraph-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="SkeletonGraph-168"><a href="#SkeletonGraph-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
</span><span id="SkeletonGraph-169"><a href="#SkeletonGraph-169"><span class="linenos">169</span></a>            <span class="n">j</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="SkeletonGraph-170"><a href="#SkeletonGraph-170"><span class="linenos">170</span></a>            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;junction&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-171"><a href="#SkeletonGraph-171"><span class="linenos">171</span></a>            <span class="n">z</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">z</span><span class="p">),</span>
</span><span id="SkeletonGraph-172"><a href="#SkeletonGraph-172"><span class="linenos">172</span></a>            <span class="n">center</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>
</span><span id="SkeletonGraph-173"><a href="#SkeletonGraph-173"><span class="linenos">173</span></a>            <span class="n">radius</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">radius</span><span class="p">),</span>
</span><span id="SkeletonGraph-174"><a href="#SkeletonGraph-174"><span class="linenos">174</span></a>            <span class="n">area</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">area</span><span class="p">),</span>
</span><span id="SkeletonGraph-175"><a href="#SkeletonGraph-175"><span class="linenos">175</span></a>            <span class="n">slice_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">slice_index</span><span class="p">),</span>
</span><span id="SkeletonGraph-176"><a href="#SkeletonGraph-176"><span class="linenos">176</span></a>            <span class="n">cross_section_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">cross_section_index</span><span class="p">),</span>
</span><span id="SkeletonGraph-177"><a href="#SkeletonGraph-177"><span class="linenos">177</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph-178"><a href="#SkeletonGraph-178"><span class="linenos">178</span></a>
</span><span id="SkeletonGraph-179"><a href="#SkeletonGraph-179"><span class="linenos">179</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_segment_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">:</span> <span class="n">Segment</span><span class="p">):</span>
</span><span id="SkeletonGraph-180"><a href="#SkeletonGraph-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
</span><span id="SkeletonGraph-181"><a href="#SkeletonGraph-181"><span class="linenos">181</span></a>        <span class="c1"># Connect all lower to all upper (supports branching). Adjacent slices only.</span>
</span><span id="SkeletonGraph-182"><a href="#SkeletonGraph-182"><span class="linenos">182</span></a>        <span class="k">for</span> <span class="n">jl</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">lower_junction_ids</span><span class="p">:</span>
</span><span id="SkeletonGraph-183"><a href="#SkeletonGraph-183"><span class="linenos">183</span></a>            <span class="k">for</span> <span class="n">ju</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">upper_junction_ids</span><span class="p">:</span>
</span><span id="SkeletonGraph-184"><a href="#SkeletonGraph-184"><span class="linenos">184</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
</span><span id="SkeletonGraph-185"><a href="#SkeletonGraph-185"><span class="linenos">185</span></a>                    <span class="n">jl</span><span class="p">,</span>
</span><span id="SkeletonGraph-186"><a href="#SkeletonGraph-186"><span class="linenos">186</span></a>                    <span class="n">ju</span><span class="p">,</span>
</span><span id="SkeletonGraph-187"><a href="#SkeletonGraph-187"><span class="linenos">187</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;segment&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-188"><a href="#SkeletonGraph-188"><span class="linenos">188</span></a>                    <span class="n">segment_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span><span id="SkeletonGraph-189"><a href="#SkeletonGraph-189"><span class="linenos">189</span></a>                    <span class="n">slice_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">slice_index</span><span class="p">),</span>
</span><span id="SkeletonGraph-190"><a href="#SkeletonGraph-190"><span class="linenos">190</span></a>                    <span class="n">z_lower</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">z_lower</span><span class="p">),</span>
</span><span id="SkeletonGraph-191"><a href="#SkeletonGraph-191"><span class="linenos">191</span></a>                    <span class="n">z_upper</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">z_upper</span><span class="p">),</span>
</span><span id="SkeletonGraph-192"><a href="#SkeletonGraph-192"><span class="linenos">192</span></a>                    <span class="n">volume</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span>
</span><span id="SkeletonGraph-193"><a href="#SkeletonGraph-193"><span class="linenos">193</span></a>                    <span class="n">surface_area</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">surface_area</span><span class="p">),</span>
</span><span id="SkeletonGraph-194"><a href="#SkeletonGraph-194"><span class="linenos">194</span></a>                <span class="p">)</span>
</span><span id="SkeletonGraph-195"><a href="#SkeletonGraph-195"><span class="linenos">195</span></a>
</span><span id="SkeletonGraph-196"><a href="#SkeletonGraph-196"><span class="linenos">196</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_networkx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">:</span>
</span><span id="SkeletonGraph-197"><a href="#SkeletonGraph-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
</span><span id="SkeletonGraph-198"><a href="#SkeletonGraph-198"><span class="linenos">198</span></a>
</span><span id="SkeletonGraph-199"><a href="#SkeletonGraph-199"><span class="linenos">199</span></a>    <span class="c1"># visualization</span>
</span><span id="SkeletonGraph-200"><a href="#SkeletonGraph-200"><span class="linenos">200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span>
</span><span id="SkeletonGraph-201"><a href="#SkeletonGraph-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph-202"><a href="#SkeletonGraph-202"><span class="linenos">202</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-203"><a href="#SkeletonGraph-203"><span class="linenos">203</span></a>        <span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph-204"><a href="#SkeletonGraph-204"><span class="linenos">204</span></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph-205"><a href="#SkeletonGraph-205"><span class="linenos">205</span></a>        <span class="n">with_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SkeletonGraph-206"><a href="#SkeletonGraph-206"><span class="linenos">206</span></a>        <span class="n">node_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="SkeletonGraph-207"><a href="#SkeletonGraph-207"><span class="linenos">207</span></a>        <span class="n">node_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C0&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-208"><a href="#SkeletonGraph-208"><span class="linenos">208</span></a>        <span class="n">edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0.6&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-209"><a href="#SkeletonGraph-209"><span class="linenos">209</span></a>        <span class="n">min_hv_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="SkeletonGraph-210"><a href="#SkeletonGraph-210"><span class="linenos">210</span></a>        <span class="n">pad_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="SkeletonGraph-211"><a href="#SkeletonGraph-211"><span class="linenos">211</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="SkeletonGraph-212"><a href="#SkeletonGraph-212"><span class="linenos">212</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SkeletonGraph-213"><a href="#SkeletonGraph-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the skeleton graph in 2D using (x,z) or (y,z) coordinates.</span>
</span><span id="SkeletonGraph-214"><a href="#SkeletonGraph-214"><span class="linenos">214</span></a>
</span><span id="SkeletonGraph-215"><a href="#SkeletonGraph-215"><span class="linenos">215</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph-216"><a href="#SkeletonGraph-216"><span class="linenos">216</span></a><span class="sd">            axis: Horizontal axis to use (&quot;x&quot; or &quot;y&quot;). Vertical axis is always z.</span>
</span><span id="SkeletonGraph-217"><a href="#SkeletonGraph-217"><span class="linenos">217</span></a><span class="sd">            ax: Optional matplotlib Axes to draw into. If None, a new figure/axes is created.</span>
</span><span id="SkeletonGraph-218"><a href="#SkeletonGraph-218"><span class="linenos">218</span></a><span class="sd">            figsize: Optional (width, height) in inches when creating a new figure.</span>
</span><span id="SkeletonGraph-219"><a href="#SkeletonGraph-219"><span class="linenos">219</span></a><span class="sd">            with_labels: Whether to render node labels.</span>
</span><span id="SkeletonGraph-220"><a href="#SkeletonGraph-220"><span class="linenos">220</span></a><span class="sd">            node_size: Node marker size passed to networkx.draw.</span>
</span><span id="SkeletonGraph-221"><a href="#SkeletonGraph-221"><span class="linenos">221</span></a><span class="sd">            node_color: Node color.</span>
</span><span id="SkeletonGraph-222"><a href="#SkeletonGraph-222"><span class="linenos">222</span></a><span class="sd">            edge_color: Edge color.</span>
</span><span id="SkeletonGraph-223"><a href="#SkeletonGraph-223"><span class="linenos">223</span></a><span class="sd">            min_hv_ratio: Minimum desired horizontal-to-vertical data range ratio.</span>
</span><span id="SkeletonGraph-224"><a href="#SkeletonGraph-224"><span class="linenos">224</span></a><span class="sd">                If the horizontal data span is less than this ratio times the</span>
</span><span id="SkeletonGraph-225"><a href="#SkeletonGraph-225"><span class="linenos">225</span></a><span class="sd">                vertical (z) span, x/y limits are expanded around the mean to</span>
</span><span id="SkeletonGraph-226"><a href="#SkeletonGraph-226"><span class="linenos">226</span></a><span class="sd">                meet this minimum. Helps avoid an overly thin vertical line.</span>
</span><span id="SkeletonGraph-227"><a href="#SkeletonGraph-227"><span class="linenos">227</span></a><span class="sd">            pad_frac: Fractional padding added to both axes limits for readability.</span>
</span><span id="SkeletonGraph-228"><a href="#SkeletonGraph-228"><span class="linenos">228</span></a><span class="sd">            **kwargs: Additional kwargs forwarded to networkx.draw.</span>
</span><span id="SkeletonGraph-229"><a href="#SkeletonGraph-229"><span class="linenos">229</span></a>
</span><span id="SkeletonGraph-230"><a href="#SkeletonGraph-230"><span class="linenos">230</span></a><span class="sd">        Returns:</span>
</span><span id="SkeletonGraph-231"><a href="#SkeletonGraph-231"><span class="linenos">231</span></a><span class="sd">            The matplotlib Axes used for drawing.</span>
</span><span id="SkeletonGraph-232"><a href="#SkeletonGraph-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph-233"><a href="#SkeletonGraph-233"><span class="linenos">233</span></a>        <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SkeletonGraph-234"><a href="#SkeletonGraph-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">):</span>
</span><span id="SkeletonGraph-235"><a href="#SkeletonGraph-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axis must be &#39;x&#39; or &#39;y&#39;&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-236"><a href="#SkeletonGraph-236"><span class="linenos">236</span></a>
</span><span id="SkeletonGraph-237"><a href="#SkeletonGraph-237"><span class="linenos">237</span></a>        <span class="c1"># Build 2D positions from node 3D centers</span>
</span><span id="SkeletonGraph-238"><a href="#SkeletonGraph-238"><span class="linenos">238</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="SkeletonGraph-239"><a href="#SkeletonGraph-239"><span class="linenos">239</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph-240"><a href="#SkeletonGraph-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SkeletonGraph-241"><a href="#SkeletonGraph-241"><span class="linenos">241</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-242"><a href="#SkeletonGraph-242"><span class="linenos">242</span></a>            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SkeletonGraph-243"><a href="#SkeletonGraph-243"><span class="linenos">243</span></a>                <span class="k">continue</span>
</span><span id="SkeletonGraph-244"><a href="#SkeletonGraph-244"><span class="linenos">244</span></a>            <span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>  <span class="c1"># (x|y, z)</span>
</span><span id="SkeletonGraph-245"><a href="#SkeletonGraph-245"><span class="linenos">245</span></a>
</span><span id="SkeletonGraph-246"><a href="#SkeletonGraph-246"><span class="linenos">246</span></a>        <span class="c1"># Compute data bounds</span>
</span><span id="SkeletonGraph-247"><a href="#SkeletonGraph-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SkeletonGraph-248"><a href="#SkeletonGraph-248"><span class="linenos">248</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-249"><a href="#SkeletonGraph-249"><span class="linenos">249</span></a>                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="SkeletonGraph-250"><a href="#SkeletonGraph-250"><span class="linenos">250</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> (horizontal)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-251"><a href="#SkeletonGraph-251"><span class="linenos">251</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z (vertical)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-252"><a href="#SkeletonGraph-252"><span class="linenos">252</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span><span id="SkeletonGraph-253"><a href="#SkeletonGraph-253"><span class="linenos">253</span></a>
</span><span id="SkeletonGraph-254"><a href="#SkeletonGraph-254"><span class="linenos">254</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="SkeletonGraph-255"><a href="#SkeletonGraph-255"><span class="linenos">255</span></a>        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="SkeletonGraph-256"><a href="#SkeletonGraph-256"><span class="linenos">256</span></a>        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="SkeletonGraph-257"><a href="#SkeletonGraph-257"><span class="linenos">257</span></a>        <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">zs</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">zs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="SkeletonGraph-258"><a href="#SkeletonGraph-258"><span class="linenos">258</span></a>        <span class="n">xmid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xmax</span><span class="p">)</span>
</span><span id="SkeletonGraph-259"><a href="#SkeletonGraph-259"><span class="linenos">259</span></a>        <span class="n">zmid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">zmin</span> <span class="o">+</span> <span class="n">zmax</span><span class="p">)</span>
</span><span id="SkeletonGraph-260"><a href="#SkeletonGraph-260"><span class="linenos">260</span></a>        <span class="n">xr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="SkeletonGraph-261"><a href="#SkeletonGraph-261"><span class="linenos">261</span></a>        <span class="n">zr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="SkeletonGraph-262"><a href="#SkeletonGraph-262"><span class="linenos">262</span></a>
</span><span id="SkeletonGraph-263"><a href="#SkeletonGraph-263"><span class="linenos">263</span></a>        <span class="c1"># Enforce a minimum horizontal span relative to vertical span</span>
</span><span id="SkeletonGraph-264"><a href="#SkeletonGraph-264"><span class="linenos">264</span></a>        <span class="n">min_xr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_hv_ratio</span> <span class="o">*</span> <span class="n">zr</span><span class="p">,</span> <span class="n">xr</span><span class="p">)</span>
</span><span id="SkeletonGraph-265"><a href="#SkeletonGraph-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="n">min_xr</span> <span class="o">&gt;</span> <span class="n">xr</span><span class="p">:</span>
</span><span id="SkeletonGraph-266"><a href="#SkeletonGraph-266"><span class="linenos">266</span></a>            <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmid</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">min_xr</span>
</span><span id="SkeletonGraph-267"><a href="#SkeletonGraph-267"><span class="linenos">267</span></a>            <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmid</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">min_xr</span>
</span><span id="SkeletonGraph-268"><a href="#SkeletonGraph-268"><span class="linenos">268</span></a>            <span class="n">xr</span> <span class="o">=</span> <span class="n">min_xr</span>
</span><span id="SkeletonGraph-269"><a href="#SkeletonGraph-269"><span class="linenos">269</span></a>
</span><span id="SkeletonGraph-270"><a href="#SkeletonGraph-270"><span class="linenos">270</span></a>        <span class="c1"># Apply padding</span>
</span><span id="SkeletonGraph-271"><a href="#SkeletonGraph-271"><span class="linenos">271</span></a>        <span class="n">xmin</span> <span class="o">-=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">xr</span>
</span><span id="SkeletonGraph-272"><a href="#SkeletonGraph-272"><span class="linenos">272</span></a>        <span class="n">xmax</span> <span class="o">+=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">xr</span>
</span><span id="SkeletonGraph-273"><a href="#SkeletonGraph-273"><span class="linenos">273</span></a>        <span class="n">zmin</span> <span class="o">-=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">zr</span>
</span><span id="SkeletonGraph-274"><a href="#SkeletonGraph-274"><span class="linenos">274</span></a>        <span class="n">zmax</span> <span class="o">+=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">zr</span>
</span><span id="SkeletonGraph-275"><a href="#SkeletonGraph-275"><span class="linenos">275</span></a>
</span><span id="SkeletonGraph-276"><a href="#SkeletonGraph-276"><span class="linenos">276</span></a>        <span class="c1"># Prepare axes</span>
</span><span id="SkeletonGraph-277"><a href="#SkeletonGraph-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-278"><a href="#SkeletonGraph-278"><span class="linenos">278</span></a>            <span class="c1"># Auto figsize that respects data aspect for clarity</span>
</span><span id="SkeletonGraph-279"><a href="#SkeletonGraph-279"><span class="linenos">279</span></a>            <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-280"><a href="#SkeletonGraph-280"><span class="linenos">280</span></a>                <span class="c1"># Base height and width with reasonable minimums</span>
</span><span id="SkeletonGraph-281"><a href="#SkeletonGraph-281"><span class="linenos">281</span></a>                <span class="n">base_h</span> <span class="o">=</span> <span class="mf">4.0</span>
</span><span id="SkeletonGraph-282"><a href="#SkeletonGraph-282"><span class="linenos">282</span></a>                <span class="c1"># width scaled by data aspect (horizontal over vertical)</span>
</span><span id="SkeletonGraph-283"><a href="#SkeletonGraph-283"><span class="linenos">283</span></a>                <span class="n">aspect</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">/</span> <span class="n">zr</span> <span class="k">if</span> <span class="n">zr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="SkeletonGraph-284"><a href="#SkeletonGraph-284"><span class="linenos">284</span></a>                <span class="n">base_w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">base_h</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span> <span class="n">min_hv_ratio</span><span class="p">))</span>
</span><span id="SkeletonGraph-285"><a href="#SkeletonGraph-285"><span class="linenos">285</span></a>                <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_w</span><span class="p">,</span> <span class="n">base_h</span><span class="p">)</span>
</span><span id="SkeletonGraph-286"><a href="#SkeletonGraph-286"><span class="linenos">286</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="SkeletonGraph-287"><a href="#SkeletonGraph-287"><span class="linenos">287</span></a>
</span><span id="SkeletonGraph-288"><a href="#SkeletonGraph-288"><span class="linenos">288</span></a>        <span class="c1"># Draw using networkx helper</span>
</span><span id="SkeletonGraph-289"><a href="#SkeletonGraph-289"><span class="linenos">289</span></a>        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
</span><span id="SkeletonGraph-290"><a href="#SkeletonGraph-290"><span class="linenos">290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
</span><span id="SkeletonGraph-291"><a href="#SkeletonGraph-291"><span class="linenos">291</span></a>            <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
</span><span id="SkeletonGraph-292"><a href="#SkeletonGraph-292"><span class="linenos">292</span></a>            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span id="SkeletonGraph-293"><a href="#SkeletonGraph-293"><span class="linenos">293</span></a>            <span class="n">with_labels</span><span class="o">=</span><span class="n">with_labels</span><span class="p">,</span>
</span><span id="SkeletonGraph-294"><a href="#SkeletonGraph-294"><span class="linenos">294</span></a>            <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span>
</span><span id="SkeletonGraph-295"><a href="#SkeletonGraph-295"><span class="linenos">295</span></a>            <span class="n">node_color</span><span class="o">=</span><span class="n">node_color</span><span class="p">,</span>
</span><span id="SkeletonGraph-296"><a href="#SkeletonGraph-296"><span class="linenos">296</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span>
</span><span id="SkeletonGraph-297"><a href="#SkeletonGraph-297"><span class="linenos">297</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SkeletonGraph-298"><a href="#SkeletonGraph-298"><span class="linenos">298</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph-299"><a href="#SkeletonGraph-299"><span class="linenos">299</span></a>
</span><span id="SkeletonGraph-300"><a href="#SkeletonGraph-300"><span class="linenos">300</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> (horizontal)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-301"><a href="#SkeletonGraph-301"><span class="linenos">301</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z (vertical)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-302"><a href="#SkeletonGraph-302"><span class="linenos">302</span></a>        <span class="c1"># Set limits and aspect for a clear, readable plot</span>
</span><span id="SkeletonGraph-303"><a href="#SkeletonGraph-303"><span class="linenos">303</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
</span><span id="SkeletonGraph-304"><a href="#SkeletonGraph-304"><span class="linenos">304</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">)</span>
</span><span id="SkeletonGraph-305"><a href="#SkeletonGraph-305"><span class="linenos">305</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph-306"><a href="#SkeletonGraph-306"><span class="linenos">306</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-307"><a href="#SkeletonGraph-307"><span class="linenos">307</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="SkeletonGraph-308"><a href="#SkeletonGraph-308"><span class="linenos">308</span></a>            <span class="c1"># Fallback to auto if backend cannot honor equal aspect</span>
</span><span id="SkeletonGraph-309"><a href="#SkeletonGraph-309"><span class="linenos">309</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-310"><a href="#SkeletonGraph-310"><span class="linenos">310</span></a>
</span><span id="SkeletonGraph-311"><a href="#SkeletonGraph-311"><span class="linenos">311</span></a>        <span class="c1"># Return provided or newly-created axes</span>
</span><span id="SkeletonGraph-312"><a href="#SkeletonGraph-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span><span id="SkeletonGraph-313"><a href="#SkeletonGraph-313"><span class="linenos">313</span></a>
</span><span id="SkeletonGraph-314"><a href="#SkeletonGraph-314"><span class="linenos">314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_cross_section</span><span class="p">(</span>
</span><span id="SkeletonGraph-315"><a href="#SkeletonGraph-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph-316"><a href="#SkeletonGraph-316"><span class="linenos">316</span></a>        <span class="n">node_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="SkeletonGraph-317"><a href="#SkeletonGraph-317"><span class="linenos">317</span></a>        <span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph-318"><a href="#SkeletonGraph-318"><span class="linenos">318</span></a>        <span class="n">boundary_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-319"><a href="#SkeletonGraph-319"><span class="linenos">319</span></a>        <span class="n">circle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-320"><a href="#SkeletonGraph-320"><span class="linenos">320</span></a>        <span class="n">center_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-321"><a href="#SkeletonGraph-321"><span class="linenos">321</span></a>        <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
</span><span id="SkeletonGraph-322"><a href="#SkeletonGraph-322"><span class="linenos">322</span></a>        <span class="n">alpha_boundary</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="SkeletonGraph-323"><a href="#SkeletonGraph-323"><span class="linenos">323</span></a>        <span class="n">alpha_circle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="SkeletonGraph-324"><a href="#SkeletonGraph-324"><span class="linenos">324</span></a>        <span class="n">show_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SkeletonGraph-325"><a href="#SkeletonGraph-325"><span class="linenos">325</span></a>        <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph-326"><a href="#SkeletonGraph-326"><span class="linenos">326</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SkeletonGraph-327"><a href="#SkeletonGraph-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the cross-section boundary curve with its fitted disk.</span>
</span><span id="SkeletonGraph-328"><a href="#SkeletonGraph-328"><span class="linenos">328</span></a>
</span><span id="SkeletonGraph-329"><a href="#SkeletonGraph-329"><span class="linenos">329</span></a><span class="sd">        Expects node attributes `boundary_2d`, `center`, and `radius`.</span>
</span><span id="SkeletonGraph-330"><a href="#SkeletonGraph-330"><span class="linenos">330</span></a>
</span><span id="SkeletonGraph-331"><a href="#SkeletonGraph-331"><span class="linenos">331</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph-332"><a href="#SkeletonGraph-332"><span class="linenos">332</span></a><span class="sd">            node_id: Graph node identifier (e.g., &quot;cut3_cs0&quot;).</span>
</span><span id="SkeletonGraph-333"><a href="#SkeletonGraph-333"><span class="linenos">333</span></a><span class="sd">            ax: Optional matplotlib Axes; if None, a new one is created.</span>
</span><span id="SkeletonGraph-334"><a href="#SkeletonGraph-334"><span class="linenos">334</span></a><span class="sd">            boundary_color: Color for the boundary polyline.</span>
</span><span id="SkeletonGraph-335"><a href="#SkeletonGraph-335"><span class="linenos">335</span></a><span class="sd">            circle_color: Color for the fitted circle.</span>
</span><span id="SkeletonGraph-336"><a href="#SkeletonGraph-336"><span class="linenos">336</span></a><span class="sd">            center_color: Color for the center marker.</span>
</span><span id="SkeletonGraph-337"><a href="#SkeletonGraph-337"><span class="linenos">337</span></a><span class="sd">            linewidth: Line width for boundary and circle.</span>
</span><span id="SkeletonGraph-338"><a href="#SkeletonGraph-338"><span class="linenos">338</span></a><span class="sd">            alpha_boundary: Alpha for the boundary.</span>
</span><span id="SkeletonGraph-339"><a href="#SkeletonGraph-339"><span class="linenos">339</span></a><span class="sd">            alpha_circle: Alpha for the circle.</span>
</span><span id="SkeletonGraph-340"><a href="#SkeletonGraph-340"><span class="linenos">340</span></a><span class="sd">            show_center: Whether to draw the center point.</span>
</span><span id="SkeletonGraph-341"><a href="#SkeletonGraph-341"><span class="linenos">341</span></a><span class="sd">            title: Optional title; defaults to node id with cut/index.</span>
</span><span id="SkeletonGraph-342"><a href="#SkeletonGraph-342"><span class="linenos">342</span></a>
</span><span id="SkeletonGraph-343"><a href="#SkeletonGraph-343"><span class="linenos">343</span></a><span class="sd">        Returns:</span>
</span><span id="SkeletonGraph-344"><a href="#SkeletonGraph-344"><span class="linenos">344</span></a><span class="sd">            The matplotlib Axes used for drawing.</span>
</span><span id="SkeletonGraph-345"><a href="#SkeletonGraph-345"><span class="linenos">345</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph-346"><a href="#SkeletonGraph-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
</span><span id="SkeletonGraph-347"><a href="#SkeletonGraph-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&#39; not in SkeletonGraph&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-348"><a href="#SkeletonGraph-348"><span class="linenos">348</span></a>
</span><span id="SkeletonGraph-349"><a href="#SkeletonGraph-349"><span class="linenos">349</span></a>        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
</span><span id="SkeletonGraph-350"><a href="#SkeletonGraph-350"><span class="linenos">350</span></a>        <span class="n">boundary_2d</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;boundary_2d&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-351"><a href="#SkeletonGraph-351"><span class="linenos">351</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-352"><a href="#SkeletonGraph-352"><span class="linenos">352</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-353"><a href="#SkeletonGraph-353"><span class="linenos">353</span></a>
</span><span id="SkeletonGraph-354"><a href="#SkeletonGraph-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="n">boundary_2d</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary_2d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph-355"><a href="#SkeletonGraph-355"><span class="linenos">355</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Node &#39;</span><span class="si">%s</span><span class="s2">&#39; has no boundary_2d; cannot plot boundary.&quot;</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="SkeletonGraph-356"><a href="#SkeletonGraph-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-357"><a href="#SkeletonGraph-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SkeletonGraph-358"><a href="#SkeletonGraph-358"><span class="linenos">358</span></a>                <span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&#39; missing center/radius required for plotting&quot;</span>
</span><span id="SkeletonGraph-359"><a href="#SkeletonGraph-359"><span class="linenos">359</span></a>            <span class="p">)</span>
</span><span id="SkeletonGraph-360"><a href="#SkeletonGraph-360"><span class="linenos">360</span></a>
</span><span id="SkeletonGraph-361"><a href="#SkeletonGraph-361"><span class="linenos">361</span></a>        <span class="c1"># Prepare axes</span>
</span><span id="SkeletonGraph-362"><a href="#SkeletonGraph-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-363"><a href="#SkeletonGraph-363"><span class="linenos">363</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="SkeletonGraph-364"><a href="#SkeletonGraph-364"><span class="linenos">364</span></a>
</span><span id="SkeletonGraph-365"><a href="#SkeletonGraph-365"><span class="linenos">365</span></a>        <span class="c1"># Plot boundary polyline</span>
</span><span id="SkeletonGraph-366"><a href="#SkeletonGraph-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">boundary_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary_2d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph-367"><a href="#SkeletonGraph-367"><span class="linenos">367</span></a>            <span class="n">bx</span> <span class="o">=</span> <span class="n">boundary_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="SkeletonGraph-368"><a href="#SkeletonGraph-368"><span class="linenos">368</span></a>            <span class="n">by</span> <span class="o">=</span> <span class="n">boundary_2d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SkeletonGraph-369"><a href="#SkeletonGraph-369"><span class="linenos">369</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">boundary_color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_boundary</span><span class="p">)</span>
</span><span id="SkeletonGraph-370"><a href="#SkeletonGraph-370"><span class="linenos">370</span></a>
</span><span id="SkeletonGraph-371"><a href="#SkeletonGraph-371"><span class="linenos">371</span></a>        <span class="c1"># Plot fitted circle</span>
</span><span id="SkeletonGraph-372"><a href="#SkeletonGraph-372"><span class="linenos">372</span></a>        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SkeletonGraph-373"><a href="#SkeletonGraph-373"><span class="linenos">373</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
</span><span id="SkeletonGraph-374"><a href="#SkeletonGraph-374"><span class="linenos">374</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
</span><span id="SkeletonGraph-375"><a href="#SkeletonGraph-375"><span class="linenos">375</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="SkeletonGraph-376"><a href="#SkeletonGraph-376"><span class="linenos">376</span></a>            <span class="n">cx</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
</span><span id="SkeletonGraph-377"><a href="#SkeletonGraph-377"><span class="linenos">377</span></a>            <span class="n">cy</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
</span><span id="SkeletonGraph-378"><a href="#SkeletonGraph-378"><span class="linenos">378</span></a>            <span class="n">color</span><span class="o">=</span><span class="n">circle_color</span><span class="p">,</span>
</span><span id="SkeletonGraph-379"><a href="#SkeletonGraph-379"><span class="linenos">379</span></a>            <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
</span><span id="SkeletonGraph-380"><a href="#SkeletonGraph-380"><span class="linenos">380</span></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_circle</span><span class="p">,</span>
</span><span id="SkeletonGraph-381"><a href="#SkeletonGraph-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph-382"><a href="#SkeletonGraph-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="n">show_center</span><span class="p">:</span>
</span><span id="SkeletonGraph-383"><a href="#SkeletonGraph-383"><span class="linenos">383</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">cx</span><span class="p">],</span> <span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">center_color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="SkeletonGraph-384"><a href="#SkeletonGraph-384"><span class="linenos">384</span></a>
</span><span id="SkeletonGraph-385"><a href="#SkeletonGraph-385"><span class="linenos">385</span></a>        <span class="c1"># Cosmetics</span>
</span><span id="SkeletonGraph-386"><a href="#SkeletonGraph-386"><span class="linenos">386</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-387"><a href="#SkeletonGraph-387"><span class="linenos">387</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-388"><a href="#SkeletonGraph-388"><span class="linenos">388</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-389"><a href="#SkeletonGraph-389"><span class="linenos">389</span></a>        <span class="n">default_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="SkeletonGraph-390"><a href="#SkeletonGraph-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="n">default_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-391"><a href="#SkeletonGraph-391"><span class="linenos">391</span></a>            <span class="n">ci</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-392"><a href="#SkeletonGraph-392"><span class="linenos">392</span></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cross_section_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-393"><a href="#SkeletonGraph-393"><span class="linenos">393</span></a>            <span class="n">default_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> (slice </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2">, cs </span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="SkeletonGraph-394"><a href="#SkeletonGraph-394"><span class="linenos">394</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">default_title</span><span class="p">)</span>
</span><span id="SkeletonGraph-395"><a href="#SkeletonGraph-395"><span class="linenos">395</span></a>
</span><span id="SkeletonGraph-396"><a href="#SkeletonGraph-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span><span id="SkeletonGraph-397"><a href="#SkeletonGraph-397"><span class="linenos">397</span></a>
</span><span id="SkeletonGraph-398"><a href="#SkeletonGraph-398"><span class="linenos">398</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_all_cross_sections</span><span class="p">(</span>
</span><span id="SkeletonGraph-399"><a href="#SkeletonGraph-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph-400"><a href="#SkeletonGraph-400"><span class="linenos">400</span></a>        <span class="n">sort_by</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_section_index&quot;</span><span class="p">),</span>
</span><span id="SkeletonGraph-401"><a href="#SkeletonGraph-401"><span class="linenos">401</span></a>        <span class="n">max_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="SkeletonGraph-402"><a href="#SkeletonGraph-402"><span class="linenos">402</span></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph-403"><a href="#SkeletonGraph-403"><span class="linenos">403</span></a>        <span class="n">share_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SkeletonGraph-404"><a href="#SkeletonGraph-404"><span class="linenos">404</span></a>        <span class="n">boundary_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-405"><a href="#SkeletonGraph-405"><span class="linenos">405</span></a>        <span class="n">circle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-406"><a href="#SkeletonGraph-406"><span class="linenos">406</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SkeletonGraph-407"><a href="#SkeletonGraph-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot every cross-section boundary with its fitted disk in a grid.</span>
</span><span id="SkeletonGraph-408"><a href="#SkeletonGraph-408"><span class="linenos">408</span></a>
</span><span id="SkeletonGraph-409"><a href="#SkeletonGraph-409"><span class="linenos">409</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph-410"><a href="#SkeletonGraph-410"><span class="linenos">410</span></a><span class="sd">            sort_by: Tuple of node attribute names to sort nodes (primary, secondary).</span>
</span><span id="SkeletonGraph-411"><a href="#SkeletonGraph-411"><span class="linenos">411</span></a><span class="sd">            max_cols: Max number of subplot columns.</span>
</span><span id="SkeletonGraph-412"><a href="#SkeletonGraph-412"><span class="linenos">412</span></a><span class="sd">            figsize: Figure size; auto if None.</span>
</span><span id="SkeletonGraph-413"><a href="#SkeletonGraph-413"><span class="linenos">413</span></a><span class="sd">            share_axes: Whether to share x/y among subplots.</span>
</span><span id="SkeletonGraph-414"><a href="#SkeletonGraph-414"><span class="linenos">414</span></a><span class="sd">            boundary_color: Color for boundaries.</span>
</span><span id="SkeletonGraph-415"><a href="#SkeletonGraph-415"><span class="linenos">415</span></a><span class="sd">            circle_color: Color for circles.</span>
</span><span id="SkeletonGraph-416"><a href="#SkeletonGraph-416"><span class="linenos">416</span></a>
</span><span id="SkeletonGraph-417"><a href="#SkeletonGraph-417"><span class="linenos">417</span></a><span class="sd">        Returns:</span>
</span><span id="SkeletonGraph-418"><a href="#SkeletonGraph-418"><span class="linenos">418</span></a><span class="sd">            The matplotlib Figure created.</span>
</span><span id="SkeletonGraph-419"><a href="#SkeletonGraph-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph-420"><a href="#SkeletonGraph-420"><span class="linenos">420</span></a>        <span class="c1"># Gather nodes that have boundary_2d and required attributes</span>
</span><span id="SkeletonGraph-421"><a href="#SkeletonGraph-421"><span class="linenos">421</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-422"><a href="#SkeletonGraph-422"><span class="linenos">422</span></a>        <span class="k">for</span> <span class="n">nid</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SkeletonGraph-423"><a href="#SkeletonGraph-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-424"><a href="#SkeletonGraph-424"><span class="linenos">424</span></a>                <span class="k">continue</span>
</span><span id="SkeletonGraph-425"><a href="#SkeletonGraph-425"><span class="linenos">425</span></a>            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">nid</span><span class="p">,</span> <span class="n">attrs</span><span class="p">))</span>
</span><span id="SkeletonGraph-426"><a href="#SkeletonGraph-426"><span class="linenos">426</span></a>
</span><span id="SkeletonGraph-427"><a href="#SkeletonGraph-427"><span class="linenos">427</span></a>        <span class="c1"># Sort nodes by provided attributes if present</span>
</span><span id="SkeletonGraph-428"><a href="#SkeletonGraph-428"><span class="linenos">428</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">sort_key</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="SkeletonGraph-429"><a href="#SkeletonGraph-429"><span class="linenos">429</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">item</span>
</span><span id="SkeletonGraph-430"><a href="#SkeletonGraph-430"><span class="linenos">430</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sort_by</span><span class="p">)</span>
</span><span id="SkeletonGraph-431"><a href="#SkeletonGraph-431"><span class="linenos">431</span></a>
</span><span id="SkeletonGraph-432"><a href="#SkeletonGraph-432"><span class="linenos">432</span></a>        <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sort_key</span><span class="p">)</span>
</span><span id="SkeletonGraph-433"><a href="#SkeletonGraph-433"><span class="linenos">433</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="SkeletonGraph-434"><a href="#SkeletonGraph-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SkeletonGraph-435"><a href="#SkeletonGraph-435"><span class="linenos">435</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No nodes available to plot&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-436"><a href="#SkeletonGraph-436"><span class="linenos">436</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SkeletonGraph-437"><a href="#SkeletonGraph-437"><span class="linenos">437</span></a>
</span><span id="SkeletonGraph-438"><a href="#SkeletonGraph-438"><span class="linenos">438</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_cols</span><span class="p">))</span>
</span><span id="SkeletonGraph-439"><a href="#SkeletonGraph-439"><span class="linenos">439</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>
</span><span id="SkeletonGraph-440"><a href="#SkeletonGraph-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-441"><a href="#SkeletonGraph-441"><span class="linenos">441</span></a>            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">)</span>
</span><span id="SkeletonGraph-442"><a href="#SkeletonGraph-442"><span class="linenos">442</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
</span><span id="SkeletonGraph-443"><a href="#SkeletonGraph-443"><span class="linenos">443</span></a>            <span class="n">nrows</span><span class="p">,</span>
</span><span id="SkeletonGraph-444"><a href="#SkeletonGraph-444"><span class="linenos">444</span></a>            <span class="n">ncols</span><span class="p">,</span>
</span><span id="SkeletonGraph-445"><a href="#SkeletonGraph-445"><span class="linenos">445</span></a>            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="SkeletonGraph-446"><a href="#SkeletonGraph-446"><span class="linenos">446</span></a>            <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SkeletonGraph-447"><a href="#SkeletonGraph-447"><span class="linenos">447</span></a>            <span class="n">sharex</span><span class="o">=</span><span class="n">share_axes</span><span class="p">,</span>
</span><span id="SkeletonGraph-448"><a href="#SkeletonGraph-448"><span class="linenos">448</span></a>            <span class="n">sharey</span><span class="o">=</span><span class="n">share_axes</span><span class="p">,</span>
</span><span id="SkeletonGraph-449"><a href="#SkeletonGraph-449"><span class="linenos">449</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph-450"><a href="#SkeletonGraph-450"><span class="linenos">450</span></a>
</span><span id="SkeletonGraph-451"><a href="#SkeletonGraph-451"><span class="linenos">451</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="SkeletonGraph-452"><a href="#SkeletonGraph-452"><span class="linenos">452</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph-453"><a href="#SkeletonGraph-453"><span class="linenos">453</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">%</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph-454"><a href="#SkeletonGraph-454"><span class="linenos">454</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
</span><span id="SkeletonGraph-455"><a href="#SkeletonGraph-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_cross_section</span><span class="p">(</span>
</span><span id="SkeletonGraph-456"><a href="#SkeletonGraph-456"><span class="linenos">456</span></a>                <span class="n">nid</span><span class="p">,</span>
</span><span id="SkeletonGraph-457"><a href="#SkeletonGraph-457"><span class="linenos">457</span></a>                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span id="SkeletonGraph-458"><a href="#SkeletonGraph-458"><span class="linenos">458</span></a>                <span class="n">boundary_color</span><span class="o">=</span><span class="n">boundary_color</span><span class="p">,</span>
</span><span id="SkeletonGraph-459"><a href="#SkeletonGraph-459"><span class="linenos">459</span></a>                <span class="n">circle_color</span><span class="o">=</span><span class="n">circle_color</span><span class="p">,</span>
</span><span id="SkeletonGraph-460"><a href="#SkeletonGraph-460"><span class="linenos">460</span></a>                <span class="n">show_center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SkeletonGraph-461"><a href="#SkeletonGraph-461"><span class="linenos">461</span></a>            <span class="p">)</span>
</span><span id="SkeletonGraph-462"><a href="#SkeletonGraph-462"><span class="linenos">462</span></a>
</span><span id="SkeletonGraph-463"><a href="#SkeletonGraph-463"><span class="linenos">463</span></a>        <span class="c1"># Hide any unused subplots</span>
</span><span id="SkeletonGraph-464"><a href="#SkeletonGraph-464"><span class="linenos">464</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">):</span>
</span><span id="SkeletonGraph-465"><a href="#SkeletonGraph-465"><span class="linenos">465</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">k</span> <span class="o">//</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph-466"><a href="#SkeletonGraph-466"><span class="linenos">466</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">k</span> <span class="o">%</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph-467"><a href="#SkeletonGraph-467"><span class="linenos">467</span></a>            <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-468"><a href="#SkeletonGraph-468"><span class="linenos">468</span></a>
</span><span id="SkeletonGraph-469"><a href="#SkeletonGraph-469"><span class="linenos">469</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SkeletonGraph-470"><a href="#SkeletonGraph-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="n">fig</span>
</span><span id="SkeletonGraph-471"><a href="#SkeletonGraph-471"><span class="linenos">471</span></a>
</span><span id="SkeletonGraph-472"><a href="#SkeletonGraph-472"><span class="linenos">472</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_swc</span><span class="p">(</span>
</span><span id="SkeletonGraph-473"><a href="#SkeletonGraph-473"><span class="linenos">473</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph-474"><a href="#SkeletonGraph-474"><span class="linenos">474</span></a>        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SkeletonGraph-475"><a href="#SkeletonGraph-475"><span class="linenos">475</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="SkeletonGraph-476"><a href="#SkeletonGraph-476"><span class="linenos">476</span></a>        <span class="n">type_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="SkeletonGraph-477"><a href="#SkeletonGraph-477"><span class="linenos">477</span></a>        <span class="n">annotate_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SkeletonGraph-478"><a href="#SkeletonGraph-478"><span class="linenos">478</span></a>        <span class="n">cycle_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;remove_edge&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph-479"><a href="#SkeletonGraph-479"><span class="linenos">479</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-480"><a href="#SkeletonGraph-480"><span class="linenos">480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write this skeleton graph to an SWC file.</span>
</span><span id="SkeletonGraph-481"><a href="#SkeletonGraph-481"><span class="linenos">481</span></a>
</span><span id="SkeletonGraph-482"><a href="#SkeletonGraph-482"><span class="linenos">482</span></a><span class="sd">        SWC format: each row has 7 columns: ``n T x y z R p``</span>
</span><span id="SkeletonGraph-483"><a href="#SkeletonGraph-483"><span class="linenos">483</span></a><span class="sd">          - ``n``: 1-based sample index</span>
</span><span id="SkeletonGraph-484"><a href="#SkeletonGraph-484"><span class="linenos">484</span></a><span class="sd">          - ``T``: sample type (default 5, overridable via ``type_index``)</span>
</span><span id="SkeletonGraph-485"><a href="#SkeletonGraph-485"><span class="linenos">485</span></a><span class="sd">          - ``x,y,z``: coordinates (from node ``center``)</span>
</span><span id="SkeletonGraph-486"><a href="#SkeletonGraph-486"><span class="linenos">486</span></a><span class="sd">          - ``R``: radius (from node ``radius``)</span>
</span><span id="SkeletonGraph-487"><a href="#SkeletonGraph-487"><span class="linenos">487</span></a><span class="sd">          - ``p``: parent index (or -1 for root)</span>
</span><span id="SkeletonGraph-488"><a href="#SkeletonGraph-488"><span class="linenos">488</span></a>
</span><span id="SkeletonGraph-489"><a href="#SkeletonGraph-489"><span class="linenos">489</span></a><span class="sd">        Important: SWC requires a tree (no cycles). If this graph contains</span>
</span><span id="SkeletonGraph-490"><a href="#SkeletonGraph-490"><span class="linenos">490</span></a><span class="sd">        cycles, we can break them in one of two ways (selectable via</span>
</span><span id="SkeletonGraph-491"><a href="#SkeletonGraph-491"><span class="linenos">491</span></a><span class="sd">        ``cycle_mode``):</span>
</span><span id="SkeletonGraph-492"><a href="#SkeletonGraph-492"><span class="linenos">492</span></a><span class="sd">          - ``&quot;remove_edge&quot;`` (default): remove one edge per cycle to obtain a</span>
</span><span id="SkeletonGraph-493"><a href="#SkeletonGraph-493"><span class="linenos">493</span></a><span class="sd">            spanning forest. Prefer removing an edge touching a branching node</span>
</span><span id="SkeletonGraph-494"><a href="#SkeletonGraph-494"><span class="linenos">494</span></a><span class="sd">            (degree &gt; 2) to preserve simpler chains. Removed edges are</span>
</span><span id="SkeletonGraph-495"><a href="#SkeletonGraph-495"><span class="linenos">495</span></a><span class="sd">            annotated in the SWC header.</span>
</span><span id="SkeletonGraph-496"><a href="#SkeletonGraph-496"><span class="linenos">496</span></a><span class="sd">          - ``&quot;duplicate_junction&quot;``: duplicate a branching node within the</span>
</span><span id="SkeletonGraph-497"><a href="#SkeletonGraph-497"><span class="linenos">497</span></a><span class="sd">            cycle and rewire one incident cycle edge to the duplicate instead</span>
</span><span id="SkeletonGraph-498"><a href="#SkeletonGraph-498"><span class="linenos">498</span></a><span class="sd">            of removing it. This preserves all segments as edges in SWC while</span>
</span><span id="SkeletonGraph-499"><a href="#SkeletonGraph-499"><span class="linenos">499</span></a><span class="sd">            yielding a tree. Duplications are annotated in the SWC header so</span>
</span><span id="SkeletonGraph-500"><a href="#SkeletonGraph-500"><span class="linenos">500</span></a><span class="sd">            downstream tools can reconnect duplicate pairs if needed.</span>
</span><span id="SkeletonGraph-501"><a href="#SkeletonGraph-501"><span class="linenos">501</span></a>
</span><span id="SkeletonGraph-502"><a href="#SkeletonGraph-502"><span class="linenos">502</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph-503"><a href="#SkeletonGraph-503"><span class="linenos">503</span></a><span class="sd">            filepath: Destination SWC file path.</span>
</span><span id="SkeletonGraph-504"><a href="#SkeletonGraph-504"><span class="linenos">504</span></a><span class="sd">            type_index: Type code to write in column T (default 5). You can</span>
</span><span id="SkeletonGraph-505"><a href="#SkeletonGraph-505"><span class="linenos">505</span></a><span class="sd">                change this to match your downstream tooling.</span>
</span><span id="SkeletonGraph-506"><a href="#SkeletonGraph-506"><span class="linenos">506</span></a><span class="sd">            annotate_cycles: If True, write header lines describing the cycle</span>
</span><span id="SkeletonGraph-507"><a href="#SkeletonGraph-507"><span class="linenos">507</span></a><span class="sd">                breaking operations (removed edges or duplicated junctions).</span>
</span><span id="SkeletonGraph-508"><a href="#SkeletonGraph-508"><span class="linenos">508</span></a><span class="sd">            cycle_mode: &quot;remove_edge&quot; (default) or &quot;duplicate_junction&quot;.</span>
</span><span id="SkeletonGraph-509"><a href="#SkeletonGraph-509"><span class="linenos">509</span></a><span class="sd">                When &quot;duplicate_junction&quot;, a branching node on the cycle is</span>
</span><span id="SkeletonGraph-510"><a href="#SkeletonGraph-510"><span class="linenos">510</span></a><span class="sd">                duplicated and one of its incident cycle edges is rewired to</span>
</span><span id="SkeletonGraph-511"><a href="#SkeletonGraph-511"><span class="linenos">511</span></a><span class="sd">                the duplicate.</span>
</span><span id="SkeletonGraph-512"><a href="#SkeletonGraph-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph-513"><a href="#SkeletonGraph-513"><span class="linenos">513</span></a>        <span class="c1"># Validate type index</span>
</span><span id="SkeletonGraph-514"><a href="#SkeletonGraph-514"><span class="linenos">514</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph-515"><a href="#SkeletonGraph-515"><span class="linenos">515</span></a>            <span class="n">t_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">type_index</span><span class="p">)</span>
</span><span id="SkeletonGraph-516"><a href="#SkeletonGraph-516"><span class="linenos">516</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SkeletonGraph-517"><a href="#SkeletonGraph-517"><span class="linenos">517</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type_index must be an integer&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="SkeletonGraph-518"><a href="#SkeletonGraph-518"><span class="linenos">518</span></a>
</span><span id="SkeletonGraph-519"><a href="#SkeletonGraph-519"><span class="linenos">519</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
</span><span id="SkeletonGraph-520"><a href="#SkeletonGraph-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SkeletonGraph-521"><a href="#SkeletonGraph-521"><span class="linenos">521</span></a>            <span class="c1"># Write a minimal header file</span>
</span><span id="SkeletonGraph-522"><a href="#SkeletonGraph-522"><span class="linenos">522</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SkeletonGraph-523"><a href="#SkeletonGraph-523"><span class="linenos">523</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Empty SWC exported by DISCOS SkeletonGraph.to_swc</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-524"><a href="#SkeletonGraph-524"><span class="linenos">524</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Date: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-525"><a href="#SkeletonGraph-525"><span class="linenos">525</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Columns: n T x y z R p</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-526"><a href="#SkeletonGraph-526"><span class="linenos">526</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Type index (T) used for all samples: </span><span class="si">{</span><span class="n">t_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-527"><a href="#SkeletonGraph-527"><span class="linenos">527</span></a>            <span class="k">return</span>
</span><span id="SkeletonGraph-528"><a href="#SkeletonGraph-528"><span class="linenos">528</span></a>
</span><span id="SkeletonGraph-529"><a href="#SkeletonGraph-529"><span class="linenos">529</span></a>        <span class="c1"># Work on a copy when breaking cycles</span>
</span><span id="SkeletonGraph-530"><a href="#SkeletonGraph-530"><span class="linenos">530</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span><span id="SkeletonGraph-531"><a href="#SkeletonGraph-531"><span class="linenos">531</span></a>        <span class="n">H</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="SkeletonGraph-532"><a href="#SkeletonGraph-532"><span class="linenos">532</span></a>        <span class="n">H</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
</span><span id="SkeletonGraph-533"><a href="#SkeletonGraph-533"><span class="linenos">533</span></a>
</span><span id="SkeletonGraph-534"><a href="#SkeletonGraph-534"><span class="linenos">534</span></a>        <span class="n">removed_edges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-535"><a href="#SkeletonGraph-535"><span class="linenos">535</span></a>        <span class="n">duplicated_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-536"><a href="#SkeletonGraph-536"><span class="linenos">536</span></a>        <span class="c1"># Attributes for synthetic duplicate nodes (not present in self.G)</span>
</span><span id="SkeletonGraph-537"><a href="#SkeletonGraph-537"><span class="linenos">537</span></a>        <span class="n">extra_node_attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph-538"><a href="#SkeletonGraph-538"><span class="linenos">538</span></a>
</span><span id="SkeletonGraph-539"><a href="#SkeletonGraph-539"><span class="linenos">539</span></a>        <span class="c1"># Helper for generating unique integer IDs for duplicates</span>
</span><span id="SkeletonGraph-540"><a href="#SkeletonGraph-540"><span class="linenos">540</span></a>        <span class="n">max_int_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="SkeletonGraph-541"><a href="#SkeletonGraph-541"><span class="linenos">541</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph-542"><a href="#SkeletonGraph-542"><span class="linenos">542</span></a>            <span class="n">int_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]</span>
</span><span id="SkeletonGraph-543"><a href="#SkeletonGraph-543"><span class="linenos">543</span></a>            <span class="k">if</span> <span class="n">int_nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph-544"><a href="#SkeletonGraph-544"><span class="linenos">544</span></a>                <span class="n">max_int_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">int_nodes</span><span class="p">)</span>
</span><span id="SkeletonGraph-545"><a href="#SkeletonGraph-545"><span class="linenos">545</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="SkeletonGraph-546"><a href="#SkeletonGraph-546"><span class="linenos">546</span></a>            <span class="k">pass</span>
</span><span id="SkeletonGraph-547"><a href="#SkeletonGraph-547"><span class="linenos">547</span></a>        <span class="n">next_new_id</span> <span class="o">=</span> <span class="n">max_int_id</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SkeletonGraph-548"><a href="#SkeletonGraph-548"><span class="linenos">548</span></a>
</span><span id="SkeletonGraph-549"><a href="#SkeletonGraph-549"><span class="linenos">549</span></a>        <span class="c1"># Iteratively break cycles per selected mode</span>
</span><span id="SkeletonGraph-550"><a href="#SkeletonGraph-550"><span class="linenos">550</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SkeletonGraph-551"><a href="#SkeletonGraph-551"><span class="linenos">551</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph-552"><a href="#SkeletonGraph-552"><span class="linenos">552</span></a>                <span class="n">cycles</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">cycle_basis</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</span><span id="SkeletonGraph-553"><a href="#SkeletonGraph-553"><span class="linenos">553</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="SkeletonGraph-554"><a href="#SkeletonGraph-554"><span class="linenos">554</span></a>                <span class="n">cycles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-555"><a href="#SkeletonGraph-555"><span class="linenos">555</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cycles</span><span class="p">:</span>
</span><span id="SkeletonGraph-556"><a href="#SkeletonGraph-556"><span class="linenos">556</span></a>                <span class="k">break</span>
</span><span id="SkeletonGraph-557"><a href="#SkeletonGraph-557"><span class="linenos">557</span></a>
</span><span id="SkeletonGraph-558"><a href="#SkeletonGraph-558"><span class="linenos">558</span></a>            <span class="n">cyc</span> <span class="o">=</span> <span class="n">cycles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SkeletonGraph-559"><a href="#SkeletonGraph-559"><span class="linenos">559</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
</span><span id="SkeletonGraph-560"><a href="#SkeletonGraph-560"><span class="linenos">560</span></a>
</span><span id="SkeletonGraph-561"><a href="#SkeletonGraph-561"><span class="linenos">561</span></a>            <span class="k">if</span> <span class="n">cycle_mode</span> <span class="o">==</span> <span class="s2">&quot;duplicate_junction&quot;</span><span class="p">:</span>
</span><span id="SkeletonGraph-562"><a href="#SkeletonGraph-562"><span class="linenos">562</span></a>                <span class="c1"># Find a branching node in the cycle (pref degree&gt;2 in original G)</span>
</span><span id="SkeletonGraph-563"><a href="#SkeletonGraph-563"><span class="linenos">563</span></a>                <span class="n">b_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SkeletonGraph-564"><a href="#SkeletonGraph-564"><span class="linenos">564</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="SkeletonGraph-565"><a href="#SkeletonGraph-565"><span class="linenos">565</span></a>                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">cyc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph-566"><a href="#SkeletonGraph-566"><span class="linenos">566</span></a>                        <span class="n">b_idx</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="SkeletonGraph-567"><a href="#SkeletonGraph-567"><span class="linenos">567</span></a>                        <span class="k">break</span>
</span><span id="SkeletonGraph-568"><a href="#SkeletonGraph-568"><span class="linenos">568</span></a>                <span class="k">if</span> <span class="n">b_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-569"><a href="#SkeletonGraph-569"><span class="linenos">569</span></a>                    <span class="c1"># Fall back to highest-degree node in the cycle</span>
</span><span id="SkeletonGraph-570"><a href="#SkeletonGraph-570"><span class="linenos">570</span></a>                    <span class="n">b_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">cyc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="SkeletonGraph-571"><a href="#SkeletonGraph-571"><span class="linenos">571</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="n">b_idx</span><span class="p">]</span>
</span><span id="SkeletonGraph-572"><a href="#SkeletonGraph-572"><span class="linenos">572</span></a>                <span class="n">prev_n</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[(</span><span class="n">b_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">]</span>
</span><span id="SkeletonGraph-573"><a href="#SkeletonGraph-573"><span class="linenos">573</span></a>
</span><span id="SkeletonGraph-574"><a href="#SkeletonGraph-574"><span class="linenos">574</span></a>                <span class="c1"># Create a duplicate node with identical attributes</span>
</span><span id="SkeletonGraph-575"><a href="#SkeletonGraph-575"><span class="linenos">575</span></a>                <span class="n">dup_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">next_new_id</span>
</span><span id="SkeletonGraph-576"><a href="#SkeletonGraph-576"><span class="linenos">576</span></a>                <span class="n">next_new_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SkeletonGraph-577"><a href="#SkeletonGraph-577"><span class="linenos">577</span></a>                <span class="c1"># Copy essential attributes from G</span>
</span><span id="SkeletonGraph-578"><a href="#SkeletonGraph-578"><span class="linenos">578</span></a>                <span class="n">b_attrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
</span><span id="SkeletonGraph-579"><a href="#SkeletonGraph-579"><span class="linenos">579</span></a>                <span class="n">extra_node_attrs</span><span class="p">[</span><span class="n">dup_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SkeletonGraph-580"><a href="#SkeletonGraph-580"><span class="linenos">580</span></a>                    <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;junction&quot;</span><span class="p">),</span>
</span><span id="SkeletonGraph-581"><a href="#SkeletonGraph-581"><span class="linenos">581</span></a>                    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
</span><span id="SkeletonGraph-582"><a href="#SkeletonGraph-582"><span class="linenos">582</span></a>                    <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="SkeletonGraph-583"><a href="#SkeletonGraph-583"><span class="linenos">583</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="SkeletonGraph-584"><a href="#SkeletonGraph-584"><span class="linenos">584</span></a>                        <span class="k">if</span> <span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SkeletonGraph-585"><a href="#SkeletonGraph-585"><span class="linenos">585</span></a>                        <span class="k">else</span> <span class="kc">None</span>
</span><span id="SkeletonGraph-586"><a href="#SkeletonGraph-586"><span class="linenos">586</span></a>                    <span class="p">),</span>
</span><span id="SkeletonGraph-587"><a href="#SkeletonGraph-587"><span class="linenos">587</span></a>                    <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
</span><span id="SkeletonGraph-588"><a href="#SkeletonGraph-588"><span class="linenos">588</span></a>                    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
</span><span id="SkeletonGraph-589"><a href="#SkeletonGraph-589"><span class="linenos">589</span></a>                    <span class="s2">&quot;slice_index&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
</span><span id="SkeletonGraph-590"><a href="#SkeletonGraph-590"><span class="linenos">590</span></a>                    <span class="s2">&quot;cross_section_index&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cross_section_index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
</span><span id="SkeletonGraph-591"><a href="#SkeletonGraph-591"><span class="linenos">591</span></a>                <span class="p">}</span>
</span><span id="SkeletonGraph-592"><a href="#SkeletonGraph-592"><span class="linenos">592</span></a>
</span><span id="SkeletonGraph-593"><a href="#SkeletonGraph-593"><span class="linenos">593</span></a>                <span class="c1"># Rewire one incident cycle edge: (prev_n, b) -&gt; (prev_n, dup_id)</span>
</span><span id="SkeletonGraph-594"><a href="#SkeletonGraph-594"><span class="linenos">594</span></a>                <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="SkeletonGraph-595"><a href="#SkeletonGraph-595"><span class="linenos">595</span></a>                    <span class="c1"># Capture edge attributes for annotation from original G</span>
</span><span id="SkeletonGraph-596"><a href="#SkeletonGraph-596"><span class="linenos">596</span></a>                    <span class="n">eattrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</span><span id="SkeletonGraph-597"><a href="#SkeletonGraph-597"><span class="linenos">597</span></a>                    <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="SkeletonGraph-598"><a href="#SkeletonGraph-598"><span class="linenos">598</span></a>                        <span class="n">H</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="SkeletonGraph-599"><a href="#SkeletonGraph-599"><span class="linenos">599</span></a>                    <span class="n">H</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">dup_id</span><span class="p">)</span>
</span><span id="SkeletonGraph-600"><a href="#SkeletonGraph-600"><span class="linenos">600</span></a>                    <span class="n">H</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">dup_id</span><span class="p">)</span>
</span><span id="SkeletonGraph-601"><a href="#SkeletonGraph-601"><span class="linenos">601</span></a>                    <span class="n">duplicated_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SkeletonGraph-602"><a href="#SkeletonGraph-602"><span class="linenos">602</span></a>                        <span class="p">{</span>
</span><span id="SkeletonGraph-603"><a href="#SkeletonGraph-603"><span class="linenos">603</span></a>                            <span class="s2">&quot;orig&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="SkeletonGraph-604"><a href="#SkeletonGraph-604"><span class="linenos">604</span></a>                            <span class="s2">&quot;duplicate&quot;</span><span class="p">:</span> <span class="n">dup_id</span><span class="p">,</span>
</span><span id="SkeletonGraph-605"><a href="#SkeletonGraph-605"><span class="linenos">605</span></a>                            <span class="s2">&quot;redirected_from&quot;</span><span class="p">:</span> <span class="n">prev_n</span><span class="p">,</span>
</span><span id="SkeletonGraph-606"><a href="#SkeletonGraph-606"><span class="linenos">606</span></a>                            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="n">eattrs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">eattrs</span><span class="p">),</span>
</span><span id="SkeletonGraph-607"><a href="#SkeletonGraph-607"><span class="linenos">607</span></a>                        <span class="p">}</span>
</span><span id="SkeletonGraph-608"><a href="#SkeletonGraph-608"><span class="linenos">608</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph-609"><a href="#SkeletonGraph-609"><span class="linenos">609</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph-610"><a href="#SkeletonGraph-610"><span class="linenos">610</span></a>                    <span class="c1"># If the expected edge isn&#39;t present (unexpected), fall back to removal</span>
</span><span id="SkeletonGraph-611"><a href="#SkeletonGraph-611"><span class="linenos">611</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SkeletonGraph-612"><a href="#SkeletonGraph-612"><span class="linenos">612</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="n">m</span><span class="p">]</span>
</span><span id="SkeletonGraph-613"><a href="#SkeletonGraph-613"><span class="linenos">613</span></a>                    <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="SkeletonGraph-614"><a href="#SkeletonGraph-614"><span class="linenos">614</span></a>                        <span class="n">eattrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</span><span id="SkeletonGraph-615"><a href="#SkeletonGraph-615"><span class="linenos">615</span></a>                        <span class="n">removed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SkeletonGraph-616"><a href="#SkeletonGraph-616"><span class="linenos">616</span></a>                            <span class="p">{</span><span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="n">eattrs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">eattrs</span><span class="p">)}</span>
</span><span id="SkeletonGraph-617"><a href="#SkeletonGraph-617"><span class="linenos">617</span></a>                        <span class="p">)</span>
</span><span id="SkeletonGraph-618"><a href="#SkeletonGraph-618"><span class="linenos">618</span></a>                        <span class="n">H</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph-619"><a href="#SkeletonGraph-619"><span class="linenos">619</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph-620"><a href="#SkeletonGraph-620"><span class="linenos">620</span></a>                <span class="c1"># Default/remove_edge mode: remove one edge touching a branching node</span>
</span><span id="SkeletonGraph-621"><a href="#SkeletonGraph-621"><span class="linenos">621</span></a>                <span class="n">chosen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SkeletonGraph-622"><a href="#SkeletonGraph-622"><span class="linenos">622</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="SkeletonGraph-623"><a href="#SkeletonGraph-623"><span class="linenos">623</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="SkeletonGraph-624"><a href="#SkeletonGraph-624"><span class="linenos">624</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">]</span>
</span><span id="SkeletonGraph-625"><a href="#SkeletonGraph-625"><span class="linenos">625</span></a>                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph-626"><a href="#SkeletonGraph-626"><span class="linenos">626</span></a>                        <span class="n">chosen</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph-627"><a href="#SkeletonGraph-627"><span class="linenos">627</span></a>                        <span class="k">break</span>
</span><span id="SkeletonGraph-628"><a href="#SkeletonGraph-628"><span class="linenos">628</span></a>                <span class="k">if</span> <span class="n">chosen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-629"><a href="#SkeletonGraph-629"><span class="linenos">629</span></a>                    <span class="n">chosen</span> <span class="o">=</span> <span class="p">(</span><span class="n">cyc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cyc</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="n">m</span><span class="p">])</span>
</span><span id="SkeletonGraph-630"><a href="#SkeletonGraph-630"><span class="linenos">630</span></a>
</span><span id="SkeletonGraph-631"><a href="#SkeletonGraph-631"><span class="linenos">631</span></a>                <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">chosen</span>
</span><span id="SkeletonGraph-632"><a href="#SkeletonGraph-632"><span class="linenos">632</span></a>                <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="SkeletonGraph-633"><a href="#SkeletonGraph-633"><span class="linenos">633</span></a>                    <span class="n">eattrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</span><span id="SkeletonGraph-634"><a href="#SkeletonGraph-634"><span class="linenos">634</span></a>                    <span class="n">removed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SkeletonGraph-635"><a href="#SkeletonGraph-635"><span class="linenos">635</span></a>                        <span class="p">{</span><span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="n">eattrs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">eattrs</span><span class="p">)}</span>
</span><span id="SkeletonGraph-636"><a href="#SkeletonGraph-636"><span class="linenos">636</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph-637"><a href="#SkeletonGraph-637"><span class="linenos">637</span></a>                    <span class="n">H</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph-638"><a href="#SkeletonGraph-638"><span class="linenos">638</span></a>
</span><span id="SkeletonGraph-639"><a href="#SkeletonGraph-639"><span class="linenos">639</span></a>        <span class="c1"># Helper to get z-value for ordering and root selection</span>
</span><span id="SkeletonGraph-640"><a href="#SkeletonGraph-640"><span class="linenos">640</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_node_z</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="SkeletonGraph-641"><a href="#SkeletonGraph-641"><span class="linenos">641</span></a>            <span class="c1"># Prefer attributes from original graph; fall back to duplicates</span>
</span><span id="SkeletonGraph-642"><a href="#SkeletonGraph-642"><span class="linenos">642</span></a>            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph-643"><a href="#SkeletonGraph-643"><span class="linenos">643</span></a>                <span class="n">attrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</span><span id="SkeletonGraph-644"><a href="#SkeletonGraph-644"><span class="linenos">644</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph-645"><a href="#SkeletonGraph-645"><span class="linenos">645</span></a>                <span class="n">attrs</span> <span class="o">=</span> <span class="n">extra_node_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="SkeletonGraph-646"><a href="#SkeletonGraph-646"><span class="linenos">646</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-647"><a href="#SkeletonGraph-647"><span class="linenos">647</span></a>            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-648"><a href="#SkeletonGraph-648"><span class="linenos">648</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-649"><a href="#SkeletonGraph-649"><span class="linenos">649</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SkeletonGraph-650"><a href="#SkeletonGraph-650"><span class="linenos">650</span></a>                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="SkeletonGraph-651"><a href="#SkeletonGraph-651"><span class="linenos">651</span></a>                <span class="k">return</span> <span class="mf">0.0</span>
</span><span id="SkeletonGraph-652"><a href="#SkeletonGraph-652"><span class="linenos">652</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SkeletonGraph-653"><a href="#SkeletonGraph-653"><span class="linenos">653</span></a>
</span><span id="SkeletonGraph-654"><a href="#SkeletonGraph-654"><span class="linenos">654</span></a>        <span class="c1"># Build a BFS forest over each connected component to define parents</span>
</span><span id="SkeletonGraph-655"><a href="#SkeletonGraph-655"><span class="linenos">655</span></a>        <span class="n">components</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>
</span><span id="SkeletonGraph-656"><a href="#SkeletonGraph-656"><span class="linenos">656</span></a>        <span class="c1"># Sort components by their lowest z to make output stable</span>
</span><span id="SkeletonGraph-657"><a href="#SkeletonGraph-657"><span class="linenos">657</span></a>        <span class="n">components</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">comp</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">_node_z</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">))</span>
</span><span id="SkeletonGraph-658"><a href="#SkeletonGraph-658"><span class="linenos">658</span></a>
</span><span id="SkeletonGraph-659"><a href="#SkeletonGraph-659"><span class="linenos">659</span></a>        <span class="n">swc_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph-660"><a href="#SkeletonGraph-660"><span class="linenos">660</span></a>        <span class="n">rows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph-661"><a href="#SkeletonGraph-661"><span class="linenos">661</span></a>        <span class="n">idx_counter</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SkeletonGraph-662"><a href="#SkeletonGraph-662"><span class="linenos">662</span></a>
</span><span id="SkeletonGraph-663"><a href="#SkeletonGraph-663"><span class="linenos">663</span></a>        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
</span><span id="SkeletonGraph-664"><a href="#SkeletonGraph-664"><span class="linenos">664</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">comp</span><span class="p">:</span>
</span><span id="SkeletonGraph-665"><a href="#SkeletonGraph-665"><span class="linenos">665</span></a>                <span class="k">continue</span>
</span><span id="SkeletonGraph-666"><a href="#SkeletonGraph-666"><span class="linenos">666</span></a>            <span class="n">root</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_node_z</span><span class="p">)</span>
</span><span id="SkeletonGraph-667"><a href="#SkeletonGraph-667"><span class="linenos">667</span></a>            <span class="c1"># Directed BFS tree rooted at root</span>
</span><span id="SkeletonGraph-668"><a href="#SkeletonGraph-668"><span class="linenos">668</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">bfs_tree</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
</span><span id="SkeletonGraph-669"><a href="#SkeletonGraph-669"><span class="linenos">669</span></a>            <span class="n">predecessors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SkeletonGraph-670"><a href="#SkeletonGraph-670"><span class="linenos">670</span></a>                <span class="n">child</span><span class="p">:</span> <span class="n">parent</span> <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">bfs_predecessors</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
</span><span id="SkeletonGraph-671"><a href="#SkeletonGraph-671"><span class="linenos">671</span></a>            <span class="p">}</span>
</span><span id="SkeletonGraph-672"><a href="#SkeletonGraph-672"><span class="linenos">672</span></a>
</span><span id="SkeletonGraph-673"><a href="#SkeletonGraph-673"><span class="linenos">673</span></a>            <span class="c1"># Iterate nodes in a parent-before-children order</span>
</span><span id="SkeletonGraph-674"><a href="#SkeletonGraph-674"><span class="linenos">674</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
</span><span id="SkeletonGraph-675"><a href="#SkeletonGraph-675"><span class="linenos">675</span></a>            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
</span><span id="SkeletonGraph-676"><a href="#SkeletonGraph-676"><span class="linenos">676</span></a>                <span class="c1"># Prefer attributes from original graph; fall back to duplicate attrs</span>
</span><span id="SkeletonGraph-677"><a href="#SkeletonGraph-677"><span class="linenos">677</span></a>                <span class="n">attrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">else</span> <span class="n">extra_node_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="SkeletonGraph-678"><a href="#SkeletonGraph-678"><span class="linenos">678</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-679"><a href="#SkeletonGraph-679"><span class="linenos">679</span></a>                <span class="n">r</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SkeletonGraph-680"><a href="#SkeletonGraph-680"><span class="linenos">680</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SkeletonGraph-681"><a href="#SkeletonGraph-681"><span class="linenos">681</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SkeletonGraph-682"><a href="#SkeletonGraph-682"><span class="linenos">682</span></a>                        <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">n</span><span class="si">!r}</span><span class="s2"> is missing a 3D center; cannot export to SWC&quot;</span>
</span><span id="SkeletonGraph-683"><a href="#SkeletonGraph-683"><span class="linenos">683</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph-684"><a href="#SkeletonGraph-684"><span class="linenos">684</span></a>
</span><span id="SkeletonGraph-685"><a href="#SkeletonGraph-685"><span class="linenos">685</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="SkeletonGraph-686"><a href="#SkeletonGraph-686"><span class="linenos">686</span></a>
</span><span id="SkeletonGraph-687"><a href="#SkeletonGraph-687"><span class="linenos">687</span></a>                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
</span><span id="SkeletonGraph-688"><a href="#SkeletonGraph-688"><span class="linenos">688</span></a>                    <span class="n">parent_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="SkeletonGraph-689"><a href="#SkeletonGraph-689"><span class="linenos">689</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph-690"><a href="#SkeletonGraph-690"><span class="linenos">690</span></a>                    <span class="n">p</span> <span class="o">=</span> <span class="n">predecessors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="SkeletonGraph-691"><a href="#SkeletonGraph-691"><span class="linenos">691</span></a>                    <span class="c1"># If predecessor is missing for some reason, fall back to root</span>
</span><span id="SkeletonGraph-692"><a href="#SkeletonGraph-692"><span class="linenos">692</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph-693"><a href="#SkeletonGraph-693"><span class="linenos">693</span></a>                        <span class="n">p</span> <span class="o">=</span> <span class="n">root</span>
</span><span id="SkeletonGraph-694"><a href="#SkeletonGraph-694"><span class="linenos">694</span></a>                    <span class="n">parent_idx</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SkeletonGraph-695"><a href="#SkeletonGraph-695"><span class="linenos">695</span></a>
</span><span id="SkeletonGraph-696"><a href="#SkeletonGraph-696"><span class="linenos">696</span></a>                <span class="n">swc_index</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_counter</span>
</span><span id="SkeletonGraph-697"><a href="#SkeletonGraph-697"><span class="linenos">697</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idx_counter</span><span class="p">,</span> <span class="n">t_code</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent_idx</span><span class="p">)))</span>
</span><span id="SkeletonGraph-698"><a href="#SkeletonGraph-698"><span class="linenos">698</span></a>                <span class="n">idx_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SkeletonGraph-699"><a href="#SkeletonGraph-699"><span class="linenos">699</span></a>
</span><span id="SkeletonGraph-700"><a href="#SkeletonGraph-700"><span class="linenos">700</span></a>        <span class="c1"># Write the SWC file</span>
</span><span id="SkeletonGraph-701"><a href="#SkeletonGraph-701"><span class="linenos">701</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SkeletonGraph-702"><a href="#SkeletonGraph-702"><span class="linenos">702</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# SWC exported by DISCOS SkeletonGraph.to_swc</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-703"><a href="#SkeletonGraph-703"><span class="linenos">703</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Date: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-704"><a href="#SkeletonGraph-704"><span class="linenos">704</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Columns: n T x y z R p</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-705"><a href="#SkeletonGraph-705"><span class="linenos">705</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Type index (T) used for all samples: </span><span class="si">{</span><span class="n">t_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-706"><a href="#SkeletonGraph-706"><span class="linenos">706</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SkeletonGraph-707"><a href="#SkeletonGraph-707"><span class="linenos">707</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph-708"><a href="#SkeletonGraph-708"><span class="linenos">708</span></a>                    <span class="sa">f</span><span class="s2">&quot;# Note: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> disconnected components were serialized; each begins with a root (parent -1).</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph-709"><a href="#SkeletonGraph-709"><span class="linenos">709</span></a>                <span class="p">)</span>
</span><span id="SkeletonGraph-710"><a href="#SkeletonGraph-710"><span class="linenos">710</span></a>            <span class="k">if</span> <span class="n">annotate_cycles</span><span class="p">:</span>
</span><span id="SkeletonGraph-711"><a href="#SkeletonGraph-711"><span class="linenos">711</span></a>                <span class="k">if</span> <span class="n">removed_edges</span><span class="p">:</span>
</span><span id="SkeletonGraph-712"><a href="#SkeletonGraph-712"><span class="linenos">712</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph-713"><a href="#SkeletonGraph-713"><span class="linenos">713</span></a>                        <span class="sa">f</span><span class="s2">&quot;# Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">removed_edges</span><span class="p">)</span><span class="si">}</span><span class="s2"> edge(s) to break cycles for SWC format.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph-714"><a href="#SkeletonGraph-714"><span class="linenos">714</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph-715"><a href="#SkeletonGraph-715"><span class="linenos">715</span></a>                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">removed_edges</span><span class="p">:</span>
</span><span id="SkeletonGraph-716"><a href="#SkeletonGraph-716"><span class="linenos">716</span></a>                        <span class="n">u</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-717"><a href="#SkeletonGraph-717"><span class="linenos">717</span></a>                        <span class="n">v</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-718"><a href="#SkeletonGraph-718"><span class="linenos">718</span></a>                        <span class="n">su</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="SkeletonGraph-719"><a href="#SkeletonGraph-719"><span class="linenos">719</span></a>                        <span class="n">sv</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph-720"><a href="#SkeletonGraph-720"><span class="linenos">720</span></a>                        <span class="n">seg_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-721"><a href="#SkeletonGraph-721"><span class="linenos">721</span></a>                        <span class="n">slice_idx</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-722"><a href="#SkeletonGraph-722"><span class="linenos">722</span></a>                        <span class="n">z_low</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_lower&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-723"><a href="#SkeletonGraph-723"><span class="linenos">723</span></a>                        <span class="n">z_up</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_upper&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-724"><a href="#SkeletonGraph-724"><span class="linenos">724</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph-725"><a href="#SkeletonGraph-725"><span class="linenos">725</span></a>                            <span class="s2">&quot;# cycle_edge_removed &quot;</span>
</span><span id="SkeletonGraph-726"><a href="#SkeletonGraph-726"><span class="linenos">726</span></a>                            <span class="sa">f</span><span class="s2">&quot;u_jid=</span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> v_jid=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> u_swc=</span><span class="si">{</span><span class="n">su</span><span class="si">}</span><span class="s2"> v_swc=</span><span class="si">{</span><span class="n">sv</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="SkeletonGraph-727"><a href="#SkeletonGraph-727"><span class="linenos">727</span></a>                            <span class="sa">f</span><span class="s2">&quot;segment_id=</span><span class="si">{</span><span class="n">seg_id</span><span class="si">}</span><span class="s2"> slice_index=</span><span class="si">{</span><span class="n">slice_idx</span><span class="si">}</span><span class="s2"> z_lower=</span><span class="si">{</span><span class="n">z_low</span><span class="si">}</span><span class="s2"> z_upper=</span><span class="si">{</span><span class="n">z_up</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph-728"><a href="#SkeletonGraph-728"><span class="linenos">728</span></a>                        <span class="p">)</span>
</span><span id="SkeletonGraph-729"><a href="#SkeletonGraph-729"><span class="linenos">729</span></a>                <span class="k">if</span> <span class="n">duplicated_nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph-730"><a href="#SkeletonGraph-730"><span class="linenos">730</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph-731"><a href="#SkeletonGraph-731"><span class="linenos">731</span></a>                        <span class="sa">f</span><span class="s2">&quot;# Duplicated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicated_nodes</span><span class="p">)</span><span class="si">}</span><span class="s2"> junction node(s) to break cycles for SWC format.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph-732"><a href="#SkeletonGraph-732"><span class="linenos">732</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph-733"><a href="#SkeletonGraph-733"><span class="linenos">733</span></a>                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">duplicated_nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph-734"><a href="#SkeletonGraph-734"><span class="linenos">734</span></a>                        <span class="n">orig</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;orig&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-735"><a href="#SkeletonGraph-735"><span class="linenos">735</span></a>                        <span class="n">dup</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duplicate&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-736"><a href="#SkeletonGraph-736"><span class="linenos">736</span></a>                        <span class="n">redirected_from</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;redirected_from&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-737"><a href="#SkeletonGraph-737"><span class="linenos">737</span></a>                        <span class="n">s_orig</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
</span><span id="SkeletonGraph-738"><a href="#SkeletonGraph-738"><span class="linenos">738</span></a>                        <span class="n">s_dup</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span>
</span><span id="SkeletonGraph-739"><a href="#SkeletonGraph-739"><span class="linenos">739</span></a>                        <span class="n">s_from</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">redirected_from</span><span class="p">)</span>
</span><span id="SkeletonGraph-740"><a href="#SkeletonGraph-740"><span class="linenos">740</span></a>                        <span class="n">seg_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-741"><a href="#SkeletonGraph-741"><span class="linenos">741</span></a>                        <span class="n">slice_idx</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-742"><a href="#SkeletonGraph-742"><span class="linenos">742</span></a>                        <span class="n">z_low</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_lower&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-743"><a href="#SkeletonGraph-743"><span class="linenos">743</span></a>                        <span class="n">z_up</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_upper&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph-744"><a href="#SkeletonGraph-744"><span class="linenos">744</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph-745"><a href="#SkeletonGraph-745"><span class="linenos">745</span></a>                            <span class="s2">&quot;# cycle_node_duplicated &quot;</span>
</span><span id="SkeletonGraph-746"><a href="#SkeletonGraph-746"><span class="linenos">746</span></a>                            <span class="sa">f</span><span class="s2">&quot;orig_jid=</span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2"> dup_id=</span><span class="si">{</span><span class="n">dup</span><span class="si">}</span><span class="s2"> from_jid=</span><span class="si">{</span><span class="n">redirected_from</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="SkeletonGraph-747"><a href="#SkeletonGraph-747"><span class="linenos">747</span></a>                            <span class="sa">f</span><span class="s2">&quot;orig_swc=</span><span class="si">{</span><span class="n">s_orig</span><span class="si">}</span><span class="s2"> dup_swc=</span><span class="si">{</span><span class="n">s_dup</span><span class="si">}</span><span class="s2"> from_swc=</span><span class="si">{</span><span class="n">s_from</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="SkeletonGraph-748"><a href="#SkeletonGraph-748"><span class="linenos">748</span></a>                            <span class="sa">f</span><span class="s2">&quot;segment_id=</span><span class="si">{</span><span class="n">seg_id</span><span class="si">}</span><span class="s2"> slice_index=</span><span class="si">{</span><span class="n">slice_idx</span><span class="si">}</span><span class="s2"> z_lower=</span><span class="si">{</span><span class="n">z_low</span><span class="si">}</span><span class="s2"> z_upper=</span><span class="si">{</span><span class="n">z_up</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph-749"><a href="#SkeletonGraph-749"><span class="linenos">749</span></a>                        <span class="p">)</span>
</span><span id="SkeletonGraph-750"><a href="#SkeletonGraph-750"><span class="linenos">750</span></a>
</span><span id="SkeletonGraph-751"><a href="#SkeletonGraph-751"><span class="linenos">751</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">T_code</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</span><span id="SkeletonGraph-752"><a href="#SkeletonGraph-752"><span class="linenos">752</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">T_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">R</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Graph where nodes are <code>Junction</code>s and edges correspond to cylinder-like
segments connecting nodes on adjacent cuts only.</p>
</div>


                            <div id="SkeletonGraph.G" class="classattr">
                                <div class="attr variable">
            <span class="name">G</span>

        
    </div>
    <a class="headerlink" href="#SkeletonGraph.G"></a>
    
    

                            </div>
                            <div id="SkeletonGraph.junctions" class="classattr">
                                <div class="attr variable">
            <span class="name">junctions</span><span class="annotation">: Dict[int, discos.skeleton.Junction]</span>

        
    </div>
    <a class="headerlink" href="#SkeletonGraph.junctions"></a>
    
    

                            </div>
                            <div id="SkeletonGraph.cross_sections" class="classattr">
                                <div class="attr variable">
            <span class="name">cross_sections</span><span class="annotation">: List[<a href="#CrossSection">CrossSection</a>]</span>

        
    </div>
    <a class="headerlink" href="#SkeletonGraph.cross_sections"></a>
    
    

                            </div>
                            <div id="SkeletonGraph.segments" class="classattr">
                                <div class="attr variable">
            <span class="name">segments</span><span class="annotation">: List[<a href="#Segment">Segment</a>]</span>

        
    </div>
    <a class="headerlink" href="#SkeletonGraph.segments"></a>
    
    

                            </div>
                            <div id="SkeletonGraph.add_junction" class="classattr">
                                        <input id="SkeletonGraph.add_junction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_junction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">j</span><span class="p">:</span> <span class="n">discos</span><span class="o">.</span><span class="n">skeleton</span><span class="o">.</span><span class="n">Junction</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SkeletonGraph.add_junction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.add_junction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.add_junction-166"><a href="#SkeletonGraph.add_junction-166"><span class="linenos">166</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_junction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">Junction</span><span class="p">):</span>
</span><span id="SkeletonGraph.add_junction-167"><a href="#SkeletonGraph.add_junction-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
</span><span id="SkeletonGraph.add_junction-168"><a href="#SkeletonGraph.add_junction-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
</span><span id="SkeletonGraph.add_junction-169"><a href="#SkeletonGraph.add_junction-169"><span class="linenos">169</span></a>            <span class="n">j</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="SkeletonGraph.add_junction-170"><a href="#SkeletonGraph.add_junction-170"><span class="linenos">170</span></a>            <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;junction&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.add_junction-171"><a href="#SkeletonGraph.add_junction-171"><span class="linenos">171</span></a>            <span class="n">z</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">z</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_junction-172"><a href="#SkeletonGraph.add_junction-172"><span class="linenos">172</span></a>            <span class="n">center</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_junction-173"><a href="#SkeletonGraph.add_junction-173"><span class="linenos">173</span></a>            <span class="n">radius</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">radius</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_junction-174"><a href="#SkeletonGraph.add_junction-174"><span class="linenos">174</span></a>            <span class="n">area</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">area</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_junction-175"><a href="#SkeletonGraph.add_junction-175"><span class="linenos">175</span></a>            <span class="n">slice_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">slice_index</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_junction-176"><a href="#SkeletonGraph.add_junction-176"><span class="linenos">176</span></a>            <span class="n">cross_section_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">cross_section_index</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_junction-177"><a href="#SkeletonGraph.add_junction-177"><span class="linenos">177</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SkeletonGraph.add_segment_edges" class="classattr">
                                        <input id="SkeletonGraph.add_segment_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_segment_edges</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seg</span><span class="p">:</span> <span class="n"><a href="#Segment">Segment</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SkeletonGraph.add_segment_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.add_segment_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.add_segment_edges-179"><a href="#SkeletonGraph.add_segment_edges-179"><span class="linenos">179</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_segment_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">:</span> <span class="n">Segment</span><span class="p">):</span>
</span><span id="SkeletonGraph.add_segment_edges-180"><a href="#SkeletonGraph.add_segment_edges-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
</span><span id="SkeletonGraph.add_segment_edges-181"><a href="#SkeletonGraph.add_segment_edges-181"><span class="linenos">181</span></a>        <span class="c1"># Connect all lower to all upper (supports branching). Adjacent slices only.</span>
</span><span id="SkeletonGraph.add_segment_edges-182"><a href="#SkeletonGraph.add_segment_edges-182"><span class="linenos">182</span></a>        <span class="k">for</span> <span class="n">jl</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">lower_junction_ids</span><span class="p">:</span>
</span><span id="SkeletonGraph.add_segment_edges-183"><a href="#SkeletonGraph.add_segment_edges-183"><span class="linenos">183</span></a>            <span class="k">for</span> <span class="n">ju</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">upper_junction_ids</span><span class="p">:</span>
</span><span id="SkeletonGraph.add_segment_edges-184"><a href="#SkeletonGraph.add_segment_edges-184"><span class="linenos">184</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
</span><span id="SkeletonGraph.add_segment_edges-185"><a href="#SkeletonGraph.add_segment_edges-185"><span class="linenos">185</span></a>                    <span class="n">jl</span><span class="p">,</span>
</span><span id="SkeletonGraph.add_segment_edges-186"><a href="#SkeletonGraph.add_segment_edges-186"><span class="linenos">186</span></a>                    <span class="n">ju</span><span class="p">,</span>
</span><span id="SkeletonGraph.add_segment_edges-187"><a href="#SkeletonGraph.add_segment_edges-187"><span class="linenos">187</span></a>                    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;segment&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.add_segment_edges-188"><a href="#SkeletonGraph.add_segment_edges-188"><span class="linenos">188</span></a>                    <span class="n">segment_id</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_segment_edges-189"><a href="#SkeletonGraph.add_segment_edges-189"><span class="linenos">189</span></a>                    <span class="n">slice_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">slice_index</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_segment_edges-190"><a href="#SkeletonGraph.add_segment_edges-190"><span class="linenos">190</span></a>                    <span class="n">z_lower</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">z_lower</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_segment_edges-191"><a href="#SkeletonGraph.add_segment_edges-191"><span class="linenos">191</span></a>                    <span class="n">z_upper</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">z_upper</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_segment_edges-192"><a href="#SkeletonGraph.add_segment_edges-192"><span class="linenos">192</span></a>                    <span class="n">volume</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">volume</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_segment_edges-193"><a href="#SkeletonGraph.add_segment_edges-193"><span class="linenos">193</span></a>                    <span class="n">surface_area</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">surface_area</span><span class="p">),</span>
</span><span id="SkeletonGraph.add_segment_edges-194"><a href="#SkeletonGraph.add_segment_edges-194"><span class="linenos">194</span></a>                <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SkeletonGraph.to_networkx" class="classattr">
                                        <input id="SkeletonGraph.to_networkx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_networkx</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">networkx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span>:</span></span>

                <label class="view-source-button" for="SkeletonGraph.to_networkx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.to_networkx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.to_networkx-196"><a href="#SkeletonGraph.to_networkx-196"><span class="linenos">196</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_networkx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_networkx-197"><a href="#SkeletonGraph.to_networkx-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
</span></pre></div>


    

                            </div>
                            <div id="SkeletonGraph.draw" class="classattr">
                                        <input id="SkeletonGraph.draw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">draw</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>,</span><span class="param">	<span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">with_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">node_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">node_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C0&#39;</span>,</span><span class="param">	<span class="n">edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;0.6&#39;</span>,</span><span class="param">	<span class="n">min_hv_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>,</span><span class="param">	<span class="n">pad_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="SkeletonGraph.draw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.draw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.draw-200"><a href="#SkeletonGraph.draw-200"><span class="linenos">200</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">draw</span><span class="p">(</span>
</span><span id="SkeletonGraph.draw-201"><a href="#SkeletonGraph.draw-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-202"><a href="#SkeletonGraph.draw-202"><span class="linenos">202</span></a>        <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-203"><a href="#SkeletonGraph.draw-203"><span class="linenos">203</span></a>        <span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-204"><a href="#SkeletonGraph.draw-204"><span class="linenos">204</span></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-205"><a href="#SkeletonGraph.draw-205"><span class="linenos">205</span></a>        <span class="n">with_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-206"><a href="#SkeletonGraph.draw-206"><span class="linenos">206</span></a>        <span class="n">node_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-207"><a href="#SkeletonGraph.draw-207"><span class="linenos">207</span></a>        <span class="n">node_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C0&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-208"><a href="#SkeletonGraph.draw-208"><span class="linenos">208</span></a>        <span class="n">edge_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0.6&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-209"><a href="#SkeletonGraph.draw-209"><span class="linenos">209</span></a>        <span class="n">min_hv_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-210"><a href="#SkeletonGraph.draw-210"><span class="linenos">210</span></a>        <span class="n">pad_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-211"><a href="#SkeletonGraph.draw-211"><span class="linenos">211</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-212"><a href="#SkeletonGraph.draw-212"><span class="linenos">212</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-213"><a href="#SkeletonGraph.draw-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw the skeleton graph in 2D using (x,z) or (y,z) coordinates.</span>
</span><span id="SkeletonGraph.draw-214"><a href="#SkeletonGraph.draw-214"><span class="linenos">214</span></a>
</span><span id="SkeletonGraph.draw-215"><a href="#SkeletonGraph.draw-215"><span class="linenos">215</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph.draw-216"><a href="#SkeletonGraph.draw-216"><span class="linenos">216</span></a><span class="sd">            axis: Horizontal axis to use (&quot;x&quot; or &quot;y&quot;). Vertical axis is always z.</span>
</span><span id="SkeletonGraph.draw-217"><a href="#SkeletonGraph.draw-217"><span class="linenos">217</span></a><span class="sd">            ax: Optional matplotlib Axes to draw into. If None, a new figure/axes is created.</span>
</span><span id="SkeletonGraph.draw-218"><a href="#SkeletonGraph.draw-218"><span class="linenos">218</span></a><span class="sd">            figsize: Optional (width, height) in inches when creating a new figure.</span>
</span><span id="SkeletonGraph.draw-219"><a href="#SkeletonGraph.draw-219"><span class="linenos">219</span></a><span class="sd">            with_labels: Whether to render node labels.</span>
</span><span id="SkeletonGraph.draw-220"><a href="#SkeletonGraph.draw-220"><span class="linenos">220</span></a><span class="sd">            node_size: Node marker size passed to networkx.draw.</span>
</span><span id="SkeletonGraph.draw-221"><a href="#SkeletonGraph.draw-221"><span class="linenos">221</span></a><span class="sd">            node_color: Node color.</span>
</span><span id="SkeletonGraph.draw-222"><a href="#SkeletonGraph.draw-222"><span class="linenos">222</span></a><span class="sd">            edge_color: Edge color.</span>
</span><span id="SkeletonGraph.draw-223"><a href="#SkeletonGraph.draw-223"><span class="linenos">223</span></a><span class="sd">            min_hv_ratio: Minimum desired horizontal-to-vertical data range ratio.</span>
</span><span id="SkeletonGraph.draw-224"><a href="#SkeletonGraph.draw-224"><span class="linenos">224</span></a><span class="sd">                If the horizontal data span is less than this ratio times the</span>
</span><span id="SkeletonGraph.draw-225"><a href="#SkeletonGraph.draw-225"><span class="linenos">225</span></a><span class="sd">                vertical (z) span, x/y limits are expanded around the mean to</span>
</span><span id="SkeletonGraph.draw-226"><a href="#SkeletonGraph.draw-226"><span class="linenos">226</span></a><span class="sd">                meet this minimum. Helps avoid an overly thin vertical line.</span>
</span><span id="SkeletonGraph.draw-227"><a href="#SkeletonGraph.draw-227"><span class="linenos">227</span></a><span class="sd">            pad_frac: Fractional padding added to both axes limits for readability.</span>
</span><span id="SkeletonGraph.draw-228"><a href="#SkeletonGraph.draw-228"><span class="linenos">228</span></a><span class="sd">            **kwargs: Additional kwargs forwarded to networkx.draw.</span>
</span><span id="SkeletonGraph.draw-229"><a href="#SkeletonGraph.draw-229"><span class="linenos">229</span></a>
</span><span id="SkeletonGraph.draw-230"><a href="#SkeletonGraph.draw-230"><span class="linenos">230</span></a><span class="sd">        Returns:</span>
</span><span id="SkeletonGraph.draw-231"><a href="#SkeletonGraph.draw-231"><span class="linenos">231</span></a><span class="sd">            The matplotlib Axes used for drawing.</span>
</span><span id="SkeletonGraph.draw-232"><a href="#SkeletonGraph.draw-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph.draw-233"><a href="#SkeletonGraph.draw-233"><span class="linenos">233</span></a>        <span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="SkeletonGraph.draw-234"><a href="#SkeletonGraph.draw-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">):</span>
</span><span id="SkeletonGraph.draw-235"><a href="#SkeletonGraph.draw-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axis must be &#39;x&#39; or &#39;y&#39;&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-236"><a href="#SkeletonGraph.draw-236"><span class="linenos">236</span></a>
</span><span id="SkeletonGraph.draw-237"><a href="#SkeletonGraph.draw-237"><span class="linenos">237</span></a>        <span class="c1"># Build 2D positions from node 3D centers</span>
</span><span id="SkeletonGraph.draw-238"><a href="#SkeletonGraph.draw-238"><span class="linenos">238</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span> <span class="k">else</span> <span class="mi">1</span>
</span><span id="SkeletonGraph.draw-239"><a href="#SkeletonGraph.draw-239"><span class="linenos">239</span></a>        <span class="n">pos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph.draw-240"><a href="#SkeletonGraph.draw-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SkeletonGraph.draw-241"><a href="#SkeletonGraph.draw-241"><span class="linenos">241</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-242"><a href="#SkeletonGraph.draw-242"><span class="linenos">242</span></a>            <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-243"><a href="#SkeletonGraph.draw-243"><span class="linenos">243</span></a>                <span class="k">continue</span>
</span><span id="SkeletonGraph.draw-244"><a href="#SkeletonGraph.draw-244"><span class="linenos">244</span></a>            <span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>  <span class="c1"># (x|y, z)</span>
</span><span id="SkeletonGraph.draw-245"><a href="#SkeletonGraph.draw-245"><span class="linenos">245</span></a>
</span><span id="SkeletonGraph.draw-246"><a href="#SkeletonGraph.draw-246"><span class="linenos">246</span></a>        <span class="c1"># Compute data bounds</span>
</span><span id="SkeletonGraph.draw-247"><a href="#SkeletonGraph.draw-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-248"><a href="#SkeletonGraph.draw-248"><span class="linenos">248</span></a>            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-249"><a href="#SkeletonGraph.draw-249"><span class="linenos">249</span></a>                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-250"><a href="#SkeletonGraph.draw-250"><span class="linenos">250</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> (horizontal)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-251"><a href="#SkeletonGraph.draw-251"><span class="linenos">251</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z (vertical)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-252"><a href="#SkeletonGraph.draw-252"><span class="linenos">252</span></a>            <span class="k">return</span> <span class="n">ax</span>
</span><span id="SkeletonGraph.draw-253"><a href="#SkeletonGraph.draw-253"><span class="linenos">253</span></a>
</span><span id="SkeletonGraph.draw-254"><a href="#SkeletonGraph.draw-254"><span class="linenos">254</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-255"><a href="#SkeletonGraph.draw-255"><span class="linenos">255</span></a>        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-256"><a href="#SkeletonGraph.draw-256"><span class="linenos">256</span></a>        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="SkeletonGraph.draw-257"><a href="#SkeletonGraph.draw-257"><span class="linenos">257</span></a>        <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">zs</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="nb">float</span><span class="p">(</span><span class="n">zs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="SkeletonGraph.draw-258"><a href="#SkeletonGraph.draw-258"><span class="linenos">258</span></a>        <span class="n">xmid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xmax</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-259"><a href="#SkeletonGraph.draw-259"><span class="linenos">259</span></a>        <span class="n">zmid</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">zmin</span> <span class="o">+</span> <span class="n">zmax</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-260"><a href="#SkeletonGraph.draw-260"><span class="linenos">260</span></a>        <span class="n">xr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-261"><a href="#SkeletonGraph.draw-261"><span class="linenos">261</span></a>        <span class="n">zr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-262"><a href="#SkeletonGraph.draw-262"><span class="linenos">262</span></a>
</span><span id="SkeletonGraph.draw-263"><a href="#SkeletonGraph.draw-263"><span class="linenos">263</span></a>        <span class="c1"># Enforce a minimum horizontal span relative to vertical span</span>
</span><span id="SkeletonGraph.draw-264"><a href="#SkeletonGraph.draw-264"><span class="linenos">264</span></a>        <span class="n">min_xr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_hv_ratio</span> <span class="o">*</span> <span class="n">zr</span><span class="p">,</span> <span class="n">xr</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-265"><a href="#SkeletonGraph.draw-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="n">min_xr</span> <span class="o">&gt;</span> <span class="n">xr</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-266"><a href="#SkeletonGraph.draw-266"><span class="linenos">266</span></a>            <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmid</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">min_xr</span>
</span><span id="SkeletonGraph.draw-267"><a href="#SkeletonGraph.draw-267"><span class="linenos">267</span></a>            <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmid</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">min_xr</span>
</span><span id="SkeletonGraph.draw-268"><a href="#SkeletonGraph.draw-268"><span class="linenos">268</span></a>            <span class="n">xr</span> <span class="o">=</span> <span class="n">min_xr</span>
</span><span id="SkeletonGraph.draw-269"><a href="#SkeletonGraph.draw-269"><span class="linenos">269</span></a>
</span><span id="SkeletonGraph.draw-270"><a href="#SkeletonGraph.draw-270"><span class="linenos">270</span></a>        <span class="c1"># Apply padding</span>
</span><span id="SkeletonGraph.draw-271"><a href="#SkeletonGraph.draw-271"><span class="linenos">271</span></a>        <span class="n">xmin</span> <span class="o">-=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">xr</span>
</span><span id="SkeletonGraph.draw-272"><a href="#SkeletonGraph.draw-272"><span class="linenos">272</span></a>        <span class="n">xmax</span> <span class="o">+=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">xr</span>
</span><span id="SkeletonGraph.draw-273"><a href="#SkeletonGraph.draw-273"><span class="linenos">273</span></a>        <span class="n">zmin</span> <span class="o">-=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">zr</span>
</span><span id="SkeletonGraph.draw-274"><a href="#SkeletonGraph.draw-274"><span class="linenos">274</span></a>        <span class="n">zmax</span> <span class="o">+=</span> <span class="n">pad_frac</span> <span class="o">*</span> <span class="n">zr</span>
</span><span id="SkeletonGraph.draw-275"><a href="#SkeletonGraph.draw-275"><span class="linenos">275</span></a>
</span><span id="SkeletonGraph.draw-276"><a href="#SkeletonGraph.draw-276"><span class="linenos">276</span></a>        <span class="c1"># Prepare axes</span>
</span><span id="SkeletonGraph.draw-277"><a href="#SkeletonGraph.draw-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-278"><a href="#SkeletonGraph.draw-278"><span class="linenos">278</span></a>            <span class="c1"># Auto figsize that respects data aspect for clarity</span>
</span><span id="SkeletonGraph.draw-279"><a href="#SkeletonGraph.draw-279"><span class="linenos">279</span></a>            <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-280"><a href="#SkeletonGraph.draw-280"><span class="linenos">280</span></a>                <span class="c1"># Base height and width with reasonable minimums</span>
</span><span id="SkeletonGraph.draw-281"><a href="#SkeletonGraph.draw-281"><span class="linenos">281</span></a>                <span class="n">base_h</span> <span class="o">=</span> <span class="mf">4.0</span>
</span><span id="SkeletonGraph.draw-282"><a href="#SkeletonGraph.draw-282"><span class="linenos">282</span></a>                <span class="c1"># width scaled by data aspect (horizontal over vertical)</span>
</span><span id="SkeletonGraph.draw-283"><a href="#SkeletonGraph.draw-283"><span class="linenos">283</span></a>                <span class="n">aspect</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">/</span> <span class="n">zr</span> <span class="k">if</span> <span class="n">zr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="SkeletonGraph.draw-284"><a href="#SkeletonGraph.draw-284"><span class="linenos">284</span></a>                <span class="n">base_w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">base_h</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span> <span class="n">min_hv_ratio</span><span class="p">))</span>
</span><span id="SkeletonGraph.draw-285"><a href="#SkeletonGraph.draw-285"><span class="linenos">285</span></a>                <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_w</span><span class="p">,</span> <span class="n">base_h</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-286"><a href="#SkeletonGraph.draw-286"><span class="linenos">286</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-287"><a href="#SkeletonGraph.draw-287"><span class="linenos">287</span></a>
</span><span id="SkeletonGraph.draw-288"><a href="#SkeletonGraph.draw-288"><span class="linenos">288</span></a>        <span class="c1"># Draw using networkx helper</span>
</span><span id="SkeletonGraph.draw-289"><a href="#SkeletonGraph.draw-289"><span class="linenos">289</span></a>        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
</span><span id="SkeletonGraph.draw-290"><a href="#SkeletonGraph.draw-290"><span class="linenos">290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-291"><a href="#SkeletonGraph.draw-291"><span class="linenos">291</span></a>            <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-292"><a href="#SkeletonGraph.draw-292"><span class="linenos">292</span></a>            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-293"><a href="#SkeletonGraph.draw-293"><span class="linenos">293</span></a>            <span class="n">with_labels</span><span class="o">=</span><span class="n">with_labels</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-294"><a href="#SkeletonGraph.draw-294"><span class="linenos">294</span></a>            <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-295"><a href="#SkeletonGraph.draw-295"><span class="linenos">295</span></a>            <span class="n">node_color</span><span class="o">=</span><span class="n">node_color</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-296"><a href="#SkeletonGraph.draw-296"><span class="linenos">296</span></a>            <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-297"><a href="#SkeletonGraph.draw-297"><span class="linenos">297</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SkeletonGraph.draw-298"><a href="#SkeletonGraph.draw-298"><span class="linenos">298</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph.draw-299"><a href="#SkeletonGraph.draw-299"><span class="linenos">299</span></a>
</span><span id="SkeletonGraph.draw-300"><a href="#SkeletonGraph.draw-300"><span class="linenos">300</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> (horizontal)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-301"><a href="#SkeletonGraph.draw-301"><span class="linenos">301</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z (vertical)&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-302"><a href="#SkeletonGraph.draw-302"><span class="linenos">302</span></a>        <span class="c1"># Set limits and aspect for a clear, readable plot</span>
</span><span id="SkeletonGraph.draw-303"><a href="#SkeletonGraph.draw-303"><span class="linenos">303</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-304"><a href="#SkeletonGraph.draw-304"><span class="linenos">304</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-305"><a href="#SkeletonGraph.draw-305"><span class="linenos">305</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-306"><a href="#SkeletonGraph.draw-306"><span class="linenos">306</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-307"><a href="#SkeletonGraph.draw-307"><span class="linenos">307</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="SkeletonGraph.draw-308"><a href="#SkeletonGraph.draw-308"><span class="linenos">308</span></a>            <span class="c1"># Fallback to auto if backend cannot honor equal aspect</span>
</span><span id="SkeletonGraph.draw-309"><a href="#SkeletonGraph.draw-309"><span class="linenos">309</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.draw-310"><a href="#SkeletonGraph.draw-310"><span class="linenos">310</span></a>
</span><span id="SkeletonGraph.draw-311"><a href="#SkeletonGraph.draw-311"><span class="linenos">311</span></a>        <span class="c1"># Return provided or newly-created axes</span>
</span><span id="SkeletonGraph.draw-312"><a href="#SkeletonGraph.draw-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span></pre></div>


            <div class="docstring"><p>Draw the skeleton graph in 2D using (x,z) or (y,z) coordinates.</p>

<p>Args:
    axis: Horizontal axis to use ("x" or "y"). Vertical axis is always z.
    ax: Optional matplotlib Axes to draw into. If None, a new figure/axes is created.
    figsize: Optional (width, height) in inches when creating a new figure.
    with_labels: Whether to render node labels.
    node_size: Node marker size passed to networkx.draw.
    node_color: Node color.
    edge_color: Edge color.
    min_hv_ratio: Minimum desired horizontal-to-vertical data range ratio.
        If the horizontal data span is less than this ratio times the
        vertical (z) span, x/y limits are expanded around the mean to
        meet this minimum. Helps avoid an overly thin vertical line.
    pad_frac: Fractional padding added to both axes limits for readability.
    **kwargs: Additional kwargs forwarded to networkx.draw.</p>

<p>Returns:
    The matplotlib Axes used for drawing.</p>
</div>


                            </div>
                            <div id="SkeletonGraph.plot_cross_section" class="classattr">
                                        <input id="SkeletonGraph.plot_cross_section-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_cross_section</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">node_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">boundary_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>,</span><span class="param">	<span class="n">circle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C1&#39;</span>,</span><span class="param">	<span class="n">center_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C2&#39;</span>,</span><span class="param">	<span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span>,</span><span class="param">	<span class="n">alpha_boundary</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">alpha_circle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span>,</span><span class="param">	<span class="n">show_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="SkeletonGraph.plot_cross_section-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.plot_cross_section"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.plot_cross_section-314"><a href="#SkeletonGraph.plot_cross_section-314"><span class="linenos">314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_cross_section</span><span class="p">(</span>
</span><span id="SkeletonGraph.plot_cross_section-315"><a href="#SkeletonGraph.plot_cross_section-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-316"><a href="#SkeletonGraph.plot_cross_section-316"><span class="linenos">316</span></a>        <span class="n">node_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="SkeletonGraph.plot_cross_section-317"><a href="#SkeletonGraph.plot_cross_section-317"><span class="linenos">317</span></a>        <span class="n">ax</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-318"><a href="#SkeletonGraph.plot_cross_section-318"><span class="linenos">318</span></a>        <span class="n">boundary_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-319"><a href="#SkeletonGraph.plot_cross_section-319"><span class="linenos">319</span></a>        <span class="n">circle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-320"><a href="#SkeletonGraph.plot_cross_section-320"><span class="linenos">320</span></a>        <span class="n">center_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-321"><a href="#SkeletonGraph.plot_cross_section-321"><span class="linenos">321</span></a>        <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-322"><a href="#SkeletonGraph.plot_cross_section-322"><span class="linenos">322</span></a>        <span class="n">alpha_boundary</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-323"><a href="#SkeletonGraph.plot_cross_section-323"><span class="linenos">323</span></a>        <span class="n">alpha_circle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-324"><a href="#SkeletonGraph.plot_cross_section-324"><span class="linenos">324</span></a>        <span class="n">show_center</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-325"><a href="#SkeletonGraph.plot_cross_section-325"><span class="linenos">325</span></a>        <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-326"><a href="#SkeletonGraph.plot_cross_section-326"><span class="linenos">326</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-327"><a href="#SkeletonGraph.plot_cross_section-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the cross-section boundary curve with its fitted disk.</span>
</span><span id="SkeletonGraph.plot_cross_section-328"><a href="#SkeletonGraph.plot_cross_section-328"><span class="linenos">328</span></a>
</span><span id="SkeletonGraph.plot_cross_section-329"><a href="#SkeletonGraph.plot_cross_section-329"><span class="linenos">329</span></a><span class="sd">        Expects node attributes `boundary_2d`, `center`, and `radius`.</span>
</span><span id="SkeletonGraph.plot_cross_section-330"><a href="#SkeletonGraph.plot_cross_section-330"><span class="linenos">330</span></a>
</span><span id="SkeletonGraph.plot_cross_section-331"><a href="#SkeletonGraph.plot_cross_section-331"><span class="linenos">331</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph.plot_cross_section-332"><a href="#SkeletonGraph.plot_cross_section-332"><span class="linenos">332</span></a><span class="sd">            node_id: Graph node identifier (e.g., &quot;cut3_cs0&quot;).</span>
</span><span id="SkeletonGraph.plot_cross_section-333"><a href="#SkeletonGraph.plot_cross_section-333"><span class="linenos">333</span></a><span class="sd">            ax: Optional matplotlib Axes; if None, a new one is created.</span>
</span><span id="SkeletonGraph.plot_cross_section-334"><a href="#SkeletonGraph.plot_cross_section-334"><span class="linenos">334</span></a><span class="sd">            boundary_color: Color for the boundary polyline.</span>
</span><span id="SkeletonGraph.plot_cross_section-335"><a href="#SkeletonGraph.plot_cross_section-335"><span class="linenos">335</span></a><span class="sd">            circle_color: Color for the fitted circle.</span>
</span><span id="SkeletonGraph.plot_cross_section-336"><a href="#SkeletonGraph.plot_cross_section-336"><span class="linenos">336</span></a><span class="sd">            center_color: Color for the center marker.</span>
</span><span id="SkeletonGraph.plot_cross_section-337"><a href="#SkeletonGraph.plot_cross_section-337"><span class="linenos">337</span></a><span class="sd">            linewidth: Line width for boundary and circle.</span>
</span><span id="SkeletonGraph.plot_cross_section-338"><a href="#SkeletonGraph.plot_cross_section-338"><span class="linenos">338</span></a><span class="sd">            alpha_boundary: Alpha for the boundary.</span>
</span><span id="SkeletonGraph.plot_cross_section-339"><a href="#SkeletonGraph.plot_cross_section-339"><span class="linenos">339</span></a><span class="sd">            alpha_circle: Alpha for the circle.</span>
</span><span id="SkeletonGraph.plot_cross_section-340"><a href="#SkeletonGraph.plot_cross_section-340"><span class="linenos">340</span></a><span class="sd">            show_center: Whether to draw the center point.</span>
</span><span id="SkeletonGraph.plot_cross_section-341"><a href="#SkeletonGraph.plot_cross_section-341"><span class="linenos">341</span></a><span class="sd">            title: Optional title; defaults to node id with cut/index.</span>
</span><span id="SkeletonGraph.plot_cross_section-342"><a href="#SkeletonGraph.plot_cross_section-342"><span class="linenos">342</span></a>
</span><span id="SkeletonGraph.plot_cross_section-343"><a href="#SkeletonGraph.plot_cross_section-343"><span class="linenos">343</span></a><span class="sd">        Returns:</span>
</span><span id="SkeletonGraph.plot_cross_section-344"><a href="#SkeletonGraph.plot_cross_section-344"><span class="linenos">344</span></a><span class="sd">            The matplotlib Axes used for drawing.</span>
</span><span id="SkeletonGraph.plot_cross_section-345"><a href="#SkeletonGraph.plot_cross_section-345"><span class="linenos">345</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph.plot_cross_section-346"><a href="#SkeletonGraph.plot_cross_section-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-347"><a href="#SkeletonGraph.plot_cross_section-347"><span class="linenos">347</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&#39; not in SkeletonGraph&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-348"><a href="#SkeletonGraph.plot_cross_section-348"><span class="linenos">348</span></a>
</span><span id="SkeletonGraph.plot_cross_section-349"><a href="#SkeletonGraph.plot_cross_section-349"><span class="linenos">349</span></a>        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span>
</span><span id="SkeletonGraph.plot_cross_section-350"><a href="#SkeletonGraph.plot_cross_section-350"><span class="linenos">350</span></a>        <span class="n">boundary_2d</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;boundary_2d&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-351"><a href="#SkeletonGraph.plot_cross_section-351"><span class="linenos">351</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-352"><a href="#SkeletonGraph.plot_cross_section-352"><span class="linenos">352</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-353"><a href="#SkeletonGraph.plot_cross_section-353"><span class="linenos">353</span></a>
</span><span id="SkeletonGraph.plot_cross_section-354"><a href="#SkeletonGraph.plot_cross_section-354"><span class="linenos">354</span></a>        <span class="k">if</span> <span class="n">boundary_2d</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary_2d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-355"><a href="#SkeletonGraph.plot_cross_section-355"><span class="linenos">355</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Node &#39;</span><span class="si">%s</span><span class="s2">&#39; has no boundary_2d; cannot plot boundary.&quot;</span><span class="p">,</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-356"><a href="#SkeletonGraph.plot_cross_section-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-357"><a href="#SkeletonGraph.plot_cross_section-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SkeletonGraph.plot_cross_section-358"><a href="#SkeletonGraph.plot_cross_section-358"><span class="linenos">358</span></a>                <span class="sa">f</span><span class="s2">&quot;Node &#39;</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&#39; missing center/radius required for plotting&quot;</span>
</span><span id="SkeletonGraph.plot_cross_section-359"><a href="#SkeletonGraph.plot_cross_section-359"><span class="linenos">359</span></a>            <span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-360"><a href="#SkeletonGraph.plot_cross_section-360"><span class="linenos">360</span></a>
</span><span id="SkeletonGraph.plot_cross_section-361"><a href="#SkeletonGraph.plot_cross_section-361"><span class="linenos">361</span></a>        <span class="c1"># Prepare axes</span>
</span><span id="SkeletonGraph.plot_cross_section-362"><a href="#SkeletonGraph.plot_cross_section-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-363"><a href="#SkeletonGraph.plot_cross_section-363"><span class="linenos">363</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="SkeletonGraph.plot_cross_section-364"><a href="#SkeletonGraph.plot_cross_section-364"><span class="linenos">364</span></a>
</span><span id="SkeletonGraph.plot_cross_section-365"><a href="#SkeletonGraph.plot_cross_section-365"><span class="linenos">365</span></a>        <span class="c1"># Plot boundary polyline</span>
</span><span id="SkeletonGraph.plot_cross_section-366"><a href="#SkeletonGraph.plot_cross_section-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">boundary_2d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundary_2d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-367"><a href="#SkeletonGraph.plot_cross_section-367"><span class="linenos">367</span></a>            <span class="n">bx</span> <span class="o">=</span> <span class="n">boundary_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="SkeletonGraph.plot_cross_section-368"><a href="#SkeletonGraph.plot_cross_section-368"><span class="linenos">368</span></a>            <span class="n">by</span> <span class="o">=</span> <span class="n">boundary_2d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="SkeletonGraph.plot_cross_section-369"><a href="#SkeletonGraph.plot_cross_section-369"><span class="linenos">369</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">boundary_color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_boundary</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-370"><a href="#SkeletonGraph.plot_cross_section-370"><span class="linenos">370</span></a>
</span><span id="SkeletonGraph.plot_cross_section-371"><a href="#SkeletonGraph.plot_cross_section-371"><span class="linenos">371</span></a>        <span class="c1"># Plot fitted circle</span>
</span><span id="SkeletonGraph.plot_cross_section-372"><a href="#SkeletonGraph.plot_cross_section-372"><span class="linenos">372</span></a>        <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SkeletonGraph.plot_cross_section-373"><a href="#SkeletonGraph.plot_cross_section-373"><span class="linenos">373</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-374"><a href="#SkeletonGraph.plot_cross_section-374"><span class="linenos">374</span></a>        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-375"><a href="#SkeletonGraph.plot_cross_section-375"><span class="linenos">375</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="SkeletonGraph.plot_cross_section-376"><a href="#SkeletonGraph.plot_cross_section-376"><span class="linenos">376</span></a>            <span class="n">cx</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
</span><span id="SkeletonGraph.plot_cross_section-377"><a href="#SkeletonGraph.plot_cross_section-377"><span class="linenos">377</span></a>            <span class="n">cy</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
</span><span id="SkeletonGraph.plot_cross_section-378"><a href="#SkeletonGraph.plot_cross_section-378"><span class="linenos">378</span></a>            <span class="n">color</span><span class="o">=</span><span class="n">circle_color</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-379"><a href="#SkeletonGraph.plot_cross_section-379"><span class="linenos">379</span></a>            <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-380"><a href="#SkeletonGraph.plot_cross_section-380"><span class="linenos">380</span></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_circle</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_cross_section-381"><a href="#SkeletonGraph.plot_cross_section-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-382"><a href="#SkeletonGraph.plot_cross_section-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="n">show_center</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-383"><a href="#SkeletonGraph.plot_cross_section-383"><span class="linenos">383</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">cx</span><span class="p">],</span> <span class="p">[</span><span class="n">cy</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">center_color</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-384"><a href="#SkeletonGraph.plot_cross_section-384"><span class="linenos">384</span></a>
</span><span id="SkeletonGraph.plot_cross_section-385"><a href="#SkeletonGraph.plot_cross_section-385"><span class="linenos">385</span></a>        <span class="c1"># Cosmetics</span>
</span><span id="SkeletonGraph.plot_cross_section-386"><a href="#SkeletonGraph.plot_cross_section-386"><span class="linenos">386</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-387"><a href="#SkeletonGraph.plot_cross_section-387"><span class="linenos">387</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-388"><a href="#SkeletonGraph.plot_cross_section-388"><span class="linenos">388</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-389"><a href="#SkeletonGraph.plot_cross_section-389"><span class="linenos">389</span></a>        <span class="n">default_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span id="SkeletonGraph.plot_cross_section-390"><a href="#SkeletonGraph.plot_cross_section-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="n">default_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_cross_section-391"><a href="#SkeletonGraph.plot_cross_section-391"><span class="linenos">391</span></a>            <span class="n">ci</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-392"><a href="#SkeletonGraph.plot_cross_section-392"><span class="linenos">392</span></a>            <span class="n">ii</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cross_section_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-393"><a href="#SkeletonGraph.plot_cross_section-393"><span class="linenos">393</span></a>            <span class="n">default_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> (slice </span><span class="si">{</span><span class="n">ci</span><span class="si">}</span><span class="s2">, cs </span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="SkeletonGraph.plot_cross_section-394"><a href="#SkeletonGraph.plot_cross_section-394"><span class="linenos">394</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">default_title</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_cross_section-395"><a href="#SkeletonGraph.plot_cross_section-395"><span class="linenos">395</span></a>
</span><span id="SkeletonGraph.plot_cross_section-396"><a href="#SkeletonGraph.plot_cross_section-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">ax</span>
</span></pre></div>


            <div class="docstring"><p>Plot the cross-section boundary curve with its fitted disk.</p>

<p>Expects node attributes <code>boundary_2d</code>, <code>center</code>, and <code>radius</code>.</p>

<p>Args:
    node_id: Graph node identifier (e.g., "cut3_cs0").
    ax: Optional matplotlib Axes; if None, a new one is created.
    boundary_color: Color for the boundary polyline.
    circle_color: Color for the fitted circle.
    center_color: Color for the center marker.
    linewidth: Line width for boundary and circle.
    alpha_boundary: Alpha for the boundary.
    alpha_circle: Alpha for the circle.
    show_center: Whether to draw the center point.
    title: Optional title; defaults to node id with cut/index.</p>

<p>Returns:
    The matplotlib Axes used for drawing.</p>
</div>


                            </div>
                            <div id="SkeletonGraph.plot_all_cross_sections" class="classattr">
                                        <input id="SkeletonGraph.plot_all_cross_sections-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_all_cross_sections</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">sort_by</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;slice_index&#39;</span><span class="p">,</span> <span class="s1">&#39;cross_section_index&#39;</span><span class="p">)</span>,</span><span class="param">	<span class="n">max_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>,</span><span class="param">	<span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">share_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">boundary_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>,</span><span class="param">	<span class="n">circle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C1&#39;</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="SkeletonGraph.plot_all_cross_sections-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.plot_all_cross_sections"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.plot_all_cross_sections-398"><a href="#SkeletonGraph.plot_all_cross_sections-398"><span class="linenos">398</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot_all_cross_sections</span><span class="p">(</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-399"><a href="#SkeletonGraph.plot_all_cross_sections-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-400"><a href="#SkeletonGraph.plot_all_cross_sections-400"><span class="linenos">400</span></a>        <span class="n">sort_by</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">,</span> <span class="s2">&quot;cross_section_index&quot;</span><span class="p">),</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-401"><a href="#SkeletonGraph.plot_all_cross_sections-401"><span class="linenos">401</span></a>        <span class="n">max_cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-402"><a href="#SkeletonGraph.plot_all_cross_sections-402"><span class="linenos">402</span></a>        <span class="n">figsize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-403"><a href="#SkeletonGraph.plot_all_cross_sections-403"><span class="linenos">403</span></a>        <span class="n">share_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-404"><a href="#SkeletonGraph.plot_all_cross_sections-404"><span class="linenos">404</span></a>        <span class="n">boundary_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-405"><a href="#SkeletonGraph.plot_all_cross_sections-405"><span class="linenos">405</span></a>        <span class="n">circle_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-406"><a href="#SkeletonGraph.plot_all_cross_sections-406"><span class="linenos">406</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-407"><a href="#SkeletonGraph.plot_all_cross_sections-407"><span class="linenos">407</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot every cross-section boundary with its fitted disk in a grid.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-408"><a href="#SkeletonGraph.plot_all_cross_sections-408"><span class="linenos">408</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-409"><a href="#SkeletonGraph.plot_all_cross_sections-409"><span class="linenos">409</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-410"><a href="#SkeletonGraph.plot_all_cross_sections-410"><span class="linenos">410</span></a><span class="sd">            sort_by: Tuple of node attribute names to sort nodes (primary, secondary).</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-411"><a href="#SkeletonGraph.plot_all_cross_sections-411"><span class="linenos">411</span></a><span class="sd">            max_cols: Max number of subplot columns.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-412"><a href="#SkeletonGraph.plot_all_cross_sections-412"><span class="linenos">412</span></a><span class="sd">            figsize: Figure size; auto if None.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-413"><a href="#SkeletonGraph.plot_all_cross_sections-413"><span class="linenos">413</span></a><span class="sd">            share_axes: Whether to share x/y among subplots.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-414"><a href="#SkeletonGraph.plot_all_cross_sections-414"><span class="linenos">414</span></a><span class="sd">            boundary_color: Color for boundaries.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-415"><a href="#SkeletonGraph.plot_all_cross_sections-415"><span class="linenos">415</span></a><span class="sd">            circle_color: Color for circles.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-416"><a href="#SkeletonGraph.plot_all_cross_sections-416"><span class="linenos">416</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-417"><a href="#SkeletonGraph.plot_all_cross_sections-417"><span class="linenos">417</span></a><span class="sd">        Returns:</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-418"><a href="#SkeletonGraph.plot_all_cross_sections-418"><span class="linenos">418</span></a><span class="sd">            The matplotlib Figure created.</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-419"><a href="#SkeletonGraph.plot_all_cross_sections-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-420"><a href="#SkeletonGraph.plot_all_cross_sections-420"><span class="linenos">420</span></a>        <span class="c1"># Gather nodes that have boundary_2d and required attributes</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-421"><a href="#SkeletonGraph.plot_all_cross_sections-421"><span class="linenos">421</span></a>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-422"><a href="#SkeletonGraph.plot_all_cross_sections-422"><span class="linenos">422</span></a>        <span class="k">for</span> <span class="n">nid</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-423"><a href="#SkeletonGraph.plot_all_cross_sections-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-424"><a href="#SkeletonGraph.plot_all_cross_sections-424"><span class="linenos">424</span></a>                <span class="k">continue</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-425"><a href="#SkeletonGraph.plot_all_cross_sections-425"><span class="linenos">425</span></a>            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">nid</span><span class="p">,</span> <span class="n">attrs</span><span class="p">))</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-426"><a href="#SkeletonGraph.plot_all_cross_sections-426"><span class="linenos">426</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-427"><a href="#SkeletonGraph.plot_all_cross_sections-427"><span class="linenos">427</span></a>        <span class="c1"># Sort nodes by provided attributes if present</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-428"><a href="#SkeletonGraph.plot_all_cross_sections-428"><span class="linenos">428</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">sort_key</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-429"><a href="#SkeletonGraph.plot_all_cross_sections-429"><span class="linenos">429</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">item</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-430"><a href="#SkeletonGraph.plot_all_cross_sections-430"><span class="linenos">430</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sort_by</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-431"><a href="#SkeletonGraph.plot_all_cross_sections-431"><span class="linenos">431</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-432"><a href="#SkeletonGraph.plot_all_cross_sections-432"><span class="linenos">432</span></a>        <span class="n">nodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sort_key</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-433"><a href="#SkeletonGraph.plot_all_cross_sections-433"><span class="linenos">433</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-434"><a href="#SkeletonGraph.plot_all_cross_sections-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-435"><a href="#SkeletonGraph.plot_all_cross_sections-435"><span class="linenos">435</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No nodes available to plot&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-436"><a href="#SkeletonGraph.plot_all_cross_sections-436"><span class="linenos">436</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-437"><a href="#SkeletonGraph.plot_all_cross_sections-437"><span class="linenos">437</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-438"><a href="#SkeletonGraph.plot_all_cross_sections-438"><span class="linenos">438</span></a>        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_cols</span><span class="p">))</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-439"><a href="#SkeletonGraph.plot_all_cross_sections-439"><span class="linenos">439</span></a>        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-440"><a href="#SkeletonGraph.plot_all_cross_sections-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-441"><a href="#SkeletonGraph.plot_all_cross_sections-441"><span class="linenos">441</span></a>            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-442"><a href="#SkeletonGraph.plot_all_cross_sections-442"><span class="linenos">442</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-443"><a href="#SkeletonGraph.plot_all_cross_sections-443"><span class="linenos">443</span></a>            <span class="n">nrows</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-444"><a href="#SkeletonGraph.plot_all_cross_sections-444"><span class="linenos">444</span></a>            <span class="n">ncols</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-445"><a href="#SkeletonGraph.plot_all_cross_sections-445"><span class="linenos">445</span></a>            <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-446"><a href="#SkeletonGraph.plot_all_cross_sections-446"><span class="linenos">446</span></a>            <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-447"><a href="#SkeletonGraph.plot_all_cross_sections-447"><span class="linenos">447</span></a>            <span class="n">sharex</span><span class="o">=</span><span class="n">share_axes</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-448"><a href="#SkeletonGraph.plot_all_cross_sections-448"><span class="linenos">448</span></a>            <span class="n">sharey</span><span class="o">=</span><span class="n">share_axes</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-449"><a href="#SkeletonGraph.plot_all_cross_sections-449"><span class="linenos">449</span></a>        <span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-450"><a href="#SkeletonGraph.plot_all_cross_sections-450"><span class="linenos">450</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-451"><a href="#SkeletonGraph.plot_all_cross_sections-451"><span class="linenos">451</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-452"><a href="#SkeletonGraph.plot_all_cross_sections-452"><span class="linenos">452</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-453"><a href="#SkeletonGraph.plot_all_cross_sections-453"><span class="linenos">453</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">%</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-454"><a href="#SkeletonGraph.plot_all_cross_sections-454"><span class="linenos">454</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-455"><a href="#SkeletonGraph.plot_all_cross_sections-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plot_cross_section</span><span class="p">(</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-456"><a href="#SkeletonGraph.plot_all_cross_sections-456"><span class="linenos">456</span></a>                <span class="n">nid</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-457"><a href="#SkeletonGraph.plot_all_cross_sections-457"><span class="linenos">457</span></a>                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-458"><a href="#SkeletonGraph.plot_all_cross_sections-458"><span class="linenos">458</span></a>                <span class="n">boundary_color</span><span class="o">=</span><span class="n">boundary_color</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-459"><a href="#SkeletonGraph.plot_all_cross_sections-459"><span class="linenos">459</span></a>                <span class="n">circle_color</span><span class="o">=</span><span class="n">circle_color</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-460"><a href="#SkeletonGraph.plot_all_cross_sections-460"><span class="linenos">460</span></a>                <span class="n">show_center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-461"><a href="#SkeletonGraph.plot_all_cross_sections-461"><span class="linenos">461</span></a>            <span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-462"><a href="#SkeletonGraph.plot_all_cross_sections-462"><span class="linenos">462</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-463"><a href="#SkeletonGraph.plot_all_cross_sections-463"><span class="linenos">463</span></a>        <span class="c1"># Hide any unused subplots</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-464"><a href="#SkeletonGraph.plot_all_cross_sections-464"><span class="linenos">464</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nrows</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">):</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-465"><a href="#SkeletonGraph.plot_all_cross_sections-465"><span class="linenos">465</span></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">k</span> <span class="o">//</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-466"><a href="#SkeletonGraph.plot_all_cross_sections-466"><span class="linenos">466</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">k</span> <span class="o">%</span> <span class="n">ncols</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-467"><a href="#SkeletonGraph.plot_all_cross_sections-467"><span class="linenos">467</span></a>            <span class="n">axes</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-468"><a href="#SkeletonGraph.plot_all_cross_sections-468"><span class="linenos">468</span></a>
</span><span id="SkeletonGraph.plot_all_cross_sections-469"><a href="#SkeletonGraph.plot_all_cross_sections-469"><span class="linenos">469</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="SkeletonGraph.plot_all_cross_sections-470"><a href="#SkeletonGraph.plot_all_cross_sections-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="n">fig</span>
</span></pre></div>


            <div class="docstring"><p>Plot every cross-section boundary with its fitted disk in a grid.</p>

<p>Args:
    sort_by: Tuple of node attribute names to sort nodes (primary, secondary).
    max_cols: Max number of subplot columns.
    figsize: Figure size; auto if None.
    share_axes: Whether to share x/y among subplots.
    boundary_color: Color for boundaries.
    circle_color: Color for circles.</p>

<p>Returns:
    The matplotlib Figure created.</p>
</div>


                            </div>
                            <div id="SkeletonGraph.to_swc" class="classattr">
                                        <input id="SkeletonGraph.to_swc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_swc</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">type_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">annotate_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">cycle_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;remove_edge&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SkeletonGraph.to_swc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SkeletonGraph.to_swc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SkeletonGraph.to_swc-472"><a href="#SkeletonGraph.to_swc-472"><span class="linenos">472</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_swc</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-473"><a href="#SkeletonGraph.to_swc-473"><span class="linenos">473</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-474"><a href="#SkeletonGraph.to_swc-474"><span class="linenos">474</span></a>        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-475"><a href="#SkeletonGraph.to_swc-475"><span class="linenos">475</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-476"><a href="#SkeletonGraph.to_swc-476"><span class="linenos">476</span></a>        <span class="n">type_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-477"><a href="#SkeletonGraph.to_swc-477"><span class="linenos">477</span></a>        <span class="n">annotate_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-478"><a href="#SkeletonGraph.to_swc-478"><span class="linenos">478</span></a>        <span class="n">cycle_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;remove_edge&quot;</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-479"><a href="#SkeletonGraph.to_swc-479"><span class="linenos">479</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-480"><a href="#SkeletonGraph.to_swc-480"><span class="linenos">480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write this skeleton graph to an SWC file.</span>
</span><span id="SkeletonGraph.to_swc-481"><a href="#SkeletonGraph.to_swc-481"><span class="linenos">481</span></a>
</span><span id="SkeletonGraph.to_swc-482"><a href="#SkeletonGraph.to_swc-482"><span class="linenos">482</span></a><span class="sd">        SWC format: each row has 7 columns: ``n T x y z R p``</span>
</span><span id="SkeletonGraph.to_swc-483"><a href="#SkeletonGraph.to_swc-483"><span class="linenos">483</span></a><span class="sd">          - ``n``: 1-based sample index</span>
</span><span id="SkeletonGraph.to_swc-484"><a href="#SkeletonGraph.to_swc-484"><span class="linenos">484</span></a><span class="sd">          - ``T``: sample type (default 5, overridable via ``type_index``)</span>
</span><span id="SkeletonGraph.to_swc-485"><a href="#SkeletonGraph.to_swc-485"><span class="linenos">485</span></a><span class="sd">          - ``x,y,z``: coordinates (from node ``center``)</span>
</span><span id="SkeletonGraph.to_swc-486"><a href="#SkeletonGraph.to_swc-486"><span class="linenos">486</span></a><span class="sd">          - ``R``: radius (from node ``radius``)</span>
</span><span id="SkeletonGraph.to_swc-487"><a href="#SkeletonGraph.to_swc-487"><span class="linenos">487</span></a><span class="sd">          - ``p``: parent index (or -1 for root)</span>
</span><span id="SkeletonGraph.to_swc-488"><a href="#SkeletonGraph.to_swc-488"><span class="linenos">488</span></a>
</span><span id="SkeletonGraph.to_swc-489"><a href="#SkeletonGraph.to_swc-489"><span class="linenos">489</span></a><span class="sd">        Important: SWC requires a tree (no cycles). If this graph contains</span>
</span><span id="SkeletonGraph.to_swc-490"><a href="#SkeletonGraph.to_swc-490"><span class="linenos">490</span></a><span class="sd">        cycles, we can break them in one of two ways (selectable via</span>
</span><span id="SkeletonGraph.to_swc-491"><a href="#SkeletonGraph.to_swc-491"><span class="linenos">491</span></a><span class="sd">        ``cycle_mode``):</span>
</span><span id="SkeletonGraph.to_swc-492"><a href="#SkeletonGraph.to_swc-492"><span class="linenos">492</span></a><span class="sd">          - ``&quot;remove_edge&quot;`` (default): remove one edge per cycle to obtain a</span>
</span><span id="SkeletonGraph.to_swc-493"><a href="#SkeletonGraph.to_swc-493"><span class="linenos">493</span></a><span class="sd">            spanning forest. Prefer removing an edge touching a branching node</span>
</span><span id="SkeletonGraph.to_swc-494"><a href="#SkeletonGraph.to_swc-494"><span class="linenos">494</span></a><span class="sd">            (degree &gt; 2) to preserve simpler chains. Removed edges are</span>
</span><span id="SkeletonGraph.to_swc-495"><a href="#SkeletonGraph.to_swc-495"><span class="linenos">495</span></a><span class="sd">            annotated in the SWC header.</span>
</span><span id="SkeletonGraph.to_swc-496"><a href="#SkeletonGraph.to_swc-496"><span class="linenos">496</span></a><span class="sd">          - ``&quot;duplicate_junction&quot;``: duplicate a branching node within the</span>
</span><span id="SkeletonGraph.to_swc-497"><a href="#SkeletonGraph.to_swc-497"><span class="linenos">497</span></a><span class="sd">            cycle and rewire one incident cycle edge to the duplicate instead</span>
</span><span id="SkeletonGraph.to_swc-498"><a href="#SkeletonGraph.to_swc-498"><span class="linenos">498</span></a><span class="sd">            of removing it. This preserves all segments as edges in SWC while</span>
</span><span id="SkeletonGraph.to_swc-499"><a href="#SkeletonGraph.to_swc-499"><span class="linenos">499</span></a><span class="sd">            yielding a tree. Duplications are annotated in the SWC header so</span>
</span><span id="SkeletonGraph.to_swc-500"><a href="#SkeletonGraph.to_swc-500"><span class="linenos">500</span></a><span class="sd">            downstream tools can reconnect duplicate pairs if needed.</span>
</span><span id="SkeletonGraph.to_swc-501"><a href="#SkeletonGraph.to_swc-501"><span class="linenos">501</span></a>
</span><span id="SkeletonGraph.to_swc-502"><a href="#SkeletonGraph.to_swc-502"><span class="linenos">502</span></a><span class="sd">        Args:</span>
</span><span id="SkeletonGraph.to_swc-503"><a href="#SkeletonGraph.to_swc-503"><span class="linenos">503</span></a><span class="sd">            filepath: Destination SWC file path.</span>
</span><span id="SkeletonGraph.to_swc-504"><a href="#SkeletonGraph.to_swc-504"><span class="linenos">504</span></a><span class="sd">            type_index: Type code to write in column T (default 5). You can</span>
</span><span id="SkeletonGraph.to_swc-505"><a href="#SkeletonGraph.to_swc-505"><span class="linenos">505</span></a><span class="sd">                change this to match your downstream tooling.</span>
</span><span id="SkeletonGraph.to_swc-506"><a href="#SkeletonGraph.to_swc-506"><span class="linenos">506</span></a><span class="sd">            annotate_cycles: If True, write header lines describing the cycle</span>
</span><span id="SkeletonGraph.to_swc-507"><a href="#SkeletonGraph.to_swc-507"><span class="linenos">507</span></a><span class="sd">                breaking operations (removed edges or duplicated junctions).</span>
</span><span id="SkeletonGraph.to_swc-508"><a href="#SkeletonGraph.to_swc-508"><span class="linenos">508</span></a><span class="sd">            cycle_mode: &quot;remove_edge&quot; (default) or &quot;duplicate_junction&quot;.</span>
</span><span id="SkeletonGraph.to_swc-509"><a href="#SkeletonGraph.to_swc-509"><span class="linenos">509</span></a><span class="sd">                When &quot;duplicate_junction&quot;, a branching node on the cycle is</span>
</span><span id="SkeletonGraph.to_swc-510"><a href="#SkeletonGraph.to_swc-510"><span class="linenos">510</span></a><span class="sd">                duplicated and one of its incident cycle edges is rewired to</span>
</span><span id="SkeletonGraph.to_swc-511"><a href="#SkeletonGraph.to_swc-511"><span class="linenos">511</span></a><span class="sd">                the duplicate.</span>
</span><span id="SkeletonGraph.to_swc-512"><a href="#SkeletonGraph.to_swc-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SkeletonGraph.to_swc-513"><a href="#SkeletonGraph.to_swc-513"><span class="linenos">513</span></a>        <span class="c1"># Validate type index</span>
</span><span id="SkeletonGraph.to_swc-514"><a href="#SkeletonGraph.to_swc-514"><span class="linenos">514</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-515"><a href="#SkeletonGraph.to_swc-515"><span class="linenos">515</span></a>            <span class="n">t_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">type_index</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-516"><a href="#SkeletonGraph.to_swc-516"><span class="linenos">516</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-517"><a href="#SkeletonGraph.to_swc-517"><span class="linenos">517</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;type_index must be an integer&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="SkeletonGraph.to_swc-518"><a href="#SkeletonGraph.to_swc-518"><span class="linenos">518</span></a>
</span><span id="SkeletonGraph.to_swc-519"><a href="#SkeletonGraph.to_swc-519"><span class="linenos">519</span></a>        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
</span><span id="SkeletonGraph.to_swc-520"><a href="#SkeletonGraph.to_swc-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-521"><a href="#SkeletonGraph.to_swc-521"><span class="linenos">521</span></a>            <span class="c1"># Write a minimal header file</span>
</span><span id="SkeletonGraph.to_swc-522"><a href="#SkeletonGraph.to_swc-522"><span class="linenos">522</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-523"><a href="#SkeletonGraph.to_swc-523"><span class="linenos">523</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Empty SWC exported by DISCOS SkeletonGraph.to_swc</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-524"><a href="#SkeletonGraph.to_swc-524"><span class="linenos">524</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Date: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-525"><a href="#SkeletonGraph.to_swc-525"><span class="linenos">525</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Columns: n T x y z R p</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-526"><a href="#SkeletonGraph.to_swc-526"><span class="linenos">526</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Type index (T) used for all samples: </span><span class="si">{</span><span class="n">t_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-527"><a href="#SkeletonGraph.to_swc-527"><span class="linenos">527</span></a>            <span class="k">return</span>
</span><span id="SkeletonGraph.to_swc-528"><a href="#SkeletonGraph.to_swc-528"><span class="linenos">528</span></a>
</span><span id="SkeletonGraph.to_swc-529"><a href="#SkeletonGraph.to_swc-529"><span class="linenos">529</span></a>        <span class="c1"># Work on a copy when breaking cycles</span>
</span><span id="SkeletonGraph.to_swc-530"><a href="#SkeletonGraph.to_swc-530"><span class="linenos">530</span></a>        <span class="n">H</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</span><span id="SkeletonGraph.to_swc-531"><a href="#SkeletonGraph.to_swc-531"><span class="linenos">531</span></a>        <span class="n">H</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-532"><a href="#SkeletonGraph.to_swc-532"><span class="linenos">532</span></a>        <span class="n">H</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-533"><a href="#SkeletonGraph.to_swc-533"><span class="linenos">533</span></a>
</span><span id="SkeletonGraph.to_swc-534"><a href="#SkeletonGraph.to_swc-534"><span class="linenos">534</span></a>        <span class="n">removed_edges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph.to_swc-535"><a href="#SkeletonGraph.to_swc-535"><span class="linenos">535</span></a>        <span class="n">duplicated_nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph.to_swc-536"><a href="#SkeletonGraph.to_swc-536"><span class="linenos">536</span></a>        <span class="c1"># Attributes for synthetic duplicate nodes (not present in self.G)</span>
</span><span id="SkeletonGraph.to_swc-537"><a href="#SkeletonGraph.to_swc-537"><span class="linenos">537</span></a>        <span class="n">extra_node_attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph.to_swc-538"><a href="#SkeletonGraph.to_swc-538"><span class="linenos">538</span></a>
</span><span id="SkeletonGraph.to_swc-539"><a href="#SkeletonGraph.to_swc-539"><span class="linenos">539</span></a>        <span class="c1"># Helper for generating unique integer IDs for duplicates</span>
</span><span id="SkeletonGraph.to_swc-540"><a href="#SkeletonGraph.to_swc-540"><span class="linenos">540</span></a>        <span class="n">max_int_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="SkeletonGraph.to_swc-541"><a href="#SkeletonGraph.to_swc-541"><span class="linenos">541</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-542"><a href="#SkeletonGraph.to_swc-542"><span class="linenos">542</span></a>            <span class="n">int_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]</span>
</span><span id="SkeletonGraph.to_swc-543"><a href="#SkeletonGraph.to_swc-543"><span class="linenos">543</span></a>            <span class="k">if</span> <span class="n">int_nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-544"><a href="#SkeletonGraph.to_swc-544"><span class="linenos">544</span></a>                <span class="n">max_int_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">int_nodes</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-545"><a href="#SkeletonGraph.to_swc-545"><span class="linenos">545</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-546"><a href="#SkeletonGraph.to_swc-546"><span class="linenos">546</span></a>            <span class="k">pass</span>
</span><span id="SkeletonGraph.to_swc-547"><a href="#SkeletonGraph.to_swc-547"><span class="linenos">547</span></a>        <span class="n">next_new_id</span> <span class="o">=</span> <span class="n">max_int_id</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="SkeletonGraph.to_swc-548"><a href="#SkeletonGraph.to_swc-548"><span class="linenos">548</span></a>
</span><span id="SkeletonGraph.to_swc-549"><a href="#SkeletonGraph.to_swc-549"><span class="linenos">549</span></a>        <span class="c1"># Iteratively break cycles per selected mode</span>
</span><span id="SkeletonGraph.to_swc-550"><a href="#SkeletonGraph.to_swc-550"><span class="linenos">550</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-551"><a href="#SkeletonGraph.to_swc-551"><span class="linenos">551</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-552"><a href="#SkeletonGraph.to_swc-552"><span class="linenos">552</span></a>                <span class="n">cycles</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">cycle_basis</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-553"><a href="#SkeletonGraph.to_swc-553"><span class="linenos">553</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-554"><a href="#SkeletonGraph.to_swc-554"><span class="linenos">554</span></a>                <span class="n">cycles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph.to_swc-555"><a href="#SkeletonGraph.to_swc-555"><span class="linenos">555</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">cycles</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-556"><a href="#SkeletonGraph.to_swc-556"><span class="linenos">556</span></a>                <span class="k">break</span>
</span><span id="SkeletonGraph.to_swc-557"><a href="#SkeletonGraph.to_swc-557"><span class="linenos">557</span></a>
</span><span id="SkeletonGraph.to_swc-558"><a href="#SkeletonGraph.to_swc-558"><span class="linenos">558</span></a>            <span class="n">cyc</span> <span class="o">=</span> <span class="n">cycles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-559"><a href="#SkeletonGraph.to_swc-559"><span class="linenos">559</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cyc</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-560"><a href="#SkeletonGraph.to_swc-560"><span class="linenos">560</span></a>
</span><span id="SkeletonGraph.to_swc-561"><a href="#SkeletonGraph.to_swc-561"><span class="linenos">561</span></a>            <span class="k">if</span> <span class="n">cycle_mode</span> <span class="o">==</span> <span class="s2">&quot;duplicate_junction&quot;</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-562"><a href="#SkeletonGraph.to_swc-562"><span class="linenos">562</span></a>                <span class="c1"># Find a branching node in the cycle (pref degree&gt;2 in original G)</span>
</span><span id="SkeletonGraph.to_swc-563"><a href="#SkeletonGraph.to_swc-563"><span class="linenos">563</span></a>                <span class="n">b_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SkeletonGraph.to_swc-564"><a href="#SkeletonGraph.to_swc-564"><span class="linenos">564</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="SkeletonGraph.to_swc-565"><a href="#SkeletonGraph.to_swc-565"><span class="linenos">565</span></a>                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">cyc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-566"><a href="#SkeletonGraph.to_swc-566"><span class="linenos">566</span></a>                        <span class="n">b_idx</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="SkeletonGraph.to_swc-567"><a href="#SkeletonGraph.to_swc-567"><span class="linenos">567</span></a>                        <span class="k">break</span>
</span><span id="SkeletonGraph.to_swc-568"><a href="#SkeletonGraph.to_swc-568"><span class="linenos">568</span></a>                <span class="k">if</span> <span class="n">b_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-569"><a href="#SkeletonGraph.to_swc-569"><span class="linenos">569</span></a>                    <span class="c1"># Fall back to highest-degree node in the cycle</span>
</span><span id="SkeletonGraph.to_swc-570"><a href="#SkeletonGraph.to_swc-570"><span class="linenos">570</span></a>                    <span class="n">b_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">cyc</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</span><span id="SkeletonGraph.to_swc-571"><a href="#SkeletonGraph.to_swc-571"><span class="linenos">571</span></a>                <span class="n">b</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="n">b_idx</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-572"><a href="#SkeletonGraph.to_swc-572"><span class="linenos">572</span></a>                <span class="n">prev_n</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[(</span><span class="n">b_idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-573"><a href="#SkeletonGraph.to_swc-573"><span class="linenos">573</span></a>
</span><span id="SkeletonGraph.to_swc-574"><a href="#SkeletonGraph.to_swc-574"><span class="linenos">574</span></a>                <span class="c1"># Create a duplicate node with identical attributes</span>
</span><span id="SkeletonGraph.to_swc-575"><a href="#SkeletonGraph.to_swc-575"><span class="linenos">575</span></a>                <span class="n">dup_id</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">next_new_id</span>
</span><span id="SkeletonGraph.to_swc-576"><a href="#SkeletonGraph.to_swc-576"><span class="linenos">576</span></a>                <span class="n">next_new_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SkeletonGraph.to_swc-577"><a href="#SkeletonGraph.to_swc-577"><span class="linenos">577</span></a>                <span class="c1"># Copy essential attributes from G</span>
</span><span id="SkeletonGraph.to_swc-578"><a href="#SkeletonGraph.to_swc-578"><span class="linenos">578</span></a>                <span class="n">b_attrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-579"><a href="#SkeletonGraph.to_swc-579"><span class="linenos">579</span></a>                <span class="n">extra_node_attrs</span><span class="p">[</span><span class="n">dup_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SkeletonGraph.to_swc-580"><a href="#SkeletonGraph.to_swc-580"><span class="linenos">580</span></a>                    <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;junction&quot;</span><span class="p">),</span>
</span><span id="SkeletonGraph.to_swc-581"><a href="#SkeletonGraph.to_swc-581"><span class="linenos">581</span></a>                    <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
</span><span id="SkeletonGraph.to_swc-582"><a href="#SkeletonGraph.to_swc-582"><span class="linenos">582</span></a>                    <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-583"><a href="#SkeletonGraph.to_swc-583"><span class="linenos">583</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-584"><a href="#SkeletonGraph.to_swc-584"><span class="linenos">584</span></a>                        <span class="k">if</span> <span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SkeletonGraph.to_swc-585"><a href="#SkeletonGraph.to_swc-585"><span class="linenos">585</span></a>                        <span class="k">else</span> <span class="kc">None</span>
</span><span id="SkeletonGraph.to_swc-586"><a href="#SkeletonGraph.to_swc-586"><span class="linenos">586</span></a>                    <span class="p">),</span>
</span><span id="SkeletonGraph.to_swc-587"><a href="#SkeletonGraph.to_swc-587"><span class="linenos">587</span></a>                    <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
</span><span id="SkeletonGraph.to_swc-588"><a href="#SkeletonGraph.to_swc-588"><span class="linenos">588</span></a>                    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
</span><span id="SkeletonGraph.to_swc-589"><a href="#SkeletonGraph.to_swc-589"><span class="linenos">589</span></a>                    <span class="s2">&quot;slice_index&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
</span><span id="SkeletonGraph.to_swc-590"><a href="#SkeletonGraph.to_swc-590"><span class="linenos">590</span></a>                    <span class="s2">&quot;cross_section_index&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cross_section_index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
</span><span id="SkeletonGraph.to_swc-591"><a href="#SkeletonGraph.to_swc-591"><span class="linenos">591</span></a>                <span class="p">}</span>
</span><span id="SkeletonGraph.to_swc-592"><a href="#SkeletonGraph.to_swc-592"><span class="linenos">592</span></a>
</span><span id="SkeletonGraph.to_swc-593"><a href="#SkeletonGraph.to_swc-593"><span class="linenos">593</span></a>                <span class="c1"># Rewire one incident cycle edge: (prev_n, b) -&gt; (prev_n, dup_id)</span>
</span><span id="SkeletonGraph.to_swc-594"><a href="#SkeletonGraph.to_swc-594"><span class="linenos">594</span></a>                <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="SkeletonGraph.to_swc-595"><a href="#SkeletonGraph.to_swc-595"><span class="linenos">595</span></a>                    <span class="c1"># Capture edge attributes for annotation from original G</span>
</span><span id="SkeletonGraph.to_swc-596"><a href="#SkeletonGraph.to_swc-596"><span class="linenos">596</span></a>                    <span class="n">eattrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</span><span id="SkeletonGraph.to_swc-597"><a href="#SkeletonGraph.to_swc-597"><span class="linenos">597</span></a>                    <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="SkeletonGraph.to_swc-598"><a href="#SkeletonGraph.to_swc-598"><span class="linenos">598</span></a>                        <span class="n">H</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-599"><a href="#SkeletonGraph.to_swc-599"><span class="linenos">599</span></a>                    <span class="n">H</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">dup_id</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-600"><a href="#SkeletonGraph.to_swc-600"><span class="linenos">600</span></a>                    <span class="n">H</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">prev_n</span><span class="p">,</span> <span class="n">dup_id</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-601"><a href="#SkeletonGraph.to_swc-601"><span class="linenos">601</span></a>                    <span class="n">duplicated_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-602"><a href="#SkeletonGraph.to_swc-602"><span class="linenos">602</span></a>                        <span class="p">{</span>
</span><span id="SkeletonGraph.to_swc-603"><a href="#SkeletonGraph.to_swc-603"><span class="linenos">603</span></a>                            <span class="s2">&quot;orig&quot;</span><span class="p">:</span> <span class="n">b</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-604"><a href="#SkeletonGraph.to_swc-604"><span class="linenos">604</span></a>                            <span class="s2">&quot;duplicate&quot;</span><span class="p">:</span> <span class="n">dup_id</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-605"><a href="#SkeletonGraph.to_swc-605"><span class="linenos">605</span></a>                            <span class="s2">&quot;redirected_from&quot;</span><span class="p">:</span> <span class="n">prev_n</span><span class="p">,</span>
</span><span id="SkeletonGraph.to_swc-606"><a href="#SkeletonGraph.to_swc-606"><span class="linenos">606</span></a>                            <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="n">eattrs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">eattrs</span><span class="p">),</span>
</span><span id="SkeletonGraph.to_swc-607"><a href="#SkeletonGraph.to_swc-607"><span class="linenos">607</span></a>                        <span class="p">}</span>
</span><span id="SkeletonGraph.to_swc-608"><a href="#SkeletonGraph.to_swc-608"><span class="linenos">608</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-609"><a href="#SkeletonGraph.to_swc-609"><span class="linenos">609</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-610"><a href="#SkeletonGraph.to_swc-610"><span class="linenos">610</span></a>                    <span class="c1"># If the expected edge isn&#39;t present (unexpected), fall back to removal</span>
</span><span id="SkeletonGraph.to_swc-611"><a href="#SkeletonGraph.to_swc-611"><span class="linenos">611</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-612"><a href="#SkeletonGraph.to_swc-612"><span class="linenos">612</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="n">m</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-613"><a href="#SkeletonGraph.to_swc-613"><span class="linenos">613</span></a>                    <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="SkeletonGraph.to_swc-614"><a href="#SkeletonGraph.to_swc-614"><span class="linenos">614</span></a>                        <span class="n">eattrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</span><span id="SkeletonGraph.to_swc-615"><a href="#SkeletonGraph.to_swc-615"><span class="linenos">615</span></a>                        <span class="n">removed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-616"><a href="#SkeletonGraph.to_swc-616"><span class="linenos">616</span></a>                            <span class="p">{</span><span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="n">eattrs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">eattrs</span><span class="p">)}</span>
</span><span id="SkeletonGraph.to_swc-617"><a href="#SkeletonGraph.to_swc-617"><span class="linenos">617</span></a>                        <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-618"><a href="#SkeletonGraph.to_swc-618"><span class="linenos">618</span></a>                        <span class="n">H</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-619"><a href="#SkeletonGraph.to_swc-619"><span class="linenos">619</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-620"><a href="#SkeletonGraph.to_swc-620"><span class="linenos">620</span></a>                <span class="c1"># Default/remove_edge mode: remove one edge touching a branching node</span>
</span><span id="SkeletonGraph.to_swc-621"><a href="#SkeletonGraph.to_swc-621"><span class="linenos">621</span></a>                <span class="n">chosen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SkeletonGraph.to_swc-622"><a href="#SkeletonGraph.to_swc-622"><span class="linenos">622</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="SkeletonGraph.to_swc-623"><a href="#SkeletonGraph.to_swc-623"><span class="linenos">623</span></a>                    <span class="n">u</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-624"><a href="#SkeletonGraph.to_swc-624"><span class="linenos">624</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">cyc</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-625"><a href="#SkeletonGraph.to_swc-625"><span class="linenos">625</span></a>                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-626"><a href="#SkeletonGraph.to_swc-626"><span class="linenos">626</span></a>                        <span class="n">chosen</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-627"><a href="#SkeletonGraph.to_swc-627"><span class="linenos">627</span></a>                        <span class="k">break</span>
</span><span id="SkeletonGraph.to_swc-628"><a href="#SkeletonGraph.to_swc-628"><span class="linenos">628</span></a>                <span class="k">if</span> <span class="n">chosen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-629"><a href="#SkeletonGraph.to_swc-629"><span class="linenos">629</span></a>                    <span class="n">chosen</span> <span class="o">=</span> <span class="p">(</span><span class="n">cyc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cyc</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="n">m</span><span class="p">])</span>
</span><span id="SkeletonGraph.to_swc-630"><a href="#SkeletonGraph.to_swc-630"><span class="linenos">630</span></a>
</span><span id="SkeletonGraph.to_swc-631"><a href="#SkeletonGraph.to_swc-631"><span class="linenos">631</span></a>                <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">chosen</span>
</span><span id="SkeletonGraph.to_swc-632"><a href="#SkeletonGraph.to_swc-632"><span class="linenos">632</span></a>                <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
</span><span id="SkeletonGraph.to_swc-633"><a href="#SkeletonGraph.to_swc-633"><span class="linenos">633</span></a>                    <span class="n">eattrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
</span><span id="SkeletonGraph.to_swc-634"><a href="#SkeletonGraph.to_swc-634"><span class="linenos">634</span></a>                    <span class="n">removed_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-635"><a href="#SkeletonGraph.to_swc-635"><span class="linenos">635</span></a>                        <span class="p">{</span><span class="s2">&quot;u&quot;</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="n">eattrs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">eattrs</span><span class="p">)}</span>
</span><span id="SkeletonGraph.to_swc-636"><a href="#SkeletonGraph.to_swc-636"><span class="linenos">636</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-637"><a href="#SkeletonGraph.to_swc-637"><span class="linenos">637</span></a>                    <span class="n">H</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-638"><a href="#SkeletonGraph.to_swc-638"><span class="linenos">638</span></a>
</span><span id="SkeletonGraph.to_swc-639"><a href="#SkeletonGraph.to_swc-639"><span class="linenos">639</span></a>        <span class="c1"># Helper to get z-value for ordering and root selection</span>
</span><span id="SkeletonGraph.to_swc-640"><a href="#SkeletonGraph.to_swc-640"><span class="linenos">640</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_node_z</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-641"><a href="#SkeletonGraph.to_swc-641"><span class="linenos">641</span></a>            <span class="c1"># Prefer attributes from original graph; fall back to duplicates</span>
</span><span id="SkeletonGraph.to_swc-642"><a href="#SkeletonGraph.to_swc-642"><span class="linenos">642</span></a>            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-643"><a href="#SkeletonGraph.to_swc-643"><span class="linenos">643</span></a>                <span class="n">attrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
</span><span id="SkeletonGraph.to_swc-644"><a href="#SkeletonGraph.to_swc-644"><span class="linenos">644</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-645"><a href="#SkeletonGraph.to_swc-645"><span class="linenos">645</span></a>                <span class="n">attrs</span> <span class="o">=</span> <span class="n">extra_node_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="SkeletonGraph.to_swc-646"><a href="#SkeletonGraph.to_swc-646"><span class="linenos">646</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-647"><a href="#SkeletonGraph.to_swc-647"><span class="linenos">647</span></a>            <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-648"><a href="#SkeletonGraph.to_swc-648"><span class="linenos">648</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-649"><a href="#SkeletonGraph.to_swc-649"><span class="linenos">649</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-650"><a href="#SkeletonGraph.to_swc-650"><span class="linenos">650</span></a>                    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="SkeletonGraph.to_swc-651"><a href="#SkeletonGraph.to_swc-651"><span class="linenos">651</span></a>                <span class="k">return</span> <span class="mf">0.0</span>
</span><span id="SkeletonGraph.to_swc-652"><a href="#SkeletonGraph.to_swc-652"><span class="linenos">652</span></a>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-653"><a href="#SkeletonGraph.to_swc-653"><span class="linenos">653</span></a>
</span><span id="SkeletonGraph.to_swc-654"><a href="#SkeletonGraph.to_swc-654"><span class="linenos">654</span></a>        <span class="c1"># Build a BFS forest over each connected component to define parents</span>
</span><span id="SkeletonGraph.to_swc-655"><a href="#SkeletonGraph.to_swc-655"><span class="linenos">655</span></a>        <span class="n">components</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>
</span><span id="SkeletonGraph.to_swc-656"><a href="#SkeletonGraph.to_swc-656"><span class="linenos">656</span></a>        <span class="c1"># Sort components by their lowest z to make output stable</span>
</span><span id="SkeletonGraph.to_swc-657"><a href="#SkeletonGraph.to_swc-657"><span class="linenos">657</span></a>        <span class="n">components</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">comp</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">_node_z</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">))</span>
</span><span id="SkeletonGraph.to_swc-658"><a href="#SkeletonGraph.to_swc-658"><span class="linenos">658</span></a>
</span><span id="SkeletonGraph.to_swc-659"><a href="#SkeletonGraph.to_swc-659"><span class="linenos">659</span></a>        <span class="n">swc_index</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SkeletonGraph.to_swc-660"><a href="#SkeletonGraph.to_swc-660"><span class="linenos">660</span></a>        <span class="n">rows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SkeletonGraph.to_swc-661"><a href="#SkeletonGraph.to_swc-661"><span class="linenos">661</span></a>        <span class="n">idx_counter</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SkeletonGraph.to_swc-662"><a href="#SkeletonGraph.to_swc-662"><span class="linenos">662</span></a>
</span><span id="SkeletonGraph.to_swc-663"><a href="#SkeletonGraph.to_swc-663"><span class="linenos">663</span></a>        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-664"><a href="#SkeletonGraph.to_swc-664"><span class="linenos">664</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">comp</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-665"><a href="#SkeletonGraph.to_swc-665"><span class="linenos">665</span></a>                <span class="k">continue</span>
</span><span id="SkeletonGraph.to_swc-666"><a href="#SkeletonGraph.to_swc-666"><span class="linenos">666</span></a>            <span class="n">root</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_node_z</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-667"><a href="#SkeletonGraph.to_swc-667"><span class="linenos">667</span></a>            <span class="c1"># Directed BFS tree rooted at root</span>
</span><span id="SkeletonGraph.to_swc-668"><a href="#SkeletonGraph.to_swc-668"><span class="linenos">668</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">bfs_tree</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-669"><a href="#SkeletonGraph.to_swc-669"><span class="linenos">669</span></a>            <span class="n">predecessors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SkeletonGraph.to_swc-670"><a href="#SkeletonGraph.to_swc-670"><span class="linenos">670</span></a>                <span class="n">child</span><span class="p">:</span> <span class="n">parent</span> <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">bfs_predecessors</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-671"><a href="#SkeletonGraph.to_swc-671"><span class="linenos">671</span></a>            <span class="p">}</span>
</span><span id="SkeletonGraph.to_swc-672"><a href="#SkeletonGraph.to_swc-672"><span class="linenos">672</span></a>
</span><span id="SkeletonGraph.to_swc-673"><a href="#SkeletonGraph.to_swc-673"><span class="linenos">673</span></a>            <span class="c1"># Iterate nodes in a parent-before-children order</span>
</span><span id="SkeletonGraph.to_swc-674"><a href="#SkeletonGraph.to_swc-674"><span class="linenos">674</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">topological_sort</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
</span><span id="SkeletonGraph.to_swc-675"><a href="#SkeletonGraph.to_swc-675"><span class="linenos">675</span></a>            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-676"><a href="#SkeletonGraph.to_swc-676"><span class="linenos">676</span></a>                <span class="c1"># Prefer attributes from original graph; fall back to duplicate attrs</span>
</span><span id="SkeletonGraph.to_swc-677"><a href="#SkeletonGraph.to_swc-677"><span class="linenos">677</span></a>                <span class="n">attrs</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span> <span class="k">else</span> <span class="n">extra_node_attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="SkeletonGraph.to_swc-678"><a href="#SkeletonGraph.to_swc-678"><span class="linenos">678</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-679"><a href="#SkeletonGraph.to_swc-679"><span class="linenos">679</span></a>                <span class="n">r</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-680"><a href="#SkeletonGraph.to_swc-680"><span class="linenos">680</span></a>                <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-681"><a href="#SkeletonGraph.to_swc-681"><span class="linenos">681</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-682"><a href="#SkeletonGraph.to_swc-682"><span class="linenos">682</span></a>                        <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">n</span><span class="si">!r}</span><span class="s2"> is missing a 3D center; cannot export to SWC&quot;</span>
</span><span id="SkeletonGraph.to_swc-683"><a href="#SkeletonGraph.to_swc-683"><span class="linenos">683</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-684"><a href="#SkeletonGraph.to_swc-684"><span class="linenos">684</span></a>
</span><span id="SkeletonGraph.to_swc-685"><a href="#SkeletonGraph.to_swc-685"><span class="linenos">685</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="SkeletonGraph.to_swc-686"><a href="#SkeletonGraph.to_swc-686"><span class="linenos">686</span></a>
</span><span id="SkeletonGraph.to_swc-687"><a href="#SkeletonGraph.to_swc-687"><span class="linenos">687</span></a>                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-688"><a href="#SkeletonGraph.to_swc-688"><span class="linenos">688</span></a>                    <span class="n">parent_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="SkeletonGraph.to_swc-689"><a href="#SkeletonGraph.to_swc-689"><span class="linenos">689</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-690"><a href="#SkeletonGraph.to_swc-690"><span class="linenos">690</span></a>                    <span class="n">p</span> <span class="o">=</span> <span class="n">predecessors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-691"><a href="#SkeletonGraph.to_swc-691"><span class="linenos">691</span></a>                    <span class="c1"># If predecessor is missing for some reason, fall back to root</span>
</span><span id="SkeletonGraph.to_swc-692"><a href="#SkeletonGraph.to_swc-692"><span class="linenos">692</span></a>                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-693"><a href="#SkeletonGraph.to_swc-693"><span class="linenos">693</span></a>                        <span class="n">p</span> <span class="o">=</span> <span class="n">root</span>
</span><span id="SkeletonGraph.to_swc-694"><a href="#SkeletonGraph.to_swc-694"><span class="linenos">694</span></a>                    <span class="n">parent_idx</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-695"><a href="#SkeletonGraph.to_swc-695"><span class="linenos">695</span></a>
</span><span id="SkeletonGraph.to_swc-696"><a href="#SkeletonGraph.to_swc-696"><span class="linenos">696</span></a>                <span class="n">swc_index</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_counter</span>
</span><span id="SkeletonGraph.to_swc-697"><a href="#SkeletonGraph.to_swc-697"><span class="linenos">697</span></a>                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">idx_counter</span><span class="p">,</span> <span class="n">t_code</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">parent_idx</span><span class="p">)))</span>
</span><span id="SkeletonGraph.to_swc-698"><a href="#SkeletonGraph.to_swc-698"><span class="linenos">698</span></a>                <span class="n">idx_counter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SkeletonGraph.to_swc-699"><a href="#SkeletonGraph.to_swc-699"><span class="linenos">699</span></a>
</span><span id="SkeletonGraph.to_swc-700"><a href="#SkeletonGraph.to_swc-700"><span class="linenos">700</span></a>        <span class="c1"># Write the SWC file</span>
</span><span id="SkeletonGraph.to_swc-701"><a href="#SkeletonGraph.to_swc-701"><span class="linenos">701</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-702"><a href="#SkeletonGraph.to_swc-702"><span class="linenos">702</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# SWC exported by DISCOS SkeletonGraph.to_swc</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-703"><a href="#SkeletonGraph.to_swc-703"><span class="linenos">703</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Date: </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-704"><a href="#SkeletonGraph.to_swc-704"><span class="linenos">704</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# Columns: n T x y z R p</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-705"><a href="#SkeletonGraph.to_swc-705"><span class="linenos">705</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Type index (T) used for all samples: </span><span class="si">{</span><span class="n">t_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-706"><a href="#SkeletonGraph.to_swc-706"><span class="linenos">706</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-707"><a href="#SkeletonGraph.to_swc-707"><span class="linenos">707</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-708"><a href="#SkeletonGraph.to_swc-708"><span class="linenos">708</span></a>                    <span class="sa">f</span><span class="s2">&quot;# Note: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> disconnected components were serialized; each begins with a root (parent -1).</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph.to_swc-709"><a href="#SkeletonGraph.to_swc-709"><span class="linenos">709</span></a>                <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-710"><a href="#SkeletonGraph.to_swc-710"><span class="linenos">710</span></a>            <span class="k">if</span> <span class="n">annotate_cycles</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-711"><a href="#SkeletonGraph.to_swc-711"><span class="linenos">711</span></a>                <span class="k">if</span> <span class="n">removed_edges</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-712"><a href="#SkeletonGraph.to_swc-712"><span class="linenos">712</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-713"><a href="#SkeletonGraph.to_swc-713"><span class="linenos">713</span></a>                        <span class="sa">f</span><span class="s2">&quot;# Removed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">removed_edges</span><span class="p">)</span><span class="si">}</span><span class="s2"> edge(s) to break cycles for SWC format.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph.to_swc-714"><a href="#SkeletonGraph.to_swc-714"><span class="linenos">714</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-715"><a href="#SkeletonGraph.to_swc-715"><span class="linenos">715</span></a>                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">removed_edges</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-716"><a href="#SkeletonGraph.to_swc-716"><span class="linenos">716</span></a>                        <span class="n">u</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-717"><a href="#SkeletonGraph.to_swc-717"><span class="linenos">717</span></a>                        <span class="n">v</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-718"><a href="#SkeletonGraph.to_swc-718"><span class="linenos">718</span></a>                        <span class="n">su</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-719"><a href="#SkeletonGraph.to_swc-719"><span class="linenos">719</span></a>                        <span class="n">sv</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-720"><a href="#SkeletonGraph.to_swc-720"><span class="linenos">720</span></a>                        <span class="n">seg_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-721"><a href="#SkeletonGraph.to_swc-721"><span class="linenos">721</span></a>                        <span class="n">slice_idx</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-722"><a href="#SkeletonGraph.to_swc-722"><span class="linenos">722</span></a>                        <span class="n">z_low</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_lower&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-723"><a href="#SkeletonGraph.to_swc-723"><span class="linenos">723</span></a>                        <span class="n">z_up</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_upper&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-724"><a href="#SkeletonGraph.to_swc-724"><span class="linenos">724</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-725"><a href="#SkeletonGraph.to_swc-725"><span class="linenos">725</span></a>                            <span class="s2">&quot;# cycle_edge_removed &quot;</span>
</span><span id="SkeletonGraph.to_swc-726"><a href="#SkeletonGraph.to_swc-726"><span class="linenos">726</span></a>                            <span class="sa">f</span><span class="s2">&quot;u_jid=</span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> v_jid=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> u_swc=</span><span class="si">{</span><span class="n">su</span><span class="si">}</span><span class="s2"> v_swc=</span><span class="si">{</span><span class="n">sv</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="SkeletonGraph.to_swc-727"><a href="#SkeletonGraph.to_swc-727"><span class="linenos">727</span></a>                            <span class="sa">f</span><span class="s2">&quot;segment_id=</span><span class="si">{</span><span class="n">seg_id</span><span class="si">}</span><span class="s2"> slice_index=</span><span class="si">{</span><span class="n">slice_idx</span><span class="si">}</span><span class="s2"> z_lower=</span><span class="si">{</span><span class="n">z_low</span><span class="si">}</span><span class="s2"> z_upper=</span><span class="si">{</span><span class="n">z_up</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph.to_swc-728"><a href="#SkeletonGraph.to_swc-728"><span class="linenos">728</span></a>                        <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-729"><a href="#SkeletonGraph.to_swc-729"><span class="linenos">729</span></a>                <span class="k">if</span> <span class="n">duplicated_nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-730"><a href="#SkeletonGraph.to_swc-730"><span class="linenos">730</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-731"><a href="#SkeletonGraph.to_swc-731"><span class="linenos">731</span></a>                        <span class="sa">f</span><span class="s2">&quot;# Duplicated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicated_nodes</span><span class="p">)</span><span class="si">}</span><span class="s2"> junction node(s) to break cycles for SWC format.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph.to_swc-732"><a href="#SkeletonGraph.to_swc-732"><span class="linenos">732</span></a>                    <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-733"><a href="#SkeletonGraph.to_swc-733"><span class="linenos">733</span></a>                    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">duplicated_nodes</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-734"><a href="#SkeletonGraph.to_swc-734"><span class="linenos">734</span></a>                        <span class="n">orig</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;orig&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-735"><a href="#SkeletonGraph.to_swc-735"><span class="linenos">735</span></a>                        <span class="n">dup</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duplicate&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-736"><a href="#SkeletonGraph.to_swc-736"><span class="linenos">736</span></a>                        <span class="n">redirected_from</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;redirected_from&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-737"><a href="#SkeletonGraph.to_swc-737"><span class="linenos">737</span></a>                        <span class="n">s_orig</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-738"><a href="#SkeletonGraph.to_swc-738"><span class="linenos">738</span></a>                        <span class="n">s_dup</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-739"><a href="#SkeletonGraph.to_swc-739"><span class="linenos">739</span></a>                        <span class="n">s_from</span> <span class="o">=</span> <span class="n">swc_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">redirected_from</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-740"><a href="#SkeletonGraph.to_swc-740"><span class="linenos">740</span></a>                        <span class="n">seg_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segment_id&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-741"><a href="#SkeletonGraph.to_swc-741"><span class="linenos">741</span></a>                        <span class="n">slice_idx</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;slice_index&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-742"><a href="#SkeletonGraph.to_swc-742"><span class="linenos">742</span></a>                        <span class="n">z_low</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_lower&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-743"><a href="#SkeletonGraph.to_swc-743"><span class="linenos">743</span></a>                        <span class="n">z_up</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z_upper&quot;</span><span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-744"><a href="#SkeletonGraph.to_swc-744"><span class="linenos">744</span></a>                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><span id="SkeletonGraph.to_swc-745"><a href="#SkeletonGraph.to_swc-745"><span class="linenos">745</span></a>                            <span class="s2">&quot;# cycle_node_duplicated &quot;</span>
</span><span id="SkeletonGraph.to_swc-746"><a href="#SkeletonGraph.to_swc-746"><span class="linenos">746</span></a>                            <span class="sa">f</span><span class="s2">&quot;orig_jid=</span><span class="si">{</span><span class="n">orig</span><span class="si">}</span><span class="s2"> dup_id=</span><span class="si">{</span><span class="n">dup</span><span class="si">}</span><span class="s2"> from_jid=</span><span class="si">{</span><span class="n">redirected_from</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="SkeletonGraph.to_swc-747"><a href="#SkeletonGraph.to_swc-747"><span class="linenos">747</span></a>                            <span class="sa">f</span><span class="s2">&quot;orig_swc=</span><span class="si">{</span><span class="n">s_orig</span><span class="si">}</span><span class="s2"> dup_swc=</span><span class="si">{</span><span class="n">s_dup</span><span class="si">}</span><span class="s2"> from_swc=</span><span class="si">{</span><span class="n">s_from</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="SkeletonGraph.to_swc-748"><a href="#SkeletonGraph.to_swc-748"><span class="linenos">748</span></a>                            <span class="sa">f</span><span class="s2">&quot;segment_id=</span><span class="si">{</span><span class="n">seg_id</span><span class="si">}</span><span class="s2"> slice_index=</span><span class="si">{</span><span class="n">slice_idx</span><span class="si">}</span><span class="s2"> z_lower=</span><span class="si">{</span><span class="n">z_low</span><span class="si">}</span><span class="s2"> z_upper=</span><span class="si">{</span><span class="n">z_up</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="SkeletonGraph.to_swc-749"><a href="#SkeletonGraph.to_swc-749"><span class="linenos">749</span></a>                        <span class="p">)</span>
</span><span id="SkeletonGraph.to_swc-750"><a href="#SkeletonGraph.to_swc-750"><span class="linenos">750</span></a>
</span><span id="SkeletonGraph.to_swc-751"><a href="#SkeletonGraph.to_swc-751"><span class="linenos">751</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">T_code</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</span><span id="SkeletonGraph.to_swc-752"><a href="#SkeletonGraph.to_swc-752"><span class="linenos">752</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">T_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">z</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">R</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write this skeleton graph to an SWC file.</p>

<p>SWC format: each row has 7 columns: <code>n T x y z R p</code></p>

<ul>
<li><code>n</code>: 1-based sample index</li>
<li><code>T</code>: sample type (default 5, overridable via <code>type_index</code>)</li>
<li><code>x,y,z</code>: coordinates (from node <code>center</code>)</li>
<li><code>R</code>: radius (from node <code>radius</code>)</li>
<li><code>p</code>: parent index (or -1 for root)</li>
</ul>

<p>Important: SWC requires a tree (no cycles). If this graph contains
cycles, we can break them in one of two ways (selectable via
<code>cycle_mode</code>):</p>

<ul>
<li><code>"remove_edge"</code> (default): remove one edge per cycle to obtain a
spanning forest. Prefer removing an edge touching a branching node
(degree &gt; 2) to preserve simpler chains. Removed edges are
annotated in the SWC header.</li>
<li><code>"duplicate_junction"</code>: duplicate a branching node within the
cycle and rewire one incident cycle edge to the duplicate instead
of removing it. This preserves all segments as edges in SWC while
yielding a tree. Duplications are annotated in the SWC header so
downstream tools can reconnect duplicate pairs if needed.</li>
</ul>

<p>Args:
    filepath: Destination SWC file path.
    type_index: Type code to write in column T (default 5). You can
        change this to match your downstream tooling.
    annotate_cycles: If True, write header lines describing the cycle
        breaking operations (removed edges or duplicated junctions).
    cycle_mode: "remove_edge" (default) or "duplicate_junction".
        When "duplicate_junction", a branching node on the cycle is
        duplicated and one of its incident cycle edges is rewired to
        the duplicate.</p>
</div>


                            </div>
                </section>
                <section id="skeletonize">
                            <input id="skeletonize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">skeletonize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">mesh_or_manager</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">,</span> <span class="n"><a href="#MeshManager">MeshManager</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">n_slices</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">radius_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;equivalent_area&#39;</span>,</span><span class="param">	<span class="n">validate_volume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">volume_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbosity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">enforce_connected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">connect_isolated_terminals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n"><a href="#SkeletonGraph">SkeletonGraph</a></span>:</span></span>

                <label class="view-source-button" for="skeletonize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#skeletonize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="skeletonize-760"><a href="#skeletonize-760"><span class="linenos"> 760</span></a><span class="k">def</span><span class="w"> </span><span class="nf">skeletonize</span><span class="p">(</span>
</span><span id="skeletonize-761"><a href="#skeletonize-761"><span class="linenos"> 761</span></a>    <span class="n">mesh_or_manager</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">,</span> <span class="n">MeshManager</span><span class="p">],</span>
</span><span id="skeletonize-762"><a href="#skeletonize-762"><span class="linenos"> 762</span></a>    <span class="n">n_slices</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="skeletonize-763"><a href="#skeletonize-763"><span class="linenos"> 763</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="skeletonize-764"><a href="#skeletonize-764"><span class="linenos"> 764</span></a>    <span class="n">radius_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;equivalent_area&quot;</span><span class="p">,</span>
</span><span id="skeletonize-765"><a href="#skeletonize-765"><span class="linenos"> 765</span></a>    <span class="n">validate_volume</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="skeletonize-766"><a href="#skeletonize-766"><span class="linenos"> 766</span></a>    <span class="n">volume_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="skeletonize-767"><a href="#skeletonize-767"><span class="linenos"> 767</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="skeletonize-768"><a href="#skeletonize-768"><span class="linenos"> 768</span></a>    <span class="n">verbosity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="skeletonize-769"><a href="#skeletonize-769"><span class="linenos"> 769</span></a>    <span class="n">enforce_connected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="skeletonize-770"><a href="#skeletonize-770"><span class="linenos"> 770</span></a>    <span class="n">connect_isolated_terminals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="skeletonize-771"><a href="#skeletonize-771"><span class="linenos"> 771</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SkeletonGraph</span><span class="p">:</span>
</span><span id="skeletonize-772"><a href="#skeletonize-772"><span class="linenos"> 772</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="skeletonize-773"><a href="#skeletonize-773"><span class="linenos"> 773</span></a><span class="sd">    Build a `SkeletonGraph` by slicing the mesh along z into `n_slices` bands.</span>
</span><span id="skeletonize-774"><a href="#skeletonize-774"><span class="linenos"> 774</span></a>
</span><span id="skeletonize-775"><a href="#skeletonize-775"><span class="linenos"> 775</span></a><span class="sd">    Steps:</span>
</span><span id="skeletonize-776"><a href="#skeletonize-776"><span class="linenos"> 776</span></a><span class="sd">      1) Validate input mesh (watertight, single component)</span>
</span><span id="skeletonize-777"><a href="#skeletonize-777"><span class="linenos"> 777</span></a><span class="sd">      2) Create cut planes (n_cuts = n_slices-1) uniformly in z</span>
</span><span id="skeletonize-778"><a href="#skeletonize-778"><span class="linenos"> 778</span></a><span class="sd">      3) For each cut, compute cross-section polygons and fit junctions</span>
</span><span id="skeletonize-779"><a href="#skeletonize-779"><span class="linenos"> 779</span></a><span class="sd">      4) For each band between adjacent cuts, compute connected components</span>
</span><span id="skeletonize-780"><a href="#skeletonize-780"><span class="linenos"> 780</span></a><span class="sd">         and connect lower/upper junctions according to component membership</span>
</span><span id="skeletonize-781"><a href="#skeletonize-781"><span class="linenos"> 781</span></a><span class="sd">      5) Optionally validate volume conservation across all bands</span>
</span><span id="skeletonize-782"><a href="#skeletonize-782"><span class="linenos"> 782</span></a>
</span><span id="skeletonize-783"><a href="#skeletonize-783"><span class="linenos"> 783</span></a><span class="sd">    Returns:</span>
</span><span id="skeletonize-784"><a href="#skeletonize-784"><span class="linenos"> 784</span></a><span class="sd">        SkeletonGraph</span>
</span><span id="skeletonize-785"><a href="#skeletonize-785"><span class="linenos"> 785</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="skeletonize-786"><a href="#skeletonize-786"><span class="linenos"> 786</span></a>
</span><span id="skeletonize-787"><a href="#skeletonize-787"><span class="linenos"> 787</span></a>    <span class="c1"># Backward-compatibility mapping for verbosity levels</span>
</span><span id="skeletonize-788"><a href="#skeletonize-788"><span class="linenos"> 788</span></a>    <span class="k">if</span> <span class="n">verbosity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-789"><a href="#skeletonize-789"><span class="linenos"> 789</span></a>        <span class="n">eff_verbosity</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="skeletonize-790"><a href="#skeletonize-790"><span class="linenos"> 790</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="skeletonize-791"><a href="#skeletonize-791"><span class="linenos"> 791</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-792"><a href="#skeletonize-792"><span class="linenos"> 792</span></a>            <span class="n">eff_verbosity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>
</span><span id="skeletonize-793"><a href="#skeletonize-793"><span class="linenos"> 793</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-794"><a href="#skeletonize-794"><span class="linenos"> 794</span></a>            <span class="n">eff_verbosity</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="skeletonize-795"><a href="#skeletonize-795"><span class="linenos"> 795</span></a>        <span class="c1"># If both are provided, verbosity takes precedence</span>
</span><span id="skeletonize-796"><a href="#skeletonize-796"><span class="linenos"> 796</span></a>
</span><span id="skeletonize-797"><a href="#skeletonize-797"><span class="linenos"> 797</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">v_info</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-798"><a href="#skeletonize-798"><span class="linenos"> 798</span></a>        <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-799"><a href="#skeletonize-799"><span class="linenos"> 799</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="skeletonize-800"><a href="#skeletonize-800"><span class="linenos"> 800</span></a>
</span><span id="skeletonize-801"><a href="#skeletonize-801"><span class="linenos"> 801</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">v_debug</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-802"><a href="#skeletonize-802"><span class="linenos"> 802</span></a>        <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-803"><a href="#skeletonize-803"><span class="linenos"> 803</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="skeletonize-804"><a href="#skeletonize-804"><span class="linenos"> 804</span></a>
</span><span id="skeletonize-805"><a href="#skeletonize-805"><span class="linenos"> 805</span></a>    <span class="n">mm</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="skeletonize-806"><a href="#skeletonize-806"><span class="linenos"> 806</span></a>        <span class="n">mesh_or_manager</span>
</span><span id="skeletonize-807"><a href="#skeletonize-807"><span class="linenos"> 807</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh_or_manager</span><span class="p">,</span> <span class="n">MeshManager</span><span class="p">)</span>
</span><span id="skeletonize-808"><a href="#skeletonize-808"><span class="linenos"> 808</span></a>        <span class="k">else</span> <span class="n">MeshManager</span><span class="p">(</span><span class="n">mesh_or_manager</span><span class="p">)</span>
</span><span id="skeletonize-809"><a href="#skeletonize-809"><span class="linenos"> 809</span></a>    <span class="p">)</span>
</span><span id="skeletonize-810"><a href="#skeletonize-810"><span class="linenos"> 810</span></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">to_trimesh</span><span class="p">()</span>
</span><span id="skeletonize-811"><a href="#skeletonize-811"><span class="linenos"> 811</span></a>
</span><span id="skeletonize-812"><a href="#skeletonize-812"><span class="linenos"> 812</span></a>    <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-813"><a href="#skeletonize-813"><span class="linenos"> 813</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No mesh provided&quot;</span><span class="p">)</span>
</span><span id="skeletonize-814"><a href="#skeletonize-814"><span class="linenos"> 814</span></a>
</span><span id="skeletonize-815"><a href="#skeletonize-815"><span class="linenos"> 815</span></a>    <span class="c1"># ------------------------------ Validation ------------------------------</span>
</span><span id="skeletonize-816"><a href="#skeletonize-816"><span class="linenos"> 816</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="skeletonize-817"><a href="#skeletonize-817"><span class="linenos"> 817</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input mesh must be watertight&quot;</span><span class="p">)</span>
</span><span id="skeletonize-818"><a href="#skeletonize-818"><span class="linenos"> 818</span></a>
</span><span id="skeletonize-819"><a href="#skeletonize-819"><span class="linenos"> 819</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-820"><a href="#skeletonize-820"><span class="linenos"> 820</span></a>        <span class="n">comps</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="skeletonize-821"><a href="#skeletonize-821"><span class="linenos"> 821</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-822"><a href="#skeletonize-822"><span class="linenos"> 822</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="skeletonize-823"><a href="#skeletonize-823"><span class="linenos"> 823</span></a>                <span class="sa">f</span><span class="s2">&quot;Input mesh must be a single connected component, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="skeletonize-824"><a href="#skeletonize-824"><span class="linenos"> 824</span></a>            <span class="p">)</span>
</span><span id="skeletonize-825"><a href="#skeletonize-825"><span class="linenos"> 825</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-826"><a href="#skeletonize-826"><span class="linenos"> 826</span></a>        <span class="c1"># If split fails, proceed but warn in verbose mode</span>
</span><span id="skeletonize-827"><a href="#skeletonize-827"><span class="linenos"> 827</span></a>        <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-828"><a href="#skeletonize-828"><span class="linenos"> 828</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to verify single component via mesh.split()&quot;</span><span class="p">)</span>
</span><span id="skeletonize-829"><a href="#skeletonize-829"><span class="linenos"> 829</span></a>
</span><span id="skeletonize-830"><a href="#skeletonize-830"><span class="linenos"> 830</span></a>    <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">get_z_range</span><span class="p">()</span>
</span><span id="skeletonize-831"><a href="#skeletonize-831"><span class="linenos"> 831</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">zmin</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">zmax</span><span class="p">)</span> <span class="ow">or</span> <span class="n">zmax</span> <span class="o">&lt;=</span> <span class="n">zmin</span><span class="p">:</span>
</span><span id="skeletonize-832"><a href="#skeletonize-832"><span class="linenos"> 832</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid z-range for mesh&quot;</span><span class="p">)</span>
</span><span id="skeletonize-833"><a href="#skeletonize-833"><span class="linenos"> 833</span></a>
</span><span id="skeletonize-834"><a href="#skeletonize-834"><span class="linenos"> 834</span></a>    <span class="k">if</span> <span class="n">n_slices</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-835"><a href="#skeletonize-835"><span class="linenos"> 835</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_slices must be &gt;= 1&quot;</span><span class="p">)</span>
</span><span id="skeletonize-836"><a href="#skeletonize-836"><span class="linenos"> 836</span></a>
</span><span id="skeletonize-837"><a href="#skeletonize-837"><span class="linenos"> 837</span></a>    <span class="n">v_info</span><span class="p">(</span>
</span><span id="skeletonize-838"><a href="#skeletonize-838"><span class="linenos"> 838</span></a>        <span class="s2">&quot;Starting skeletonization: n_slices=</span><span class="si">%d</span><span class="s2">, radius_mode=</span><span class="si">%s</span><span class="s2">, validate_volume=</span><span class="si">%s</span><span class="s2">, volume_tol=</span><span class="si">%.3f</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-839"><a href="#skeletonize-839"><span class="linenos"> 839</span></a>        <span class="n">n_slices</span><span class="p">,</span>
</span><span id="skeletonize-840"><a href="#skeletonize-840"><span class="linenos"> 840</span></a>        <span class="n">radius_mode</span><span class="p">,</span>
</span><span id="skeletonize-841"><a href="#skeletonize-841"><span class="linenos"> 841</span></a>        <span class="n">validate_volume</span><span class="p">,</span>
</span><span id="skeletonize-842"><a href="#skeletonize-842"><span class="linenos"> 842</span></a>        <span class="n">volume_tol</span><span class="p">,</span>
</span><span id="skeletonize-843"><a href="#skeletonize-843"><span class="linenos"> 843</span></a>    <span class="p">)</span>
</span><span id="skeletonize-844"><a href="#skeletonize-844"><span class="linenos"> 844</span></a>    <span class="n">v_debug</span><span class="p">(</span>
</span><span id="skeletonize-845"><a href="#skeletonize-845"><span class="linenos"> 845</span></a>        <span class="s2">&quot;Mesh z-range: zmin=</span><span class="si">%.6g</span><span class="s2">, zmax=</span><span class="si">%.6g</span><span class="s2"> (dz=</span><span class="si">%.6g</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="skeletonize-846"><a href="#skeletonize-846"><span class="linenos"> 846</span></a>        <span class="n">zmin</span><span class="p">,</span>
</span><span id="skeletonize-847"><a href="#skeletonize-847"><span class="linenos"> 847</span></a>        <span class="n">zmax</span><span class="p">,</span>
</span><span id="skeletonize-848"><a href="#skeletonize-848"><span class="linenos"> 848</span></a>        <span class="nb">float</span><span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">),</span>
</span><span id="skeletonize-849"><a href="#skeletonize-849"><span class="linenos"> 849</span></a>    <span class="p">)</span>
</span><span id="skeletonize-850"><a href="#skeletonize-850"><span class="linenos"> 850</span></a>
</span><span id="skeletonize-851"><a href="#skeletonize-851"><span class="linenos"> 851</span></a>    <span class="c1"># Warn about known issue when n_slices is a power of 2</span>
</span><span id="skeletonize-852"><a href="#skeletonize-852"><span class="linenos"> 852</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-853"><a href="#skeletonize-853"><span class="linenos"> 853</span></a>        <span class="n">n_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_slices</span><span class="p">)</span>
</span><span id="skeletonize-854"><a href="#skeletonize-854"><span class="linenos"> 854</span></a>        <span class="k">if</span> <span class="n">n_int</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n_int</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n_int</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="skeletonize-855"><a href="#skeletonize-855"><span class="linenos"> 855</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="skeletonize-856"><a href="#skeletonize-856"><span class="linenos"> 856</span></a>                <span class="s2">&quot;DISCOS skeletonize: n_slices is a power of 2. The current connectivity algorithm is known to misbehave for some meshes in this case.&quot;</span>
</span><span id="skeletonize-857"><a href="#skeletonize-857"><span class="linenos"> 857</span></a>            <span class="p">)</span>
</span><span id="skeletonize-858"><a href="#skeletonize-858"><span class="linenos"> 858</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="skeletonize-859"><a href="#skeletonize-859"><span class="linenos"> 859</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="skeletonize-860"><a href="#skeletonize-860"><span class="linenos"> 860</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-861"><a href="#skeletonize-861"><span class="linenos"> 861</span></a>        <span class="k">pass</span>
</span><span id="skeletonize-862"><a href="#skeletonize-862"><span class="linenos"> 862</span></a>
</span><span id="skeletonize-863"><a href="#skeletonize-863"><span class="linenos"> 863</span></a>    <span class="c1"># Uniform partition including bounding planes</span>
</span><span id="skeletonize-864"><a href="#skeletonize-864"><span class="linenos"> 864</span></a>    <span class="n">z_planes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">n_slices</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="skeletonize-865"><a href="#skeletonize-865"><span class="linenos"> 865</span></a>    <span class="n">cut_zs</span> <span class="o">=</span> <span class="n">z_planes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># internal cuts</span>
</span><span id="skeletonize-866"><a href="#skeletonize-866"><span class="linenos"> 866</span></a>
</span><span id="skeletonize-867"><a href="#skeletonize-867"><span class="linenos"> 867</span></a>    <span class="c1"># Numerical tolerance</span>
</span><span id="skeletonize-868"><a href="#skeletonize-868"><span class="linenos"> 868</span></a>    <span class="n">dz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span>
</span><span id="skeletonize-869"><a href="#skeletonize-869"><span class="linenos"> 869</span></a>    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="p">(</span><span class="n">dz</span> <span class="k">if</span> <span class="n">dz</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="skeletonize-870"><a href="#skeletonize-870"><span class="linenos"> 870</span></a>    <span class="c1"># Use a terminal probe offset that scales with slice height to avoid</span>
</span><span id="skeletonize-871"><a href="#skeletonize-871"><span class="linenos"> 871</span></a>    <span class="c1"># degenerate/unstable sections right at the bounding planes.</span>
</span><span id="skeletonize-872"><a href="#skeletonize-872"><span class="linenos"> 872</span></a>    <span class="n">slice_height</span> <span class="o">=</span> <span class="n">dz</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_slices</span><span class="p">)</span>
</span><span id="skeletonize-873"><a href="#skeletonize-873"><span class="linenos"> 873</span></a>    <span class="n">terminal_probe</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">eps</span><span class="p">,</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">slice_height</span><span class="p">)</span>
</span><span id="skeletonize-874"><a href="#skeletonize-874"><span class="linenos"> 874</span></a>
</span><span id="skeletonize-875"><a href="#skeletonize-875"><span class="linenos"> 875</span></a>    <span class="n">skel</span> <span class="o">=</span> <span class="n">SkeletonGraph</span><span class="p">()</span>
</span><span id="skeletonize-876"><a href="#skeletonize-876"><span class="linenos"> 876</span></a>
</span><span id="skeletonize-877"><a href="#skeletonize-877"><span class="linenos"> 877</span></a>    <span class="c1"># ------------------------ Terminal junctions (ends) ----------------------</span>
</span><span id="skeletonize-878"><a href="#skeletonize-878"><span class="linenos"> 878</span></a>    <span class="c1"># Fit junctions at bounding planes using near-plane sections</span>
</span><span id="skeletonize-879"><a href="#skeletonize-879"><span class="linenos"> 879</span></a>    <span class="n">terminal_bottom_ids</span> <span class="o">=</span> <span class="n">_create_junctions_at_cut</span><span class="p">(</span>
</span><span id="skeletonize-880"><a href="#skeletonize-880"><span class="linenos"> 880</span></a>        <span class="n">skel</span><span class="p">,</span>
</span><span id="skeletonize-881"><a href="#skeletonize-881"><span class="linenos"> 881</span></a>        <span class="n">mesh</span><span class="p">,</span>
</span><span id="skeletonize-882"><a href="#skeletonize-882"><span class="linenos"> 882</span></a>        <span class="n">z_plane</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">zmin</span><span class="p">),</span>
</span><span id="skeletonize-883"><a href="#skeletonize-883"><span class="linenos"> 883</span></a>        <span class="n">slice_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="skeletonize-884"><a href="#skeletonize-884"><span class="linenos"> 884</span></a>        <span class="n">probe_offset</span><span class="o">=+</span><span class="n">terminal_probe</span><span class="p">,</span>
</span><span id="skeletonize-885"><a href="#skeletonize-885"><span class="linenos"> 885</span></a>        <span class="n">radius_mode</span><span class="o">=</span><span class="n">radius_mode</span><span class="p">,</span>
</span><span id="skeletonize-886"><a href="#skeletonize-886"><span class="linenos"> 886</span></a>        <span class="n">verbosity</span><span class="o">=</span><span class="n">eff_verbosity</span><span class="p">,</span>
</span><span id="skeletonize-887"><a href="#skeletonize-887"><span class="linenos"> 887</span></a>    <span class="p">)</span>
</span><span id="skeletonize-888"><a href="#skeletonize-888"><span class="linenos"> 888</span></a>    <span class="n">terminal_top_ids</span> <span class="o">=</span> <span class="n">_create_junctions_at_cut</span><span class="p">(</span>
</span><span id="skeletonize-889"><a href="#skeletonize-889"><span class="linenos"> 889</span></a>        <span class="n">skel</span><span class="p">,</span>
</span><span id="skeletonize-890"><a href="#skeletonize-890"><span class="linenos"> 890</span></a>        <span class="n">mesh</span><span class="p">,</span>
</span><span id="skeletonize-891"><a href="#skeletonize-891"><span class="linenos"> 891</span></a>        <span class="n">z_plane</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">zmax</span><span class="p">),</span>
</span><span id="skeletonize-892"><a href="#skeletonize-892"><span class="linenos"> 892</span></a>        <span class="n">slice_index</span><span class="o">=</span><span class="n">n_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="skeletonize-893"><a href="#skeletonize-893"><span class="linenos"> 893</span></a>        <span class="n">probe_offset</span><span class="o">=-</span><span class="n">terminal_probe</span><span class="p">,</span>
</span><span id="skeletonize-894"><a href="#skeletonize-894"><span class="linenos"> 894</span></a>        <span class="n">radius_mode</span><span class="o">=</span><span class="n">radius_mode</span><span class="p">,</span>
</span><span id="skeletonize-895"><a href="#skeletonize-895"><span class="linenos"> 895</span></a>        <span class="n">verbosity</span><span class="o">=</span><span class="n">eff_verbosity</span><span class="p">,</span>
</span><span id="skeletonize-896"><a href="#skeletonize-896"><span class="linenos"> 896</span></a>    <span class="p">)</span>
</span><span id="skeletonize-897"><a href="#skeletonize-897"><span class="linenos"> 897</span></a>
</span><span id="skeletonize-898"><a href="#skeletonize-898"><span class="linenos"> 898</span></a>    <span class="c1"># --------------------- Internal cuts: cross-sections ---------------------</span>
</span><span id="skeletonize-899"><a href="#skeletonize-899"><span class="linenos"> 899</span></a>    <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">zc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cut_zs</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
</span><span id="skeletonize-900"><a href="#skeletonize-900"><span class="linenos"> 900</span></a>        <span class="n">_create_junctions_at_cut</span><span class="p">(</span>
</span><span id="skeletonize-901"><a href="#skeletonize-901"><span class="linenos"> 901</span></a>            <span class="n">skel</span><span class="p">,</span>
</span><span id="skeletonize-902"><a href="#skeletonize-902"><span class="linenos"> 902</span></a>            <span class="n">mesh</span><span class="p">,</span>
</span><span id="skeletonize-903"><a href="#skeletonize-903"><span class="linenos"> 903</span></a>            <span class="n">z_plane</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">zc</span><span class="p">),</span>
</span><span id="skeletonize-904"><a href="#skeletonize-904"><span class="linenos"> 904</span></a>            <span class="n">slice_index</span><span class="o">=</span><span class="n">si</span><span class="p">,</span>
</span><span id="skeletonize-905"><a href="#skeletonize-905"><span class="linenos"> 905</span></a>            <span class="n">probe_offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="skeletonize-906"><a href="#skeletonize-906"><span class="linenos"> 906</span></a>            <span class="n">radius_mode</span><span class="o">=</span><span class="n">radius_mode</span><span class="p">,</span>
</span><span id="skeletonize-907"><a href="#skeletonize-907"><span class="linenos"> 907</span></a>            <span class="n">verbosity</span><span class="o">=</span><span class="n">eff_verbosity</span><span class="p">,</span>
</span><span id="skeletonize-908"><a href="#skeletonize-908"><span class="linenos"> 908</span></a>        <span class="p">)</span>
</span><span id="skeletonize-909"><a href="#skeletonize-909"><span class="linenos"> 909</span></a>
</span><span id="skeletonize-910"><a href="#skeletonize-910"><span class="linenos"> 910</span></a>    <span class="n">v_info</span><span class="p">(</span>
</span><span id="skeletonize-911"><a href="#skeletonize-911"><span class="linenos"> 911</span></a>        <span class="s2">&quot;Constructed cross-sections: </span><span class="si">%d</span><span class="s2"> cuts, </span><span class="si">%d</span><span class="s2"> total junctions&quot;</span><span class="p">,</span>
</span><span id="skeletonize-912"><a href="#skeletonize-912"><span class="linenos"> 912</span></a>        <span class="nb">len</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">cross_sections</span><span class="p">),</span>
</span><span id="skeletonize-913"><a href="#skeletonize-913"><span class="linenos"> 913</span></a>        <span class="nb">len</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">),</span>
</span><span id="skeletonize-914"><a href="#skeletonize-914"><span class="linenos"> 914</span></a>    <span class="p">)</span>
</span><span id="skeletonize-915"><a href="#skeletonize-915"><span class="linenos"> 915</span></a>
</span><span id="skeletonize-916"><a href="#skeletonize-916"><span class="linenos"> 916</span></a>    <span class="c1"># ---------------- Bands: connect junctions across adjacent cuts ----------</span>
</span><span id="skeletonize-917"><a href="#skeletonize-917"><span class="linenos"> 917</span></a>    <span class="n">junctions_by_slice</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="skeletonize-918"><a href="#skeletonize-918"><span class="linenos"> 918</span></a>    <span class="k">for</span> <span class="n">j_id</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="skeletonize-919"><a href="#skeletonize-919"><span class="linenos"> 919</span></a>        <span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">slice_index</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j_id</span><span class="p">)</span>
</span><span id="skeletonize-920"><a href="#skeletonize-920"><span class="linenos"> 920</span></a>
</span><span id="skeletonize-921"><a href="#skeletonize-921"><span class="linenos"> 921</span></a>    <span class="c1"># For each band (slice interval), build components and map to junctions</span>
</span><span id="skeletonize-922"><a href="#skeletonize-922"><span class="linenos"> 922</span></a>    <span class="n">segment_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="skeletonize-923"><a href="#skeletonize-923"><span class="linenos"> 923</span></a>    <span class="n">total_band_volume</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="skeletonize-924"><a href="#skeletonize-924"><span class="linenos"> 924</span></a>    <span class="k">for</span> <span class="n">band_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_slices</span><span class="p">):</span>
</span><span id="skeletonize-925"><a href="#skeletonize-925"><span class="linenos"> 925</span></a>        <span class="n">z_low</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z_planes</span><span class="p">[</span><span class="n">band_index</span><span class="p">])</span>
</span><span id="skeletonize-926"><a href="#skeletonize-926"><span class="linenos"> 926</span></a>        <span class="n">z_high</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z_planes</span><span class="p">[</span><span class="n">band_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="skeletonize-927"><a href="#skeletonize-927"><span class="linenos"> 927</span></a>
</span><span id="skeletonize-928"><a href="#skeletonize-928"><span class="linenos"> 928</span></a>        <span class="n">band_mesh</span> <span class="o">=</span> <span class="n">_extract_band_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">z_low</span><span class="p">,</span> <span class="n">z_high</span><span class="p">)</span>
</span><span id="skeletonize-929"><a href="#skeletonize-929"><span class="linenos"> 929</span></a>        <span class="k">if</span> <span class="n">band_mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-930"><a href="#skeletonize-930"><span class="linenos"> 930</span></a>            <span class="k">continue</span>
</span><span id="skeletonize-931"><a href="#skeletonize-931"><span class="linenos"> 931</span></a>
</span><span id="skeletonize-932"><a href="#skeletonize-932"><span class="linenos"> 932</span></a>        <span class="c1"># Split into connected components</span>
</span><span id="skeletonize-933"><a href="#skeletonize-933"><span class="linenos"> 933</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-934"><a href="#skeletonize-934"><span class="linenos"> 934</span></a>            <span class="n">components</span> <span class="o">=</span> <span class="n">band_mesh</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">only_watertight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="skeletonize-935"><a href="#skeletonize-935"><span class="linenos"> 935</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-936"><a href="#skeletonize-936"><span class="linenos"> 936</span></a>            <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="n">band_mesh</span><span class="p">]</span>
</span><span id="skeletonize-937"><a href="#skeletonize-937"><span class="linenos"> 937</span></a>        <span class="c1"># Track number of components in this band for potential fallbacks</span>
</span><span id="skeletonize-938"><a href="#skeletonize-938"><span class="linenos"> 938</span></a>        <span class="n">n_comp_in_band</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
</span><span id="skeletonize-939"><a href="#skeletonize-939"><span class="linenos"> 939</span></a>        <span class="n">v_debug</span><span class="p">(</span>
</span><span id="skeletonize-940"><a href="#skeletonize-940"><span class="linenos"> 940</span></a>            <span class="s2">&quot;Band </span><span class="si">%d</span><span class="s2"> [</span><span class="si">%.6g</span><span class="s2">, </span><span class="si">%.6g</span><span class="s2">]: </span><span class="si">%d</span><span class="s2"> component(s)&quot;</span><span class="p">,</span>
</span><span id="skeletonize-941"><a href="#skeletonize-941"><span class="linenos"> 941</span></a>            <span class="n">band_index</span><span class="p">,</span>
</span><span id="skeletonize-942"><a href="#skeletonize-942"><span class="linenos"> 942</span></a>            <span class="n">z_low</span><span class="p">,</span>
</span><span id="skeletonize-943"><a href="#skeletonize-943"><span class="linenos"> 943</span></a>            <span class="n">z_high</span><span class="p">,</span>
</span><span id="skeletonize-944"><a href="#skeletonize-944"><span class="linenos"> 944</span></a>            <span class="n">n_comp_in_band</span><span class="p">,</span>
</span><span id="skeletonize-945"><a href="#skeletonize-945"><span class="linenos"> 945</span></a>        <span class="p">)</span>
</span><span id="skeletonize-946"><a href="#skeletonize-946"><span class="linenos"> 946</span></a>
</span><span id="skeletonize-947"><a href="#skeletonize-947"><span class="linenos"> 947</span></a>        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
</span><span id="skeletonize-948"><a href="#skeletonize-948"><span class="linenos"> 948</span></a>            <span class="c1"># Volumes may be negative if orientation is inverted; take absolute</span>
</span><span id="skeletonize-949"><a href="#skeletonize-949"><span class="linenos"> 949</span></a>            <span class="n">c_vol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
</span><span id="skeletonize-950"><a href="#skeletonize-950"><span class="linenos"> 950</span></a>            <span class="n">c_area</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="skeletonize-951"><a href="#skeletonize-951"><span class="linenos"> 951</span></a>            <span class="n">total_band_volume</span> <span class="o">+=</span> <span class="n">c_vol</span>
</span><span id="skeletonize-952"><a href="#skeletonize-952"><span class="linenos"> 952</span></a>
</span><span id="skeletonize-953"><a href="#skeletonize-953"><span class="linenos"> 953</span></a>            <span class="c1"># Determine associated junctions at z_low (lower) and z_high (upper)</span>
</span><span id="skeletonize-954"><a href="#skeletonize-954"><span class="linenos"> 954</span></a>            <span class="c1"># Probe just inside the band near the lower/upper planes. If nothing is</span>
</span><span id="skeletonize-955"><a href="#skeletonize-955"><span class="linenos"> 955</span></a>            <span class="c1"># detected at the immediate near-plane, incrementally step further</span>
</span><span id="skeletonize-956"><a href="#skeletonize-956"><span class="linenos"> 956</span></a>            <span class="c1"># inside to robustly capture tiny/numerically fragile cross-sections.</span>
</span><span id="skeletonize-957"><a href="#skeletonize-957"><span class="linenos"> 957</span></a>            <span class="n">lower_locals</span> <span class="o">=</span> <span class="n">_section_polygon_centroids</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">z_low</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
</span><span id="skeletonize-958"><a href="#skeletonize-958"><span class="linenos"> 958</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">lower_locals</span><span class="p">:</span>
</span><span id="skeletonize-959"><a href="#skeletonize-959"><span class="linenos"> 959</span></a>                <span class="n">bt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">z_high</span> <span class="o">-</span> <span class="n">z_low</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="skeletonize-960"><a href="#skeletonize-960"><span class="linenos"> 960</span></a>                <span class="n">probe_offsets</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="skeletonize-961"><a href="#skeletonize-961"><span class="linenos"> 961</span></a>                    <span class="mf">5.0</span> <span class="o">*</span> <span class="n">eps</span><span class="p">,</span>
</span><span id="skeletonize-962"><a href="#skeletonize-962"><span class="linenos"> 962</span></a>                    <span class="mf">20.0</span> <span class="o">*</span> <span class="n">eps</span><span class="p">,</span>
</span><span id="skeletonize-963"><a href="#skeletonize-963"><span class="linenos"> 963</span></a>                    <span class="mf">0.001</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-964"><a href="#skeletonize-964"><span class="linenos"> 964</span></a>                    <span class="mf">0.002</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-965"><a href="#skeletonize-965"><span class="linenos"> 965</span></a>                    <span class="mf">0.005</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-966"><a href="#skeletonize-966"><span class="linenos"> 966</span></a>                    <span class="mf">0.01</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-967"><a href="#skeletonize-967"><span class="linenos"> 967</span></a>                <span class="p">]</span>
</span><span id="skeletonize-968"><a href="#skeletonize-968"><span class="linenos"> 968</span></a>                <span class="c1"># Near the bottom boundary, probe a little deeper to avoid</span>
</span><span id="skeletonize-969"><a href="#skeletonize-969"><span class="linenos"> 969</span></a>                <span class="c1"># degenerate sections exactly at the cap. Include terminal_probe</span>
</span><span id="skeletonize-970"><a href="#skeletonize-970"><span class="linenos"> 970</span></a>                <span class="c1"># and larger fractions of the band thickness.</span>
</span><span id="skeletonize-971"><a href="#skeletonize-971"><span class="linenos"> 971</span></a>                <span class="k">if</span> <span class="n">band_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="skeletonize-972"><a href="#skeletonize-972"><span class="linenos"> 972</span></a>                    <span class="n">probe_offsets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="skeletonize-973"><a href="#skeletonize-973"><span class="linenos"> 973</span></a>                        <span class="p">[</span>
</span><span id="skeletonize-974"><a href="#skeletonize-974"><span class="linenos"> 974</span></a>                            <span class="nb">min</span><span class="p">(</span><span class="mf">0.02</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span> <span class="n">terminal_probe</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="skeletonize-975"><a href="#skeletonize-975"><span class="linenos"> 975</span></a>                            <span class="nb">min</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span> <span class="n">terminal_probe</span><span class="p">),</span>
</span><span id="skeletonize-976"><a href="#skeletonize-976"><span class="linenos"> 976</span></a>                            <span class="nb">min</span><span class="p">(</span><span class="mf">0.10</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span> <span class="n">terminal_probe</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>
</span><span id="skeletonize-977"><a href="#skeletonize-977"><span class="linenos"> 977</span></a>                        <span class="p">]</span>
</span><span id="skeletonize-978"><a href="#skeletonize-978"><span class="linenos"> 978</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-979"><a href="#skeletonize-979"><span class="linenos"> 979</span></a>                <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="n">probe_offsets</span><span class="p">:</span>
</span><span id="skeletonize-980"><a href="#skeletonize-980"><span class="linenos"> 980</span></a>                    <span class="k">if</span> <span class="n">off</span> <span class="o">&gt;=</span> <span class="n">bt</span> <span class="ow">or</span> <span class="n">off</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="skeletonize-981"><a href="#skeletonize-981"><span class="linenos"> 981</span></a>                        <span class="k">continue</span>
</span><span id="skeletonize-982"><a href="#skeletonize-982"><span class="linenos"> 982</span></a>                    <span class="n">cand</span> <span class="o">=</span> <span class="n">_section_polygon_centroids</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">z_low</span> <span class="o">+</span> <span class="n">off</span><span class="p">)</span>
</span><span id="skeletonize-983"><a href="#skeletonize-983"><span class="linenos"> 983</span></a>                    <span class="k">if</span> <span class="n">cand</span><span class="p">:</span>
</span><span id="skeletonize-984"><a href="#skeletonize-984"><span class="linenos"> 984</span></a>                        <span class="n">lower_locals</span> <span class="o">=</span> <span class="n">cand</span>
</span><span id="skeletonize-985"><a href="#skeletonize-985"><span class="linenos"> 985</span></a>                        <span class="k">break</span>
</span><span id="skeletonize-986"><a href="#skeletonize-986"><span class="linenos"> 986</span></a>
</span><span id="skeletonize-987"><a href="#skeletonize-987"><span class="linenos"> 987</span></a>            <span class="n">upper_locals</span> <span class="o">=</span> <span class="n">_section_polygon_centroids</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">z_high</span> <span class="o">-</span> <span class="n">eps</span><span class="p">)</span>
</span><span id="skeletonize-988"><a href="#skeletonize-988"><span class="linenos"> 988</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">upper_locals</span><span class="p">:</span>
</span><span id="skeletonize-989"><a href="#skeletonize-989"><span class="linenos"> 989</span></a>                <span class="n">bt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">z_high</span> <span class="o">-</span> <span class="n">z_low</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="skeletonize-990"><a href="#skeletonize-990"><span class="linenos"> 990</span></a>                <span class="n">probe_offsets</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="skeletonize-991"><a href="#skeletonize-991"><span class="linenos"> 991</span></a>                    <span class="mf">5.0</span> <span class="o">*</span> <span class="n">eps</span><span class="p">,</span>
</span><span id="skeletonize-992"><a href="#skeletonize-992"><span class="linenos"> 992</span></a>                    <span class="mf">20.0</span> <span class="o">*</span> <span class="n">eps</span><span class="p">,</span>
</span><span id="skeletonize-993"><a href="#skeletonize-993"><span class="linenos"> 993</span></a>                    <span class="mf">0.001</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-994"><a href="#skeletonize-994"><span class="linenos"> 994</span></a>                    <span class="mf">0.002</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-995"><a href="#skeletonize-995"><span class="linenos"> 995</span></a>                    <span class="mf">0.005</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-996"><a href="#skeletonize-996"><span class="linenos"> 996</span></a>                    <span class="mf">0.01</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span>
</span><span id="skeletonize-997"><a href="#skeletonize-997"><span class="linenos"> 997</span></a>                <span class="p">]</span>
</span><span id="skeletonize-998"><a href="#skeletonize-998"><span class="linenos"> 998</span></a>                <span class="c1"># Near the top boundary, probe a little deeper into the band.</span>
</span><span id="skeletonize-999"><a href="#skeletonize-999"><span class="linenos"> 999</span></a>                <span class="k">if</span> <span class="n">band_index</span> <span class="o">==</span> <span class="n">n_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-1000"><a href="#skeletonize-1000"><span class="linenos">1000</span></a>                    <span class="n">probe_offsets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="skeletonize-1001"><a href="#skeletonize-1001"><span class="linenos">1001</span></a>                        <span class="p">[</span>
</span><span id="skeletonize-1002"><a href="#skeletonize-1002"><span class="linenos">1002</span></a>                            <span class="nb">min</span><span class="p">(</span><span class="mf">0.02</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span> <span class="n">terminal_probe</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="skeletonize-1003"><a href="#skeletonize-1003"><span class="linenos">1003</span></a>                            <span class="nb">min</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span> <span class="n">terminal_probe</span><span class="p">),</span>
</span><span id="skeletonize-1004"><a href="#skeletonize-1004"><span class="linenos">1004</span></a>                            <span class="nb">min</span><span class="p">(</span><span class="mf">0.10</span> <span class="o">*</span> <span class="n">bt</span><span class="p">,</span> <span class="n">terminal_probe</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>
</span><span id="skeletonize-1005"><a href="#skeletonize-1005"><span class="linenos">1005</span></a>                        <span class="p">]</span>
</span><span id="skeletonize-1006"><a href="#skeletonize-1006"><span class="linenos">1006</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-1007"><a href="#skeletonize-1007"><span class="linenos">1007</span></a>                <span class="k">for</span> <span class="n">off</span> <span class="ow">in</span> <span class="n">probe_offsets</span><span class="p">:</span>
</span><span id="skeletonize-1008"><a href="#skeletonize-1008"><span class="linenos">1008</span></a>                    <span class="k">if</span> <span class="n">off</span> <span class="o">&gt;=</span> <span class="n">bt</span> <span class="ow">or</span> <span class="n">off</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="skeletonize-1009"><a href="#skeletonize-1009"><span class="linenos">1009</span></a>                        <span class="k">continue</span>
</span><span id="skeletonize-1010"><a href="#skeletonize-1010"><span class="linenos">1010</span></a>                    <span class="n">cand</span> <span class="o">=</span> <span class="n">_section_polygon_centroids</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">z_high</span> <span class="o">-</span> <span class="n">off</span><span class="p">)</span>
</span><span id="skeletonize-1011"><a href="#skeletonize-1011"><span class="linenos">1011</span></a>                    <span class="k">if</span> <span class="n">cand</span><span class="p">:</span>
</span><span id="skeletonize-1012"><a href="#skeletonize-1012"><span class="linenos">1012</span></a>                        <span class="n">upper_locals</span> <span class="o">=</span> <span class="n">cand</span>
</span><span id="skeletonize-1013"><a href="#skeletonize-1013"><span class="linenos">1013</span></a>                        <span class="k">break</span>
</span><span id="skeletonize-1014"><a href="#skeletonize-1014"><span class="linenos">1014</span></a>
</span><span id="skeletonize-1015"><a href="#skeletonize-1015"><span class="linenos">1015</span></a>            <span class="n">lower_ids</span> <span class="o">=</span> <span class="n">_match_centroids_to_junctions</span><span class="p">(</span>
</span><span id="skeletonize-1016"><a href="#skeletonize-1016"><span class="linenos">1016</span></a>                <span class="n">centroids</span><span class="o">=</span><span class="n">lower_locals</span><span class="p">,</span>
</span><span id="skeletonize-1017"><a href="#skeletonize-1017"><span class="linenos">1017</span></a>                <span class="n">z_plane</span><span class="o">=</span><span class="n">z_low</span><span class="p">,</span>
</span><span id="skeletonize-1018"><a href="#skeletonize-1018"><span class="linenos">1018</span></a>                <span class="n">skel</span><span class="o">=</span><span class="n">skel</span><span class="p">,</span>
</span><span id="skeletonize-1019"><a href="#skeletonize-1019"><span class="linenos">1019</span></a>                <span class="n">slice_index</span><span class="o">=</span><span class="n">band_index</span><span class="p">,</span>
</span><span id="skeletonize-1020"><a href="#skeletonize-1020"><span class="linenos">1020</span></a>            <span class="p">)</span>
</span><span id="skeletonize-1021"><a href="#skeletonize-1021"><span class="linenos">1021</span></a>            <span class="c1"># Targeted fallback for the first band: if no lower matches were found</span>
</span><span id="skeletonize-1022"><a href="#skeletonize-1022"><span class="linenos">1022</span></a>            <span class="c1"># but we do have local centroids and existing junctions at slice 0,</span>
</span><span id="skeletonize-1023"><a href="#skeletonize-1023"><span class="linenos">1023</span></a>            <span class="c1"># assign the nearest junction(s) by polygon centroid proximity.</span>
</span><span id="skeletonize-1024"><a href="#skeletonize-1024"><span class="linenos">1024</span></a>            <span class="k">if</span> <span class="n">band_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lower_ids</span> <span class="ow">and</span> <span class="n">lower_locals</span><span class="p">:</span>
</span><span id="skeletonize-1025"><a href="#skeletonize-1025"><span class="linenos">1025</span></a>                <span class="c1"># Find the cross-section record for slice 0 at z_low</span>
</span><span id="skeletonize-1026"><a href="#skeletonize-1026"><span class="linenos">1026</span></a>                <span class="n">cs_candidates</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="skeletonize-1027"><a href="#skeletonize-1027"><span class="linenos">1027</span></a>                    <span class="n">cs</span>
</span><span id="skeletonize-1028"><a href="#skeletonize-1028"><span class="linenos">1028</span></a>                    <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">skel</span><span class="o">.</span><span class="n">cross_sections</span>
</span><span id="skeletonize-1029"><a href="#skeletonize-1029"><span class="linenos">1029</span></a>                    <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">slice_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">z_low</span><span class="p">)</span>
</span><span id="skeletonize-1030"><a href="#skeletonize-1030"><span class="linenos">1030</span></a>                <span class="p">]</span>
</span><span id="skeletonize-1031"><a href="#skeletonize-1031"><span class="linenos">1031</span></a>                <span class="k">if</span> <span class="n">cs_candidates</span><span class="p">:</span>
</span><span id="skeletonize-1032"><a href="#skeletonize-1032"><span class="linenos">1032</span></a>                    <span class="n">cs0</span> <span class="o">=</span> <span class="n">cs_candidates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="skeletonize-1033"><a href="#skeletonize-1033"><span class="linenos">1033</span></a>                    <span class="c1"># Precompute polygon centroids</span>
</span><span id="skeletonize-1034"><a href="#skeletonize-1034"><span class="linenos">1034</span></a>                    <span class="n">poly_centroids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="skeletonize-1035"><a href="#skeletonize-1035"><span class="linenos">1035</span></a>                    <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">cs0</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
</span><span id="skeletonize-1036"><a href="#skeletonize-1036"><span class="linenos">1036</span></a>                        <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-1037"><a href="#skeletonize-1037"><span class="linenos">1037</span></a>                            <span class="n">poly_centroids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="skeletonize-1038"><a href="#skeletonize-1038"><span class="linenos">1038</span></a>                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">y</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="skeletonize-1039"><a href="#skeletonize-1039"><span class="linenos">1039</span></a>                            <span class="p">)</span>
</span><span id="skeletonize-1040"><a href="#skeletonize-1040"><span class="linenos">1040</span></a>                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-1041"><a href="#skeletonize-1041"><span class="linenos">1041</span></a>                            <span class="n">poly_centroids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="skeletonize-1042"><a href="#skeletonize-1042"><span class="linenos">1042</span></a>                    <span class="n">chosen</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="skeletonize-1043"><a href="#skeletonize-1043"><span class="linenos">1043</span></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">lower_locals</span><span class="p">:</span>
</span><span id="skeletonize-1044"><a href="#skeletonize-1044"><span class="linenos">1044</span></a>                        <span class="n">best_j</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="skeletonize-1045"><a href="#skeletonize-1045"><span class="linenos">1045</span></a>                        <span class="n">best_d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="skeletonize-1046"><a href="#skeletonize-1046"><span class="linenos">1046</span></a>                        <span class="k">for</span> <span class="n">pc</span><span class="p">,</span> <span class="n">j_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">poly_centroids</span><span class="p">,</span> <span class="n">cs0</span><span class="o">.</span><span class="n">junction_ids</span><span class="p">):</span>
</span><span id="skeletonize-1047"><a href="#skeletonize-1047"><span class="linenos">1047</span></a>                            <span class="k">if</span> <span class="n">pc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-1048"><a href="#skeletonize-1048"><span class="linenos">1048</span></a>                                <span class="k">continue</span>
</span><span id="skeletonize-1049"><a href="#skeletonize-1049"><span class="linenos">1049</span></a>                            <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pc</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)))</span>
</span><span id="skeletonize-1050"><a href="#skeletonize-1050"><span class="linenos">1050</span></a>                            <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
</span><span id="skeletonize-1051"><a href="#skeletonize-1051"><span class="linenos">1051</span></a>                                <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="skeletonize-1052"><a href="#skeletonize-1052"><span class="linenos">1052</span></a>                                <span class="n">best_j</span> <span class="o">=</span> <span class="n">j_id</span>
</span><span id="skeletonize-1053"><a href="#skeletonize-1053"><span class="linenos">1053</span></a>                        <span class="k">if</span> <span class="n">best_j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-1054"><a href="#skeletonize-1054"><span class="linenos">1054</span></a>                            <span class="n">chosen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_j</span><span class="p">)</span>
</span><span id="skeletonize-1055"><a href="#skeletonize-1055"><span class="linenos">1055</span></a>                    <span class="c1"># Deduplicate while preserving order</span>
</span><span id="skeletonize-1056"><a href="#skeletonize-1056"><span class="linenos">1056</span></a>                    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="skeletonize-1057"><a href="#skeletonize-1057"><span class="linenos">1057</span></a>                    <span class="n">lower_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">chosen</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">j</span> <span class="ow">in</span> <span class="n">seen</span> <span class="ow">or</span> <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">))]</span>
</span><span id="skeletonize-1058"><a href="#skeletonize-1058"><span class="linenos">1058</span></a>                <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-1059"><a href="#skeletonize-1059"><span class="linenos">1059</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="skeletonize-1060"><a href="#skeletonize-1060"><span class="linenos">1060</span></a>                        <span class="s2">&quot;[diag] band 0 lower fallback -&gt; lower_ids=</span><span class="si">%s</span><span class="s2"> (had lower_locals=</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1061"><a href="#skeletonize-1061"><span class="linenos">1061</span></a>                        <span class="n">lower_ids</span><span class="p">,</span>
</span><span id="skeletonize-1062"><a href="#skeletonize-1062"><span class="linenos">1062</span></a>                        <span class="nb">len</span><span class="p">(</span><span class="n">lower_locals</span><span class="p">),</span>
</span><span id="skeletonize-1063"><a href="#skeletonize-1063"><span class="linenos">1063</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-1064"><a href="#skeletonize-1064"><span class="linenos">1064</span></a>
</span><span id="skeletonize-1065"><a href="#skeletonize-1065"><span class="linenos">1065</span></a>            <span class="c1"># Additional minimal fallback for the very first band: if matching</span>
</span><span id="skeletonize-1066"><a href="#skeletonize-1066"><span class="linenos">1066</span></a>            <span class="c1"># completely failed (no lower_ids), try selecting a single best</span>
</span><span id="skeletonize-1067"><a href="#skeletonize-1067"><span class="linenos">1067</span></a>            <span class="c1"># junction from slice 0 to avoid leaving the terminal isolated.</span>
</span><span id="skeletonize-1068"><a href="#skeletonize-1068"><span class="linenos">1068</span></a>            <span class="k">if</span> <span class="n">band_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lower_ids</span><span class="p">:</span>
</span><span id="skeletonize-1069"><a href="#skeletonize-1069"><span class="linenos">1069</span></a>                <span class="n">cand0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="skeletonize-1070"><a href="#skeletonize-1070"><span class="linenos">1070</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cand0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-1071"><a href="#skeletonize-1071"><span class="linenos">1071</span></a>                    <span class="n">lower_ids</span> <span class="o">=</span> <span class="n">cand0</span>
</span><span id="skeletonize-1072"><a href="#skeletonize-1072"><span class="linenos">1072</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cand0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">upper_locals</span><span class="p">:</span>
</span><span id="skeletonize-1073"><a href="#skeletonize-1073"><span class="linenos">1073</span></a>                    <span class="c1"># Choose the junction whose center is closest to the mean of</span>
</span><span id="skeletonize-1074"><a href="#skeletonize-1074"><span class="linenos">1074</span></a>                    <span class="c1"># the detected upper centroids (xy) as a conservative guess.</span>
</span><span id="skeletonize-1075"><a href="#skeletonize-1075"><span class="linenos">1075</span></a>                    <span class="n">u_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">upper_locals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="skeletonize-1076"><a href="#skeletonize-1076"><span class="linenos">1076</span></a>                    <span class="n">best_j</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="skeletonize-1077"><a href="#skeletonize-1077"><span class="linenos">1077</span></a>                    <span class="n">best_d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="skeletonize-1078"><a href="#skeletonize-1078"><span class="linenos">1078</span></a>                    <span class="k">for</span> <span class="n">j_id</span> <span class="ow">in</span> <span class="n">cand0</span><span class="p">:</span>
</span><span id="skeletonize-1079"><a href="#skeletonize-1079"><span class="linenos">1079</span></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j_id</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1080"><a href="#skeletonize-1080"><span class="linenos">1080</span></a>                        <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="n">u_mean</span><span class="p">))</span>
</span><span id="skeletonize-1081"><a href="#skeletonize-1081"><span class="linenos">1081</span></a>                        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
</span><span id="skeletonize-1082"><a href="#skeletonize-1082"><span class="linenos">1082</span></a>                            <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="skeletonize-1083"><a href="#skeletonize-1083"><span class="linenos">1083</span></a>                            <span class="n">best_j</span> <span class="o">=</span> <span class="n">j_id</span>
</span><span id="skeletonize-1084"><a href="#skeletonize-1084"><span class="linenos">1084</span></a>                    <span class="k">if</span> <span class="n">best_j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-1085"><a href="#skeletonize-1085"><span class="linenos">1085</span></a>                        <span class="n">lower_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_j</span><span class="p">]</span>
</span><span id="skeletonize-1086"><a href="#skeletonize-1086"><span class="linenos">1086</span></a>                <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-1087"><a href="#skeletonize-1087"><span class="linenos">1087</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="skeletonize-1088"><a href="#skeletonize-1088"><span class="linenos">1088</span></a>                        <span class="s2">&quot;[diag] band 0 lower minimal fallback -&gt; lower_ids=</span><span class="si">%s</span><span class="s2"> from slice0 candidates=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1089"><a href="#skeletonize-1089"><span class="linenos">1089</span></a>                        <span class="n">lower_ids</span><span class="p">,</span>
</span><span id="skeletonize-1090"><a href="#skeletonize-1090"><span class="linenos">1090</span></a>                        <span class="n">cand0</span><span class="p">,</span>
</span><span id="skeletonize-1091"><a href="#skeletonize-1091"><span class="linenos">1091</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-1092"><a href="#skeletonize-1092"><span class="linenos">1092</span></a>
</span><span id="skeletonize-1093"><a href="#skeletonize-1093"><span class="linenos">1093</span></a>            <span class="n">upper_slice_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">band_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_slices</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="skeletonize-1094"><a href="#skeletonize-1094"><span class="linenos">1094</span></a>            <span class="n">upper_ids</span> <span class="o">=</span> <span class="n">_match_centroids_to_junctions</span><span class="p">(</span>
</span><span id="skeletonize-1095"><a href="#skeletonize-1095"><span class="linenos">1095</span></a>                <span class="n">centroids</span><span class="o">=</span><span class="n">upper_locals</span><span class="p">,</span>
</span><span id="skeletonize-1096"><a href="#skeletonize-1096"><span class="linenos">1096</span></a>                <span class="n">z_plane</span><span class="o">=</span><span class="n">z_high</span><span class="p">,</span>
</span><span id="skeletonize-1097"><a href="#skeletonize-1097"><span class="linenos">1097</span></a>                <span class="n">skel</span><span class="o">=</span><span class="n">skel</span><span class="p">,</span>
</span><span id="skeletonize-1098"><a href="#skeletonize-1098"><span class="linenos">1098</span></a>                <span class="n">slice_index</span><span class="o">=</span><span class="n">upper_slice_index</span><span class="p">,</span>
</span><span id="skeletonize-1099"><a href="#skeletonize-1099"><span class="linenos">1099</span></a>            <span class="p">)</span>
</span><span id="skeletonize-1100"><a href="#skeletonize-1100"><span class="linenos">1100</span></a>            <span class="n">v_debug</span><span class="p">(</span>
</span><span id="skeletonize-1101"><a href="#skeletonize-1101"><span class="linenos">1101</span></a>                <span class="s2">&quot;Band </span><span class="si">%d</span><span class="s2"> component: matched lower=</span><span class="si">%s</span><span class="s2">, upper=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1102"><a href="#skeletonize-1102"><span class="linenos">1102</span></a>                <span class="n">band_index</span><span class="p">,</span>
</span><span id="skeletonize-1103"><a href="#skeletonize-1103"><span class="linenos">1103</span></a>                <span class="n">lower_ids</span><span class="p">,</span>
</span><span id="skeletonize-1104"><a href="#skeletonize-1104"><span class="linenos">1104</span></a>                <span class="n">upper_ids</span><span class="p">,</span>
</span><span id="skeletonize-1105"><a href="#skeletonize-1105"><span class="linenos">1105</span></a>            <span class="p">)</span>
</span><span id="skeletonize-1106"><a href="#skeletonize-1106"><span class="linenos">1106</span></a>            <span class="c1"># Symmetric minimal fallback for the first band when no upper_ids matched</span>
</span><span id="skeletonize-1107"><a href="#skeletonize-1107"><span class="linenos">1107</span></a>            <span class="k">if</span> <span class="n">band_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">upper_ids</span><span class="p">:</span>
</span><span id="skeletonize-1108"><a href="#skeletonize-1108"><span class="linenos">1108</span></a>                <span class="n">cand1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">upper_slice_index</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="skeletonize-1109"><a href="#skeletonize-1109"><span class="linenos">1109</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cand1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-1110"><a href="#skeletonize-1110"><span class="linenos">1110</span></a>                    <span class="n">upper_ids</span> <span class="o">=</span> <span class="n">cand1</span>
</span><span id="skeletonize-1111"><a href="#skeletonize-1111"><span class="linenos">1111</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cand1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">lower_locals</span><span class="p">:</span>
</span><span id="skeletonize-1112"><a href="#skeletonize-1112"><span class="linenos">1112</span></a>                    <span class="n">l_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lower_locals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="skeletonize-1113"><a href="#skeletonize-1113"><span class="linenos">1113</span></a>                    <span class="n">best_j</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="skeletonize-1114"><a href="#skeletonize-1114"><span class="linenos">1114</span></a>                    <span class="n">best_d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="skeletonize-1115"><a href="#skeletonize-1115"><span class="linenos">1115</span></a>                    <span class="k">for</span> <span class="n">j_id</span> <span class="ow">in</span> <span class="n">cand1</span><span class="p">:</span>
</span><span id="skeletonize-1116"><a href="#skeletonize-1116"><span class="linenos">1116</span></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j_id</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1117"><a href="#skeletonize-1117"><span class="linenos">1117</span></a>                        <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="n">l_mean</span><span class="p">))</span>
</span><span id="skeletonize-1118"><a href="#skeletonize-1118"><span class="linenos">1118</span></a>                        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
</span><span id="skeletonize-1119"><a href="#skeletonize-1119"><span class="linenos">1119</span></a>                            <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="skeletonize-1120"><a href="#skeletonize-1120"><span class="linenos">1120</span></a>                            <span class="n">best_j</span> <span class="o">=</span> <span class="n">j_id</span>
</span><span id="skeletonize-1121"><a href="#skeletonize-1121"><span class="linenos">1121</span></a>                    <span class="k">if</span> <span class="n">best_j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-1122"><a href="#skeletonize-1122"><span class="linenos">1122</span></a>                        <span class="n">upper_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_j</span><span class="p">]</span>
</span><span id="skeletonize-1123"><a href="#skeletonize-1123"><span class="linenos">1123</span></a>                <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-1124"><a href="#skeletonize-1124"><span class="linenos">1124</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="skeletonize-1125"><a href="#skeletonize-1125"><span class="linenos">1125</span></a>                        <span class="s2">&quot;[diag] band 0 upper minimal fallback -&gt; upper_ids=</span><span class="si">%s</span><span class="s2"> from slice1 candidates=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1126"><a href="#skeletonize-1126"><span class="linenos">1126</span></a>                        <span class="n">upper_ids</span><span class="p">,</span>
</span><span id="skeletonize-1127"><a href="#skeletonize-1127"><span class="linenos">1127</span></a>                        <span class="n">cand1</span><span class="p">,</span>
</span><span id="skeletonize-1128"><a href="#skeletonize-1128"><span class="linenos">1128</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-1129"><a href="#skeletonize-1129"><span class="linenos">1129</span></a>            <span class="c1"># Minimal fallback for the last band when no upper_ids matched</span>
</span><span id="skeletonize-1130"><a href="#skeletonize-1130"><span class="linenos">1130</span></a>            <span class="k">if</span> <span class="n">band_index</span> <span class="o">==</span> <span class="n">n_slices</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">upper_ids</span><span class="p">:</span>
</span><span id="skeletonize-1131"><a href="#skeletonize-1131"><span class="linenos">1131</span></a>                <span class="n">candU</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">upper_slice_index</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="skeletonize-1132"><a href="#skeletonize-1132"><span class="linenos">1132</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candU</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-1133"><a href="#skeletonize-1133"><span class="linenos">1133</span></a>                    <span class="n">upper_ids</span> <span class="o">=</span> <span class="n">candU</span>
</span><span id="skeletonize-1134"><a href="#skeletonize-1134"><span class="linenos">1134</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">candU</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">lower_locals</span><span class="p">:</span>
</span><span id="skeletonize-1135"><a href="#skeletonize-1135"><span class="linenos">1135</span></a>                    <span class="n">l_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lower_locals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="skeletonize-1136"><a href="#skeletonize-1136"><span class="linenos">1136</span></a>                    <span class="n">best_j</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="skeletonize-1137"><a href="#skeletonize-1137"><span class="linenos">1137</span></a>                    <span class="n">best_d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="skeletonize-1138"><a href="#skeletonize-1138"><span class="linenos">1138</span></a>                    <span class="k">for</span> <span class="n">j_id</span> <span class="ow">in</span> <span class="n">candU</span><span class="p">:</span>
</span><span id="skeletonize-1139"><a href="#skeletonize-1139"><span class="linenos">1139</span></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j_id</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1140"><a href="#skeletonize-1140"><span class="linenos">1140</span></a>                        <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="n">l_mean</span><span class="p">))</span>
</span><span id="skeletonize-1141"><a href="#skeletonize-1141"><span class="linenos">1141</span></a>                        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
</span><span id="skeletonize-1142"><a href="#skeletonize-1142"><span class="linenos">1142</span></a>                            <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="skeletonize-1143"><a href="#skeletonize-1143"><span class="linenos">1143</span></a>                            <span class="n">best_j</span> <span class="o">=</span> <span class="n">j_id</span>
</span><span id="skeletonize-1144"><a href="#skeletonize-1144"><span class="linenos">1144</span></a>                    <span class="k">if</span> <span class="n">best_j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="skeletonize-1145"><a href="#skeletonize-1145"><span class="linenos">1145</span></a>                        <span class="n">upper_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">best_j</span><span class="p">]</span>
</span><span id="skeletonize-1146"><a href="#skeletonize-1146"><span class="linenos">1146</span></a>
</span><span id="skeletonize-1147"><a href="#skeletonize-1147"><span class="linenos">1147</span></a>            <span class="c1"># Build a Segment metadata object</span>
</span><span id="skeletonize-1148"><a href="#skeletonize-1148"><span class="linenos">1148</span></a>            <span class="n">seg</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span>
</span><span id="skeletonize-1149"><a href="#skeletonize-1149"><span class="linenos">1149</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">segment_id</span><span class="p">,</span>
</span><span id="skeletonize-1150"><a href="#skeletonize-1150"><span class="linenos">1150</span></a>                <span class="n">slice_index</span><span class="o">=</span><span class="n">band_index</span><span class="p">,</span>
</span><span id="skeletonize-1151"><a href="#skeletonize-1151"><span class="linenos">1151</span></a>                <span class="n">z_lower</span><span class="o">=</span><span class="n">z_low</span><span class="p">,</span>
</span><span id="skeletonize-1152"><a href="#skeletonize-1152"><span class="linenos">1152</span></a>                <span class="n">z_upper</span><span class="o">=</span><span class="n">z_high</span><span class="p">,</span>
</span><span id="skeletonize-1153"><a href="#skeletonize-1153"><span class="linenos">1153</span></a>                <span class="n">volume</span><span class="o">=</span><span class="n">c_vol</span><span class="p">,</span>
</span><span id="skeletonize-1154"><a href="#skeletonize-1154"><span class="linenos">1154</span></a>                <span class="n">surface_area</span><span class="o">=</span><span class="n">c_area</span><span class="p">,</span>
</span><span id="skeletonize-1155"><a href="#skeletonize-1155"><span class="linenos">1155</span></a>                <span class="n">lower_junction_ids</span><span class="o">=</span><span class="n">lower_ids</span><span class="p">,</span>
</span><span id="skeletonize-1156"><a href="#skeletonize-1156"><span class="linenos">1156</span></a>                <span class="n">upper_junction_ids</span><span class="o">=</span><span class="n">upper_ids</span><span class="p">,</span>
</span><span id="skeletonize-1157"><a href="#skeletonize-1157"><span class="linenos">1157</span></a>            <span class="p">)</span>
</span><span id="skeletonize-1158"><a href="#skeletonize-1158"><span class="linenos">1158</span></a>            <span class="n">skel</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
</span><span id="skeletonize-1159"><a href="#skeletonize-1159"><span class="linenos">1159</span></a>            <span class="c1"># Simplified connectivity: connect all lower junctions to all upper</span>
</span><span id="skeletonize-1160"><a href="#skeletonize-1160"><span class="linenos">1160</span></a>            <span class="c1"># junctions that are matched within this band component. This</span>
</span><span id="skeletonize-1161"><a href="#skeletonize-1161"><span class="linenos">1161</span></a>            <span class="c1"># ensures connections only occur between adjacent slices and within</span>
</span><span id="skeletonize-1162"><a href="#skeletonize-1162"><span class="linenos">1162</span></a>            <span class="c1"># the same contiguous volume component.</span>
</span><span id="skeletonize-1163"><a href="#skeletonize-1163"><span class="linenos">1163</span></a>            <span class="k">if</span> <span class="n">lower_ids</span> <span class="ow">and</span> <span class="n">upper_ids</span><span class="p">:</span>
</span><span id="skeletonize-1164"><a href="#skeletonize-1164"><span class="linenos">1164</span></a>                <span class="n">skel</span><span class="o">.</span><span class="n">add_segment_edges</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
</span><span id="skeletonize-1165"><a href="#skeletonize-1165"><span class="linenos">1165</span></a>            <span class="n">segment_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="skeletonize-1166"><a href="#skeletonize-1166"><span class="linenos">1166</span></a>
</span><span id="skeletonize-1167"><a href="#skeletonize-1167"><span class="linenos">1167</span></a>    <span class="c1"># -------------------- Attach boundary polylines to nodes -------------------</span>
</span><span id="skeletonize-1168"><a href="#skeletonize-1168"><span class="linenos">1168</span></a>    <span class="c1"># After connectivity is established, store each cross-section polygon&#39;s</span>
</span><span id="skeletonize-1169"><a href="#skeletonize-1169"><span class="linenos">1169</span></a>    <span class="c1"># 2D boundary as a node attribute `boundary_2d` for plotting functions.</span>
</span><span id="skeletonize-1170"><a href="#skeletonize-1170"><span class="linenos">1170</span></a>    <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">skel</span><span class="o">.</span><span class="n">cross_sections</span><span class="p">:</span>
</span><span id="skeletonize-1171"><a href="#skeletonize-1171"><span class="linenos">1171</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cs</span><span class="o">.</span><span class="n">polygons</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cs</span><span class="o">.</span><span class="n">junction_ids</span><span class="p">:</span>
</span><span id="skeletonize-1172"><a href="#skeletonize-1172"><span class="linenos">1172</span></a>            <span class="k">continue</span>
</span><span id="skeletonize-1173"><a href="#skeletonize-1173"><span class="linenos">1173</span></a>        <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">j_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">polygons</span><span class="p">,</span> <span class="n">cs</span><span class="o">.</span><span class="n">junction_ids</span><span class="p">):</span>
</span><span id="skeletonize-1174"><a href="#skeletonize-1174"><span class="linenos">1174</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-1175"><a href="#skeletonize-1175"><span class="linenos">1175</span></a>                <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</span><span id="skeletonize-1176"><a href="#skeletonize-1176"><span class="linenos">1176</span></a>                <span class="k">if</span> <span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-1177"><a href="#skeletonize-1177"><span class="linenos">1177</span></a>                    <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">j_id</span><span class="p">][</span><span class="s2">&quot;boundary_2d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="skeletonize-1178"><a href="#skeletonize-1178"><span class="linenos">1178</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-1179"><a href="#skeletonize-1179"><span class="linenos">1179</span></a>                <span class="c1"># If shapely polygon lacks exterior or any other issue, skip</span>
</span><span id="skeletonize-1180"><a href="#skeletonize-1180"><span class="linenos">1180</span></a>                <span class="k">continue</span>
</span><span id="skeletonize-1181"><a href="#skeletonize-1181"><span class="linenos">1181</span></a>
</span><span id="skeletonize-1182"><a href="#skeletonize-1182"><span class="linenos">1182</span></a>    <span class="c1"># -------------------------- Volume conservation --------------------------</span>
</span><span id="skeletonize-1183"><a href="#skeletonize-1183"><span class="linenos">1183</span></a>    <span class="k">if</span> <span class="n">validate_volume</span><span class="p">:</span>
</span><span id="skeletonize-1184"><a href="#skeletonize-1184"><span class="linenos">1184</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-1185"><a href="#skeletonize-1185"><span class="linenos">1185</span></a>            <span class="n">mesh_vol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
</span><span id="skeletonize-1186"><a href="#skeletonize-1186"><span class="linenos">1186</span></a>            <span class="n">rel_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">total_band_volume</span> <span class="o">-</span> <span class="n">mesh_vol</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mesh_vol</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>
</span><span id="skeletonize-1187"><a href="#skeletonize-1187"><span class="linenos">1187</span></a>            <span class="k">if</span> <span class="n">rel_err</span> <span class="o">&gt;</span> <span class="n">volume_tol</span><span class="p">:</span>
</span><span id="skeletonize-1188"><a href="#skeletonize-1188"><span class="linenos">1188</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="skeletonize-1189"><a href="#skeletonize-1189"><span class="linenos">1189</span></a>                    <span class="sa">f</span><span class="s2">&quot;Volume conservation failed: bands=</span><span class="si">{</span><span class="n">total_band_volume</span><span class="si">:</span><span class="s2">.6g</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="skeletonize-1190"><a href="#skeletonize-1190"><span class="linenos">1190</span></a>                    <span class="sa">f</span><span class="s2">&quot;mesh=</span><span class="si">{</span><span class="n">mesh_vol</span><span class="si">:</span><span class="s2">.6g</span><span class="si">}</span><span class="s2">, rel_err=</span><span class="si">{</span><span class="n">rel_err</span><span class="si">:</span><span class="s2">.3%</span><span class="si">}</span><span class="s2"> (&gt; </span><span class="si">{</span><span class="n">volume_tol</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="skeletonize-1191"><a href="#skeletonize-1191"><span class="linenos">1191</span></a>                <span class="p">)</span>
</span><span id="skeletonize-1192"><a href="#skeletonize-1192"><span class="linenos">1192</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="skeletonize-1193"><a href="#skeletonize-1193"><span class="linenos">1193</span></a>            <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-1194"><a href="#skeletonize-1194"><span class="linenos">1194</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Volume validation warning: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="skeletonize-1195"><a href="#skeletonize-1195"><span class="linenos">1195</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="skeletonize-1196"><a href="#skeletonize-1196"><span class="linenos">1196</span></a>            <span class="n">v_info</span><span class="p">(</span>
</span><span id="skeletonize-1197"><a href="#skeletonize-1197"><span class="linenos">1197</span></a>                <span class="s2">&quot;Volume check OK: bands=</span><span class="si">%.6g</span><span class="s2">, mesh=</span><span class="si">%.6g</span><span class="s2">, rel_err=</span><span class="si">%.3f%%</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1198"><a href="#skeletonize-1198"><span class="linenos">1198</span></a>                <span class="n">total_band_volume</span><span class="p">,</span>
</span><span id="skeletonize-1199"><a href="#skeletonize-1199"><span class="linenos">1199</span></a>                <span class="n">mesh_vol</span><span class="p">,</span>
</span><span id="skeletonize-1200"><a href="#skeletonize-1200"><span class="linenos">1200</span></a>                <span class="mf">100.0</span>
</span><span id="skeletonize-1201"><a href="#skeletonize-1201"><span class="linenos">1201</span></a>                <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">total_band_volume</span> <span class="o">-</span> <span class="n">mesh_vol</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mesh_vol</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)),</span>
</span><span id="skeletonize-1202"><a href="#skeletonize-1202"><span class="linenos">1202</span></a>            <span class="p">)</span>
</span><span id="skeletonize-1203"><a href="#skeletonize-1203"><span class="linenos">1203</span></a>
</span><span id="skeletonize-1204"><a href="#skeletonize-1204"><span class="linenos">1204</span></a>    <span class="c1"># (Removed) Genus-based topological closure: no non-adjacent closure edges are added.</span>
</span><span id="skeletonize-1205"><a href="#skeletonize-1205"><span class="linenos">1205</span></a>
</span><span id="skeletonize-1206"><a href="#skeletonize-1206"><span class="linenos">1206</span></a>    <span class="c1"># ---------------- Safety net: connect isolated terminal nodes -------------</span>
</span><span id="skeletonize-1207"><a href="#skeletonize-1207"><span class="linenos">1207</span></a>    <span class="k">if</span> <span class="n">connect_isolated_terminals</span><span class="p">:</span>
</span><span id="skeletonize-1208"><a href="#skeletonize-1208"><span class="linenos">1208</span></a>        <span class="c1"># Bottom slice 0 isolated nodes connect to nearest in slice 1</span>
</span><span id="skeletonize-1209"><a href="#skeletonize-1209"><span class="linenos">1209</span></a>        <span class="n">s0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="skeletonize-1210"><a href="#skeletonize-1210"><span class="linenos">1210</span></a>        <span class="n">s1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[]))</span> <span class="k">if</span> <span class="n">n_slices</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="skeletonize-1211"><a href="#skeletonize-1211"><span class="linenos">1211</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">s0</span><span class="p">:</span>
</span><span id="skeletonize-1212"><a href="#skeletonize-1212"><span class="linenos">1212</span></a>            <span class="k">if</span> <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">s1</span><span class="p">:</span>
</span><span id="skeletonize-1213"><a href="#skeletonize-1213"><span class="linenos">1213</span></a>                <span class="n">cj</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1214"><a href="#skeletonize-1214"><span class="linenos">1214</span></a>                <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="skeletonize-1215"><a href="#skeletonize-1215"><span class="linenos">1215</span></a>                <span class="n">best_d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="skeletonize-1216"><a href="#skeletonize-1216"><span class="linenos">1216</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s1</span><span class="p">:</span>
</span><span id="skeletonize-1217"><a href="#skeletonize-1217"><span class="linenos">1217</span></a>                    <span class="n">ck</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1218"><a href="#skeletonize-1218"><span class="linenos">1218</span></a>                    <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cj</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ck</span><span class="p">[:</span><span class="mi">2</span><span class="p">])))</span>
</span><span id="skeletonize-1219"><a href="#skeletonize-1219"><span class="linenos">1219</span></a>                    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
</span><span id="skeletonize-1220"><a href="#skeletonize-1220"><span class="linenos">1220</span></a>                        <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="skeletonize-1221"><a href="#skeletonize-1221"><span class="linenos">1221</span></a>                        <span class="n">best</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="skeletonize-1222"><a href="#skeletonize-1222"><span class="linenos">1222</span></a>                <span class="k">if</span> <span class="n">best</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">best</span><span class="p">):</span>
</span><span id="skeletonize-1223"><a href="#skeletonize-1223"><span class="linenos">1223</span></a>                    <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-1224"><a href="#skeletonize-1224"><span class="linenos">1224</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="skeletonize-1225"><a href="#skeletonize-1225"><span class="linenos">1225</span></a>                            <span class="s2">&quot;[diag] safety-net: connecting isolated bottom node </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1226"><a href="#skeletonize-1226"><span class="linenos">1226</span></a>                            <span class="n">j</span><span class="p">,</span>
</span><span id="skeletonize-1227"><a href="#skeletonize-1227"><span class="linenos">1227</span></a>                            <span class="n">best</span><span class="p">,</span>
</span><span id="skeletonize-1228"><a href="#skeletonize-1228"><span class="linenos">1228</span></a>                        <span class="p">)</span>
</span><span id="skeletonize-1229"><a href="#skeletonize-1229"><span class="linenos">1229</span></a>                    <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
</span><span id="skeletonize-1230"><a href="#skeletonize-1230"><span class="linenos">1230</span></a>                        <span class="n">j</span><span class="p">,</span>
</span><span id="skeletonize-1231"><a href="#skeletonize-1231"><span class="linenos">1231</span></a>                        <span class="n">best</span><span class="p">,</span>
</span><span id="skeletonize-1232"><a href="#skeletonize-1232"><span class="linenos">1232</span></a>                        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;segment&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1233"><a href="#skeletonize-1233"><span class="linenos">1233</span></a>                        <span class="n">segment_id</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
</span><span id="skeletonize-1234"><a href="#skeletonize-1234"><span class="linenos">1234</span></a>                        <span class="n">slice_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="skeletonize-1235"><a href="#skeletonize-1235"><span class="linenos">1235</span></a>                        <span class="n">z_lower</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">zmin</span><span class="p">)),</span>
</span><span id="skeletonize-1236"><a href="#skeletonize-1236"><span class="linenos">1236</span></a>                        <span class="n">z_upper</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">best</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">zmin</span><span class="p">)),</span>
</span><span id="skeletonize-1237"><a href="#skeletonize-1237"><span class="linenos">1237</span></a>                        <span class="n">volume</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="skeletonize-1238"><a href="#skeletonize-1238"><span class="linenos">1238</span></a>                        <span class="n">surface_area</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="skeletonize-1239"><a href="#skeletonize-1239"><span class="linenos">1239</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-1240"><a href="#skeletonize-1240"><span class="linenos">1240</span></a>        <span class="c1"># Top slice isolated nodes connect to nearest in previous slice</span>
</span><span id="skeletonize-1241"><a href="#skeletonize-1241"><span class="linenos">1241</span></a>        <span class="n">top_slice</span> <span class="o">=</span> <span class="n">n_slices</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="skeletonize-1242"><a href="#skeletonize-1242"><span class="linenos">1242</span></a>        <span class="n">sT</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">top_slice</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="skeletonize-1243"><a href="#skeletonize-1243"><span class="linenos">1243</span></a>        <span class="n">sPrev</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">junctions_by_slice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">top_slice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[]))</span> <span class="k">if</span> <span class="n">top_slice</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[]</span>
</span><span id="skeletonize-1244"><a href="#skeletonize-1244"><span class="linenos">1244</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sT</span><span class="p">:</span>
</span><span id="skeletonize-1245"><a href="#skeletonize-1245"><span class="linenos">1245</span></a>            <span class="k">if</span> <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">sPrev</span><span class="p">:</span>
</span><span id="skeletonize-1246"><a href="#skeletonize-1246"><span class="linenos">1246</span></a>                <span class="n">cj</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1247"><a href="#skeletonize-1247"><span class="linenos">1247</span></a>                <span class="n">best</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="skeletonize-1248"><a href="#skeletonize-1248"><span class="linenos">1248</span></a>                <span class="n">best_d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
</span><span id="skeletonize-1249"><a href="#skeletonize-1249"><span class="linenos">1249</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sPrev</span><span class="p">:</span>
</span><span id="skeletonize-1250"><a href="#skeletonize-1250"><span class="linenos">1250</span></a>                    <span class="n">ck</span> <span class="o">=</span> <span class="n">skel</span><span class="o">.</span><span class="n">junctions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">center</span>
</span><span id="skeletonize-1251"><a href="#skeletonize-1251"><span class="linenos">1251</span></a>                    <span class="n">d</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cj</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ck</span><span class="p">[:</span><span class="mi">2</span><span class="p">])))</span>
</span><span id="skeletonize-1252"><a href="#skeletonize-1252"><span class="linenos">1252</span></a>                    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">best_d</span><span class="p">:</span>
</span><span id="skeletonize-1253"><a href="#skeletonize-1253"><span class="linenos">1253</span></a>                        <span class="n">best_d</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="skeletonize-1254"><a href="#skeletonize-1254"><span class="linenos">1254</span></a>                        <span class="n">best</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="skeletonize-1255"><a href="#skeletonize-1255"><span class="linenos">1255</span></a>                <span class="k">if</span> <span class="n">best</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">best</span><span class="p">):</span>
</span><span id="skeletonize-1256"><a href="#skeletonize-1256"><span class="linenos">1256</span></a>                    <span class="k">if</span> <span class="n">eff_verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="skeletonize-1257"><a href="#skeletonize-1257"><span class="linenos">1257</span></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="skeletonize-1258"><a href="#skeletonize-1258"><span class="linenos">1258</span></a>                            <span class="s2">&quot;[diag] safety-net: connecting isolated top node </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1259"><a href="#skeletonize-1259"><span class="linenos">1259</span></a>                            <span class="n">j</span><span class="p">,</span>
</span><span id="skeletonize-1260"><a href="#skeletonize-1260"><span class="linenos">1260</span></a>                            <span class="n">best</span><span class="p">,</span>
</span><span id="skeletonize-1261"><a href="#skeletonize-1261"><span class="linenos">1261</span></a>                        <span class="p">)</span>
</span><span id="skeletonize-1262"><a href="#skeletonize-1262"><span class="linenos">1262</span></a>                    <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
</span><span id="skeletonize-1263"><a href="#skeletonize-1263"><span class="linenos">1263</span></a>                        <span class="n">best</span><span class="p">,</span>
</span><span id="skeletonize-1264"><a href="#skeletonize-1264"><span class="linenos">1264</span></a>                        <span class="n">j</span><span class="p">,</span>
</span><span id="skeletonize-1265"><a href="#skeletonize-1265"><span class="linenos">1265</span></a>                        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;segment&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1266"><a href="#skeletonize-1266"><span class="linenos">1266</span></a>                        <span class="n">segment_id</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
</span><span id="skeletonize-1267"><a href="#skeletonize-1267"><span class="linenos">1267</span></a>                        <span class="n">slice_index</span><span class="o">=</span><span class="n">top_slice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="skeletonize-1268"><a href="#skeletonize-1268"><span class="linenos">1268</span></a>                        <span class="n">z_lower</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">best</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">zmax</span><span class="p">)),</span>
</span><span id="skeletonize-1269"><a href="#skeletonize-1269"><span class="linenos">1269</span></a>                        <span class="n">z_upper</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">zmax</span><span class="p">)),</span>
</span><span id="skeletonize-1270"><a href="#skeletonize-1270"><span class="linenos">1270</span></a>                        <span class="n">volume</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="skeletonize-1271"><a href="#skeletonize-1271"><span class="linenos">1271</span></a>                        <span class="n">surface_area</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span id="skeletonize-1272"><a href="#skeletonize-1272"><span class="linenos">1272</span></a>                    <span class="p">)</span>
</span><span id="skeletonize-1273"><a href="#skeletonize-1273"><span class="linenos">1273</span></a>
</span><span id="skeletonize-1274"><a href="#skeletonize-1274"><span class="linenos">1274</span></a>    <span class="c1"># -------------------------- Connectivity check ---------------------------</span>
</span><span id="skeletonize-1275"><a href="#skeletonize-1275"><span class="linenos">1275</span></a>    <span class="c1"># By default, require a single connected component for the SkeletonGraph.</span>
</span><span id="skeletonize-1276"><a href="#skeletonize-1276"><span class="linenos">1276</span></a>    <span class="c1"># This can be bypassed by setting enforce_connected=False.</span>
</span><span id="skeletonize-1277"><a href="#skeletonize-1277"><span class="linenos">1277</span></a>    <span class="k">if</span> <span class="n">enforce_connected</span><span class="p">:</span>
</span><span id="skeletonize-1278"><a href="#skeletonize-1278"><span class="linenos">1278</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="skeletonize-1279"><a href="#skeletonize-1279"><span class="linenos">1279</span></a>            <span class="n">ncomp</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">number_connected_components</span><span class="p">(</span><span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
</span><span id="skeletonize-1280"><a href="#skeletonize-1280"><span class="linenos">1280</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="skeletonize-1281"><a href="#skeletonize-1281"><span class="linenos">1281</span></a>            <span class="n">ncomp</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">2</span>
</span><span id="skeletonize-1282"><a href="#skeletonize-1282"><span class="linenos">1282</span></a>        <span class="k">if</span> <span class="n">ncomp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="skeletonize-1283"><a href="#skeletonize-1283"><span class="linenos">1283</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="skeletonize-1284"><a href="#skeletonize-1284"><span class="linenos">1284</span></a>                <span class="sa">f</span><span class="s2">&quot;SkeletonGraph has </span><span class="si">{</span><span class="n">ncomp</span><span class="si">}</span><span class="s2"> connected components, but a single connected component is required. &quot;</span>
</span><span id="skeletonize-1285"><a href="#skeletonize-1285"><span class="linenos">1285</span></a>                <span class="sa">f</span><span class="s2">&quot;Re-check mesh integrity or call skeletonize(..., enforce_connected=False) to bypass.&quot;</span>
</span><span id="skeletonize-1286"><a href="#skeletonize-1286"><span class="linenos">1286</span></a>            <span class="p">)</span>
</span><span id="skeletonize-1287"><a href="#skeletonize-1287"><span class="linenos">1287</span></a>        <span class="n">v_info</span><span class="p">(</span>
</span><span id="skeletonize-1288"><a href="#skeletonize-1288"><span class="linenos">1288</span></a>            <span class="s2">&quot;Final connectivity: </span><span class="si">%d</span><span class="s2"> node(s), </span><span class="si">%d</span><span class="s2"> edge(s), </span><span class="si">%d</span><span class="s2"> component(s)&quot;</span><span class="p">,</span>
</span><span id="skeletonize-1289"><a href="#skeletonize-1289"><span class="linenos">1289</span></a>            <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">(),</span>
</span><span id="skeletonize-1290"><a href="#skeletonize-1290"><span class="linenos">1290</span></a>            <span class="n">skel</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">(),</span>
</span><span id="skeletonize-1291"><a href="#skeletonize-1291"><span class="linenos">1291</span></a>            <span class="n">ncomp</span><span class="p">,</span>
</span><span id="skeletonize-1292"><a href="#skeletonize-1292"><span class="linenos">1292</span></a>        <span class="p">)</span>
</span><span id="skeletonize-1293"><a href="#skeletonize-1293"><span class="linenos">1293</span></a>
</span><span id="skeletonize-1294"><a href="#skeletonize-1294"><span class="linenos">1294</span></a>    <span class="k">return</span> <span class="n">skel</span>
</span></pre></div>


            <div class="docstring"><p>Build a <code><a href="#SkeletonGraph">SkeletonGraph</a></code> by slicing the mesh along z into <code>n_slices</code> bands.</p>

<p>Steps:
  1) Validate input mesh (watertight, single component)
  2) Create cut planes (n_cuts = n_slices-1) uniformly in z
  3) For each cut, compute cross-section polygons and fit junctions
  4) For each band between adjacent cuts, compute connected components
     and connect lower/upper junctions according to component membership
  5) Optionally validate volume conservation across all bands</p>

<p>Returns:
    SkeletonGraph</p>
</div>


                </section>
                <section id="create_cylinder_mesh">
                            <input id="create_cylinder_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_cylinder_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span>,</span><span class="param">	<span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>,</span><span class="param">	<span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>,</span><span class="param">	<span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="create_cylinder_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_cylinder_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_cylinder_mesh-20"><a href="#create_cylinder_mesh-20"><span class="linenos">20</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_cylinder_mesh</span><span class="p">(</span>
</span><span id="create_cylinder_mesh-21"><a href="#create_cylinder_mesh-21"><span class="linenos">21</span></a>    <span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">,</span>
</span><span id="create_cylinder_mesh-22"><a href="#create_cylinder_mesh-22"><span class="linenos">22</span></a>    <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span id="create_cylinder_mesh-23"><a href="#create_cylinder_mesh-23"><span class="linenos">23</span></a>    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
</span><span id="create_cylinder_mesh-24"><a href="#create_cylinder_mesh-24"><span class="linenos">24</span></a>    <span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
</span><span id="create_cylinder_mesh-25"><a href="#create_cylinder_mesh-25"><span class="linenos">25</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span>
</span><span id="create_cylinder_mesh-26"><a href="#create_cylinder_mesh-26"><span class="linenos">26</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="create_cylinder_mesh-27"><a href="#create_cylinder_mesh-27"><span class="linenos">27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_cylinder_mesh-28"><a href="#create_cylinder_mesh-28"><span class="linenos">28</span></a><span class="sd">    Create a cylindrical mesh representing a simple neuronal process.</span>
</span><span id="create_cylinder_mesh-29"><a href="#create_cylinder_mesh-29"><span class="linenos">29</span></a>
</span><span id="create_cylinder_mesh-30"><a href="#create_cylinder_mesh-30"><span class="linenos">30</span></a><span class="sd">    Args:</span>
</span><span id="create_cylinder_mesh-31"><a href="#create_cylinder_mesh-31"><span class="linenos">31</span></a><span class="sd">        length: Cylinder length (m)</span>
</span><span id="create_cylinder_mesh-32"><a href="#create_cylinder_mesh-32"><span class="linenos">32</span></a><span class="sd">        radius: Cylinder radius (m)</span>
</span><span id="create_cylinder_mesh-33"><a href="#create_cylinder_mesh-33"><span class="linenos">33</span></a><span class="sd">        resolution: Number of circumferential segments</span>
</span><span id="create_cylinder_mesh-34"><a href="#create_cylinder_mesh-34"><span class="linenos">34</span></a><span class="sd">        center: Center position (x, y, z) in m</span>
</span><span id="create_cylinder_mesh-35"><a href="#create_cylinder_mesh-35"><span class="linenos">35</span></a><span class="sd">        axis: Primary axis (&#39;x&#39;, &#39;y&#39;, or &#39;z&#39;)</span>
</span><span id="create_cylinder_mesh-36"><a href="#create_cylinder_mesh-36"><span class="linenos">36</span></a>
</span><span id="create_cylinder_mesh-37"><a href="#create_cylinder_mesh-37"><span class="linenos">37</span></a><span class="sd">    Returns:</span>
</span><span id="create_cylinder_mesh-38"><a href="#create_cylinder_mesh-38"><span class="linenos">38</span></a><span class="sd">        Trimesh cylinder object</span>
</span><span id="create_cylinder_mesh-39"><a href="#create_cylinder_mesh-39"><span class="linenos">39</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_cylinder_mesh-40"><a href="#create_cylinder_mesh-40"><span class="linenos">40</span></a>    <span class="c1"># Create cylinder along z-axis first</span>
</span><span id="create_cylinder_mesh-41"><a href="#create_cylinder_mesh-41"><span class="linenos">41</span></a>    <span class="n">cylinder</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span>
</span><span id="create_cylinder_mesh-42"><a href="#create_cylinder_mesh-42"><span class="linenos">42</span></a>        <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="n">resolution</span>
</span><span id="create_cylinder_mesh-43"><a href="#create_cylinder_mesh-43"><span class="linenos">43</span></a>    <span class="p">)</span>
</span><span id="create_cylinder_mesh-44"><a href="#create_cylinder_mesh-44"><span class="linenos">44</span></a>
</span><span id="create_cylinder_mesh-45"><a href="#create_cylinder_mesh-45"><span class="linenos">45</span></a>    <span class="c1"># Rotate to desired axis if needed</span>
</span><span id="create_cylinder_mesh-46"><a href="#create_cylinder_mesh-46"><span class="linenos">46</span></a>    <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="create_cylinder_mesh-47"><a href="#create_cylinder_mesh-47"><span class="linenos">47</span></a>        <span class="c1"># Rotate 90 degrees around y-axis to align with x</span>
</span><span id="create_cylinder_mesh-48"><a href="#create_cylinder_mesh-48"><span class="linenos">48</span></a>        <span class="n">rotation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="create_cylinder_mesh-49"><a href="#create_cylinder_mesh-49"><span class="linenos">49</span></a>        <span class="n">cylinder</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
</span><span id="create_cylinder_mesh-50"><a href="#create_cylinder_mesh-50"><span class="linenos">50</span></a>    <span class="k">elif</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
</span><span id="create_cylinder_mesh-51"><a href="#create_cylinder_mesh-51"><span class="linenos">51</span></a>        <span class="c1"># Rotate 90 degrees around x-axis to align with y</span>
</span><span id="create_cylinder_mesh-52"><a href="#create_cylinder_mesh-52"><span class="linenos">52</span></a>        <span class="n">rotation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="create_cylinder_mesh-53"><a href="#create_cylinder_mesh-53"><span class="linenos">53</span></a>        <span class="n">cylinder</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
</span><span id="create_cylinder_mesh-54"><a href="#create_cylinder_mesh-54"><span class="linenos">54</span></a>    <span class="c1"># z-axis is default, no rotation needed</span>
</span><span id="create_cylinder_mesh-55"><a href="#create_cylinder_mesh-55"><span class="linenos">55</span></a>
</span><span id="create_cylinder_mesh-56"><a href="#create_cylinder_mesh-56"><span class="linenos">56</span></a>    <span class="c1"># Translate to center position</span>
</span><span id="create_cylinder_mesh-57"><a href="#create_cylinder_mesh-57"><span class="linenos">57</span></a>    <span class="k">if</span> <span class="n">center</span> <span class="o">!=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>
</span><span id="create_cylinder_mesh-58"><a href="#create_cylinder_mesh-58"><span class="linenos">58</span></a>        <span class="n">translation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">translation_matrix</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
</span><span id="create_cylinder_mesh-59"><a href="#create_cylinder_mesh-59"><span class="linenos">59</span></a>        <span class="n">cylinder</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
</span><span id="create_cylinder_mesh-60"><a href="#create_cylinder_mesh-60"><span class="linenos">60</span></a>
</span><span id="create_cylinder_mesh-61"><a href="#create_cylinder_mesh-61"><span class="linenos">61</span></a>    <span class="c1"># Add metadata</span>
</span><span id="create_cylinder_mesh-62"><a href="#create_cylinder_mesh-62"><span class="linenos">62</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;morphology_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cylinder&quot;</span>
</span><span id="create_cylinder_mesh-63"><a href="#create_cylinder_mesh-63"><span class="linenos">63</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span>
</span><span id="create_cylinder_mesh-64"><a href="#create_cylinder_mesh-64"><span class="linenos">64</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
</span><span id="create_cylinder_mesh-65"><a href="#create_cylinder_mesh-65"><span class="linenos">65</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;volume_theoretical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">length</span>
</span><span id="create_cylinder_mesh-66"><a href="#create_cylinder_mesh-66"><span class="linenos">66</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;surface_area_theoretical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="create_cylinder_mesh-67"><a href="#create_cylinder_mesh-67"><span class="linenos">67</span></a>        <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">+</span> <span class="n">length</span><span class="p">)</span>
</span><span id="create_cylinder_mesh-68"><a href="#create_cylinder_mesh-68"><span class="linenos">68</span></a>    <span class="p">)</span>
</span><span id="create_cylinder_mesh-69"><a href="#create_cylinder_mesh-69"><span class="linenos">69</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span>
</span><span id="create_cylinder_mesh-70"><a href="#create_cylinder_mesh-70"><span class="linenos">70</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis</span>
</span><span id="create_cylinder_mesh-71"><a href="#create_cylinder_mesh-71"><span class="linenos">71</span></a>
</span><span id="create_cylinder_mesh-72"><a href="#create_cylinder_mesh-72"><span class="linenos">72</span></a>    <span class="k">return</span> <span class="n">cylinder</span>
</span></pre></div>


            <div class="docstring"><p>Create a cylindrical mesh representing a simple neuronal process.</p>

<p>Args:
    length: Cylinder length (m)
    radius: Cylinder radius (m)
    resolution: Number of circumferential segments
    center: Center position (x, y, z) in m
    axis: Primary axis ('x', 'y', or 'z')</p>

<p>Returns:
    Trimesh cylinder object</p>
</div>


                </section>
                <section id="create_torus_mesh">
                            <input id="create_torus_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_torus_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">major_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span>,</span><span class="param">	<span class="n">minor_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>,</span><span class="param">	<span class="n">major_segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>,</span><span class="param">	<span class="n">minor_segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span>,</span><span class="param">	<span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="create_torus_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_torus_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_torus_mesh-75"><a href="#create_torus_mesh-75"><span class="linenos"> 75</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_torus_mesh</span><span class="p">(</span>
</span><span id="create_torus_mesh-76"><a href="#create_torus_mesh-76"><span class="linenos"> 76</span></a>    <span class="n">major_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">,</span>
</span><span id="create_torus_mesh-77"><a href="#create_torus_mesh-77"><span class="linenos"> 77</span></a>    <span class="n">minor_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span id="create_torus_mesh-78"><a href="#create_torus_mesh-78"><span class="linenos"> 78</span></a>    <span class="n">major_segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="create_torus_mesh-79"><a href="#create_torus_mesh-79"><span class="linenos"> 79</span></a>    <span class="n">minor_segments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
</span><span id="create_torus_mesh-80"><a href="#create_torus_mesh-80"><span class="linenos"> 80</span></a>    <span class="n">center</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
</span><span id="create_torus_mesh-81"><a href="#create_torus_mesh-81"><span class="linenos"> 81</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="create_torus_mesh-82"><a href="#create_torus_mesh-82"><span class="linenos"> 82</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="create_torus_mesh-83"><a href="#create_torus_mesh-83"><span class="linenos"> 83</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_torus_mesh-84"><a href="#create_torus_mesh-84"><span class="linenos"> 84</span></a><span class="sd">    Create a torus mesh representing a ring-shaped neuronal structure.</span>
</span><span id="create_torus_mesh-85"><a href="#create_torus_mesh-85"><span class="linenos"> 85</span></a>
</span><span id="create_torus_mesh-86"><a href="#create_torus_mesh-86"><span class="linenos"> 86</span></a><span class="sd">    Args:</span>
</span><span id="create_torus_mesh-87"><a href="#create_torus_mesh-87"><span class="linenos"> 87</span></a><span class="sd">        major_radius: Radius from center of torus to center of tube (m)</span>
</span><span id="create_torus_mesh-88"><a href="#create_torus_mesh-88"><span class="linenos"> 88</span></a><span class="sd">        minor_radius: Radius of the tube itself (m)</span>
</span><span id="create_torus_mesh-89"><a href="#create_torus_mesh-89"><span class="linenos"> 89</span></a><span class="sd">        major_segments: Number of segments around the major radius</span>
</span><span id="create_torus_mesh-90"><a href="#create_torus_mesh-90"><span class="linenos"> 90</span></a><span class="sd">        minor_segments: Number of segments around the minor radius (tube)</span>
</span><span id="create_torus_mesh-91"><a href="#create_torus_mesh-91"><span class="linenos"> 91</span></a><span class="sd">        center: Center position (x, y, z) in m</span>
</span><span id="create_torus_mesh-92"><a href="#create_torus_mesh-92"><span class="linenos"> 92</span></a><span class="sd">        axis: Axis of symmetry (&#39;x&#39;, &#39;y&#39;, or &#39;z&#39;) - torus rotates around this axis</span>
</span><span id="create_torus_mesh-93"><a href="#create_torus_mesh-93"><span class="linenos"> 93</span></a>
</span><span id="create_torus_mesh-94"><a href="#create_torus_mesh-94"><span class="linenos"> 94</span></a><span class="sd">    Returns:</span>
</span><span id="create_torus_mesh-95"><a href="#create_torus_mesh-95"><span class="linenos"> 95</span></a><span class="sd">        Trimesh torus object</span>
</span><span id="create_torus_mesh-96"><a href="#create_torus_mesh-96"><span class="linenos"> 96</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_torus_mesh-97"><a href="#create_torus_mesh-97"><span class="linenos"> 97</span></a>    <span class="c1"># Create torus using trimesh (default: axis of symmetry along z)</span>
</span><span id="create_torus_mesh-98"><a href="#create_torus_mesh-98"><span class="linenos"> 98</span></a>    <span class="c1"># Handle API differences across trimesh versions by trying multiple signatures</span>
</span><span id="create_torus_mesh-99"><a href="#create_torus_mesh-99"><span class="linenos"> 99</span></a>    <span class="n">torus</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="create_torus_mesh-100"><a href="#create_torus_mesh-100"><span class="linenos">100</span></a>    <span class="n">candidate_kwargs</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="create_torus_mesh-101"><a href="#create_torus_mesh-101"><span class="linenos">101</span></a>        <span class="c1"># Newer style keyword names</span>
</span><span id="create_torus_mesh-102"><a href="#create_torus_mesh-102"><span class="linenos">102</span></a>        <span class="p">{</span>
</span><span id="create_torus_mesh-103"><a href="#create_torus_mesh-103"><span class="linenos">103</span></a>            <span class="s2">&quot;major_radius&quot;</span><span class="p">:</span> <span class="n">major_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-104"><a href="#create_torus_mesh-104"><span class="linenos">104</span></a>            <span class="s2">&quot;minor_radius&quot;</span><span class="p">:</span> <span class="n">minor_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-105"><a href="#create_torus_mesh-105"><span class="linenos">105</span></a>            <span class="s2">&quot;major_sections&quot;</span><span class="p">:</span> <span class="n">major_segments</span><span class="p">,</span>
</span><span id="create_torus_mesh-106"><a href="#create_torus_mesh-106"><span class="linenos">106</span></a>            <span class="s2">&quot;minor_sections&quot;</span><span class="p">:</span> <span class="n">minor_segments</span><span class="p">,</span>
</span><span id="create_torus_mesh-107"><a href="#create_torus_mesh-107"><span class="linenos">107</span></a>        <span class="p">},</span>
</span><span id="create_torus_mesh-108"><a href="#create_torus_mesh-108"><span class="linenos">108</span></a>        <span class="p">{</span>
</span><span id="create_torus_mesh-109"><a href="#create_torus_mesh-109"><span class="linenos">109</span></a>            <span class="s2">&quot;major_radius&quot;</span><span class="p">:</span> <span class="n">major_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-110"><a href="#create_torus_mesh-110"><span class="linenos">110</span></a>            <span class="s2">&quot;minor_radius&quot;</span><span class="p">:</span> <span class="n">minor_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-111"><a href="#create_torus_mesh-111"><span class="linenos">111</span></a>        <span class="p">},</span>
</span><span id="create_torus_mesh-112"><a href="#create_torus_mesh-112"><span class="linenos">112</span></a>        <span class="c1"># Older style keyword names</span>
</span><span id="create_torus_mesh-113"><a href="#create_torus_mesh-113"><span class="linenos">113</span></a>        <span class="p">{</span>
</span><span id="create_torus_mesh-114"><a href="#create_torus_mesh-114"><span class="linenos">114</span></a>            <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="n">major_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-115"><a href="#create_torus_mesh-115"><span class="linenos">115</span></a>            <span class="s2">&quot;tube_radius&quot;</span><span class="p">:</span> <span class="n">minor_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-116"><a href="#create_torus_mesh-116"><span class="linenos">116</span></a>            <span class="s2">&quot;major_sections&quot;</span><span class="p">:</span> <span class="n">major_segments</span><span class="p">,</span>
</span><span id="create_torus_mesh-117"><a href="#create_torus_mesh-117"><span class="linenos">117</span></a>            <span class="s2">&quot;minor_sections&quot;</span><span class="p">:</span> <span class="n">minor_segments</span><span class="p">,</span>
</span><span id="create_torus_mesh-118"><a href="#create_torus_mesh-118"><span class="linenos">118</span></a>        <span class="p">},</span>
</span><span id="create_torus_mesh-119"><a href="#create_torus_mesh-119"><span class="linenos">119</span></a>        <span class="p">{</span>
</span><span id="create_torus_mesh-120"><a href="#create_torus_mesh-120"><span class="linenos">120</span></a>            <span class="s2">&quot;radius&quot;</span><span class="p">:</span> <span class="n">major_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-121"><a href="#create_torus_mesh-121"><span class="linenos">121</span></a>            <span class="s2">&quot;tube_radius&quot;</span><span class="p">:</span> <span class="n">minor_radius</span><span class="p">,</span>
</span><span id="create_torus_mesh-122"><a href="#create_torus_mesh-122"><span class="linenos">122</span></a>        <span class="p">},</span>
</span><span id="create_torus_mesh-123"><a href="#create_torus_mesh-123"><span class="linenos">123</span></a>    <span class="p">]</span>
</span><span id="create_torus_mesh-124"><a href="#create_torus_mesh-124"><span class="linenos">124</span></a>
</span><span id="create_torus_mesh-125"><a href="#create_torus_mesh-125"><span class="linenos">125</span></a>    <span class="n">last_err</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="create_torus_mesh-126"><a href="#create_torus_mesh-126"><span class="linenos">126</span></a>    <span class="k">for</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">candidate_kwargs</span><span class="p">:</span>
</span><span id="create_torus_mesh-127"><a href="#create_torus_mesh-127"><span class="linenos">127</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="create_torus_mesh-128"><a href="#create_torus_mesh-128"><span class="linenos">128</span></a>            <span class="n">torus</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">torus</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="create_torus_mesh-129"><a href="#create_torus_mesh-129"><span class="linenos">129</span></a>            <span class="k">break</span>
</span><span id="create_torus_mesh-130"><a href="#create_torus_mesh-130"><span class="linenos">130</span></a>        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_torus_mesh-131"><a href="#create_torus_mesh-131"><span class="linenos">131</span></a>            <span class="n">last_err</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="create_torus_mesh-132"><a href="#create_torus_mesh-132"><span class="linenos">132</span></a>            <span class="k">continue</span>
</span><span id="create_torus_mesh-133"><a href="#create_torus_mesh-133"><span class="linenos">133</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_torus_mesh-134"><a href="#create_torus_mesh-134"><span class="linenos">134</span></a>            <span class="n">last_err</span> <span class="o">=</span> <span class="n">e</span>
</span><span id="create_torus_mesh-135"><a href="#create_torus_mesh-135"><span class="linenos">135</span></a>            <span class="k">continue</span>
</span><span id="create_torus_mesh-136"><a href="#create_torus_mesh-136"><span class="linenos">136</span></a>
</span><span id="create_torus_mesh-137"><a href="#create_torus_mesh-137"><span class="linenos">137</span></a>    <span class="k">if</span> <span class="n">torus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="create_torus_mesh-138"><a href="#create_torus_mesh-138"><span class="linenos">138</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="create_torus_mesh-139"><a href="#create_torus_mesh-139"><span class="linenos">139</span></a>            <span class="sa">f</span><span class="s2">&quot;Failed to construct torus with trimesh.creation.torus using multiple signatures: </span><span class="si">{</span><span class="n">last_err</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="create_torus_mesh-140"><a href="#create_torus_mesh-140"><span class="linenos">140</span></a>        <span class="p">)</span>
</span><span id="create_torus_mesh-141"><a href="#create_torus_mesh-141"><span class="linenos">141</span></a>
</span><span id="create_torus_mesh-142"><a href="#create_torus_mesh-142"><span class="linenos">142</span></a>    <span class="c1"># Rotate to desired axis of symmetry if needed</span>
</span><span id="create_torus_mesh-143"><a href="#create_torus_mesh-143"><span class="linenos">143</span></a>    <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
</span><span id="create_torus_mesh-144"><a href="#create_torus_mesh-144"><span class="linenos">144</span></a>        <span class="c1"># Rotate 90 degrees around y-axis to make x the axis of symmetry</span>
</span><span id="create_torus_mesh-145"><a href="#create_torus_mesh-145"><span class="linenos">145</span></a>        <span class="n">rotation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="create_torus_mesh-146"><a href="#create_torus_mesh-146"><span class="linenos">146</span></a>        <span class="n">torus</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
</span><span id="create_torus_mesh-147"><a href="#create_torus_mesh-147"><span class="linenos">147</span></a>    <span class="k">elif</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
</span><span id="create_torus_mesh-148"><a href="#create_torus_mesh-148"><span class="linenos">148</span></a>        <span class="c1"># Rotate 90 degrees around x-axis to make y the axis of symmetry</span>
</span><span id="create_torus_mesh-149"><a href="#create_torus_mesh-149"><span class="linenos">149</span></a>        <span class="n">rotation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="create_torus_mesh-150"><a href="#create_torus_mesh-150"><span class="linenos">150</span></a>        <span class="n">torus</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
</span><span id="create_torus_mesh-151"><a href="#create_torus_mesh-151"><span class="linenos">151</span></a>    <span class="c1"># z-axis is default, no rotation needed</span>
</span><span id="create_torus_mesh-152"><a href="#create_torus_mesh-152"><span class="linenos">152</span></a>
</span><span id="create_torus_mesh-153"><a href="#create_torus_mesh-153"><span class="linenos">153</span></a>    <span class="c1"># Translate to center position if needed</span>
</span><span id="create_torus_mesh-154"><a href="#create_torus_mesh-154"><span class="linenos">154</span></a>    <span class="k">if</span> <span class="n">center</span> <span class="o">!=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>
</span><span id="create_torus_mesh-155"><a href="#create_torus_mesh-155"><span class="linenos">155</span></a>        <span class="n">translation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">translation_matrix</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
</span><span id="create_torus_mesh-156"><a href="#create_torus_mesh-156"><span class="linenos">156</span></a>        <span class="n">torus</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
</span><span id="create_torus_mesh-157"><a href="#create_torus_mesh-157"><span class="linenos">157</span></a>
</span><span id="create_torus_mesh-158"><a href="#create_torus_mesh-158"><span class="linenos">158</span></a>    <span class="c1"># Add metadata</span>
</span><span id="create_torus_mesh-159"><a href="#create_torus_mesh-159"><span class="linenos">159</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;morphology_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;torus&quot;</span>
</span><span id="create_torus_mesh-160"><a href="#create_torus_mesh-160"><span class="linenos">160</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;major_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">major_radius</span>
</span><span id="create_torus_mesh-161"><a href="#create_torus_mesh-161"><span class="linenos">161</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;minor_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minor_radius</span>
</span><span id="create_torus_mesh-162"><a href="#create_torus_mesh-162"><span class="linenos">162</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span>
</span><span id="create_torus_mesh-163"><a href="#create_torus_mesh-163"><span class="linenos">163</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis</span>
</span><span id="create_torus_mesh-164"><a href="#create_torus_mesh-164"><span class="linenos">164</span></a>
</span><span id="create_torus_mesh-165"><a href="#create_torus_mesh-165"><span class="linenos">165</span></a>    <span class="c1"># Calculate theoretical properties</span>
</span><span id="create_torus_mesh-166"><a href="#create_torus_mesh-166"><span class="linenos">166</span></a>    <span class="n">volume_theoretical</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">major_radius</span> <span class="o">*</span> <span class="n">minor_radius</span><span class="o">**</span><span class="mi">2</span>
</span><span id="create_torus_mesh-167"><a href="#create_torus_mesh-167"><span class="linenos">167</span></a>    <span class="n">surface_area_theoretical</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">major_radius</span> <span class="o">*</span> <span class="n">minor_radius</span>
</span><span id="create_torus_mesh-168"><a href="#create_torus_mesh-168"><span class="linenos">168</span></a>
</span><span id="create_torus_mesh-169"><a href="#create_torus_mesh-169"><span class="linenos">169</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;volume_theoretical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_theoretical</span>
</span><span id="create_torus_mesh-170"><a href="#create_torus_mesh-170"><span class="linenos">170</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;surface_area_theoretical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">surface_area_theoretical</span>
</span><span id="create_torus_mesh-171"><a href="#create_torus_mesh-171"><span class="linenos">171</span></a>
</span><span id="create_torus_mesh-172"><a href="#create_torus_mesh-172"><span class="linenos">172</span></a>    <span class="k">return</span> <span class="n">torus</span>
</span></pre></div>


            <div class="docstring"><p>Create a torus mesh representing a ring-shaped neuronal structure.</p>

<p>Args:
    major_radius: Radius from center of torus to center of tube (m)
    minor_radius: Radius of the tube itself (m)
    major_segments: Number of segments around the major radius
    minor_segments: Number of segments around the minor radius (tube)
    center: Center position (x, y, z) in m
    axis: Axis of symmetry ('x', 'y', or 'z') - torus rotates around this axis</p>

<p>Returns:
    Trimesh torus object</p>
</div>


                </section>
                <section id="create_branching_mesh">
                            <input id="create_branching_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_branching_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">trunk_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">60.0</span>,</span><span class="param">	<span class="n">trunk_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>,</span><span class="param">	<span class="n">branch_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">40.0</span>,</span><span class="param">	<span class="n">branch_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span>,</span><span class="param">	<span class="n">branch_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">45.0</span>,</span><span class="param">	<span class="n">num_branches</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span>,</span><span class="param">	<span class="n">smooth_junctions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="create_branching_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_branching_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_branching_mesh-198"><a href="#create_branching_mesh-198"><span class="linenos">198</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_branching_mesh</span><span class="p">(</span>
</span><span id="create_branching_mesh-199"><a href="#create_branching_mesh-199"><span class="linenos">199</span></a>    <span class="n">trunk_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">60.0</span><span class="p">,</span>
</span><span id="create_branching_mesh-200"><a href="#create_branching_mesh-200"><span class="linenos">200</span></a>    <span class="n">trunk_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
</span><span id="create_branching_mesh-201"><a href="#create_branching_mesh-201"><span class="linenos">201</span></a>    <span class="n">branch_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">40.0</span><span class="p">,</span>
</span><span id="create_branching_mesh-202"><a href="#create_branching_mesh-202"><span class="linenos">202</span></a>    <span class="n">branch_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
</span><span id="create_branching_mesh-203"><a href="#create_branching_mesh-203"><span class="linenos">203</span></a>    <span class="n">branch_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">45.0</span><span class="p">,</span>
</span><span id="create_branching_mesh-204"><a href="#create_branching_mesh-204"><span class="linenos">204</span></a>    <span class="n">num_branches</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="create_branching_mesh-205"><a href="#create_branching_mesh-205"><span class="linenos">205</span></a>    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
</span><span id="create_branching_mesh-206"><a href="#create_branching_mesh-206"><span class="linenos">206</span></a>    <span class="n">smooth_junctions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="create_branching_mesh-207"><a href="#create_branching_mesh-207"><span class="linenos">207</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="create_branching_mesh-208"><a href="#create_branching_mesh-208"><span class="linenos">208</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_branching_mesh-209"><a href="#create_branching_mesh-209"><span class="linenos">209</span></a><span class="sd">    Create a branching mesh representing a dendritic or axonal tree.</span>
</span><span id="create_branching_mesh-210"><a href="#create_branching_mesh-210"><span class="linenos">210</span></a>
</span><span id="create_branching_mesh-211"><a href="#create_branching_mesh-211"><span class="linenos">211</span></a><span class="sd">    Args:</span>
</span><span id="create_branching_mesh-212"><a href="#create_branching_mesh-212"><span class="linenos">212</span></a><span class="sd">        trunk_length: Length of main trunk (m)</span>
</span><span id="create_branching_mesh-213"><a href="#create_branching_mesh-213"><span class="linenos">213</span></a><span class="sd">        trunk_radius: Radius of main trunk (m)</span>
</span><span id="create_branching_mesh-214"><a href="#create_branching_mesh-214"><span class="linenos">214</span></a><span class="sd">        branch_length: Length of each branch (m)</span>
</span><span id="create_branching_mesh-215"><a href="#create_branching_mesh-215"><span class="linenos">215</span></a><span class="sd">        branch_radius: Radius of each branch (m)</span>
</span><span id="create_branching_mesh-216"><a href="#create_branching_mesh-216"><span class="linenos">216</span></a><span class="sd">        branch_angle: Angle of branches from trunk axis (degrees)</span>
</span><span id="create_branching_mesh-217"><a href="#create_branching_mesh-217"><span class="linenos">217</span></a><span class="sd">        num_branches: Number of branches (2 for Y-shape, more for multi-branch)</span>
</span><span id="create_branching_mesh-218"><a href="#create_branching_mesh-218"><span class="linenos">218</span></a><span class="sd">        resolution: Number of circumferential segments</span>
</span><span id="create_branching_mesh-219"><a href="#create_branching_mesh-219"><span class="linenos">219</span></a><span class="sd">        smooth_junctions: Whether to smooth branch junctions</span>
</span><span id="create_branching_mesh-220"><a href="#create_branching_mesh-220"><span class="linenos">220</span></a>
</span><span id="create_branching_mesh-221"><a href="#create_branching_mesh-221"><span class="linenos">221</span></a><span class="sd">    Returns:</span>
</span><span id="create_branching_mesh-222"><a href="#create_branching_mesh-222"><span class="linenos">222</span></a><span class="sd">        Trimesh object with branching structure</span>
</span><span id="create_branching_mesh-223"><a href="#create_branching_mesh-223"><span class="linenos">223</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_branching_mesh-224"><a href="#create_branching_mesh-224"><span class="linenos">224</span></a>    <span class="c1"># Create main trunk along z-axis</span>
</span><span id="create_branching_mesh-225"><a href="#create_branching_mesh-225"><span class="linenos">225</span></a>    <span class="n">trunk</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span>
</span><span id="create_branching_mesh-226"><a href="#create_branching_mesh-226"><span class="linenos">226</span></a>        <span class="n">radius</span><span class="o">=</span><span class="n">trunk_radius</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">trunk_length</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="n">resolution</span>
</span><span id="create_branching_mesh-227"><a href="#create_branching_mesh-227"><span class="linenos">227</span></a>    <span class="p">)</span>
</span><span id="create_branching_mesh-228"><a href="#create_branching_mesh-228"><span class="linenos">228</span></a>
</span><span id="create_branching_mesh-229"><a href="#create_branching_mesh-229"><span class="linenos">229</span></a>    <span class="c1"># Position trunk so top is at z=trunk_length</span>
</span><span id="create_branching_mesh-230"><a href="#create_branching_mesh-230"><span class="linenos">230</span></a>    <span class="n">trunk_translation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">translation_matrix</span><span class="p">(</span>
</span><span id="create_branching_mesh-231"><a href="#create_branching_mesh-231"><span class="linenos">231</span></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">trunk_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="create_branching_mesh-232"><a href="#create_branching_mesh-232"><span class="linenos">232</span></a>    <span class="p">)</span>
</span><span id="create_branching_mesh-233"><a href="#create_branching_mesh-233"><span class="linenos">233</span></a>    <span class="n">trunk</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">trunk_translation</span><span class="p">)</span>
</span><span id="create_branching_mesh-234"><a href="#create_branching_mesh-234"><span class="linenos">234</span></a>
</span><span id="create_branching_mesh-235"><a href="#create_branching_mesh-235"><span class="linenos">235</span></a>    <span class="c1"># Create branches</span>
</span><span id="create_branching_mesh-236"><a href="#create_branching_mesh-236"><span class="linenos">236</span></a>    <span class="n">branches</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="create_branching_mesh-237"><a href="#create_branching_mesh-237"><span class="linenos">237</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_branches</span><span class="p">):</span>
</span><span id="create_branching_mesh-238"><a href="#create_branching_mesh-238"><span class="linenos">238</span></a>        <span class="c1"># Create branch cylinder (initially centered at origin along z-axis)</span>
</span><span id="create_branching_mesh-239"><a href="#create_branching_mesh-239"><span class="linenos">239</span></a>        <span class="n">branch</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span>
</span><span id="create_branching_mesh-240"><a href="#create_branching_mesh-240"><span class="linenos">240</span></a>            <span class="n">radius</span><span class="o">=</span><span class="n">branch_radius</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">branch_length</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">resolution</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="create_branching_mesh-241"><a href="#create_branching_mesh-241"><span class="linenos">241</span></a>        <span class="p">)</span>
</span><span id="create_branching_mesh-242"><a href="#create_branching_mesh-242"><span class="linenos">242</span></a>
</span><span id="create_branching_mesh-243"><a href="#create_branching_mesh-243"><span class="linenos">243</span></a>        <span class="c1"># Calculate branch angle in radians</span>
</span><span id="create_branching_mesh-244"><a href="#create_branching_mesh-244"><span class="linenos">244</span></a>        <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">branch_angle</span><span class="p">)</span>
</span><span id="create_branching_mesh-245"><a href="#create_branching_mesh-245"><span class="linenos">245</span></a>
</span><span id="create_branching_mesh-246"><a href="#create_branching_mesh-246"><span class="linenos">246</span></a>        <span class="c1"># Calculate rotation angle around z-axis for this branch</span>
</span><span id="create_branching_mesh-247"><a href="#create_branching_mesh-247"><span class="linenos">247</span></a>        <span class="n">azimuth_angle</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_branches</span>
</span><span id="create_branching_mesh-248"><a href="#create_branching_mesh-248"><span class="linenos">248</span></a>
</span><span id="create_branching_mesh-249"><a href="#create_branching_mesh-249"><span class="linenos">249</span></a>        <span class="c1"># Step 1: Rotate the branch around its center to desired angle</span>
</span><span id="create_branching_mesh-250"><a href="#create_branching_mesh-250"><span class="linenos">250</span></a>        <span class="c1"># Rotate around axis perpendicular to both z-axis and the desired branch direction</span>
</span><span id="create_branching_mesh-251"><a href="#create_branching_mesh-251"><span class="linenos">251</span></a>        <span class="n">rotation_axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuth_angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">azimuth_angle</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="create_branching_mesh-252"><a href="#create_branching_mesh-252"><span class="linenos">252</span></a>        <span class="n">rotation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">,</span> <span class="n">rotation_axis</span><span class="p">)</span>
</span><span id="create_branching_mesh-253"><a href="#create_branching_mesh-253"><span class="linenos">253</span></a>        <span class="n">branch</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
</span><span id="create_branching_mesh-254"><a href="#create_branching_mesh-254"><span class="linenos">254</span></a>
</span><span id="create_branching_mesh-255"><a href="#create_branching_mesh-255"><span class="linenos">255</span></a>        <span class="c1"># Step 2: Calculate where the bottom of the rotated branch is now</span>
</span><span id="create_branching_mesh-256"><a href="#create_branching_mesh-256"><span class="linenos">256</span></a>        <span class="c1"># The original bottom was at [0, 0, -branch_length/2]</span>
</span><span id="create_branching_mesh-257"><a href="#create_branching_mesh-257"><span class="linenos">257</span></a>        <span class="n">original_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="create_branching_mesh-258"><a href="#create_branching_mesh-258"><span class="linenos">258</span></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">branch_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="create_branching_mesh-259"><a href="#create_branching_mesh-259"><span class="linenos">259</span></a>        <span class="p">)</span>  <span class="c1"># homogeneous coordinates</span>
</span><span id="create_branching_mesh-260"><a href="#create_branching_mesh-260"><span class="linenos">260</span></a>        <span class="n">rotated_bottom</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">original_bottom</span>
</span><span id="create_branching_mesh-261"><a href="#create_branching_mesh-261"><span class="linenos">261</span></a>
</span><span id="create_branching_mesh-262"><a href="#create_branching_mesh-262"><span class="linenos">262</span></a>        <span class="c1"># Step 3: Translate so the bottom of the branch is at trunk top</span>
</span><span id="create_branching_mesh-263"><a href="#create_branching_mesh-263"><span class="linenos">263</span></a>        <span class="c1"># We want rotated_bottom to be at [0, 0, trunk_length]</span>
</span><span id="create_branching_mesh-264"><a href="#create_branching_mesh-264"><span class="linenos">264</span></a>        <span class="n">target_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">trunk_length</span><span class="p">])</span>
</span><span id="create_branching_mesh-265"><a href="#create_branching_mesh-265"><span class="linenos">265</span></a>        <span class="n">translation_vector</span> <span class="o">=</span> <span class="n">target_bottom</span> <span class="o">-</span> <span class="n">rotated_bottom</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="create_branching_mesh-266"><a href="#create_branching_mesh-266"><span class="linenos">266</span></a>        <span class="n">translation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">translation_matrix</span><span class="p">(</span><span class="n">translation_vector</span><span class="p">)</span>
</span><span id="create_branching_mesh-267"><a href="#create_branching_mesh-267"><span class="linenos">267</span></a>        <span class="n">branch</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
</span><span id="create_branching_mesh-268"><a href="#create_branching_mesh-268"><span class="linenos">268</span></a>
</span><span id="create_branching_mesh-269"><a href="#create_branching_mesh-269"><span class="linenos">269</span></a>        <span class="n">branches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="create_branching_mesh-270"><a href="#create_branching_mesh-270"><span class="linenos">270</span></a>            <span class="n">branch</span>
</span><span id="create_branching_mesh-271"><a href="#create_branching_mesh-271"><span class="linenos">271</span></a>        <span class="p">)</span>  <span class="c1"># Combine using boolean union operations for clean exterior surface</span>
</span><span id="create_branching_mesh-272"><a href="#create_branching_mesh-272"><span class="linenos">272</span></a>    <span class="n">all_meshes</span> <span class="o">=</span> <span class="p">[</span><span class="n">trunk</span><span class="p">]</span> <span class="o">+</span> <span class="n">branches</span>
</span><span id="create_branching_mesh-273"><a href="#create_branching_mesh-273"><span class="linenos">273</span></a>
</span><span id="create_branching_mesh-274"><a href="#create_branching_mesh-274"><span class="linenos">274</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="create_branching_mesh-275"><a href="#create_branching_mesh-275"><span class="linenos">275</span></a>        <span class="c1"># Use boolean union to combine all overlapping shapes cleanly</span>
</span><span id="create_branching_mesh-276"><a href="#create_branching_mesh-276"><span class="linenos">276</span></a>        <span class="n">combined</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">boolean</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">all_meshes</span><span class="p">)</span>
</span><span id="create_branching_mesh-277"><a href="#create_branching_mesh-277"><span class="linenos">277</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_branching_mesh-278"><a href="#create_branching_mesh-278"><span class="linenos">278</span></a>        <span class="c1"># If union fails, fall back to concatenation</span>
</span><span id="create_branching_mesh-279"><a href="#create_branching_mesh-279"><span class="linenos">279</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Boolean union failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using concatenation&quot;</span><span class="p">)</span>
</span><span id="create_branching_mesh-280"><a href="#create_branching_mesh-280"><span class="linenos">280</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Boolean union failed: </span><span class="si">%s</span><span class="s2">; using concatenation&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="create_branching_mesh-281"><a href="#create_branching_mesh-281"><span class="linenos">281</span></a>        <span class="n">combined</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_meshes</span><span class="p">)</span>
</span><span id="create_branching_mesh-282"><a href="#create_branching_mesh-282"><span class="linenos">282</span></a>
</span><span id="create_branching_mesh-283"><a href="#create_branching_mesh-283"><span class="linenos">283</span></a>    <span class="c1"># Smooth junctions if requested</span>
</span><span id="create_branching_mesh-284"><a href="#create_branching_mesh-284"><span class="linenos">284</span></a>    <span class="k">if</span> <span class="n">smooth_junctions</span><span class="p">:</span>
</span><span id="create_branching_mesh-285"><a href="#create_branching_mesh-285"><span class="linenos">285</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="create_branching_mesh-286"><a href="#create_branching_mesh-286"><span class="linenos">286</span></a>            <span class="c1"># Apply light smoothing to reduce sharp edges at junctions</span>
</span><span id="create_branching_mesh-287"><a href="#create_branching_mesh-287"><span class="linenos">287</span></a>            <span class="n">combined</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">smoothed</span><span class="p">()</span>
</span><span id="create_branching_mesh-288"><a href="#create_branching_mesh-288"><span class="linenos">288</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_branching_mesh-289"><a href="#create_branching_mesh-289"><span class="linenos">289</span></a>            <span class="c1"># If smoothing fails, continue with unsmoothed mesh</span>
</span><span id="create_branching_mesh-290"><a href="#create_branching_mesh-290"><span class="linenos">290</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Could not smooth branch junctions, using unsmoothed mesh&quot;</span><span class="p">)</span>
</span><span id="create_branching_mesh-291"><a href="#create_branching_mesh-291"><span class="linenos">291</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Smoothing failed at branch junctions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="create_branching_mesh-292"><a href="#create_branching_mesh-292"><span class="linenos">292</span></a>
</span><span id="create_branching_mesh-293"><a href="#create_branching_mesh-293"><span class="linenos">293</span></a>    <span class="c1"># Add metadata</span>
</span><span id="create_branching_mesh-294"><a href="#create_branching_mesh-294"><span class="linenos">294</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;morphology_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;branching&quot;</span>
</span><span id="create_branching_mesh-295"><a href="#create_branching_mesh-295"><span class="linenos">295</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;trunk_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trunk_length</span>
</span><span id="create_branching_mesh-296"><a href="#create_branching_mesh-296"><span class="linenos">296</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;trunk_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trunk_radius</span>
</span><span id="create_branching_mesh-297"><a href="#create_branching_mesh-297"><span class="linenos">297</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;branch_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">branch_length</span>
</span><span id="create_branching_mesh-298"><a href="#create_branching_mesh-298"><span class="linenos">298</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;branch_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">branch_radius</span>
</span><span id="create_branching_mesh-299"><a href="#create_branching_mesh-299"><span class="linenos">299</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;branch_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">branch_angle</span>
</span><span id="create_branching_mesh-300"><a href="#create_branching_mesh-300"><span class="linenos">300</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;num_branches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_branches</span>
</span><span id="create_branching_mesh-301"><a href="#create_branching_mesh-301"><span class="linenos">301</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;total_branches&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_branches</span>
</span><span id="create_branching_mesh-302"><a href="#create_branching_mesh-302"><span class="linenos">302</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;smooth_junctions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">smooth_junctions</span>
</span><span id="create_branching_mesh-303"><a href="#create_branching_mesh-303"><span class="linenos">303</span></a>
</span><span id="create_branching_mesh-304"><a href="#create_branching_mesh-304"><span class="linenos">304</span></a>    <span class="c1"># Calculate theoretical properties</span>
</span><span id="create_branching_mesh-305"><a href="#create_branching_mesh-305"><span class="linenos">305</span></a>    <span class="n">trunk_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">trunk_radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">trunk_length</span>
</span><span id="create_branching_mesh-306"><a href="#create_branching_mesh-306"><span class="linenos">306</span></a>    <span class="n">branch_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">branch_radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">branch_length</span>
</span><span id="create_branching_mesh-307"><a href="#create_branching_mesh-307"><span class="linenos">307</span></a>    <span class="n">total_volume</span> <span class="o">=</span> <span class="n">trunk_volume</span> <span class="o">+</span> <span class="n">num_branches</span> <span class="o">*</span> <span class="n">branch_volume</span>
</span><span id="create_branching_mesh-308"><a href="#create_branching_mesh-308"><span class="linenos">308</span></a>
</span><span id="create_branching_mesh-309"><a href="#create_branching_mesh-309"><span class="linenos">309</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;volume_theoretical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_volume</span>
</span><span id="create_branching_mesh-310"><a href="#create_branching_mesh-310"><span class="linenos">310</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;trunk_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trunk_volume</span>
</span><span id="create_branching_mesh-311"><a href="#create_branching_mesh-311"><span class="linenos">311</span></a>    <span class="n">combined</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;branch_volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">branch_volume</span>
</span><span id="create_branching_mesh-312"><a href="#create_branching_mesh-312"><span class="linenos">312</span></a>
</span><span id="create_branching_mesh-313"><a href="#create_branching_mesh-313"><span class="linenos">313</span></a>    <span class="k">return</span> <span class="n">combined</span>
</span></pre></div>


            <div class="docstring"><p>Create a branching mesh representing a dendritic or axonal tree.</p>

<p>Args:
    trunk_length: Length of main trunk (m)
    trunk_radius: Radius of main trunk (m)
    branch_length: Length of each branch (m)
    branch_radius: Radius of each branch (m)
    branch_angle: Angle of branches from trunk axis (degrees)
    num_branches: Number of branches (2 for Y-shape, more for multi-branch)
    resolution: Number of circumferential segments
    smooth_junctions: Whether to smooth branch junctions</p>

<p>Returns:
    Trimesh object with branching structure</p>
</div>


                </section>
                <section id="create_demo_neuron_mesh">
                            <input id="create_demo_neuron_mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_demo_neuron_mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">soma_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span>,</span><span class="param">	<span class="n">dendrite_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span>,</span><span class="param">	<span class="n">dendrite_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>,</span><span class="param">	<span class="n">axon_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span>,</span><span class="param">	<span class="n">axon_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span>,</span><span class="param">	<span class="n">num_dendrites</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>,</span><span class="param">	<span class="n">dendrite_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span></span><span class="return-annotation">) -> <span class="n">trimesh</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Trimesh</span>:</span></span>

                <label class="view-source-button" for="create_demo_neuron_mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#create_demo_neuron_mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="create_demo_neuron_mesh-380"><a href="#create_demo_neuron_mesh-380"><span class="linenos">380</span></a><span class="k">def</span><span class="w"> </span><span class="nf">create_demo_neuron_mesh</span><span class="p">(</span>
</span><span id="create_demo_neuron_mesh-381"><a href="#create_demo_neuron_mesh-381"><span class="linenos">381</span></a>    <span class="n">soma_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-382"><a href="#create_demo_neuron_mesh-382"><span class="linenos">382</span></a>    <span class="n">dendrite_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-383"><a href="#create_demo_neuron_mesh-383"><span class="linenos">383</span></a>    <span class="n">dendrite_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-384"><a href="#create_demo_neuron_mesh-384"><span class="linenos">384</span></a>    <span class="n">axon_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-385"><a href="#create_demo_neuron_mesh-385"><span class="linenos">385</span></a>    <span class="n">axon_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-386"><a href="#create_demo_neuron_mesh-386"><span class="linenos">386</span></a>    <span class="n">num_dendrites</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-387"><a href="#create_demo_neuron_mesh-387"><span class="linenos">387</span></a>    <span class="n">dendrite_angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">,</span>
</span><span id="create_demo_neuron_mesh-388"><a href="#create_demo_neuron_mesh-388"><span class="linenos">388</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">Trimesh</span><span class="p">:</span>
</span><span id="create_demo_neuron_mesh-389"><a href="#create_demo_neuron_mesh-389"><span class="linenos">389</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="create_demo_neuron_mesh-390"><a href="#create_demo_neuron_mesh-390"><span class="linenos">390</span></a><span class="sd">    Create a simplified neuron mesh with soma, dendrites, and axon.</span>
</span><span id="create_demo_neuron_mesh-391"><a href="#create_demo_neuron_mesh-391"><span class="linenos">391</span></a>
</span><span id="create_demo_neuron_mesh-392"><a href="#create_demo_neuron_mesh-392"><span class="linenos">392</span></a><span class="sd">    Args:</span>
</span><span id="create_demo_neuron_mesh-393"><a href="#create_demo_neuron_mesh-393"><span class="linenos">393</span></a><span class="sd">        soma_radius: Radius of soma (cell body) in m</span>
</span><span id="create_demo_neuron_mesh-394"><a href="#create_demo_neuron_mesh-394"><span class="linenos">394</span></a><span class="sd">        dendrite_length: Length of each dendrite in m</span>
</span><span id="create_demo_neuron_mesh-395"><a href="#create_demo_neuron_mesh-395"><span class="linenos">395</span></a><span class="sd">        dendrite_radius: Radius of dendrites in m</span>
</span><span id="create_demo_neuron_mesh-396"><a href="#create_demo_neuron_mesh-396"><span class="linenos">396</span></a><span class="sd">        axon_length: Length of axon in m</span>
</span><span id="create_demo_neuron_mesh-397"><a href="#create_demo_neuron_mesh-397"><span class="linenos">397</span></a><span class="sd">        axon_radius: Radius of axon in m</span>
</span><span id="create_demo_neuron_mesh-398"><a href="#create_demo_neuron_mesh-398"><span class="linenos">398</span></a><span class="sd">        num_dendrites: Number of dendrites</span>
</span><span id="create_demo_neuron_mesh-399"><a href="#create_demo_neuron_mesh-399"><span class="linenos">399</span></a><span class="sd">        dendrite_angle: Angle of dendrites from vertical (degrees)</span>
</span><span id="create_demo_neuron_mesh-400"><a href="#create_demo_neuron_mesh-400"><span class="linenos">400</span></a>
</span><span id="create_demo_neuron_mesh-401"><a href="#create_demo_neuron_mesh-401"><span class="linenos">401</span></a><span class="sd">    Returns:</span>
</span><span id="create_demo_neuron_mesh-402"><a href="#create_demo_neuron_mesh-402"><span class="linenos">402</span></a><span class="sd">        Trimesh object representing a simple neuron</span>
</span><span id="create_demo_neuron_mesh-403"><a href="#create_demo_neuron_mesh-403"><span class="linenos">403</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="create_demo_neuron_mesh-404"><a href="#create_demo_neuron_mesh-404"><span class="linenos">404</span></a>    <span class="c1"># Create soma (cell body) as sphere</span>
</span><span id="create_demo_neuron_mesh-405"><a href="#create_demo_neuron_mesh-405"><span class="linenos">405</span></a>    <span class="n">soma</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">icosphere</span><span class="p">(</span><span class="n">subdivisions</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">soma_radius</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-406"><a href="#create_demo_neuron_mesh-406"><span class="linenos">406</span></a>
</span><span id="create_demo_neuron_mesh-407"><a href="#create_demo_neuron_mesh-407"><span class="linenos">407</span></a>    <span class="c1"># Create axon extending downward</span>
</span><span id="create_demo_neuron_mesh-408"><a href="#create_demo_neuron_mesh-408"><span class="linenos">408</span></a>    <span class="n">axon</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span>
</span><span id="create_demo_neuron_mesh-409"><a href="#create_demo_neuron_mesh-409"><span class="linenos">409</span></a>        <span class="n">radius</span><span class="o">=</span><span class="n">axon_radius</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">axon_length</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="mi">12</span>
</span><span id="create_demo_neuron_mesh-410"><a href="#create_demo_neuron_mesh-410"><span class="linenos">410</span></a>    <span class="p">)</span>
</span><span id="create_demo_neuron_mesh-411"><a href="#create_demo_neuron_mesh-411"><span class="linenos">411</span></a>
</span><span id="create_demo_neuron_mesh-412"><a href="#create_demo_neuron_mesh-412"><span class="linenos">412</span></a>    <span class="c1"># Position axon extending down from soma</span>
</span><span id="create_demo_neuron_mesh-413"><a href="#create_demo_neuron_mesh-413"><span class="linenos">413</span></a>    <span class="n">axon_translation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">translation_matrix</span><span class="p">(</span>
</span><span id="create_demo_neuron_mesh-414"><a href="#create_demo_neuron_mesh-414"><span class="linenos">414</span></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">axon_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="create_demo_neuron_mesh-415"><a href="#create_demo_neuron_mesh-415"><span class="linenos">415</span></a>    <span class="p">)</span>
</span><span id="create_demo_neuron_mesh-416"><a href="#create_demo_neuron_mesh-416"><span class="linenos">416</span></a>    <span class="n">axon</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">axon_translation</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-417"><a href="#create_demo_neuron_mesh-417"><span class="linenos">417</span></a>
</span><span id="create_demo_neuron_mesh-418"><a href="#create_demo_neuron_mesh-418"><span class="linenos">418</span></a>    <span class="c1"># Create dendrites extending upward</span>
</span><span id="create_demo_neuron_mesh-419"><a href="#create_demo_neuron_mesh-419"><span class="linenos">419</span></a>    <span class="n">dendrites</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="create_demo_neuron_mesh-420"><a href="#create_demo_neuron_mesh-420"><span class="linenos">420</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dendrites</span><span class="p">):</span>
</span><span id="create_demo_neuron_mesh-421"><a href="#create_demo_neuron_mesh-421"><span class="linenos">421</span></a>        <span class="n">dendrite</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">creation</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span>
</span><span id="create_demo_neuron_mesh-422"><a href="#create_demo_neuron_mesh-422"><span class="linenos">422</span></a>            <span class="n">radius</span><span class="o">=</span><span class="n">dendrite_radius</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">dendrite_length</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="mi">8</span>
</span><span id="create_demo_neuron_mesh-423"><a href="#create_demo_neuron_mesh-423"><span class="linenos">423</span></a>        <span class="p">)</span>
</span><span id="create_demo_neuron_mesh-424"><a href="#create_demo_neuron_mesh-424"><span class="linenos">424</span></a>
</span><span id="create_demo_neuron_mesh-425"><a href="#create_demo_neuron_mesh-425"><span class="linenos">425</span></a>        <span class="c1"># Calculate rotation for this dendrite</span>
</span><span id="create_demo_neuron_mesh-426"><a href="#create_demo_neuron_mesh-426"><span class="linenos">426</span></a>        <span class="n">azimuth_angle</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_dendrites</span>
</span><span id="create_demo_neuron_mesh-427"><a href="#create_demo_neuron_mesh-427"><span class="linenos">427</span></a>        <span class="n">tilt_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">dendrite_angle</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-428"><a href="#create_demo_neuron_mesh-428"><span class="linenos">428</span></a>
</span><span id="create_demo_neuron_mesh-429"><a href="#create_demo_neuron_mesh-429"><span class="linenos">429</span></a>        <span class="c1"># Step 1: Rotate dendrite around its center to desired angle</span>
</span><span id="create_demo_neuron_mesh-430"><a href="#create_demo_neuron_mesh-430"><span class="linenos">430</span></a>        <span class="c1"># Rotate around axis perpendicular to both z-axis and the desired dendrite direction</span>
</span><span id="create_demo_neuron_mesh-431"><a href="#create_demo_neuron_mesh-431"><span class="linenos">431</span></a>        <span class="n">rotation_axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuth_angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">azimuth_angle</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="create_demo_neuron_mesh-432"><a href="#create_demo_neuron_mesh-432"><span class="linenos">432</span></a>        <span class="n">rotation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">rotation_matrix</span><span class="p">(</span><span class="n">tilt_angle</span><span class="p">,</span> <span class="n">rotation_axis</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-433"><a href="#create_demo_neuron_mesh-433"><span class="linenos">433</span></a>        <span class="n">dendrite</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-434"><a href="#create_demo_neuron_mesh-434"><span class="linenos">434</span></a>
</span><span id="create_demo_neuron_mesh-435"><a href="#create_demo_neuron_mesh-435"><span class="linenos">435</span></a>        <span class="c1"># Step 2: Calculate where the bottom of the rotated dendrite is now</span>
</span><span id="create_demo_neuron_mesh-436"><a href="#create_demo_neuron_mesh-436"><span class="linenos">436</span></a>        <span class="c1"># The original bottom was at [0, 0, -dendrite_length/2]</span>
</span><span id="create_demo_neuron_mesh-437"><a href="#create_demo_neuron_mesh-437"><span class="linenos">437</span></a>        <span class="n">original_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="create_demo_neuron_mesh-438"><a href="#create_demo_neuron_mesh-438"><span class="linenos">438</span></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">dendrite_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="create_demo_neuron_mesh-439"><a href="#create_demo_neuron_mesh-439"><span class="linenos">439</span></a>        <span class="p">)</span>  <span class="c1"># homogeneous coordinates</span>
</span><span id="create_demo_neuron_mesh-440"><a href="#create_demo_neuron_mesh-440"><span class="linenos">440</span></a>        <span class="n">rotated_bottom</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">@</span> <span class="n">original_bottom</span>
</span><span id="create_demo_neuron_mesh-441"><a href="#create_demo_neuron_mesh-441"><span class="linenos">441</span></a>
</span><span id="create_demo_neuron_mesh-442"><a href="#create_demo_neuron_mesh-442"><span class="linenos">442</span></a>        <span class="c1"># Step 3: Translate so the bottom of the dendrite is at soma surface</span>
</span><span id="create_demo_neuron_mesh-443"><a href="#create_demo_neuron_mesh-443"><span class="linenos">443</span></a>        <span class="c1"># We want rotated_bottom to be at soma surface in the direction of the dendrite</span>
</span><span id="create_demo_neuron_mesh-444"><a href="#create_demo_neuron_mesh-444"><span class="linenos">444</span></a>        <span class="n">dendrite_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="create_demo_neuron_mesh-445"><a href="#create_demo_neuron_mesh-445"><span class="linenos">445</span></a>            <span class="p">[</span>
</span><span id="create_demo_neuron_mesh-446"><a href="#create_demo_neuron_mesh-446"><span class="linenos">446</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuth_angle</span><span class="p">),</span>
</span><span id="create_demo_neuron_mesh-447"><a href="#create_demo_neuron_mesh-447"><span class="linenos">447</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">azimuth_angle</span><span class="p">),</span>
</span><span id="create_demo_neuron_mesh-448"><a href="#create_demo_neuron_mesh-448"><span class="linenos">448</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tilt_angle</span><span class="p">),</span>
</span><span id="create_demo_neuron_mesh-449"><a href="#create_demo_neuron_mesh-449"><span class="linenos">449</span></a>            <span class="p">]</span>
</span><span id="create_demo_neuron_mesh-450"><a href="#create_demo_neuron_mesh-450"><span class="linenos">450</span></a>        <span class="p">)</span>
</span><span id="create_demo_neuron_mesh-451"><a href="#create_demo_neuron_mesh-451"><span class="linenos">451</span></a>        <span class="n">target_bottom</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="create_demo_neuron_mesh-452"><a href="#create_demo_neuron_mesh-452"><span class="linenos">452</span></a>            <span class="n">dendrite_direction</span> <span class="o">*</span> <span class="n">soma_radius</span> <span class="o">*</span> <span class="mf">0.8</span>
</span><span id="create_demo_neuron_mesh-453"><a href="#create_demo_neuron_mesh-453"><span class="linenos">453</span></a>        <span class="p">)</span>  <span class="c1"># Point on soma surface. included a factor to ensure proper overlap</span>
</span><span id="create_demo_neuron_mesh-454"><a href="#create_demo_neuron_mesh-454"><span class="linenos">454</span></a>        <span class="n">translation_vector</span> <span class="o">=</span> <span class="n">target_bottom</span> <span class="o">-</span> <span class="n">rotated_bottom</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="create_demo_neuron_mesh-455"><a href="#create_demo_neuron_mesh-455"><span class="linenos">455</span></a>        <span class="n">translation</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">transformations</span><span class="o">.</span><span class="n">translation_matrix</span><span class="p">(</span><span class="n">translation_vector</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-456"><a href="#create_demo_neuron_mesh-456"><span class="linenos">456</span></a>        <span class="n">dendrite</span><span class="o">.</span><span class="n">apply_transform</span><span class="p">(</span><span class="n">translation</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-457"><a href="#create_demo_neuron_mesh-457"><span class="linenos">457</span></a>
</span><span id="create_demo_neuron_mesh-458"><a href="#create_demo_neuron_mesh-458"><span class="linenos">458</span></a>        <span class="n">dendrites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dendrite</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-459"><a href="#create_demo_neuron_mesh-459"><span class="linenos">459</span></a>
</span><span id="create_demo_neuron_mesh-460"><a href="#create_demo_neuron_mesh-460"><span class="linenos">460</span></a>    <span class="c1"># Ensure all components are watertight before union</span>
</span><span id="create_demo_neuron_mesh-461"><a href="#create_demo_neuron_mesh-461"><span class="linenos">461</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">soma</span><span class="p">,</span> <span class="n">axon</span><span class="p">]</span> <span class="o">+</span> <span class="n">dendrites</span><span class="p">):</span>
</span><span id="create_demo_neuron_mesh-462"><a href="#create_demo_neuron_mesh-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">component</span><span class="o">.</span><span class="n">is_watertight</span><span class="p">:</span>
</span><span id="create_demo_neuron_mesh-463"><a href="#create_demo_neuron_mesh-463"><span class="linenos">463</span></a>            <span class="n">component</span><span class="o">.</span><span class="n">fill_holes</span><span class="p">()</span>
</span><span id="create_demo_neuron_mesh-464"><a href="#create_demo_neuron_mesh-464"><span class="linenos">464</span></a>
</span><span id="create_demo_neuron_mesh-465"><a href="#create_demo_neuron_mesh-465"><span class="linenos">465</span></a>    <span class="c1"># Combine using boolean union operations for clean exterior surface</span>
</span><span id="create_demo_neuron_mesh-466"><a href="#create_demo_neuron_mesh-466"><span class="linenos">466</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="create_demo_neuron_mesh-467"><a href="#create_demo_neuron_mesh-467"><span class="linenos">467</span></a>        <span class="c1"># Start with soma and progressively add components</span>
</span><span id="create_demo_neuron_mesh-468"><a href="#create_demo_neuron_mesh-468"><span class="linenos">468</span></a>        <span class="n">neuron</span> <span class="o">=</span> <span class="n">soma</span>
</span><span id="create_demo_neuron_mesh-469"><a href="#create_demo_neuron_mesh-469"><span class="linenos">469</span></a>        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="p">[</span><span class="n">axon</span><span class="p">]</span> <span class="o">+</span> <span class="n">dendrites</span><span class="p">:</span>
</span><span id="create_demo_neuron_mesh-470"><a href="#create_demo_neuron_mesh-470"><span class="linenos">470</span></a>            <span class="n">neuron</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">boolean</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">neuron</span><span class="p">,</span> <span class="n">component</span><span class="p">])</span>
</span><span id="create_demo_neuron_mesh-471"><a href="#create_demo_neuron_mesh-471"><span class="linenos">471</span></a>            <span class="k">if</span> <span class="n">neuron</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">neuron</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="create_demo_neuron_mesh-472"><a href="#create_demo_neuron_mesh-472"><span class="linenos">472</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Boolean union resulted in empty mesh&quot;</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-473"><a href="#create_demo_neuron_mesh-473"><span class="linenos">473</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="create_demo_neuron_mesh-474"><a href="#create_demo_neuron_mesh-474"><span class="linenos">474</span></a>        <span class="c1"># If union fails, fall back to concatenation</span>
</span><span id="create_demo_neuron_mesh-475"><a href="#create_demo_neuron_mesh-475"><span class="linenos">475</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Boolean union failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using concatenation&quot;</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-476"><a href="#create_demo_neuron_mesh-476"><span class="linenos">476</span></a>        <span class="n">all_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">soma</span><span class="p">,</span> <span class="n">axon</span><span class="p">]</span> <span class="o">+</span> <span class="n">dendrites</span>
</span><span id="create_demo_neuron_mesh-477"><a href="#create_demo_neuron_mesh-477"><span class="linenos">477</span></a>        <span class="n">neuron</span> <span class="o">=</span> <span class="n">trimesh</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_components</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-478"><a href="#create_demo_neuron_mesh-478"><span class="linenos">478</span></a>
</span><span id="create_demo_neuron_mesh-479"><a href="#create_demo_neuron_mesh-479"><span class="linenos">479</span></a>    <span class="c1"># Light cleanup to remove any duplicate faces from concatenation fallback</span>
</span><span id="create_demo_neuron_mesh-480"><a href="#create_demo_neuron_mesh-480"><span class="linenos">480</span></a>    <span class="n">neuron</span> <span class="o">=</span> <span class="n">_clean_exterior_mesh</span><span class="p">(</span><span class="n">neuron</span><span class="p">)</span>
</span><span id="create_demo_neuron_mesh-481"><a href="#create_demo_neuron_mesh-481"><span class="linenos">481</span></a>
</span><span id="create_demo_neuron_mesh-482"><a href="#create_demo_neuron_mesh-482"><span class="linenos">482</span></a>    <span class="c1"># Add metadata</span>
</span><span id="create_demo_neuron_mesh-483"><a href="#create_demo_neuron_mesh-483"><span class="linenos">483</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;morphology_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;neuron&quot;</span>
</span><span id="create_demo_neuron_mesh-484"><a href="#create_demo_neuron_mesh-484"><span class="linenos">484</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;soma_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">soma_radius</span>
</span><span id="create_demo_neuron_mesh-485"><a href="#create_demo_neuron_mesh-485"><span class="linenos">485</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;dendrite_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dendrite_length</span>
</span><span id="create_demo_neuron_mesh-486"><a href="#create_demo_neuron_mesh-486"><span class="linenos">486</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;dendrite_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dendrite_radius</span>
</span><span id="create_demo_neuron_mesh-487"><a href="#create_demo_neuron_mesh-487"><span class="linenos">487</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;axon_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axon_length</span>
</span><span id="create_demo_neuron_mesh-488"><a href="#create_demo_neuron_mesh-488"><span class="linenos">488</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;axon_radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axon_radius</span>
</span><span id="create_demo_neuron_mesh-489"><a href="#create_demo_neuron_mesh-489"><span class="linenos">489</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;num_dendrites&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_dendrites</span>
</span><span id="create_demo_neuron_mesh-490"><a href="#create_demo_neuron_mesh-490"><span class="linenos">490</span></a>    <span class="n">neuron</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;dendrite_angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dendrite_angle</span>
</span><span id="create_demo_neuron_mesh-491"><a href="#create_demo_neuron_mesh-491"><span class="linenos">491</span></a>
</span><span id="create_demo_neuron_mesh-492"><a href="#create_demo_neuron_mesh-492"><span class="linenos">492</span></a>    <span class="k">return</span> <span class="n">neuron</span>
</span></pre></div>


            <div class="docstring"><p>Create a simplified neuron mesh with soma, dendrites, and axon.</p>

<p>Args:
    soma_radius: Radius of soma (cell body) in m
    dendrite_length: Length of each dendrite in m
    dendrite_radius: Radius of dendrites in m
    axon_length: Length of axon in m
    axon_radius: Radius of axon in m
    num_dendrites: Number of dendrites
    dendrite_angle: Angle of dendrites from vertical (degrees)</p>

<p>Returns:
    Trimesh object representing a simple neuron</p>
</div>


                </section>
                <section id="save_demo_meshes">
                            <input id="save_demo_meshes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_demo_meshes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;data/mesh&#39;</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="save_demo_meshes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#save_demo_meshes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="save_demo_meshes-316"><a href="#save_demo_meshes-316"><span class="linenos">316</span></a><span class="k">def</span><span class="w"> </span><span class="nf">save_demo_meshes</span><span class="p">(</span><span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;data/mesh&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="save_demo_meshes-317"><a href="#save_demo_meshes-317"><span class="linenos">317</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="save_demo_meshes-318"><a href="#save_demo_meshes-318"><span class="linenos">318</span></a><span class="sd">    Generate and save example meshes to files.</span>
</span><span id="save_demo_meshes-319"><a href="#save_demo_meshes-319"><span class="linenos">319</span></a>
</span><span id="save_demo_meshes-320"><a href="#save_demo_meshes-320"><span class="linenos">320</span></a><span class="sd">    Args:</span>
</span><span id="save_demo_meshes-321"><a href="#save_demo_meshes-321"><span class="linenos">321</span></a><span class="sd">        output_dir: Directory to save mesh files</span>
</span><span id="save_demo_meshes-322"><a href="#save_demo_meshes-322"><span class="linenos">322</span></a>
</span><span id="save_demo_meshes-323"><a href="#save_demo_meshes-323"><span class="linenos">323</span></a><span class="sd">    Returns:</span>
</span><span id="save_demo_meshes-324"><a href="#save_demo_meshes-324"><span class="linenos">324</span></a><span class="sd">        Dictionary mapping mesh names to file paths</span>
</span><span id="save_demo_meshes-325"><a href="#save_demo_meshes-325"><span class="linenos">325</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="save_demo_meshes-326"><a href="#save_demo_meshes-326"><span class="linenos">326</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="save_demo_meshes-327"><a href="#save_demo_meshes-327"><span class="linenos">327</span></a>
</span><span id="save_demo_meshes-328"><a href="#save_demo_meshes-328"><span class="linenos">328</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="save_demo_meshes-329"><a href="#save_demo_meshes-329"><span class="linenos">329</span></a>
</span><span id="save_demo_meshes-330"><a href="#save_demo_meshes-330"><span class="linenos">330</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating demo meshes...&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-331"><a href="#save_demo_meshes-331"><span class="linenos">331</span></a>
</span><span id="save_demo_meshes-332"><a href="#save_demo_meshes-332"><span class="linenos">332</span></a>    <span class="c1"># Create cylinder mesh</span>
</span><span id="save_demo_meshes-333"><a href="#save_demo_meshes-333"><span class="linenos">333</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Creating cylinder mesh...&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-334"><a href="#save_demo_meshes-334"><span class="linenos">334</span></a>    <span class="n">cylinder</span> <span class="o">=</span> <span class="n">create_cylinder_mesh</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="save_demo_meshes-335"><a href="#save_demo_meshes-335"><span class="linenos">335</span></a>    <span class="n">cylinder_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;cylinder.stl&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-336"><a href="#save_demo_meshes-336"><span class="linenos">336</span></a>    <span class="n">cylinder</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">cylinder_path</span><span class="p">)</span>
</span><span id="save_demo_meshes-337"><a href="#save_demo_meshes-337"><span class="linenos">337</span></a>
</span><span id="save_demo_meshes-338"><a href="#save_demo_meshes-338"><span class="linenos">338</span></a>    <span class="c1"># Create torus mesh</span>
</span><span id="save_demo_meshes-339"><a href="#save_demo_meshes-339"><span class="linenos">339</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Creating torus mesh...&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-340"><a href="#save_demo_meshes-340"><span class="linenos">340</span></a>    <span class="n">torus</span> <span class="o">=</span> <span class="n">create_torus_mesh</span><span class="p">(</span><span class="n">major_radius</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">minor_radius</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
</span><span id="save_demo_meshes-341"><a href="#save_demo_meshes-341"><span class="linenos">341</span></a>    <span class="n">torus_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;torus.stl&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-342"><a href="#save_demo_meshes-342"><span class="linenos">342</span></a>    <span class="n">torus</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">torus_path</span><span class="p">)</span>
</span><span id="save_demo_meshes-343"><a href="#save_demo_meshes-343"><span class="linenos">343</span></a>
</span><span id="save_demo_meshes-344"><a href="#save_demo_meshes-344"><span class="linenos">344</span></a>    <span class="c1"># Create Y-branching mesh</span>
</span><span id="save_demo_meshes-345"><a href="#save_demo_meshes-345"><span class="linenos">345</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Creating Y-branching mesh...&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-346"><a href="#save_demo_meshes-346"><span class="linenos">346</span></a>    <span class="n">y_branch</span> <span class="o">=</span> <span class="n">create_branching_mesh</span><span class="p">(</span>
</span><span id="save_demo_meshes-347"><a href="#save_demo_meshes-347"><span class="linenos">347</span></a>        <span class="n">trunk_length</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-348"><a href="#save_demo_meshes-348"><span class="linenos">348</span></a>        <span class="n">trunk_radius</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-349"><a href="#save_demo_meshes-349"><span class="linenos">349</span></a>        <span class="n">branch_length</span><span class="o">=</span><span class="mf">40.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-350"><a href="#save_demo_meshes-350"><span class="linenos">350</span></a>        <span class="n">branch_radius</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-351"><a href="#save_demo_meshes-351"><span class="linenos">351</span></a>        <span class="n">branch_angle</span><span class="o">=</span><span class="mf">45.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-352"><a href="#save_demo_meshes-352"><span class="linenos">352</span></a>        <span class="n">num_branches</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="save_demo_meshes-353"><a href="#save_demo_meshes-353"><span class="linenos">353</span></a>    <span class="p">)</span>
</span><span id="save_demo_meshes-354"><a href="#save_demo_meshes-354"><span class="linenos">354</span></a>    <span class="n">y_branch_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;y_branch.stl&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-355"><a href="#save_demo_meshes-355"><span class="linenos">355</span></a>    <span class="n">y_branch</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">y_branch_path</span><span class="p">)</span>
</span><span id="save_demo_meshes-356"><a href="#save_demo_meshes-356"><span class="linenos">356</span></a>
</span><span id="save_demo_meshes-357"><a href="#save_demo_meshes-357"><span class="linenos">357</span></a>    <span class="c1"># Create multi-branching mesh</span>
</span><span id="save_demo_meshes-358"><a href="#save_demo_meshes-358"><span class="linenos">358</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Creating multi-branching mesh...&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-359"><a href="#save_demo_meshes-359"><span class="linenos">359</span></a>    <span class="n">multi_branch</span> <span class="o">=</span> <span class="n">create_branching_mesh</span><span class="p">(</span>
</span><span id="save_demo_meshes-360"><a href="#save_demo_meshes-360"><span class="linenos">360</span></a>        <span class="n">trunk_length</span><span class="o">=</span><span class="mf">80.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-361"><a href="#save_demo_meshes-361"><span class="linenos">361</span></a>        <span class="n">trunk_radius</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-362"><a href="#save_demo_meshes-362"><span class="linenos">362</span></a>        <span class="n">branch_length</span><span class="o">=</span><span class="mf">35.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-363"><a href="#save_demo_meshes-363"><span class="linenos">363</span></a>        <span class="n">branch_radius</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span>
</span><span id="save_demo_meshes-364"><a href="#save_demo_meshes-364"><span class="linenos">364</span></a>        <span class="n">branch_angle</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span id="save_demo_meshes-365"><a href="#save_demo_meshes-365"><span class="linenos">365</span></a>        <span class="n">num_branches</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span id="save_demo_meshes-366"><a href="#save_demo_meshes-366"><span class="linenos">366</span></a>    <span class="p">)</span>
</span><span id="save_demo_meshes-367"><a href="#save_demo_meshes-367"><span class="linenos">367</span></a>    <span class="n">multi_branch_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;multi_branch.stl&quot;</span><span class="p">)</span>
</span><span id="save_demo_meshes-368"><a href="#save_demo_meshes-368"><span class="linenos">368</span></a>    <span class="n">multi_branch</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">multi_branch_path</span><span class="p">)</span>
</span><span id="save_demo_meshes-369"><a href="#save_demo_meshes-369"><span class="linenos">369</span></a>
</span><span id="save_demo_meshes-370"><a href="#save_demo_meshes-370"><span class="linenos">370</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Demo meshes saved to </span><span class="si">%s</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>
</span><span id="save_demo_meshes-371"><a href="#save_demo_meshes-371"><span class="linenos">371</span></a>
</span><span id="save_demo_meshes-372"><a href="#save_demo_meshes-372"><span class="linenos">372</span></a>    <span class="k">return</span> <span class="p">{</span>
</span><span id="save_demo_meshes-373"><a href="#save_demo_meshes-373"><span class="linenos">373</span></a>        <span class="s2">&quot;cylinder&quot;</span><span class="p">:</span> <span class="n">cylinder_path</span><span class="p">,</span>
</span><span id="save_demo_meshes-374"><a href="#save_demo_meshes-374"><span class="linenos">374</span></a>        <span class="s2">&quot;torus&quot;</span><span class="p">:</span> <span class="n">torus_path</span><span class="p">,</span>
</span><span id="save_demo_meshes-375"><a href="#save_demo_meshes-375"><span class="linenos">375</span></a>        <span class="s2">&quot;y_branch&quot;</span><span class="p">:</span> <span class="n">y_branch_path</span><span class="p">,</span>
</span><span id="save_demo_meshes-376"><a href="#save_demo_meshes-376"><span class="linenos">376</span></a>        <span class="s2">&quot;multi_branch&quot;</span><span class="p">:</span> <span class="n">multi_branch_path</span><span class="p">,</span>
</span><span id="save_demo_meshes-377"><a href="#save_demo_meshes-377"><span class="linenos">377</span></a>    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Generate and save example meshes to files.</p>

<p>Args:
    output_dir: Directory to save mesh files</p>

<p>Returns:
    Dictionary mapping mesh names to file paths</p>
</div>


                </section>
                <section id="data_path">
                            <input id="data_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">data_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>:</span></span>

                <label class="view-source-button" for="data_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#data_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="data_path-25"><a href="#data_path-25"><span class="linenos">25</span></a><span class="k">def</span><span class="w"> </span><span class="nf">data_path</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="data_path-26"><a href="#data_path-26"><span class="linenos">26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="data_path-27"><a href="#data_path-27"><span class="linenos">27</span></a><span class="sd">    Return the full path of the specified data file from the project data directory using pathlib.</span>
</span><span id="data_path-28"><a href="#data_path-28"><span class="linenos">28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="data_path-29"><a href="#data_path-29"><span class="linenos">29</span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">project_root</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="n">filename</span>
</span><span id="data_path-30"><a href="#data_path-30"><span class="linenos">30</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Data path for &#39;</span><span class="si">%s</span><span class="s2">&#39; -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span><span id="data_path-31"><a href="#data_path-31"><span class="linenos">31</span></a>    <span class="k">return</span> <span class="n">p</span>
</span></pre></div>


            <div class="docstring"><p>Return the full path of the specified data file from the project data directory using pathlib.</p>
</div>


                </section>
    </main>
</body>
</html>